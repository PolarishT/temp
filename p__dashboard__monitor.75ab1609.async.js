(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7567],{90829:function(Ue,W,R){"use strict";var Y=R(67294),$=R(36428),v=R(23185),ee=R(4322),F=R(24770),Q=R(89182),re=function(ne,je){var Ce={};for(var et in ne)Object.prototype.hasOwnProperty.call(ne,et)&&je.indexOf(et)<0&&(Ce[et]=ne[et]);if(ne!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Pt=0,et=Object.getOwnPropertySymbols(ne);Pt<et.length;Pt++)je.indexOf(et[Pt])<0&&Object.prototype.propertyIsEnumerable.call(ne,et[Pt])&&(Ce[et[Pt]]=ne[et[Pt]]);return Ce},Ee=(0,Y.forwardRef)(function(ne,je){var Ce=ne.chartRef,et=ne.style,Pt=et===void 0?{height:"inherit"}:et,nr=ne.className,xt=ne.loading,Wt=ne.loadingTemplate,wt=ne.errorTemplate,st=re(ne,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),ut=(0,v.Z)($.TZ,st),Jt=ut.chart,X=ut.container;return(0,Y.useEffect)(function(){(0,ee.J)(Ce,Jt.current)},[Jt.current]),(0,Y.useImperativeHandle)(je,function(){return{getChart:function(){return Jt.current}}}),Y.createElement(F.Z,{errorTemplate:wt},xt&&Y.createElement(Q.Z,{loadingTemplate:Wt}),Y.createElement("div",{className:nr,style:Pt,ref:X}))});W.Z=Ee},93343:function(Ue,W,R){"use strict";var Y=R(67294),$=R(36428),v=R(23185),ee=R(4322),F=R(24770),Q=R(89182),re=function(ne,je){var Ce={};for(var et in ne)Object.prototype.hasOwnProperty.call(ne,et)&&je.indexOf(et)<0&&(Ce[et]=ne[et]);if(ne!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Pt=0,et=Object.getOwnPropertySymbols(ne);Pt<et.length;Pt++)je.indexOf(et[Pt])<0&&Object.prototype.propertyIsEnumerable.call(ne,et[Pt])&&(Ce[et[Pt]]=ne[et[Pt]]);return Ce},Ee=(0,Y.forwardRef)(function(ne,je){var Ce=ne.chartRef,et=ne.style,Pt=et===void 0?{height:"inherit"}:et,nr=ne.className,xt=ne.loading,Wt=ne.loadingTemplate,wt=ne.errorTemplate,st=re(ne,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),ut=(0,v.Z)($.m,st),Jt=ut.chart,X=ut.container;return(0,Y.useEffect)(function(){(0,ee.J)(Ce,Jt.current)},[Jt.current]),(0,Y.useImperativeHandle)(je,function(){return{getChart:function(){return Jt.current}}}),Y.createElement(F.Z,{errorTemplate:wt},xt&&Y.createElement(Q.Z,{loadingTemplate:Wt}),Y.createElement("div",{className:nr,style:Pt,ref:X}))});W.Z=Ee},64335:function(Ue,W,R){"use strict";var Y=R(67294),$=(0,Y.createContext)({});W.Z=$},21349:function(Ue,W,R){"use strict";var Y=R(84305),$=R(39559),v=R(53645),ee=R.n(v),F=R(67294),Q=R(94184),re=R.n(Q),Ee=R(64335),ne=function(Ce){var et=(0,F.useContext)(Ee.Z),Pt=Ce.children,nr=Ce.contentWidth,xt=Ce.className,Wt=Ce.style,wt=(0,F.useContext)($.ZP.ConfigContext),st=wt.getPrefixCls,ut=Ce.prefixCls||st("pro"),Jt=nr||et.contentWidth,X="".concat(ut,"-grid-content");return F.createElement("div",{className:re()(X,xt,{wide:Jt==="Fixed"}),style:Wt},F.createElement("div",{className:"".concat(ut,"-grid-content-children")},Pt))};W.Z=ne},66213:function(Ue,W,R){"use strict";R.d(W,{Z:function(){return v}});var Y=R(77608);function $(ee,F){for(;!Object.prototype.hasOwnProperty.call(ee,F)&&(ee=(0,Y.Z)(ee),ee!==null););return ee}function v(){return typeof Reflect!="undefined"&&Reflect.get?v=Reflect.get:v=function(F,Q,re){var Ee=$(F,Q);if(!!Ee){var ne=Object.getOwnPropertyDescriptor(Ee,Q);return ne.get?ne.get.call(arguments.length<3?F:re):ne.value}},v.apply(this,arguments)}},31795:function(Ue,W,R){var Y=R(75752);Ue.exports.geometry=$,Ue.exports.ring=ee;function $(Q){var re=0,Ee;switch(Q.type){case"Polygon":return v(Q.coordinates);case"MultiPolygon":for(Ee=0;Ee<Q.coordinates.length;Ee++)re+=v(Q.coordinates[Ee]);return re;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Ee=0;Ee<Q.geometries.length;Ee++)re+=$(Q.geometries[Ee]);return re}}function v(Q){var re=0;if(Q&&Q.length>0){re+=Math.abs(ee(Q[0]));for(var Ee=1;Ee<Q.length;Ee++)re-=Math.abs(ee(Q[Ee]))}return re}function ee(Q){var re,Ee,ne,je,Ce,et,Pt,nr=0,xt=Q.length;if(xt>2){for(Pt=0;Pt<xt;Pt++)Pt===xt-2?(je=xt-2,Ce=xt-1,et=0):Pt===xt-1?(je=xt-1,Ce=0,et=1):(je=Pt,Ce=Pt+1,et=Pt+2),re=Q[je],Ee=Q[Ce],ne=Q[et],nr+=(F(ne[0])-F(re[0]))*Math.sin(F(Ee[1]));nr=nr*Y.RADIUS*Y.RADIUS/2}return nr}function F(Q){return Q*Math.PI/180}},38163:function(Ue,W,R){var Y=R(31795);Ue.exports=$;function $(Ee,ne){switch(Ee&&Ee.type||null){case"FeatureCollection":return Ee.features=Ee.features.map(v($,ne)),Ee;case"GeometryCollection":return Ee.geometries=Ee.geometries.map(v($,ne)),Ee;case"Feature":return Ee.geometry=$(Ee.geometry,ne),Ee;case"Polygon":case"MultiPolygon":return ee(Ee,ne);default:return Ee}}function v(Ee,ne){return function(je){return Ee(je,ne)}}function ee(Ee,ne){return Ee.type==="Polygon"?Ee.coordinates=F(Ee.coordinates,ne):Ee.type==="MultiPolygon"&&(Ee.coordinates=Ee.coordinates.map(v(F,ne))),Ee}function F(Ee,ne){ne=!!ne,Ee[0]=Q(Ee[0],ne);for(var je=1;je<Ee.length;je++)Ee[je]=Q(Ee[je],!ne);return Ee}function Q(Ee,ne){return re(Ee)===ne?Ee:Ee.reverse()}function re(Ee){return Y.ring(Ee)>=0}},70499:function(Ue){Ue.exports={activeChart:"activeChart___15gpK",activeChartGrid:"activeChartGrid___3PL4c",activeChartLegend:"activeChartLegend___2Ieyc",dashedLine:"dashedLine___2fgZX",line:"line___2cxqk"}},19134:function(Ue){Ue.exports={mapChart:"mapChart___4fQJB",pieCard:"pieCard___1ETZj"}},53645:function(){},28452:function(Ue,W,R){"use strict";R.r(W),R.d(W,{default:function(){return DP}});var Y={};R.r(Y),R.d(Y,{add:function(){return ps},adjoint:function(){return Rr},clone:function(){return sr},copy:function(){return Rt},create:function(){return Mt},determinant:function(){return Hr},equals:function(){return jo},exactEquals:function(){return ra},frob:function(){return Uo},fromQuat:function(){return an},fromQuat2:function(){return Tr},fromRotation:function(){return Fn},fromRotationTranslation:function(){return Xr},fromRotationTranslationScale:function(){return ri},fromRotationTranslationScaleOrigin:function(){return Kr},fromScaling:function(){return en},fromTranslation:function(){return kr},fromValues:function(){return er},fromXRotation:function(){return tr},fromYRotation:function(){return ar},fromZRotation:function(){return Sn},frustum:function(){return Kn},getRotation:function(){return mi},getScaling:function(){return Qr},getTranslation:function(){return Jr},identity:function(){return br},invert:function(){return Mr},lookAt:function(){return $o},mul:function(){return ti},multiply:function(){return vr},multiplyScalar:function(){return gi},multiplyScalarAndAdd:function(){return Zo},ortho:function(){return ns},orthoNO:function(){return ki},orthoZO:function(){return qa},perspective:function(){return Fi},perspectiveFromFieldOfView:function(){return po},perspectiveNO:function(){return ui},perspectiveZO:function(){return so},rotate:function(){return Gt},rotateX:function(){return Sr},rotateY:function(){return Ur},rotateZ:function(){return fr},scale:function(){return at},set:function(){return pr},str:function(){return Jo},sub:function(){return Bi},subtract:function(){return uo},targetTo:function(){return Mo},translate:function(){return Ar},transpose:function(){return wr}});var $=R(58024),v=R(39144),ee=R(13062),F=R(71230),Q=R(89032),re=R(15746),Ee=R(95300),ne=R(7277),je=R(21010),Ce=R(67294),et=R(36428),Pt=R(23185),nr=R(4322),xt=R(24770),Wt=R(89182),wt=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)i.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r},st=(0,Ce.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,o=n===void 0?{height:"inherit"}:n,s=e.className,p=e.loading,y=e.loadingTemplate,_=e.errorTemplate,E=wt(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),T=(0,Pt.Z)(et.aC,E),P=T.chart,D=T.container;return(0,Ce.useEffect)(function(){(0,nr.J)(r,P.current)},[P.current]),(0,Ce.useImperativeHandle)(i,function(){return{getChart:function(){return P.current}}}),Ce.createElement(xt.Z,{errorTemplate:_},p&&Ce.createElement(Wt.Z,{loadingTemplate:y}),Ce.createElement("div",{className:s,style:o,ref:D}))}),ut=st,Jt=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)i.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r},X=(0,Ce.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,o=n===void 0?{height:"inherit"}:n,s=e.className,p=e.loading,y=e.loadingTemplate,_=e.errorTemplate,E=Jt(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),T=(0,Pt.Z)(et.kB,E),P=T.chart,D=T.container;return(0,Ce.useEffect)(function(){(0,nr.J)(r,P.current)},[P.current]),(0,Ce.useImperativeHandle)(i,function(){return{getChart:function(){return P.current}}}),Ce.createElement(xt.Z,{errorTemplate:_},p&&Ce.createElement(Wt.Z,{loadingTemplate:y}),Ce.createElement("div",{className:s,style:o,ref:D}))}),Xt=X,vt=function(e,i){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&i.indexOf(n)<0&&(r[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)i.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]]);return r},qe=(0,Ce.forwardRef)(function(e,i){var r=e.chartRef,n=e.style,o=n===void 0?{height:"inherit"}:n,s=e.className,p=e.loading,y=e.loadingTemplate,_=e.errorTemplate,E=vt(e,["chartRef","style","className","loading","loadingTemplate","errorTemplate"]),T=(0,Pt.Z)(et.Kj,E),P=T.chart,D=T.container;return(0,Ce.useEffect)(function(){(0,nr.J)(r,P.current)},[P.current]),(0,Ce.useImperativeHandle)(i,function(){return{getChart:function(){return P.current}}}),Ce.createElement(xt.Z,{errorTemplate:_},p&&Ce.createElement(Wt.Z,{loadingTemplate:y}),Ce.createElement("div",{className:s,style:o,ref:D}))}),pt=qe,$e=R(90829),kt=R(21349),xr=R(92077),Ir=R.n(xr),Wr=R(2824),Me=R(3182),Ye=R(69610),Fe=R(54941),At=R(81306),gt=R(19809),Nt=R(94043),qt=R.n(Nt),Cr=(0,Ce.createContext)({});function Wn(){return(0,Ce.useContext)(Cr)}var hn={},Yi={},Un=function(i){return Yi[i]},Gn=function(i,r){Yi[i]=r},di=function(i){return hn[i]},Xn=function(i,r){hn[i]=r},ai={},aa={},Ri=34,Ei=10,ji=13;function ua(e){return new Function("d","return {"+e.map(function(i,r){return JSON.stringify(i)+": d["+r+'] || ""'}).join(",")+"}")}function Si(e,i){var r=ua(e);return function(n,o){return i(r(n),o,e)}}function ba(e){var i=Object.create(null),r=[];return e.forEach(function(n){for(var o in n)o in i||r.push(i[o]=o)}),r}function Mn(e,i){var r=e+"",n=r.length;return n<i?new Array(i-n+1).join(0)+r:r}function _i(e){return e<0?"-"+Mn(-e,6):e>9999?"+"+Mn(e,6):Mn(e,4)}function Ui(e){var i=e.getUTCHours(),r=e.getUTCMinutes(),n=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":_i(e.getUTCFullYear(),4)+"-"+Mn(e.getUTCMonth()+1,2)+"-"+Mn(e.getUTCDate(),2)+(o?"T"+Mn(i,2)+":"+Mn(r,2)+":"+Mn(n,2)+"."+Mn(o,3)+"Z":n?"T"+Mn(i,2)+":"+Mn(r,2)+":"+Mn(n,2)+"Z":r||i?"T"+Mn(i,2)+":"+Mn(r,2)+"Z":"")}function qi(e){var i=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function n(P,D){var z,J,oe=o(P,function(he,De){if(z)return z(he,De-1);J=he,z=D?Si(he,D):ua(he)});return oe.columns=J||[],oe}function o(P,D){var z=[],J=P.length,oe=0,he=0,De,it=J<=0,ht=!1;P.charCodeAt(J-1)===Ei&&--J,P.charCodeAt(J-1)===ji&&--J;function _t(){if(it)return aa;if(ht)return ht=!1,ai;var Vt,rr=oe,yr;if(P.charCodeAt(rr)===Ri){for(;oe++<J&&P.charCodeAt(oe)!==Ri||P.charCodeAt(++oe)===Ri;);return(Vt=oe)>=J?it=!0:(yr=P.charCodeAt(oe++))===Ei?ht=!0:yr===ji&&(ht=!0,P.charCodeAt(oe)===Ei&&++oe),P.slice(rr+1,Vt-1).replace(/""/g,'"')}for(;oe<J;){if((yr=P.charCodeAt(Vt=oe++))===Ei)ht=!0;else if(yr===ji)ht=!0,P.charCodeAt(oe)===Ei&&++oe;else if(yr!==r)continue;return P.slice(rr,Vt)}return it=!0,P.slice(rr,J)}for(;(De=_t())!==aa;){for(var jt=[];De!==ai&&De!==aa;)jt.push(De),De=_t();D&&(jt=D(jt,he++))==null||z.push(jt)}return z}function s(P,D){return P.map(function(z){return D.map(function(J){return T(z[J])}).join(e)})}function p(P,D){return D==null&&(D=ba(P)),[D.map(T).join(e)].concat(s(P,D)).join(`
`)}function y(P,D){return D==null&&(D=ba(P)),s(P,D).join(`
`)}function _(P){return P.map(E).join(`
`)}function E(P){return P.map(T).join(e)}function T(P){return P==null?"":P instanceof Date?Ui(P):i.test(P+="")?'"'+P.replace(/"/g,'""')+'"':P}return{parse:n,parseRows:o,format:p,formatBody:y,formatRows:_,formatRow:E,formatValue:T}}var Ga=qi(","),ve=Ga.parse,Ln=Ga.parseRows,Ha=Ga.format,os=Ga.formatBody,Ut=Ga.formatRows,ir=Ga.formatRow,Pr=Ga.formatValue,I=R(96156),or=R(85061),Rn=R(38163),oi=R.n(Rn);function jn(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function nn(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?jn(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jn(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ti(e,i){var r=i.x,n=i.y,o=i.x1,s=i.y1,p=i.coordinates,y=[];return e.forEach(function(_,E){var T=[];if(r&&n&&(T=[parseFloat(_[r]),parseFloat(_[n])]),r&&n&&o&&s){var P=[parseFloat(_[r]),parseFloat(_[n])],D=[parseFloat(_[o]),parseFloat(_[s])];T=[P,D]}if(p){var z="Polygon";Array.isArray(p[0])||(z="Point"),Array.isArray(p[0])&&!Array.isArray(p[0][0])&&(z="LineString");var J={type:z,coordinates:(0,or.Z)(_[p])};oi()(J,!0),T=J.coordinates}var oe=nn(nn({},_),{},{_id:E,coordinates:T});y.push(oe)}),{dataArray:y}}var Mi=[{lng1:100,lat1:30,lng2:130,lat2:30}],$a={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function ss(e,i){var r=ve(e);return Ti(r,i)}var ma=63710088e-1,Ra={centimeters:ma*100,centimetres:ma*100,degrees:ma/111325,feet:ma*3.28084,inches:ma*39.37,kilometers:ma/1e3,kilometres:ma/1e3,meters:ma,metres:ma,miles:ma/1609.344,millimeters:ma*1e3,millimetres:ma*1e3,nauticalmiles:ma/1852,radians:1,yards:ma*1.0936},Ca={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ma,yards:1.0936133},G={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function K(e,i,r){r===void 0&&(r={});var n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=i||{},n.geometry=e,n}function se(e,i,r){switch(r===void 0&&(r={}),e){case"Point":return ge(i).geometry;case"LineString":return pe(i).geometry;case"Polygon":return Ge(i).geometry;case"MultiPoint":return Dt(i).geometry;case"MultiLineString":return dr(i).geometry;case"MultiPolygon":return Ft(i).geometry;default:throw new Error(e+" is invalid")}}function ge(e,i,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ji(e[0])||!Ji(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return K(n,i,r)}function Le(e,i,r){return r===void 0&&(r={}),yt(e.map(function(n){return ge(n,i)}),r)}function Ge(e,i,r){r===void 0&&(r={});for(var n=0,o=e;n<o.length;n++){var s=o[n];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<s[s.length-1].length;p++)if(s[s.length-1][p]!==s[0][p])throw new Error("First and last Position are not equivalent.")}var y={type:"Polygon",coordinates:e};return K(y,i,r)}function rt(e,i,r){return r===void 0&&(r={}),yt(e.map(function(n){return Ge(n,i)}),r)}function pe(e,i,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return K(n,i,r)}function Be(e,i,r){return r===void 0&&(r={}),yt(e.map(function(n){return pe(n,i)}),r)}function yt(e,i){i===void 0&&(i={});var r={type:"FeatureCollection"};return i.id&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.features=e,r}function dr(e,i,r){r===void 0&&(r={});var n={type:"MultiLineString",coordinates:e};return K(n,i,r)}function Dt(e,i,r){r===void 0&&(r={});var n={type:"MultiPoint",coordinates:e};return K(n,i,r)}function Ft(e,i,r){r===void 0&&(r={});var n={type:"MultiPolygon",coordinates:e};return K(n,i,r)}function _r(e,i,r){r===void 0&&(r={});var n={type:"GeometryCollection",geometries:e};return K(n,i,r)}function En(e,i){if(i===void 0&&(i=0),i&&!(i>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,i||0);return Math.round(e*r)/r}function un(e,i){i===void 0&&(i="kilometers");var r=Ra[i];if(!r)throw new Error(i+" units is invalid");return e*r}function Tt(e,i){i===void 0&&(i="kilometers");var r=Ra[i];if(!r)throw new Error(i+" units is invalid");return e/r}function on(e,i){return qr(Tt(e,i))}function Gr(e){var i=e%360;return i<0&&(i+=360),i}function qr(e){var i=e%(2*Math.PI);return i*180/Math.PI}function ni(e){var i=e%360;return i*Math.PI/180}function tn(e,i,r){if(i===void 0&&(i="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return un(Tt(e,i),r)}function Ci(e,i,r){if(i===void 0&&(i="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=G[i];if(!n)throw new Error("invalid original units");var o=G[r];if(!o)throw new Error("invalid final units");return e/n*o}function Ji(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function yi(e){return!!e&&e.constructor===Object}function Pi(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(i){if(!Ji(i))throw new Error("bbox must only contain numbers")})}function xi(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function ei(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Wi(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function La(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return La(e[0]);throw new Error("coordinates must only contain numbers")}function oa(e,i,r){if(!i||!r)throw new Error("type and name required");if(!e||e.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.type)}function Ii(e,i,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+e.geometry.type)}function Vi(e,i,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var n=0,o=e.features;n<o.length;n++){var s=o[n];if(!s||s.type!=="Feature"||!s.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!s.geometry||s.geometry.type!==i)throw new Error("Invalid input to "+r+": must be a "+i+", given "+s.geometry.type)}}function Na(e){return e.type==="Feature"?e.geometry:e}function tu(e,i){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function wa(e,i,r){if(e!==null)for(var n,o,s,p,y,_,E,T=0,P=0,D,z=e.type,J=z==="FeatureCollection",oe=z==="Feature",he=J?e.features.length:1,De=0;De<he;De++){E=J?e.features[De].geometry:oe?e.geometry:e,D=E?E.type==="GeometryCollection":!1,y=D?E.geometries.length:1;for(var it=0;it<y;it++){var ht=0,_t=0;if(p=D?E.geometries[it]:E,p!==null){_=p.coordinates;var jt=p.type;switch(T=r&&(jt==="Polygon"||jt==="MultiPolygon")?1:0,jt){case null:break;case"Point":if(i(_,P,De,ht,_t)===!1)return!1;P++,ht++;break;case"LineString":case"MultiPoint":for(n=0;n<_.length;n++){if(i(_[n],P,De,ht,_t)===!1)return!1;P++,jt==="MultiPoint"&&ht++}jt==="LineString"&&ht++;break;case"Polygon":case"MultiLineString":for(n=0;n<_.length;n++){for(o=0;o<_[n].length-T;o++){if(i(_[n][o],P,De,ht,_t)===!1)return!1;P++}jt==="MultiLineString"&&ht++,jt==="Polygon"&&_t++}jt==="Polygon"&&ht++;break;case"MultiPolygon":for(n=0;n<_.length;n++){for(_t=0,o=0;o<_[n].length;o++){for(s=0;s<_[n][o].length-T;s++){if(i(_[n][o][s],P,De,ht,_t)===!1)return!1;P++}_t++}ht++}break;case"GeometryCollection":for(n=0;n<p.geometries.length;n++)if(wa(p.geometries[n],i,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Aa(e,i,r,n){var o=r;return wa(e,function(s,p,y,_,E){p===0&&r===void 0?o=s:o=i(o,s,p,y,_,E)},n),o}function ms(e,i){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&i(e.features[r].properties,r)!==!1;r++);break;case"Feature":i(e.properties,0);break}}function us(e,i,r){var n=r;return ms(e,function(o,s){s===0&&r===void 0?n=o:n=i(n,o,s)}),n}function ta(e,i){if(e.type==="Feature")i(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&i(e.features[r],r)!==!1;r++);}function Bu(e,i,r){var n=r;return ta(e,function(o,s){s===0&&r===void 0?n=o:n=i(n,o,s)}),n}function mo(e){var i=[];return wa(e,function(r){i.push(r)}),i}function za(e,i){var r,n,o,s,p,y,_,E,T,P,D=0,z=e.type==="FeatureCollection",J=e.type==="Feature",oe=z?e.features.length:1;for(r=0;r<oe;r++){for(y=z?e.features[r].geometry:J?e.geometry:e,E=z?e.features[r].properties:J?e.properties:{},T=z?e.features[r].bbox:J?e.bbox:void 0,P=z?e.features[r].id:J?e.id:void 0,_=y?y.type==="GeometryCollection":!1,p=_?y.geometries.length:1,o=0;o<p;o++){if(s=_?y.geometries[o]:y,s===null){if(i(null,D,E,T,P)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(i(s,D,E,T,P)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<s.geometries.length;n++)if(i(s.geometries[n],D,E,T,P)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}D++}}function ro(e,i,r){var n=r;return za(e,function(o,s,p,y,_){s===0&&r===void 0?n=o:n=i(n,o,s,p,y,_)}),n}function Ki(e,i){za(e,function(r,n,o,s,p){var y=r===null?null:r.type;switch(y){case null:case"Point":case"LineString":case"Polygon":return i(K(r,o,{bbox:s,id:p}),n,0)===!1?!1:void 0}var _;switch(y){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var E=0;E<r.coordinates.length;E++){var T=r.coordinates[E],P={type:_,coordinates:T};if(i(K(P,o),n,E)===!1)return!1}})}function Ho(e,i,r){var n=r;return Ki(e,function(o,s,p){s===0&&p===0&&r===void 0?n=o:n=i(n,o,s,p)}),n}function Wo(e,i){Ki(e,function(r,n,o){var s=0;if(!!r.geometry){var p=r.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var y,_=0,E=0,T=0;if(wa(r,function(P,D,z,J,oe){if(y===void 0||n>_||J>E||oe>T){y=P,_=n,E=J,T=oe,s=0;return}var he=lineString([y,P],r.properties);if(i(he,n,o,oe,s)===!1)return!1;s++,y=P})===!1)return!1}}})}function Nu(e,i,r){var n=r,o=!1;return Wo(e,function(s,p,y,_,E){o===!1&&r===void 0?n=s:n=i(n,s,p,y,_,E),o=!0}),n}function Co(e,i){if(!e)throw new Error("geojson is required");Ki(e,function(r,n,o){if(r.geometry!==null){var s=r.geometry.type,p=r.geometry.coordinates;switch(s){case"LineString":if(i(r,n,o,0,0)===!1)return!1;break;case"Polygon":for(var y=0;y<p.length;y++)if(i(lineString(p[y],r.properties),n,o,y)===!1)return!1;break}}})}function Xo(e,i,r){var n=r;return Co(e,function(o,s,p,y){s===0&&r===void 0?n=o:n=i(n,o,s,p,y)}),n}function ga(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,o=i.geometryIndex||0,s=i.segmentIndex||0,p=i.properties,y;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,y=e.features[r].geometry;break;case"Feature":p=p||e.properties,y=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":y=e;break;default:throw new Error("geojson is invalid")}if(y===null)return null;var _=y.coordinates;switch(y.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=_.length+s-1),lineString([_[s],_[s+1]],p,i);case"Polygon":return o<0&&(o=_.length+o),s<0&&(s=_[o].length+s-1),lineString([_[o][s],_[o][s+1]],p,i);case"MultiLineString":return n<0&&(n=_.length+n),s<0&&(s=_[n].length+s-1),lineString([_[n][s],_[n][s+1]],p,i);case"MultiPolygon":return n<0&&(n=_.length+n),o<0&&(o=_[n].length+o),s<0&&(s=_[n][o].length-s-1),lineString([_[n][o][s],_[n][o][s+1]],p,i)}throw new Error("geojson is invalid")}function go(e,i){if(i=i||{},!isObject(i))throw new Error("options is invalid");var r=i.featureIndex||0,n=i.multiFeatureIndex||0,o=i.geometryIndex||0,s=i.coordIndex||0,p=i.properties,y;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),p=p||e.features[r].properties,y=e.features[r].geometry;break;case"Feature":p=p||e.properties,y=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":y=e;break;default:throw new Error("geojson is invalid")}if(y===null)return null;var _=y.coordinates;switch(y.type){case"Point":return point(_,p,i);case"MultiPoint":return n<0&&(n=_.length+n),point(_[n],p,i);case"LineString":return s<0&&(s=_.length+s),point(_[s],p,i);case"Polygon":return o<0&&(o=_.length+o),s<0&&(s=_[o].length+s),point(_[o][s],p,i);case"MultiLineString":return n<0&&(n=_.length+n),s<0&&(s=_[n].length+s),point(_[n][s],p,i);case"MultiPolygon":return n<0&&(n=_.length+n),o<0&&(o=_[n].length+o),s<0&&(s=_[n][o].length-s),point(_[n][o][s],p,i)}throw new Error("geojson is invalid")}function Yo(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function no(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Yo(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yo(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ru(e,i){var r=[],n={};if(e.features=e.features.filter(function(s){var p=s.geometry;return s!=null&&p&&p.type&&p.coordinates&&p.coordinates.length>0}),oi()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:n};var o=0;return Ki(e,function(s,p){var y=Wi(s),_=p,E=no(no({},s.properties),{},{coordinates:y,_id:_});r.push(E)}),{dataArray:r,featureKeys:n}}function _c(e){var i=131,r=137,n=0;e+="x";for(var o=Math.floor(9007199254740991/r),s=0;s<e.length;s++)n>o&&(n=Math.floor(n/r)),n=n*i+e.charCodeAt(s);return n}function Os(e){e=e.toString();for(var i=5381,r=e.length;r;)i=i*33^e.charCodeAt(--r);return i>>>0}var ie=R(28481),be="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Qe(e){this.message=e}Qe.prototype=new Error,Qe.prototype.name="InvalidCharacterError";function Ot(e){var i=String(e).replace(/=+$/,"");if(i.length%4==1)throw new Qe("'atob' failed: The string to be decoded is not correctly encoded.");for(var r="",n=0,o,s,p=0;s=i.charAt(p++);~s&&(o=n%4?o*64+s:s,n++%4)?r+=String.fromCharCode(255&o>>(-2*n&6)):0)s=be.indexOf(s);return r}function Dr(e){e=String(e);for(var i,r,n,o,s="",p=0,y=e.length%3;p<e.length;){if((r=e.charCodeAt(p++))>255||(n=e.charCodeAt(p++))>255||(o=e.charCodeAt(p++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i=r<<16|n<<8|o,s+=be.charAt(i>>18&63)+be.charAt(i>>12&63)+be.charAt(i>>6&63)+be.charAt(i&63)}return y?s.slice(0,y-3)+"===".substring(y):s}var lt=R(6610),Lt=R(5991),io=function(){function e(i,r){(0,lt.Z)(this,e),this.buffers=i,this.type=r}return(0,Lt.Z)(e,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(r,n,o){throw new Error("not implemented")}}]),e}(),$i;typeof window=="undefined"?$i={devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(i){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){return new Date().getTime()}},Blob:"",dispatchEvent:function(i){return!0},Event:function(i,r){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:$i=window;var Wa=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",qo=Wa?my.getSystemInfoSync().pixelRatio:$i.devicePixelRatio,xn=R(10379),dn=R(46070),Kt=R(77608),Bo=(0,Lt.Z)(function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"cancelBubble",void 0),(0,I.Z)(this,"cancelable",void 0),(0,I.Z)(this,"target",void 0),(0,I.Z)(this,"currentTarget",void 0),(0,I.Z)(this,"preventDefault",void 0),(0,I.Z)(this,"stopPropagation",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=i,this.timeStamp=Date.now()}),xe=R(63349);function Vs(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=nu(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,y=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw y}}}}function nu(e,i){if(!!e){if(typeof e=="string")return ls(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ls(e,i)}}function ls(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var sa=new WeakMap,yo=function(){function e(){(0,lt.Z)(this,e),sa.set(this,{})}return(0,Lt.Z)(e,[{key:"addEventListener",value:function(r,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=sa.get(this);s||(s={}),s[r]||(s[r]=[]),s[r].push(n),sa.set(this,s),o.capture,o.once,o.passive}},{key:"removeEventListener",value:function(r,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=sa.get(this);if(s){var p=s[r];if(p&&p.length>0){for(var y=p.length;y--;y>0)if(p[y]===n){p.splice(y,1);break}}}}},{key:"dispatchEvent",value:function(r){var n=sa.get(this)[r.type];if(n){var o=Vs(n),s;try{for(o.s();!(s=o.n()).done;){var p=s.value;p(r)}}catch(y){o.e(y)}finally{o.f()}}}}]),e}();function Wl(e){var i=xc();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function xc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var zu=function(e){(0,xn.Z)(r,e);var i=Wl(r);function r(){var n;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,xe.Z)(n),"childNodes",void 0),n.childNodes=[],n}return(0,Lt.Z)(r,[{key:"appendChild",value:function(o){this.childNodes.push(o)}},{key:"cloneNode",value:function(){var o=Object.create(this);return Object.assign(o,this),o}},{key:"removeChild",value:function(o){var s=this.childNodes.findIndex(function(p){return p===o});return s>-1?this.childNodes.splice(s,1):null}}]),r}(yo);function bc(e){var i=El();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function El(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Uu=function(e){(0,xn.Z)(r,e);var i=bc(r);function r(){var n;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,xe.Z)(n),"className",void 0),(0,I.Z)((0,xe.Z)(n),"children",void 0),n.className="",n.children=[],n}return(0,Lt.Z)(r,[{key:"setAttribute",value:function(o,s){this[o]=s}},{key:"getAttribute",value:function(o){return this[o]}},{key:"setAttributeNS",value:function(o,s){this[o]=s}},{key:"getAttributeNS",value:function(o){return this[o]}}]),r}(zu),iu=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Zu,g,w,B;if(iu){var O=my.getSystemInfoSync();Zu=O.screenWidth,g=O.screenHeight,w=O.windowWidth,B=O.windowHeight}else{var q=$i.innerWidth,_e=$i.innerHeight;Zu=q,g=_e,w=q,B=_e}var Xe={width:Zu,height:g,availWidth:w,availHeight:B,availLeft:0,availTop:0},ct=Xe.availWidth,mt=Xe.availHeight,lr={style:[]};function Er(e,i){if(!("parentNode"in e)){var r;i===0?r=function(){return null}:i===1?r=function(){return lr}:r=function(){return null},Object.defineProperty(e,"parentNode",{enumerable:!0,get:r})}if(!("parentElement"in e)){var n;i===0?n=function(){return null}:i===1?n=function(){return lr}:n=function(){return null},Object.defineProperty(e,"parentElement",{enumerable:!0,get:n})}}function In(e){e.style=e.style||{},Object.assign(e.style,{top:"0px",left:"0px",width:ct+"px",height:mt+"px",margin:"0px",padding:"0px"})}function si(e){"clientLeft"in e||(e.clientLeft=0,e.clientTop=0),"clientWidth"in e||(e.clientWidth=ct,e.clientHeight=mt),"getBoundingClientRect"in e||(e.getBoundingClientRect=function(){var i={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return i})}function Jn(e){"offsetLeft"in e||(e.offsetLeft=0,e.offsetTop=0),"offsetWidth"in e||(e.offsetWidth=ct,e.offsetHeight=mt)}function Xi(e){"scrollLeft"in e||(e.scrollLeft=0,e.scrollTop=0),"scrollWidth"in e||(e.scrollWidth=ct,e.scrollHeight=mt)}function fa(e){var i=function(){return!0};e.classList=[],e.classList.add=i,e.classList.remove=i,e.classList.contains=i,e.classList.toggle=i}function Ia(e){var i=Gi();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function Gi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Lo(){}var gs=function(e){(0,xn.Z)(r,e);var i=Ia(r);function r(){var n,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",s=arguments.length>1?arguments[1]:void 0;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,xe.Z)(n),"className",void 0),(0,I.Z)((0,xe.Z)(n),"children",void 0),(0,I.Z)((0,xe.Z)(n),"focus",void 0),(0,I.Z)((0,xe.Z)(n),"blur",void 0),(0,I.Z)((0,xe.Z)(n),"insertBefore",void 0),(0,I.Z)((0,xe.Z)(n),"appendChild",void 0),(0,I.Z)((0,xe.Z)(n),"removeChild",void 0),(0,I.Z)((0,xe.Z)(n),"remove",void 0),(0,I.Z)((0,xe.Z)(n),"innerHTML",void 0),(0,I.Z)((0,xe.Z)(n),"tagName",void 0),n.className="",n.children=[],n.focus=Lo,n.blur=Lo,n.insertBefore=Lo,n.appendChild=Lo,n.removeChild=Lo,n.remove=Lo,n.innerHTML="",n.tagName=o.toUpperCase(),Er((0,xe.Z)(n),s),In((0,xe.Z)(n)),fa((0,xe.Z)(n)),si((0,xe.Z)(n)),Jn((0,xe.Z)(n)),Xi((0,xe.Z)(n)),n}return(0,Lt.Z)(r)}(Uu);function il(e){var i=Xc();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function Xc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ju=function(e){(0,xn.Z)(r,e);var i=il(r);function r(n){return(0,lt.Z)(this,r),i.call(this,n)}return(0,Lt.Z)(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(gs);function Ec(e){var i=Eu();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function Eu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hu=function(e){(0,xn.Z)(r,e);var i=Ec(r);function r(){return(0,lt.Z)(this,r),i.call(this,"video")}return(0,Lt.Z)(r)}(ju),wo={},ha={};function oh(e,i){wo=e,wo.id=i,"tagName"in wo||(wo.tagName="CANVAS"),wo.type="canvas",Mixin.parentNode(wo),Mixin.style(wo),Mixin.classList(wo),Mixin.clientRegion(wo),Mixin.offsetRegion(wo),wo.focus=function(){},wo.blur=function(){}}function sh(e,i){var r=1024,n=1024;ha={width:r,height:n,clientWidth:r/devicePixelRatio,clientHeight:n/devicePixelRatio,id:i,type:"canvas"},"tagName"in ha||(ha.tagName="CANVAS"),Mixin.parentNode(ha),Mixin.style(ha),Mixin.classList(ha),Mixin.clientRegion(ha),Mixin.offsetRegion(ha),ha.getContext=function(o){if(o==="2d")return e},ha.focus=function(){},ha.blur=function(){}}function fo(){return wo}function wf(){return ha}var pu=(0,Lt.Z)(function e(){(0,lt.Z)(this,e);var i=fo(),r=i.createImage&&i.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=e.prototype),Er(r),fa(r),Object.assign(r,{addEventListener:function(o,s){r["on".concat(o)]=s.bind(r)},removeEventListener:function(o){r["on".concat(o)]=null}}),r}),Rs={href:"",protocol:"",host:""};function Sc(e){var i=al();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function al(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ea=function(e){(0,xn.Z)(r,e);var i=Sc(r);function r(){return(0,lt.Z)(this,r),i.call(this,"body",0)}return(0,Lt.Z)(r,[{key:"addEventListener",value:function(o,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,s,p){}},{key:"dispatchEvent",value:function(o){}}]),r}(gs),Sl=function(e){(0,xn.Z)(r,e);var i=Sc(r);function r(){return(0,lt.Z)(this,r),i.call(this,"html",0)}return(0,Lt.Z)(r,[{key:"addEventListener",value:function(o,s){var p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{}}},{key:"removeEventListener",value:function(o,s){}},{key:"dispatchEvent",value:function(o){}}]),r}(gs),Xl={},ts={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:Rs,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(i){return i=i.toLowerCase(),i==="canvas"?my.createOffscreenCanvas(1024,128,"2d"):i==="img"?new pu:i==="video"?new hu:new gs(i)},createElementNS:function(i,r){return this.createElement(r)},createTextNode:function(i){return i},getElementById:function(i){return null},getElementsByTagName:function(i){return i=i.toLowerCase(),[]},getElementsByTagNameNS:function(i,r){return this.getElementsByTagName(r)},getElementsByName:function(i){return[]},querySelector:function(i){return null},querySelectorAll:function(i){return[]},addEventListener:function(i,r,n){Xl[i]||(Xl[i]=[]),Xl[i].push(r)},removeEventListener:function(i,r){var n=Xl[i];if(n&&n.length>0){for(var o=n.length;o--;o>0)if(n[o]===r){n.splice(o,1);break}}},dispatchEvent:function(i){var r=i.type,n=Xl[r];if(n)for(var o=0;o<n.length;o++)n[o](i);i.target&&typeof i.target["on"+r]=="function"&&i.target["on"+r](i)},createEvent:function(i){return new Bo(i)}};ts.documentElement=new Sl,ts.head=new gs("head"),ts.body=new Ea;var Af=Object,uh=R(90484),lh=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"_w",void 0),(0,I.Z)(this,"_h",void 0),(0,I.Z)(this,"_data",void 0);var i=arguments.length;if(i===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){this._w=arguments[0],this._h=arguments[1],this._data=new Uint8ClampedArray(this._w*this._h*4);return}}else i===3&&(0,uh.Z)(arguments[0])==="object"&&typeof arguments[1]=="number"&&typeof arguments[2]=="number"&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return(0,Lt.Z)(e,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),e}(),Yc=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ol,No,Su;if(Yc){var Vu=my.getSystemInfoSync();ol=Vu.system,No=Vu.platform,Su=Vu.language}else{var zo={versions:function(){var e=$i.navigator.userAgent;return{trident:e.indexOf("Trident")>-1,presto:e.indexOf("Presto")>-1,webKit:e.indexOf("AppleWebKit")>-1,gecko:e.indexOf("Gecko")>-1&&e.indexOf("KHTML")===-1,mobile:!!e.match(/AppleWebKit.*Mobile.*/),ios:!!e.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:e.indexOf("Android")>-1||e.indexOf("Linux")>-1,iPhone:e.indexOf("iPhone")>-1,iPad:e.indexOf("iPad")>-1,webApp:e.indexOf("Safari")===-1,weixin:e.indexOf("MicroMessenger")>-1,qq:e.match(/\sQQ/i)===" qq"}}(),language:($i.navigator.browserLanguage||$i.navigator.language).toLowerCase()};zo.versions.android?No="android":zo.versions.trident?No="IE":zo.versions.presto?No="Opera":zo.versions.webKit?No="webKit":zo.versions.gecko?No="Firefox":zo.versions.mobile?No="mobile":zo.versions.ios?No="ios":zo.versions.iPhone?No="iPhone":zo.versions.iPad?No="ipad":zo.versions.webApp?No="webApp":zo.versions.weixin?No="weixin":zo.versions.qq&&(No="qq"),ol=$i.navigator.userAgent,Su=zo.language}var Cl=ol.toLowerCase().indexOf("android")!==-1,Gu=Cl?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",Gs="Mozilla/5.0 (".concat(Gu,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(Su),qc={platform:No,language:Su,appVersion:"5.0 (".concat(Gu,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:Gs},Kc={mark:function(i){return null},clearMeasures:function(i){return null},clearMarks:function(i){return null},measure:function(i,r,n){return{duration:0}},now:function(){}},$c=0,Hu=0;function Yl(e){var i=Date.now(),r=Math.max($c+23,i);return Hu=setTimeout(function(){e($c=r)},r-i),Hu}function Cc(e){var i=fo();return i.requestAnimationFrame?i.requestAnimationFrame(e):Yl(e)}function Jc(e){var i=fo();return i.cancelAnimationFrame?i.cancelAnimationFrame(e):clearTimeout(e)}var wc=function(){function e(i){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if((0,lt.Z)(this,e),(0,I.Z)(this,"href",void 0),i.indexOf("http://")==0||i.indexOf("https://")==0){this.href=i;return}this.href=r+i}return(0,Lt.Z)(e,null,[{key:"createObjectURL",value:function(r){var n=r.buffers[0],o=r.type,s=ch(n),p="data:".concat(o,";base64, ");return p+s}}]),e}();function ch(e){for(var i="",r=new Uint8Array(e),n=r.byteLength,o=0;o<n;o++)i+=String.fromCharCode(r[o]);return Dr(i)}var Ac={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:18446744073709552e3,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},sl={};function Qc(e){var i=ef();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function ef(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Cu=new Map,tf=new Map,Tf=new Map,fh={json:"application/json",text:"application/text",arraybuffer:"application/octet-stream"};function wl(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{target:this};typeof this["on".concat(e)]=="function"&&this["on".concat(e)].call(this,i)}function $h(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{readyState:e};this.readyState=e,wl.call(this,"readystatechange",i)}var rs=function(e){(0,xn.Z)(r,e);var i=Qc(r);function r(){var n;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,xe.Z)(n),"onabort",void 0),(0,I.Z)((0,xe.Z)(n),"onerror",void 0),(0,I.Z)((0,xe.Z)(n),"onload",void 0),(0,I.Z)((0,xe.Z)(n),"onloadstart",void 0),(0,I.Z)((0,xe.Z)(n),"onprogress",void 0),(0,I.Z)((0,xe.Z)(n),"ontimeout",void 0),(0,I.Z)((0,xe.Z)(n),"onloadend",void 0),(0,I.Z)((0,xe.Z)(n),"onreadystatechange",void 0),(0,I.Z)((0,xe.Z)(n),"readyState",void 0),(0,I.Z)((0,xe.Z)(n),"response",void 0),(0,I.Z)((0,xe.Z)(n),"responseText",void 0),(0,I.Z)((0,xe.Z)(n),"_responseType",void 0),(0,I.Z)((0,xe.Z)(n),"responseXML",void 0),(0,I.Z)((0,xe.Z)(n),"status",void 0),(0,I.Z)((0,xe.Z)(n),"statusText",void 0),(0,I.Z)((0,xe.Z)(n),"upload",void 0),(0,I.Z)((0,xe.Z)(n),"withCredentials",void 0),(0,I.Z)((0,xe.Z)(n),"timeout",void 0),(0,I.Z)((0,xe.Z)(n),"_url",void 0),(0,I.Z)((0,xe.Z)(n),"_method",void 0),n.onabort=null,n.onerror=null,n.onload=null,n.onloadstart=null,n.onprogress=null,n.ontimeout=null,n.onloadend=null,n.onreadystatechange=null,n.readyState=0,n.response=null,n.responseText=null,n._responseType="text",n.responseXML=null,n.status=0,n.statusText="",n.upload={},n.withCredentials=!1,Cu.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),n}return(0,Lt.Z)(r,[{key:"responseType",set:function(o){this._responseType=o}},{key:"abort",value:function(){var o=Tf.get("requestTask");o&&o.abort()}},{key:"getAllResponseHeaders",value:function(){var o=tf.get("responseHeader");return Object.keys(o).map(function(s){return"".concat(s,": ").concat(o[s])}).join(`
`)}},{key:"getResponseHeader",value:function(o){return tf.get("responseHeader")[o]}},{key:"open",value:function(o,s,p){this._method=o,this._url=s}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:""}},{key:"setRequestHeader",value:function(o,s){var p=Cu.get("requestHeader");p[o]=s,Cu.set("requestHeader",p)}},{key:"addEventListener",value:function(o,s){var p=this;typeof s=="function"&&(this["on"+o]=function(){var y=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};y.target=y.target||p,s.call(p,y)})}},{key:"removeEventListener",value:function(o,s){this["on"+o]===s&&(this["on"+o]=null)}}]),r}(yo);(0,I.Z)(rs,"UNSEND",void 0),(0,I.Z)(rs,"OPENED",void 0),(0,I.Z)(rs,"HEADERS_RECEIVED",void 0),(0,I.Z)(rs,"LOADING",void 0),(0,I.Z)(rs,"DONE",void 0),rs.UNSEND=0,rs.OPENED=1,rs.HEADERS_RECEIVED=2,rs.LOADING=3,rs.DONE=4;function Xa(e){var i=ql();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function ql(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Al=function(e){(0,xn.Z)(r,e);var i=Xa(r);function r(n){var o;return(0,lt.Z)(this,r),o=i.call(this,n),(0,I.Z)((0,xe.Z)(o),"touches",void 0),(0,I.Z)((0,xe.Z)(o),"targetTouches",void 0),(0,I.Z)((0,xe.Z)(o),"changedTouches",void 0),o.touches=[],o.targetTouches=[],o.changedTouches=[],o.target=fo(),o.currentTarget=fo(),o}return(0,Lt.Z)(r)}(Bo);function au(e){var i=e||{},r=i.x,n=r===void 0?0:r,o=i.y,s=o===void 0?0:o,p=i.clientX,y=p===void 0?0:p,_=i.clientY,E=_===void 0?0:_;Object.keys(e).indexOf("x")!==-1?(e.pageX=e.clientX=n,e.pageY=e.clientY=s):(e.x=y,e.y=E)}function Di(e){return function(i){var r=new Al(e);r.changedTouches=i.changedTouches,r.touches=i.touches,r.targetTouches=Array.prototype.slice.call(i.touches),r.timeStamp=i.timeStamp,r.changedTouches.forEach(function(n){return au(n)}),r.touches.forEach(function(n){return au(n)}),r.targetTouches.forEach(function(n){return au(n)}),ts.dispatchEvent(r)}}function ka(e){return function(i){i.type=e,ts.dispatchEvent(i)}}var Ls=Di("touchstart"),rf=Di("touchmove"),ul=Di("touchend"),nf=ka("mapCameaParams");function Jh(e){var i=Qh();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function Qh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tc=function(e){(0,xn.Z)(r,e);var i=Jh(r);function r(n){var o;return(0,lt.Z)(this,r),o=i.call(this,n),(0,I.Z)((0,xe.Z)(o),"buttons",void 0),(0,I.Z)((0,xe.Z)(o),"which",void 0),(0,I.Z)((0,xe.Z)(o),"pointerId",void 0),(0,I.Z)((0,xe.Z)(o),"bubbles",void 0),(0,I.Z)((0,xe.Z)(o),"button",void 0),(0,I.Z)((0,xe.Z)(o),"width",void 0),(0,I.Z)((0,xe.Z)(o),"height",void 0),(0,I.Z)((0,xe.Z)(o),"pressure",void 0),(0,I.Z)((0,xe.Z)(o),"isPrimary",void 0),(0,I.Z)((0,xe.Z)(o),"pointerType",void 0),(0,I.Z)((0,xe.Z)(o),"altKey",void 0),(0,I.Z)((0,xe.Z)(o),"ctrlKey",void 0),(0,I.Z)((0,xe.Z)(o),"metaKey",void 0),(0,I.Z)((0,xe.Z)(o),"shiftKey",void 0),o.target=fo(),o.currentTarget=fo(),o}return(0,Lt.Z)(r)}(Bo),Kl=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Wu=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],ko="touch";function $l(e,i,r){for(var n=new Tc(e),o=0;o<Kl.length;o++){var s=Kl[o];n[s]=i[s]||Wu[o]}return n.type=e,n.target=fo(),n.currentTarget=fo(),n.buttons=Jl(e),n.which=n.buttons,n.pointerId=(i.identifier||0)+2,n.bubbles=!0,n.cancelable=!0,n.button=0,n.width=(i.radiusX||.5)*2,n.height=(i.radiusY||.5)*2,n.pressure=i.force||.5,n.isPrimary=yn(i),n.pointerType=ko,n.altKey=r.altKey,n.ctrlKey=r.ctrlKey,n.metaKey=r.metaKey,n.shiftKey=r.shiftKey,r.preventDefault&&(n.preventDefault=function(){r.preventDefault()}),n}function Jl(e){var i=0;return(e==="touchstart"||e==="touchmove"||e==="pointerdown"||e==="pointermove")&&(i=1),i}var Ja=null;function yn(e){return Ja===e.identifier}function ao(e){Ja===null&&(Ja=e.identifier)}function Xu(e){Ja===e.identifier&&(Ja=null)}function Yu(e){return function(i){for(var r=i.changedTouches,n=0;n<r.length;n++){var o=r[n];n===0&&e==="pointerdown"?ao(o):(e==="pointerup"||e==="pointercancel")&&Xu(o);var s=$l(e,o,i);ts.dispatchEvent(s)}}}var du=Yu("pointerdown"),ks=Yu("pointermove"),Mf=Yu("pointerup");function $r(e){var i=af();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function af(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pf=function(e){(0,xn.Z)(r,e);var i=$r(r);function r(n){return(0,lt.Z)(this,r),i.call(this,n)}return(0,Lt.Z)(r)}(Bo);function wu(e){return function(i){i.type=e,ts.dispatchEvent(i)}}var ja=wu("mousedown"),Ds=wu("mousemove"),of=wu("mouseup"),Au=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ws=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ao=Au||ws,hh={atob:Ot,btoa:Dr,devicePixelRatio:qo,Blob:io,document:ts,Element:Uu,Event:Bo,EventTarget:yo,HTMLCanvasElement:Af,HTMLElement:gs,HTMLMediaElement:ju,HTMLVideoElement:hu,Image:pu,ImageData:lh,navigator:qc,Node:zu,requestAnimationFrame:Cc,cancelAnimationFrame:Jc,screen:Xe,XMLHttpRequest:rs,performance:Kc,URL:wc,WebGLRenderingContext:Ac,WebGL2RenderingContext:sl,addEventListener:function(i,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};ts.addEventListener(i,r,n)},removeEventListener:function(i,r,n){ts.removeEventListener(i,r)},dispatchEvent:function(i){ts.dispatchEvent(i)},innerWidth:Xe.availWidth,innerHeight:Xe.availHeight,setTimeout,clearTimeout,setInterval,clearInterval},ya=Ao?hh:$i,If=Ao?rs:$i.XMLHttpRequest,ph=Ao?Rs:$i.location;function Hs(e){var i=e;return typeof e=="string"&&(i=ya.document.getElementById(e)),i}function As(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Oi(e){return As(e).split(/\s+/)}function vu(e){var i,r,n=ya==null||(i=ya.document)===null||i===void 0||(r=i.documentElement)===null||r===void 0?void 0:r.style;if(!n)return e[0];for(var o in e)if(e[o]&&e[o]in n)return e[o];return e[0]}function pa(e,i,r){var n=ya.document.createElement(e);return n.className=i||"",r&&r.appendChild(n),n}function ho(e){var i=e.parentNode;i&&i.removeChild(e)}function Fs(e,i){if(e.classList!==void 0)for(var r=Oi(i),n=0,o=r.length;n<o;n++)e.classList.add(r[n]);else if(!Bs(e,i)){var s=Ns(e);cs(e,(s?s+" ":"")+i)}}function ou(e,i){e.classList!==void 0?e.classList.remove(i):cs(e,As((" "+Ns(e)+" ").replace(" "+i+" "," ")))}function Bs(e,i){if(e.classList!==void 0)return e.classList.contains(i);var r=Ns(e);return r.length>0&&new RegExp("(^|\\s)"+i+"(\\s|$)").test(r)}function cs(e,i){e instanceof HTMLElement?e.className=i:e.className.baseVal=i}function Ns(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function On(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var wn=vu(["transform","WebkitTransform"]);function Ql(e,i){e.style[wn]=i}function fs(){if(typeof Event=="function")ya.dispatchEvent(new Event("resize"));else{var e=ya.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,ya,0),ya.dispatchEvent(e)}}function mu(e){var i=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,i.join(""))}function Ko(){var e,i=ya.document.querySelector('meta[name="viewport"]');if(!i)return 1;var r=(e=i.content)===null||e===void 0?void 0:e.split(","),n=r.find(function(o){var s=o.split("="),p=(0,ie.Z)(s,2),y=p[0],_=p[1];return y==="initial-scale"});return n?n.split("=")[1]*1:1}var Sa=Ko()<1?1:ya.devicePixelRatio,Mc=R(14665);function Pc(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var da=R(51814);function Ta(e,i,r){return(0,da.Z)()?Ta=Reflect.construct:Ta=function(o,s,p){var y=[null];y.push.apply(y,s);var _=Function.bind.apply(o,y),E=new _;return p&&(0,Mc.Z)(E,p.prototype),E},Ta.apply(null,arguments)}function Ic(e){var i=typeof Map=="function"?new Map:void 0;return Ic=function(n){if(n===null||!Pc(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof i!="undefined"){if(i.has(n))return i.get(n);i.set(n,o)}function o(){return Ta(n,arguments,(0,Kt.Z)(this).constructor)}return o.prototype=Object.create(n.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),(0,Mc.Z)(o,n)},Ic(e)}function Tl(e){var i=gu();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function gu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ws=function(e){(0,xn.Z)(r,e);var i=Tl(r);function r(n,o,s){var p;return(0,lt.Z)(this,r),p=i.call(this,n),(0,I.Z)((0,xe.Z)(p),"status",void 0),(0,I.Z)((0,xe.Z)(p),"url",void 0),p.status=o,p.url=s,p.name=p.constructor.name,p.message=n,p}return(0,Lt.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(Ic(Error));function Do(e){var i=new If;i.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&i.setRequestHeader(r,e.headers[r]);return i.withCredentials=e.credentials==="include",i}var ll=function(i,r){var n=Do(i);return n.setRequestHeader("Accept","application/json"),n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){if(n.status>=200&&n.status<300&&n.response){var o;try{o=JSON.parse(n.response)}catch(s){return r(s)}r(null,o)}else n.status===401?r(new Ws("".concat(n.statusText),n.status,i.url)):r(new Ws(n.statusText,n.status,i.url))},n.send(),n},yu=function(i,r){var n=Do(i);return n.responseType="arraybuffer",n.onerror=function(){r(new Error(n.statusText))},n.onload=function(){var o=n.response;if(o.byteLength===0&&n.status===200)return r(new Error("http status 200 returned without content."));n.status>=200&&n.status<300&&n.response?r(null,{data:o,cacheControl:n.getResponseHeader("Cache-Control"),expires:n.getResponseHeader("Expires")}):r(new Ws(n.statusText,n.status,i.url))},n.send(),n};function sf(e){var i=$window.document.createElement("a");return i.href=e,i.protocol===$window.document.location.protocol&&i.host===$window.document.location.host}var Ml="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Pl=function(i,r){return yu(i,function(n,o){if(n)r(n);else if(o){var s=new ya.Image;s.crossOrigin="anonymous";var p=ya.URL||ya.webkitURL;s.onload=function(){r(null,s),p.revokeObjectURL(s.src)};var y=new ya.Blob([new Uint8Array(o.data)],{type:"image/png"});s.src=o.data.byteLength?p.createObjectURL(y):Ml}})},Il=2*Math.PI*6378137/2;function ec(e){var i=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var n=r.coordinates;cl(i,n)}),i}function cl(e,i){return Array.isArray(i[0])?i.forEach(function(r){cl(e,r)}):(e[0]>i[0]&&(e[0]=i[0]),e[1]>i[1]&&(e[1]=i[1]),e[2]<i[0]&&(e[2]=i[0]),e[3]<i[1]&&(e[3]=i[1])),e}function dh(e,i){return qu(e,i)}function qu(e,i){return Array.isArray(e[0])?e.map(function(r){return qu(r,i)}):i(e)}function Tu(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=uf(e,i);var n=e[0],o=e[1],s=n*Il/180,p=Math.log(Math.tan((90+o)*Math.PI/360))/(Math.PI/180);return p=p*Il/180,r.enable&&(s=Number(s.toFixed(r.decimal)),p=Number(p.toFixed(r.decimal))),e.length===3?[s,p,e[2]]:[s,p]}function Of(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],n=e[1],o=r/Il*180,s=n/Il*180;return s=180/Math.PI*(2*Math.atan(Math.exp(s*Math.PI/180))-Math.PI/2),i!=null&&(o=Number(o.toFixed(i)),s=Number(s.toFixed(i))),e.length===3?[o,s,e[2]]:[o,s]}function fl(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Xs(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function uf(e,i){if(i===!1)return e;var r=fl(e[0]),n=Xs(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[r,n,e[2]]:[r,n]}function _u(e){var i=85.0511287798,r=Math.max(Math.min(i,e[1]),-i),n=256<<20,o=Math.PI/180,s=e[0]*o,p=r*o;p=Math.log(Math.tan(Math.PI/4+p/2));var y=.5/Math.PI,_=.5,E=-.5/Math.PI;return o=.5,s=n*(y*s+_),p=n*(E*p+o),[Math.floor(s),Math.floor(p)]}function vh(e){var i=.5/Math.PI,r=.5,n=-.5/Math.PI,o=.5,s=256<<20,p=_slicedToArray(e,2),y=p[0],_=p[1];y=(y/s-r)/i,_=(_/s-o)/n,_=(Math.atan(Math.pow(Math.E,_))-Math.PI/4)*2,o=Math.PI/180;var E=_/o,T=y/o;return[T,E]}function tc(e,i,r){var n=ni(i[1]-e[1]),o=ni(i[0]-e[0]),s=ni(e[1]),p=ni(i[1]),y=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(s)*Math.cos(p);return un(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)),r="meters")}function l(e){var i=Math.PI/180,r=85.0511287798,n=6378137,o=Math.max(Math.min(r,e[1]),-r),s=Math.sin(o*i),p=n*e[0]*i,y=n*Math.log((1+s)/(1-s))/2;return[p,y]}function f(e,i){var r=Math.abs(e[1][1]-e[0][1])*i,n=Math.abs(e[1][0]-e[0][0])*i;return[[e[0][0]-n,e[0][1]-r],[e[1][0]+n,e[1][1]+r]]}function c(e,i){return e[0][0]<=i[0][0]&&e[0][1]<=i[0][1]&&e[1][0]>=i[1][0]&&e[1][1]>=i[1][1]}function d(e){return[[e[0],e[1]],[e[2],e[3]]]}var b=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,lt.Z)(this,e),(0,I.Z)(this,"limit",void 0),(0,I.Z)(this,"cache",void 0),(0,I.Z)(this,"destroy",void 0),(0,I.Z)(this,"order",void 0),this.limit=i,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Lt.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(n){r.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var n=this.cache[r];return n&&(this.deleteOrder(r),this.appendOrder(r)),n}},{key:"set",value:function(r,n){this.cache[r]?(this.delete(r),this.cache[r]=n,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=n,this.appendOrder(r))}},{key:"delete",value:function(r){var n=this.cache[r];n&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(n,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var n=this.order.findIndex(function(o){return o===r});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,n){return null}}]),e}();function C(e,i){e.forEach(function(r){!i[r]||(i[r]=i[r].bind(i))})}var A=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:16;(0,lt.Z)(this,e),(0,I.Z)(this,"duration",16),(0,I.Z)(this,"timestamp",new Date().getTime()),this.duration=i}return(0,Lt.Z)(e,[{key:"run",value:function(r){var n=new Date().getTime(),o=n-this.timestamp;this.timestamp=n,o>=this.duration&&r()}}]),e}(),L=R(2650);function Z(e){return typeof e=="string"?!!L.ZP(e):!1}function V(e){var i=L.ZP(e),r=[0,0,0,0];return i!=null&&(r[0]=i.r/255,r[1]=i.g/255,r[2]=i.b/255,r[3]=i.opacity),r}function le(e){var i=e&&e[0],r=e&&e[1],n=e&&e[2],o=i+r*256+n*65536-1;return o}function fe(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function de(e){var i=ya.document.createElement("canvas"),r=i.getContext("2d");i.width=256,i.height=1;for(var n=r.createLinearGradient(0,0,256,1),o=null,s=e.positions[0],p=e.positions[e.positions.length-1],y=0;y<e.colors.length;++y){var _=(e.positions[y]-s)/(p-s);n.addColorStop(_,e.colors[y])}return r.fillStyle=n,r.fillRect(0,0,256,1),o=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),Ao?{data:o,width:256,height:1}:new ImageData(o,256,1)}var ke;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(ke||(ke={}));var Re={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function He(e,i,r){var n=e.classList;for(var o in Re)Re.hasOwnProperty(o)&&n.remove("l7-".concat(r,"-anchor-").concat(o));n.add("l7-".concat(r,"-anchor-").concat(i))}function Ae(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i*1}function We(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i*1}function tt(e){if(e.length===0)return 0;for(var i=e[0]*1,r=1;r<e.length;r++)i+=e[r]*1;return i}function bt(e){if(e.length===0)throw new Error("mean requires at least one data point");return tt(e)/e.length}function Yt(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var i=e[0],r=NaN,n=0,o=1,s=1;s<e.length+1;s++)e[s]!==i?(o>n&&(n=o,r=i),o=1,i=e[s]):o++;return r*1}var zt={min:We,max:Ae,mean:bt,sum:tt,mode:Yt};function $t(e,i){return e.map(function(r){return r[i]})}function gr(e,i){return zt[e](i)}function Br(e,i){var r=i.extent,n=r===void 0?[121.168,30.2828,121.384,30.4219]:r,o=new Promise(function(p){Fr(e,function(y){p(y)})}),s={originData:e,images:o,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return s}function Fr(e,i){var r=e,n=[];if(typeof r=="string")Pl({url:r},function(p,y){n.push(y),i(n)});else{var o=r.length,s=0;r.forEach(function(p){Pl({url:p},function(y,_){s++,n.push(_),s===o&&i(n)})})}return Br}function sn(e,i){var r=i.extent,n=i.width,o=i.height,s=i.min,p=i.max,y={_id:1,dataArray:[{_id:1,data:Array.from(e),width:n,height:o,min:s,max:p,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return y}var kn=R(30236),Dn=R.n(kn),zn=R(47037),ci=R.n(zn),ln=R(23560),Hn=R.n(ln),fi=R(50361),Yn=R.n(fi),Zn=R(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function vi(e,i,r,n){function o(s){return s instanceof r?s:new r(function(p){p(s)})}return new(r||(r=Promise))(function(s,p){function y(T){try{E(n.next(T))}catch(P){p(P)}}function _(T){try{E(n.throw(T))}catch(P){p(P)}}function E(T){T.done?s(T.value):o(T.value).then(y,_)}E((n=n.apply(e,i||[])).next())})}function qn(e,i){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,o,s,p;return p={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function y(E){return function(T){return _([E,T])}}function _(E){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,o&&(s=E[0]&2?o.return:E[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,E[1])).done)return s;switch(o=0,s&&(E=[E[0]&2,s.value]),E[0]){case 0:case 1:s=E;break;case 4:return r.label++,{value:E[1],done:!1};case 5:r.label++,o=E[1],E=[0];continue;case 7:E=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(E[0]===6||E[0]===2)){r=0;continue}if(E[0]===3&&(!s||E[1]>s[0]&&E[1]<s[3])){r.label=E[1];break}if(E[0]===6&&r.label<s[1]){r.label=s[1],s=E;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(E);break}s[2]&&r.ops.pop(),r.trys.pop();continue}E=i.call(e,r)}catch(T){E=[6,T],o=0}finally{n=s=0}if(E[0]&5)throw E[1];return{value:E[0]?E[1]:void 0,done:!0}}}function Vn(e,i){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var n=r.call(e),o,s=[],p;try{for(;(i===void 0||i-- >0)&&!(o=n.next()).done;)s.push(o.value)}catch(y){p={error:y}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(p)throw p.error}}return s}function To(){for(var e=[],i=0;i<arguments.length;i++)e=e.concat(Vn(arguments[i]));return e}function Li(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Qi(e,i){return i={exports:{}},e(i,i.exports),i.exports}var _o=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1==0}e.exports=i.default});Li(_o);var Ya=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return function(){for(var n=[],o=arguments.length;o--;)n[o]=arguments[o];var s=n.pop();return r.call(this,n,s)}},e.exports=i.default});Li(Ya);var Ua=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.fallback=o,i.wrap=s;var r=i.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,n=i.hasNextTick=typeof Zn=="object"&&typeof Zn.nextTick=="function";function o(y){setTimeout(y,0)}function s(y){return function(_){for(var E=[],T=arguments.length-1;T-- >0;)E[T]=arguments[T+1];return y(function(){return _.apply(void 0,E)})}}var p;r?p=setImmediate:n?p=Zn.nextTick:p=o,i.default=s(p)});Li(Ua);var zs=Ua.fallback,ys=Ua.wrap,Ku=Ua.hasSetImmediate,_s=Ua.hasNextTick,Ys=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=o(Ya),n=o(Ua);function o(_){return _&&_.__esModule?_:{default:_}}function s(_){return(0,xo.isAsync)(_)?function(){for(var E=[],T=arguments.length;T--;)E[T]=arguments[T];var P=E.pop(),D=_.apply(this,E);return p(D,P)}:(0,r.default)(function(E,T){var P;try{P=_.apply(this,E)}catch(D){return T(D)}if(P&&typeof P.then=="function")return p(P,T);T(null,P)})}function p(_,E){return _.then(function(T){y(E,null,T)},function(T){y(E,T&&T.message?T:new Error(T))})}function y(_,E,T){try{_(E,T)}catch(P){(0,n.default)(function(D){throw D},P)}}e.exports=i.default});Li(Ys);var xo=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isAsyncIterable=i.isAsyncGenerator=i.isAsync=void 0;var r=n(Ys);function n(_){return _&&_.__esModule?_:{default:_}}function o(_){return _[Symbol.toStringTag]==="AsyncFunction"}function s(_){return _[Symbol.toStringTag]==="AsyncGenerator"}function p(_){return typeof _[Symbol.asyncIterator]=="function"}function y(_){if(typeof _!="function")throw new Error("expected a function");return o(_)?(0,r.default)(_):_}i.default=y,i.isAsync=o,i.isAsyncGenerator=s,i.isAsyncIterable=p});Li(xo);var Oc=xo.isAsyncIterable,rc=xo.isAsyncGenerator,$u=xo.isAsync,su=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n,o){if(o===void 0&&(o=n.length),!o)throw new Error("arity is undefined");function s(){for(var p=this,y=[],_=arguments.length;_--;)y[_]=arguments[_];return typeof y[o-1]=="function"?n.apply(this,y):new Promise(function(E,T){y[o-1]=function(P){for(var D=[],z=arguments.length-1;z-- >0;)D[z]=arguments[z+1];if(P)return T(P);E(D.length>1?D:D[0])},n.apply(p,y)})}return Object.defineProperty(s,"name",{configurable:!0,value:"awaitable("+n.name+")"}),s}e.exports=i.default});Li(su);var hl=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(_o),n=s(xo),o=s(su);function s(p){return p&&p.__esModule?p:{default:p}}i.default=(0,o.default)(function(p,y,_){var E=(0,r.default)(y)?[]:{};p(y,function(T,P,D){(0,n.default)(T)(function(z){for(var J,oe=[],he=arguments.length-1;he-- >0;)oe[he]=arguments[he+1];oe.length<2&&(J=oe,oe=J[0]),E[P]=oe,D(z)})},function(T){return _(T,E)})},3),e.exports=i.default});Li(hl);var Ts=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){function o(){for(var s=[],p=arguments.length;p--;)s[p]=arguments[p];if(n!==null){var y=n;n=null,y.apply(this,s)}}return Object.assign(o,n),o}e.exports=i.default});Li(Ts);var pl=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=i.default});Li(pl);var uu=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=_;var r=o(_o),n=o(pl);function o(E){return E&&E.__esModule?E:{default:E}}function s(E){var T=-1,P=E.length;return function(){return++T<P?{value:E[T],key:T}:null}}function p(E){var T=-1;return function(){var D=E.next();return D.done?null:(T++,{value:D.value,key:T})}}function y(E){var T=E?Object.keys(E):[],P=-1,D=T.length;return function(){var J=T[++P];return P<D?{value:E[J],key:J}:null}}function _(E){if((0,r.default)(E))return s(E);var T=(0,n.default)(E);return T?p(T):y(E)}e.exports=i.default});Li(uu);var oo=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=r;function r(n){return function(){for(var o=[],s=arguments.length;s--;)o[s]=arguments[s];if(n===null)throw new Error("Callback was already called.");var p=n;n=null,p.apply(this,o)}}e.exports=i.default});Li(oo);var qs=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r={};i.default=r,e.exports=i.default});Li(qs);var Mu=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=o;var r=n(qs);function n(s){return s&&s.__esModule?s:{default:s}}function o(s,p,y,_){var E=!1,T=!1,P=!1,D=0,z=0;function J(){D>=p||P||E||(P=!0,s.next().then(function(De){var it=De.value,ht=De.done;if(!(T||E)){if(P=!1,ht){E=!0,D<=0&&_(null);return}D++,y(it,z,oe),z++,J()}}).catch(he))}function oe(De,it){if(D-=1,!T){if(De)return he(De);if(De===!1){E=!0,T=!0;return}if(it===r.default||E&&D<=0)return E=!0,_(null);J()}}function he(De){T||(P=!1,E=!0,_(De))}J()}e.exports=i.default});Li(Mu);var Pu=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=y(Ts),n=y(uu),o=y(oo),s=y(Mu),p=y(qs);function y(_){return _&&_.__esModule?_:{default:_}}i.default=function(_){return function(E,T,P){if(P=(0,r.default)(P),_<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!E)return P(null);if((0,xo.isAsyncGenerator)(E))return(0,s.default)(E,_,T,P);if((0,xo.isAsyncIterable)(E))return(0,s.default)(E[Symbol.asyncIterator](),_,T,P);var D=(0,n.default)(E),z=!1,J=!1,oe=0,he=!1;function De(ht,_t){if(!J)if(oe-=1,ht)z=!0,P(ht);else if(ht===!1)z=!0,J=!0;else{if(_t===p.default||z&&oe<=0)return z=!0,P(null);he||it()}}function it(){for(he=!0;oe<_&&!z;){var ht=D();if(ht===null){z=!0,oe<=0&&P(null);return}oe+=1,T(ht.value,ht.key,(0,o.default)(De))}he=!1}it()}},e.exports=i.default});Li(Pu);var ea=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=s(Pu),n=s(xo),o=s(su);function s(y){return y&&y.__esModule?y:{default:y}}function p(y,_,E,T){return(0,r.default)(_)(y,(0,n.default)(E),T)}i.default=(0,o.default)(p,4),e.exports=i.default});Li(ea);var Ms=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=o(ea),n=o(su);function o(p){return p&&p.__esModule?p:{default:p}}function s(p,y,_){return(0,r.default)(p,1,y,_)}i.default=(0,n.default)(s,3),e.exports=i.default});Li(Ms);var hs=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=o(hl),n=o(Ms);function o(p){return p&&p.__esModule?p:{default:p}}function s(p,y){return(0,r.default)(n.default,p,y)}e.exports=i.default}),Iu=Li(hs),Us=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return this.args=r,Iu(this.tasks)},e.prototype.tap=function(i,r){var n=this;this.tasks.push(function(o){r.apply(void 0,To(n.args)),o(null,i)})},e}(),nc=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=E(_o),n=E(qs),o=E(ea),s=E(Ts),p=E(oo),y=E(xo),_=E(su);function E(z){return z&&z.__esModule?z:{default:z}}function T(z,J,oe){oe=(0,s.default)(oe);var he=0,De=0,it=z.length,ht=!1;it===0&&oe(null);function _t(jt,Vt){jt===!1&&(ht=!0),ht!==!0&&(jt?oe(jt):(++De===it||Vt===n.default)&&oe(null))}for(;he<it;he++)J(z[he],he,(0,p.default)(_t))}function P(z,J,oe){return(0,o.default)(z,Infinity,J,oe)}function D(z,J,oe){var he=(0,r.default)(z)?T:P;return he(z,(0,y.default)(J),oe)}i.default=(0,_.default)(D,3),e.exports=i.default});Li(nc);var lf=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default=s;var r=o(nc),n=o(hl);function o(p){return p&&p.__esModule?p:{default:p}}function s(p,y){return(0,n.default)(r.default,p,y)}e.exports=i.default}),Ks=Li(lf),ic=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.promise=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Ks(this.tasks)},e.prototype.tapPromise=function(i,r){var n=this;this.tasks.push(function(o){return vi(n,void 0,void 0,function(){return qn(this,function(s){switch(s.label){case 0:return[4,r()];case 1:return s.sent(),o(null,i),[2]}})})})},e}(),lu=Qi(function(e,i){Object.defineProperty(i,"__esModule",{value:!0});var r=p(Ts),n=p(oo),o=p(xo),s=p(su);function p(_){return _&&_.__esModule?_:{default:_}}function y(_,E){if(E=(0,r.default)(E),!Array.isArray(_))return E(new Error("First argument to waterfall must be an array of functions"));if(!_.length)return E();var T=0;function P(z){var J=(0,o.default)(_[T++]);J.apply(void 0,z.concat([(0,n.default)(D)]))}function D(z){for(var J=[],oe=arguments.length-1;oe-- >0;)J[oe]=arguments[oe+1];if(z!==!1){if(z||T===_.length)return E.apply(void 0,[z].concat(J));P(J)}}P([])}i.default=(0,s.default)(y),e.exports=i.default}),dl=Li(lu),Rc=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return dl(this.tasks)},e.prototype.tap=function(i,r){this.tasks.length===0?this.tasks.push(function(n){var o=r();n(o?null:!1,o)}):this.tasks.push(function(n,o){var s=r();o(s?null:!1,i)})},e}(),$s=function(){function e(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];this.tasks=[]}return e.prototype.call=function(){for(var i=arguments,r=[],n=0;n<arguments.length;n++)r[n]=i[n];return Iu(this.tasks)},e.prototype.tap=function(i,r){this.tasks.push(function(n){var o=r();n(o,i)})},e}(),Da=R(26729),Lc=R.n(Da),Rf=R(69848),Lf=R.n(Rf);function cf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function mh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?cf(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gh(e,i){var r=i.radius,n=r===void 0?40:r,o=i.maxZoom,s=o===void 0?18:o,p=i.minZoom,y=p===void 0?0:p,_=i.zoom,E=_===void 0?2:_;if(e.pointIndex){var T=e.pointIndex.getClusters(e.extent,Math.floor(E));return e.dataArray=ac(T),e}var P=new(Lf())({radius:n,minZoom:y,maxZoom:s}),D={type:"FeatureCollection",features:[]};return D.features=e.dataArray.map(function(z){return{type:"Feature",geometry:{type:"Point",coordinates:z.coordinates},properties:mh({},z)}}),P.load(D.features),P}function ac(e){return e.map(function(i,r){return mh({coordinates:i.geometry.coordinates,_id:r+1},i.properties)})}function ff(e){if(e.length===0)throw new Error("max requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]>i&&(i=e[r]);return i}function yh(e){if(e.length===0)throw new Error("min requires at least one data point");for(var i=e[0],r=1;r<e.length;r++)e[r]<i&&(i=e[r]);return i}function ep(e){if(e.length===0)return 0;for(var i=e[0],r=0,n,o=1;o<e.length;o++)n=i+e[o]*1,Math.abs(i)>=Math.abs(e[o])?r+=i-n+e[o]:r+=e[o]-n+i,i=n;return i+r*1}function Ol(e){if(e.length===0)throw new Error("mean requires at least one data point");return ep(e)/e.length}var hf={min:yh,max:ff,mean:Ol,sum:ep};function Lp(e,i){return e.map(function(r){return r[i]*1})}function kp(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function kc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?kp(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):kp(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function tp(e){var i=bd();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function bd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Ed(e,i){if(Array.isArray(i))return i}var Dp=function(e){(0,xn.Z)(r,e);var i=tp(r);function r(n,o){var s;return(0,lt.Z)(this,r),s=i.call(this),(0,I.Z)((0,xe.Z)(s),"data",void 0),(0,I.Z)((0,xe.Z)(s),"extent",void 0),(0,I.Z)((0,xe.Z)(s),"hooks",{init:new Us}),(0,I.Z)((0,xe.Z)(s),"parser",{type:"geojson"}),(0,I.Z)((0,xe.Z)(s),"transforms",[]),(0,I.Z)((0,xe.Z)(s),"cluster",!1),(0,I.Z)((0,xe.Z)(s),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,I.Z)((0,xe.Z)(s),"mapService",void 0),(0,I.Z)((0,xe.Z)(s),"invalidExtent",!1),(0,I.Z)((0,xe.Z)(s),"originData",void 0),(0,I.Z)((0,xe.Z)(s),"rawData",void 0),(0,I.Z)((0,xe.Z)(s),"cfg",{}),(0,I.Z)((0,xe.Z)(s),"clusterIndex",void 0),s.originData=n,s.initCfg(o),s.hooks.init.tap("parser",function(){s.excuteParser()}),s.hooks.init.tap("cluster",function(){s.initCluster()}),s.hooks.init.tap("transform",function(){s.executeTrans()}),s.init(),s}return(0,Lt.Z)(r,[{key:"setData",value:function(o,s){this.rawData=o,this.originData=o,this.initCfg(s),this.init(),this.emit("update")}},{key:"getClusters",value:function(o){return this.clusterIndex.getClusters(this.caculClusterExtent(2),o)}},{key:"getClustersLeaves",value:function(o){return this.clusterIndex.getLeaves(o,Infinity)}},{key:"updateClusterData",value:function(o){var s=this,p=this.clusterOptions,y=p.method,_=y===void 0?"sum":y,E=p.field,T=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(o));this.clusterOptions.zoom=o,T.forEach(function(P){P.id||(P.properties.point_count=1)}),(E||Hn()(_))&&(T=T.map(function(P){var D=P.id;if(D){var z=s.clusterIndex.getLeaves(D,Infinity),J=z.map(function(De){return De.properties}),oe;if(ci()(_)&&E){var he=Lp(J,E);oe=hf[_](he)}Hn()(_)&&(oe=_(J)),P.properties.stat=oe}else P.properties.point_count=1;return P})),this.data=Un("geojson")({type:"FeatureCollection",features:T}),this.executeTrans()}},{key:"getFeatureById",value:function(o){var s=this.parser.type,p=s===void 0?"geojson":s;if(p==="geojson"&&!this.cluster){var y=o<this.originData.features.length?this.originData.features[o]:"null",_=Yn()(y);if(this.transforms.length!==0){var E=this.data.dataArray.find(function(T){return T._id===o});_.properties=E}return _}else return o<this.data.dataArray.length?this.data.dataArray[o]:"null"}},{key:"getFeatureId",value:function(o,s){var p=this.data.dataArray.find(function(y){return y[o]===name});return p==null?void 0:p._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(o){var s=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(s=f(d(this.extent),o)),s[0].concat(s[1])}},{key:"initCfg",value:function(o){this.cfg=Dn()(this.cfg,o,Ed);var s=this.cfg;s&&(s.parser&&(this.parser=s.parser),s.transforms&&(this.transforms=s.transforms),this.cluster=s.cluster||!1,s.clusterOptions&&(this.cluster=!0,this.clusterOptions=kc(kc({},this.clusterOptions),s.clusterOptions)))}},{key:"excuteParser",value:function(){var o=this.parser,s=o.type||"geojson";if(s==="imagetile"){this.data={tileurl:this.originData,dataArray:[]};return}var p=Un(s);this.data=p(this.originData,o),this.extent=ec(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var o=this,s=this.transforms;s.forEach(function(p){var y=p.type,_=di(y)(o.data,p);Object.assign(o.data,_)})}},{key:"initCluster",value:function(){if(!!this.cluster){var o=this.clusterOptions||{};this.clusterIndex=gh(this.data,o)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(Da.EventEmitter);function rp(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Fp(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=pf(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,y=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw y}}}}function pf(e,i){if(!!e){if(typeof e=="string")return Bp(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Bp(e,i)}}function Bp(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var bo=6378e3;function _h(e,i){var r=e.dataArray,n=i.size,o=n===void 0?10:n,s=o/(2*Math.PI*bo)*(256<<20)/2,p=Np(r,o),y=p.gridHash,_=p.gridOffset,E=Eh(y,_,i);return{yOffset:s,xOffset:s,radius:s,type:"grid",dataArray:E}}function Np(e,i){var r=Infinity,n=-Infinity,o,s=Fp(e),p;try{for(s.s();!(p=s.n()).done;){var y=p.value;o=y.coordinates[1],Number.isFinite(o)&&(r=o<r?o:r,n=o>n?o:n)}}catch(ht){s.e(ht)}finally{s.f()}var _=(r+n)/2,E=xh(i,_);if(E.xOffset<=0||E.yOffset<=0)return{gridHash:{},gridOffset:E};var T={},P=Fp(e),D;try{for(P.s();!(D=P.n()).done;){var z=D.value,J=z.coordinates[1],oe=z.coordinates[0];if(Number.isFinite(J)&&Number.isFinite(oe)){var he=Math.floor((J+90)/E.yOffset),De=Math.floor((oe+180)/E.xOffset),it="".concat(he,"-").concat(De);T[it]=T[it]||{count:0,points:[]},T[it].count+=1,T[it].points.push(z)}}}catch(ht){P.e(ht)}finally{P.f()}return{gridHash:T,gridOffset:E}}function xh(e,i){var r=bh(e),n=kf(i,e);return{yOffset:r,xOffset:n}}function bh(e){return e/bo*(180/Math.PI)}function kf(e,i){return i/bo*(180/Math.PI)/Math.cos(e*Math.PI/180)}function Eh(e,i,r){return Object.keys(e).reduce(function(n,o,s){var p=o.split("-"),y=parseInt(p[0],10),_=parseInt(p[1],10),E={};if(r.field&&r.method){var T=$t(e[o].points,r.field);E[r.method]=zt[r.method](T)}return Object.assign(E,{_id:s,coordinates:_u([-180+i.xOffset*(_+.5),-90+i.yOffset*(y+.5)]),rawData:e[o].points,count:e[o].count}),n.push(E),n},[])}var vl=Math.PI/3,oc=[0,vl,2*vl,3*vl,4*vl,5*vl];function df(e){return e[0]}function Df(e){return e[1]}function Sh(){var e=0,i=0,r=1,n=1,o=df,s=Df,p,y,_;function E(P){var D={},z=[],J,oe=P.length;for(J=0;J<oe;++J)if(!(isNaN(De=+o.call(null,he=P[J],J,P))||isNaN(it=+s.call(null,he,J,P)))){var he,De,it,ht=Math.round(it=it/_),_t=Math.round(De=De/y-(ht&1)/2),jt=it-ht;if(Math.abs(jt)*3>1){var Vt=De-_t,rr=_t+(De<_t?-1:1)/2,yr=ht+(it<ht?-1:1),Yr=De-rr,fn=it-yr;Vt*Vt+jt*jt>Yr*Yr+fn*fn&&(_t=rr+(ht&1?1:-1)/2,ht=yr)}var Or=_t+"-"+ht,Tn=D[Or];Tn?Tn.push(he):(z.push(Tn=D[Or]=[he]),Tn.x=(_t+(ht&1)/2)*y,Tn.y=ht*_)}return z}function T(P){var D=0,z=0;return oc.map(function(J){var oe=Math.sin(J)*P,he=-Math.cos(J)*P,De=oe-D,it=he-z;return D=oe,z=he,[De,it]})}return E.hexagon=function(P){return"m"+T(P==null?p:+P).join("l")+"z"},E.centers=function(){for(var P=[],D=Math.round(i/_),z=Math.round(e/y),J=D*_;J<n+p;J+=_,++D)for(var oe=z*y+(D&1)*y/2;oe<r+y/2;oe+=y)P.push([oe,J]);return P},E.mesh=function(){var P=T(p).slice(0,4).join("l");return E.centers().map(function(D){return"M"+D+"m"+P}).join("")},E.x=function(P){return arguments.length?(o=P,E):o},E.y=function(P){return arguments.length?(s=P,E):s},E.radius=function(P){return arguments.length?(p=+P,y=p*2*Math.sin(vl),_=p*1.5,E):p},E.size=function(P){return arguments.length?(e=i=0,r=+P[0],n=+P[1],E):[r-e,n-i]},E.extent=function(P){return arguments.length?(e=+P[0][0],i=+P[0][1],r=+P[1][0],n=+P[1][1],E):[[e,i],[r,n]]},E.radius(1)}function Rl(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Ff(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Rl(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rl(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Bf=6378e3;function Ch(e,i){var r=e.dataArray,n=i.size,o=n===void 0?10:n,s=i.method,p=s===void 0?"sum":s,y=o/(2*Math.PI*Bf)*(256<<20)/2,_=r.map(function(D){var z=_u(D.coordinates),J=(0,ie.Z)(z,2),oe=J[0],he=J[1];return Ff(Ff({},D),{},{coordinates:[oe,he]})}),E=Sh().radius(y).x(function(D){return D.coordinates[0]}).y(function(D){return D.coordinates[1]}),T=E(_),P={dataArray:T.map(function(D,z){var J;if(i.field&&p){var oe=$t(D,i.field);D[p]=zt[p](oe)}return J={},(0,I.Z)(J,i.method,D[p]),(0,I.Z)(J,"count",D.length),(0,I.Z)(J,"rawData",D),(0,I.Z)(J,"coordinates",[D.x,D.y]),(0,I.Z)(J,"_id",z),J}),radius:y,xOffset:y,yOffset:y,type:"hexagon"};return P}function Dc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Fc(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Dc(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Dc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Js(e,i){var r=i.sourceField,n=i.targetField,o=i.data,s={};return o.forEach(function(p){s[p[r]]=p}),e.dataArray=e.dataArray.map(function(p){var y=p[n];return Fc(Fc({},p),s[y])}),e}function Nf(e,i){var r=i.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}Gn("geojson",ru),Gn("image",Br),Gn("csv",ss),Gn("json",Ti),Gn("raster",sn),Xn("cluster",gh),Xn("filter",rp),Xn("join",Js),Xn("map",Nf),Xn("grid",_h),Xn("hexagon",Ch);var zf=Mi,Uf=$a,Zf=Dp,np=R(28660),zr=R(86700),Bc=R(84879),Qt={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},wh=R(31745),zp=R.n(wh);function Up(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Zp(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Up(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Up(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cu(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=jp(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,y=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw y}}}}function jp(e,i){if(!!e){if(typeof e=="string")return jf(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jf(e,i)}}function jf(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var ml=30;function Ju(e){var i=e.characterSet,r=e.getFontWidth,n=e.fontHeight,o=e.buffer,s=e.maxCanvasWidth,p=e.mapping,y=p===void 0?{}:p,_=e.xOffset,E=_===void 0?0:_,T=e.yOffset,P=T===void 0?0:T,D=0,z=E;Array.from(i).forEach(function(oe,he){if(!y[oe]){var De=r(oe,he);z+ml>s&&(z=0,D++),y[oe]={x:z,y:P+D*ml,width:ml,height:ml,advance:De},z+=ml}});var J=n+o*2;return{mapping:y,xOffset:z,yOffset:P+D*J,canvasHeight:Qu(P+(D+1)*J)}}function Vp(e,i,r){var n=0,o=0,s=0,p=[],y={},_=cu(e),E;try{for(_.s();!(E=_.n()).done;){var T=E.value;if(!y[T.id]){var P=T.size;n+P+i>r&&(Gp(y,p,o),n=0,o=s+o+i,s=0,p=[]),p.push({icon:T,xOffset:n}),n=n+P+i,s=Math.max(s,P)}}}catch(z){_.e(z)}finally{_.f()}p.length>0&&Gp(y,p,o);var D=Qu(s+o+i);return{mapping:y,canvasHeight:D}}function Gp(e,i,r){var n=cu(i),o;try{for(n.s();!(o=n.n()).done;){var s=o.value,p=s.icon,y=s.xOffset;e[p.id]=Zp(Zp({},p),{},{x:y,y:r,image:p.image,width:p.width,height:p.height})}}catch(_){n.e(_)}finally{n.f()}}function Qu(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var Nc,sc;function Ll(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Hp(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,y=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw y}}}}function Hp(e,i){if(!!e){if(typeof e=="string")return Ah(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ah(e,i)}}function Ah(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Vf(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Gf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Vf(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Vf(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var _a=Hf(),uc="sans-serif",Fo="normal",Qs=24,Wp=3,Xp=.25,Sd=8,Yp=1024,Cd=1,Th=1,wd=3,pv=null;function Hf(){for(var e=[],i=32;i<128;i++)e.push(String.fromCharCode(i));return e}function ip(e,i,r,n){e.font="".concat(n," ").concat(r,"px ").concat(i),e.fillStyle="black",e.textBaseline="middle"}function ap(e,i){for(var r=0;r<e.length;r++)i.data[4*r+3]=e[r]}var Wf=(Nc=(0,zr.b2)(),Nc(sc=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"fontAtlas",void 0),(0,I.Z)(this,"iconFontMap",void 0),(0,I.Z)(this,"iconFontGlyphs",{}),(0,I.Z)(this,"fontOptions",void 0),(0,I.Z)(this,"key",void 0),(0,I.Z)(this,"cache",new b(wd))}return(0,Lt.Z)(e,[{key:"scale",get:function(){return Th}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:uc,fontWeight:Fo,characterSet:_a,fontSize:Qs,buffer:Wp,sdf:!0,cutoff:Xp,radius:Sd,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var n=this;r.forEach(function(o){n.iconFontGlyphs[o.name]=o.unicode})}},{key:"addIconFont",value:function(r,n){this.iconFontMap.set(r,n)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=Gf(Gf({},this.fontOptions),r),this.key=this.getKey();var n=this.getNewChars(this.key,this.fontOptions.characterSet),o=this.cache.get(this.key);if(!(o&&n.length===0)){var s=this.generateFontAtlas(this.key,n,o);this.fontAtlas=s,this.cache.set(this.key,s)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,n,o){var s=this.fontOptions,p=s.fontFamily,y=s.fontWeight,_=s.fontSize,E=s.buffer,T=s.sdf,P=s.radius,D=s.cutoff,z=s.iconfont,J=o&&o.data;J||(J=ya.document.createElement("canvas"),J.width=Yp);var oe=J.getContext("2d");ip(oe,p,_,y);var he=Ju(Gf({getFontWidth:function(nl){return oe.measureText(nl).width},fontHeight:_*Th,buffer:E,characterSet:n,maxCanvasWidth:Yp},o&&{mapping:o.mapping,xOffset:o.xOffset,yOffset:o.yOffset})),De=he.mapping,it=he.canvasHeight,ht=he.xOffset,_t=he.yOffset,jt=oe.getImageData(0,0,J.width,J.height);if(J.height=it,oe.putImageData(jt,0,0),ip(oe,p,_,y),T){var Vt=new(zp())(_,E,P,D,p,y),rr=oe.getImageData(0,0,Vt.size,Vt.size),yr=Ll(n),Yr;try{for(yr.s();!(Yr=yr.n()).done;){var fn=Yr.value;if(z){var Or=String.fromCharCode(parseInt(fn.replace("&#x","").replace(";",""),16)),Tn=Vt.draw(Or);ap(Tn,rr)}else ap(Vt.draw(fn),rr);oe.putImageData(rr,De[fn].x,De[fn].y)}}catch(Cs){yr.e(Cs)}finally{yr.f()}}else{var Bn=Ll(n),hi;try{for(Bn.s();!(hi=Bn.n()).done;){var vo=hi.value;oe.fillText(vo,De[vo].x,De[vo].y+_*Cd)}}catch(Cs){Bn.e(Cs)}finally{Bn.f()}}return{xOffset:ht,yOffset:_t,mapping:De,data:J,width:J.width,height:J.height}}},{key:"getKey",value:function(){return"key";var r,n,o,s,p,y,_,E}},{key:"getNewChars",value:function(r,n){var o=this.cache.get(r);if(!o)return n;var s=[],p=o.mapping,y=new Set(Object.keys(p)),_=new Set(n);return _.forEach(function(E){y.has(E)||s.push(E)}),s}}]),e}())||sc),Oa,Mh;function kl(e){var i=vf();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function vf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var op=3,qp=1024,N=64,me=(Oa=(0,zr.b2)(),Oa(Mh=function(e){(0,xn.Z)(r,e);var i=kl(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"canvasHeight",128),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"canvas",void 0),(0,I.Z)((0,xe.Z)(n),"iconData",void 0),(0,I.Z)((0,xe.Z)(n),"iconMap",void 0),(0,I.Z)((0,xe.Z)(n),"ctx",void 0),(0,I.Z)((0,xe.Z)(n),"loadingImageCount",0),n}return(0,Lt.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=ya.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(o,s){var p=this,y=new Image;if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:N}),this.updateIconMap(),this.loadImage(s).then(function(_){y=_;var E=p.iconData.find(function(T){return T.id===o});E&&(E.image=y,E.width=y.width,E.height=y.height),p.update()})}},{key:"addImageMini",value:function(o,s,p){var y=this,_=p.getSceneConfig().canvas,E=_.createImage();if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:N}),this.updateIconMap(),this.loadImageMini(s,_).then(function(T){E=T;var P=y.iconData.find(function(D){return D.id===o});P&&(P.image=E,P.width=E.width,P.height=E.height),y.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(o){return this.iconMap.hasOwnProperty(o)}},{key:"removeImage",value:function(o){this.hasImage(o)&&(this.iconData=this.iconData.filter(function(s){return s.id!==o}),delete this.iconMap[o],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var o=this;this.canvas.width=qp,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(s){var p=o.iconMap[s],y=p.x,_=p.y,E=p.image,T=p.width,P=T===void 0?64:T,D=p.height,z=D===void 0?64:D,J=Math.max(P,z),oe=J/N,he=z/oe,De=P/oe;E&&o.ctx.drawImage(E,y+(N-De)/2,_+(N-he)/2,De,he)})}},{key:"updateIconMap",value:function(){var o=Vp(this.iconData,op,qp),s=o.mapping,p=o.canvasHeight;this.iconMap=s,this.canvasHeight=p}},{key:"loadImage",value:function(o){return new Promise(function(s,p){if(o instanceof HTMLImageElement){s(o);return}var y=new Image;y.crossOrigin="anonymous",y.onload=function(){s(y)},y.onerror=function(){p(new Error("Could not load image at "+o))},y.src=o instanceof File?URL.createObjectURL(o):o})}},{key:"loadImageMini",value:function(o,s){return new Promise(function(p,y){var _=s.createImage();_.crossOrigin="anonymous",_.onload=function(){p(_)},_.onerror=function(){y(new Error("Could not load image at "+o))},_.src=o})}}]),r}(Da.EventEmitter))||Mh),Pe=R(49685);function Mt(){var e=new Pe.WT(16);return Pe.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function sr(e){var i=new Pe.WT(16);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i}function Rt(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function er(e,i,r,n,o,s,p,y,_,E,T,P,D,z,J,oe){var he=new Pe.WT(16);return he[0]=e,he[1]=i,he[2]=r,he[3]=n,he[4]=o,he[5]=s,he[6]=p,he[7]=y,he[8]=_,he[9]=E,he[10]=T,he[11]=P,he[12]=D,he[13]=z,he[14]=J,he[15]=oe,he}function pr(e,i,r,n,o,s,p,y,_,E,T,P,D,z,J,oe,he){return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e[4]=s,e[5]=p,e[6]=y,e[7]=_,e[8]=E,e[9]=T,e[10]=P,e[11]=D,e[12]=z,e[13]=J,e[14]=oe,e[15]=he,e}function br(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wr(e,i){if(e===i){var r=i[1],n=i[2],o=i[3],s=i[6],p=i[7],y=i[11];e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=r,e[6]=i[9],e[7]=i[13],e[8]=n,e[9]=s,e[11]=i[14],e[12]=o,e[13]=p,e[14]=y}else e[0]=i[0],e[1]=i[4],e[2]=i[8],e[3]=i[12],e[4]=i[1],e[5]=i[5],e[6]=i[9],e[7]=i[13],e[8]=i[2],e[9]=i[6],e[10]=i[10],e[11]=i[14],e[12]=i[3],e[13]=i[7],e[14]=i[11],e[15]=i[15];return e}function Mr(e,i){var r=i[0],n=i[1],o=i[2],s=i[3],p=i[4],y=i[5],_=i[6],E=i[7],T=i[8],P=i[9],D=i[10],z=i[11],J=i[12],oe=i[13],he=i[14],De=i[15],it=r*y-n*p,ht=r*_-o*p,_t=r*E-s*p,jt=n*_-o*y,Vt=n*E-s*y,rr=o*E-s*_,yr=T*oe-P*J,Yr=T*he-D*J,fn=T*De-z*J,Or=P*he-D*oe,Tn=P*De-z*oe,Bn=D*De-z*he,hi=it*Bn-ht*Tn+_t*Or+jt*fn-Vt*Yr+rr*yr;return hi?(hi=1/hi,e[0]=(y*Bn-_*Tn+E*Or)*hi,e[1]=(o*Tn-n*Bn-s*Or)*hi,e[2]=(oe*rr-he*Vt+De*jt)*hi,e[3]=(D*Vt-P*rr-z*jt)*hi,e[4]=(_*fn-p*Bn-E*Yr)*hi,e[5]=(r*Bn-o*fn+s*Yr)*hi,e[6]=(he*_t-J*rr-De*ht)*hi,e[7]=(T*rr-D*_t+z*ht)*hi,e[8]=(p*Tn-y*fn+E*yr)*hi,e[9]=(n*fn-r*Tn-s*yr)*hi,e[10]=(J*Vt-oe*_t+De*it)*hi,e[11]=(P*_t-T*Vt-z*it)*hi,e[12]=(y*Yr-p*Or-_*yr)*hi,e[13]=(r*Or-n*Yr+o*yr)*hi,e[14]=(oe*ht-J*jt-he*it)*hi,e[15]=(T*jt-P*ht+D*it)*hi,e):null}function Rr(e,i){var r=i[0],n=i[1],o=i[2],s=i[3],p=i[4],y=i[5],_=i[6],E=i[7],T=i[8],P=i[9],D=i[10],z=i[11],J=i[12],oe=i[13],he=i[14],De=i[15];return e[0]=y*(D*De-z*he)-P*(_*De-E*he)+oe*(_*z-E*D),e[1]=-(n*(D*De-z*he)-P*(o*De-s*he)+oe*(o*z-s*D)),e[2]=n*(_*De-E*he)-y*(o*De-s*he)+oe*(o*E-s*_),e[3]=-(n*(_*z-E*D)-y*(o*z-s*D)+P*(o*E-s*_)),e[4]=-(p*(D*De-z*he)-T*(_*De-E*he)+J*(_*z-E*D)),e[5]=r*(D*De-z*he)-T*(o*De-s*he)+J*(o*z-s*D),e[6]=-(r*(_*De-E*he)-p*(o*De-s*he)+J*(o*E-s*_)),e[7]=r*(_*z-E*D)-p*(o*z-s*D)+T*(o*E-s*_),e[8]=p*(P*De-z*oe)-T*(y*De-E*oe)+J*(y*z-E*P),e[9]=-(r*(P*De-z*oe)-T*(n*De-s*oe)+J*(n*z-s*P)),e[10]=r*(y*De-E*oe)-p*(n*De-s*oe)+J*(n*E-s*y),e[11]=-(r*(y*z-E*P)-p*(n*z-s*P)+T*(n*E-s*y)),e[12]=-(p*(P*he-D*oe)-T*(y*he-_*oe)+J*(y*D-_*P)),e[13]=r*(P*he-D*oe)-T*(n*he-o*oe)+J*(n*D-o*P),e[14]=-(r*(y*he-_*oe)-p*(n*he-o*oe)+J*(n*_-o*y)),e[15]=r*(y*D-_*P)-p*(n*D-o*P)+T*(n*_-o*y),e}function Hr(e){var i=e[0],r=e[1],n=e[2],o=e[3],s=e[4],p=e[5],y=e[6],_=e[7],E=e[8],T=e[9],P=e[10],D=e[11],z=e[12],J=e[13],oe=e[14],he=e[15],De=i*p-r*s,it=i*y-n*s,ht=i*_-o*s,_t=r*y-n*p,jt=r*_-o*p,Vt=n*_-o*y,rr=E*J-T*z,yr=E*oe-P*z,Yr=E*he-D*z,fn=T*oe-P*J,Or=T*he-D*J,Tn=P*he-D*oe;return De*Tn-it*Or+ht*fn+_t*Yr-jt*yr+Vt*rr}function vr(e,i,r){var n=i[0],o=i[1],s=i[2],p=i[3],y=i[4],_=i[5],E=i[6],T=i[7],P=i[8],D=i[9],z=i[10],J=i[11],oe=i[12],he=i[13],De=i[14],it=i[15],ht=r[0],_t=r[1],jt=r[2],Vt=r[3];return e[0]=ht*n+_t*y+jt*P+Vt*oe,e[1]=ht*o+_t*_+jt*D+Vt*he,e[2]=ht*s+_t*E+jt*z+Vt*De,e[3]=ht*p+_t*T+jt*J+Vt*it,ht=r[4],_t=r[5],jt=r[6],Vt=r[7],e[4]=ht*n+_t*y+jt*P+Vt*oe,e[5]=ht*o+_t*_+jt*D+Vt*he,e[6]=ht*s+_t*E+jt*z+Vt*De,e[7]=ht*p+_t*T+jt*J+Vt*it,ht=r[8],_t=r[9],jt=r[10],Vt=r[11],e[8]=ht*n+_t*y+jt*P+Vt*oe,e[9]=ht*o+_t*_+jt*D+Vt*he,e[10]=ht*s+_t*E+jt*z+Vt*De,e[11]=ht*p+_t*T+jt*J+Vt*it,ht=r[12],_t=r[13],jt=r[14],Vt=r[15],e[12]=ht*n+_t*y+jt*P+Vt*oe,e[13]=ht*o+_t*_+jt*D+Vt*he,e[14]=ht*s+_t*E+jt*z+Vt*De,e[15]=ht*p+_t*T+jt*J+Vt*it,e}function Ar(e,i,r){var n=r[0],o=r[1],s=r[2],p,y,_,E,T,P,D,z,J,oe,he,De;return i===e?(e[12]=i[0]*n+i[4]*o+i[8]*s+i[12],e[13]=i[1]*n+i[5]*o+i[9]*s+i[13],e[14]=i[2]*n+i[6]*o+i[10]*s+i[14],e[15]=i[3]*n+i[7]*o+i[11]*s+i[15]):(p=i[0],y=i[1],_=i[2],E=i[3],T=i[4],P=i[5],D=i[6],z=i[7],J=i[8],oe=i[9],he=i[10],De=i[11],e[0]=p,e[1]=y,e[2]=_,e[3]=E,e[4]=T,e[5]=P,e[6]=D,e[7]=z,e[8]=J,e[9]=oe,e[10]=he,e[11]=De,e[12]=p*n+T*o+J*s+i[12],e[13]=y*n+P*o+oe*s+i[13],e[14]=_*n+D*o+he*s+i[14],e[15]=E*n+z*o+De*s+i[15]),e}function at(e,i,r){var n=r[0],o=r[1],s=r[2];return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=i[3]*n,e[4]=i[4]*o,e[5]=i[5]*o,e[6]=i[6]*o,e[7]=i[7]*o,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=i[11]*s,e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],e}function Gt(e,i,r,n){var o=n[0],s=n[1],p=n[2],y=Math.hypot(o,s,p),_,E,T,P,D,z,J,oe,he,De,it,ht,_t,jt,Vt,rr,yr,Yr,fn,Or,Tn,Bn,hi,vo;return y<Pe.Ib?null:(y=1/y,o*=y,s*=y,p*=y,_=Math.sin(r),E=Math.cos(r),T=1-E,P=i[0],D=i[1],z=i[2],J=i[3],oe=i[4],he=i[5],De=i[6],it=i[7],ht=i[8],_t=i[9],jt=i[10],Vt=i[11],rr=o*o*T+E,yr=s*o*T+p*_,Yr=p*o*T-s*_,fn=o*s*T-p*_,Or=s*s*T+E,Tn=p*s*T+o*_,Bn=o*p*T+s*_,hi=s*p*T-o*_,vo=p*p*T+E,e[0]=P*rr+oe*yr+ht*Yr,e[1]=D*rr+he*yr+_t*Yr,e[2]=z*rr+De*yr+jt*Yr,e[3]=J*rr+it*yr+Vt*Yr,e[4]=P*fn+oe*Or+ht*Tn,e[5]=D*fn+he*Or+_t*Tn,e[6]=z*fn+De*Or+jt*Tn,e[7]=J*fn+it*Or+Vt*Tn,e[8]=P*Bn+oe*hi+ht*vo,e[9]=D*Bn+he*hi+_t*vo,e[10]=z*Bn+De*hi+jt*vo,e[11]=J*Bn+it*hi+Vt*vo,i!==e&&(e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e)}function Sr(e,i,r){var n=Math.sin(r),o=Math.cos(r),s=i[4],p=i[5],y=i[6],_=i[7],E=i[8],T=i[9],P=i[10],D=i[11];return i!==e&&(e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[4]=s*o+E*n,e[5]=p*o+T*n,e[6]=y*o+P*n,e[7]=_*o+D*n,e[8]=E*o-s*n,e[9]=T*o-p*n,e[10]=P*o-y*n,e[11]=D*o-_*n,e}function Ur(e,i,r){var n=Math.sin(r),o=Math.cos(r),s=i[0],p=i[1],y=i[2],_=i[3],E=i[8],T=i[9],P=i[10],D=i[11];return i!==e&&(e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*o-E*n,e[1]=p*o-T*n,e[2]=y*o-P*n,e[3]=_*o-D*n,e[8]=s*n+E*o,e[9]=p*n+T*o,e[10]=y*n+P*o,e[11]=_*n+D*o,e}function fr(e,i,r){var n=Math.sin(r),o=Math.cos(r),s=i[0],p=i[1],y=i[2],_=i[3],E=i[4],T=i[5],P=i[6],D=i[7];return i!==e&&(e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15]),e[0]=s*o+E*n,e[1]=p*o+T*n,e[2]=y*o+P*n,e[3]=_*o+D*n,e[4]=E*o-s*n,e[5]=T*o-p*n,e[6]=P*o-y*n,e[7]=D*o-_*n,e}function kr(e,i){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function en(e,i){return e[0]=i[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Fn(e,i,r){var n=r[0],o=r[1],s=r[2],p=Math.hypot(n,o,s),y,_,E;return p<Pe.Ib?null:(p=1/p,n*=p,o*=p,s*=p,y=Math.sin(i),_=Math.cos(i),E=1-_,e[0]=n*n*E+_,e[1]=o*n*E+s*y,e[2]=s*n*E-o*y,e[3]=0,e[4]=n*o*E-s*y,e[5]=o*o*E+_,e[6]=s*o*E+n*y,e[7]=0,e[8]=n*s*E+o*y,e[9]=o*s*E-n*y,e[10]=s*s*E+_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function tr(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ar(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Sn(e,i){var r=Math.sin(i),n=Math.cos(i);return e[0]=n,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xr(e,i,r){var n=i[0],o=i[1],s=i[2],p=i[3],y=n+n,_=o+o,E=s+s,T=n*y,P=n*_,D=n*E,z=o*_,J=o*E,oe=s*E,he=p*y,De=p*_,it=p*E;return e[0]=1-(z+oe),e[1]=P+it,e[2]=D-De,e[3]=0,e[4]=P-it,e[5]=1-(T+oe),e[6]=J+he,e[7]=0,e[8]=D+De,e[9]=J-he,e[10]=1-(T+z),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Tr(e,i){var r=new Pe.WT(3),n=-i[0],o=-i[1],s=-i[2],p=i[3],y=i[4],_=i[5],E=i[6],T=i[7],P=n*n+o*o+s*s+p*p;return P>0?(r[0]=(y*p+T*n+_*s-E*o)*2/P,r[1]=(_*p+T*o+E*n-y*s)*2/P,r[2]=(E*p+T*s+y*o-_*n)*2/P):(r[0]=(y*p+T*n+_*s-E*o)*2,r[1]=(_*p+T*o+E*n-y*s)*2,r[2]=(E*p+T*s+y*o-_*n)*2),Xr(e,i,r),e}function Jr(e,i){return e[0]=i[12],e[1]=i[13],e[2]=i[14],e}function Qr(e,i){var r=i[0],n=i[1],o=i[2],s=i[4],p=i[5],y=i[6],_=i[8],E=i[9],T=i[10];return e[0]=Math.hypot(r,n,o),e[1]=Math.hypot(s,p,y),e[2]=Math.hypot(_,E,T),e}function mi(e,i){var r=new Pe.WT(3);Qr(r,i);var n=1/r[0],o=1/r[1],s=1/r[2],p=i[0]*n,y=i[1]*o,_=i[2]*s,E=i[4]*n,T=i[5]*o,P=i[6]*s,D=i[8]*n,z=i[9]*o,J=i[10]*s,oe=p+T+J,he=0;return oe>0?(he=Math.sqrt(oe+1)*2,e[3]=.25*he,e[0]=(P-z)/he,e[1]=(D-_)/he,e[2]=(y-E)/he):p>T&&p>J?(he=Math.sqrt(1+p-T-J)*2,e[3]=(P-z)/he,e[0]=.25*he,e[1]=(y+E)/he,e[2]=(D+_)/he):T>J?(he=Math.sqrt(1+T-p-J)*2,e[3]=(D-_)/he,e[0]=(y+E)/he,e[1]=.25*he,e[2]=(P+z)/he):(he=Math.sqrt(1+J-p-T)*2,e[3]=(y-E)/he,e[0]=(D+_)/he,e[1]=(P+z)/he,e[2]=.25*he),e}function ri(e,i,r,n){var o=i[0],s=i[1],p=i[2],y=i[3],_=o+o,E=s+s,T=p+p,P=o*_,D=o*E,z=o*T,J=s*E,oe=s*T,he=p*T,De=y*_,it=y*E,ht=y*T,_t=n[0],jt=n[1],Vt=n[2];return e[0]=(1-(J+he))*_t,e[1]=(D+ht)*_t,e[2]=(z-it)*_t,e[3]=0,e[4]=(D-ht)*jt,e[5]=(1-(P+he))*jt,e[6]=(oe+De)*jt,e[7]=0,e[8]=(z+it)*Vt,e[9]=(oe-De)*Vt,e[10]=(1-(P+J))*Vt,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Kr(e,i,r,n,o){var s=i[0],p=i[1],y=i[2],_=i[3],E=s+s,T=p+p,P=y+y,D=s*E,z=s*T,J=s*P,oe=p*T,he=p*P,De=y*P,it=_*E,ht=_*T,_t=_*P,jt=n[0],Vt=n[1],rr=n[2],yr=o[0],Yr=o[1],fn=o[2],Or=(1-(oe+De))*jt,Tn=(z+_t)*jt,Bn=(J-ht)*jt,hi=(z-_t)*Vt,vo=(1-(D+De))*Vt,Cs=(he+it)*Vt,nl=(J+ht)*rr,yc=(he-it)*rr,xl=(1-(D+oe))*rr;return e[0]=Or,e[1]=Tn,e[2]=Bn,e[3]=0,e[4]=hi,e[5]=vo,e[6]=Cs,e[7]=0,e[8]=nl,e[9]=yc,e[10]=xl,e[11]=0,e[12]=r[0]+yr-(Or*yr+hi*Yr+nl*fn),e[13]=r[1]+Yr-(Tn*yr+vo*Yr+yc*fn),e[14]=r[2]+fn-(Bn*yr+Cs*Yr+xl*fn),e[15]=1,e}function an(e,i){var r=i[0],n=i[1],o=i[2],s=i[3],p=r+r,y=n+n,_=o+o,E=r*p,T=n*p,P=n*y,D=o*p,z=o*y,J=o*_,oe=s*p,he=s*y,De=s*_;return e[0]=1-P-J,e[1]=T+De,e[2]=D-he,e[3]=0,e[4]=T-De,e[5]=1-E-J,e[6]=z+oe,e[7]=0,e[8]=D+he,e[9]=z-oe,e[10]=1-E-P,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Kn(e,i,r,n,o,s,p){var y=1/(r-i),_=1/(o-n),E=1/(s-p);return e[0]=s*2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s*2*_,e[6]=0,e[7]=0,e[8]=(r+i)*y,e[9]=(o+n)*_,e[10]=(p+s)*E,e[11]=-1,e[12]=0,e[13]=0,e[14]=p*s*2*E,e[15]=0,e}function ui(e,i,r,n,o){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(p=1/(n-o),e[10]=(o+n)*p,e[14]=2*o*n*p):(e[10]=-1,e[14]=-2*n),e}var Fi=ui;function so(e,i,r,n,o){var s=1/Math.tan(i/2),p;return e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(p=1/(n-o),e[10]=o*p,e[14]=o*n*p):(e[10]=-1,e[14]=-n),e}function po(e,i,r,n){var o=Math.tan(i.upDegrees*Math.PI/180),s=Math.tan(i.downDegrees*Math.PI/180),p=Math.tan(i.leftDegrees*Math.PI/180),y=Math.tan(i.rightDegrees*Math.PI/180),_=2/(p+y),E=2/(o+s);return e[0]=_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=E,e[6]=0,e[7]=0,e[8]=-((p-y)*_*.5),e[9]=(o-s)*E*.5,e[10]=n/(r-n),e[11]=-1,e[12]=0,e[13]=0,e[14]=n*r/(r-n),e[15]=0,e}function ki(e,i,r,n,o,s,p){var y=1/(i-r),_=1/(n-o),E=1/(s-p);return e[0]=-2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*_,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*E,e[11]=0,e[12]=(i+r)*y,e[13]=(o+n)*_,e[14]=(p+s)*E,e[15]=1,e}var ns=ki;function qa(e,i,r,n,o,s,p){var y=1/(i-r),_=1/(n-o),E=1/(s-p);return e[0]=-2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*_,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=E,e[11]=0,e[12]=(i+r)*y,e[13]=(o+n)*_,e[14]=s*E,e[15]=1,e}function $o(e,i,r,n){var o,s,p,y,_,E,T,P,D,z,J=i[0],oe=i[1],he=i[2],De=n[0],it=n[1],ht=n[2],_t=r[0],jt=r[1],Vt=r[2];return Math.abs(J-_t)<Pe.Ib&&Math.abs(oe-jt)<Pe.Ib&&Math.abs(he-Vt)<Pe.Ib?br(e):(T=J-_t,P=oe-jt,D=he-Vt,z=1/Math.hypot(T,P,D),T*=z,P*=z,D*=z,o=it*D-ht*P,s=ht*T-De*D,p=De*P-it*T,z=Math.hypot(o,s,p),z?(z=1/z,o*=z,s*=z,p*=z):(o=0,s=0,p=0),y=P*p-D*s,_=D*o-T*p,E=T*s-P*o,z=Math.hypot(y,_,E),z?(z=1/z,y*=z,_*=z,E*=z):(y=0,_=0,E=0),e[0]=o,e[1]=y,e[2]=T,e[3]=0,e[4]=s,e[5]=_,e[6]=P,e[7]=0,e[8]=p,e[9]=E,e[10]=D,e[11]=0,e[12]=-(o*J+s*oe+p*he),e[13]=-(y*J+_*oe+E*he),e[14]=-(T*J+P*oe+D*he),e[15]=1,e)}function Mo(e,i,r,n){var o=i[0],s=i[1],p=i[2],y=n[0],_=n[1],E=n[2],T=o-r[0],P=s-r[1],D=p-r[2],z=T*T+P*P+D*D;z>0&&(z=1/Math.sqrt(z),T*=z,P*=z,D*=z);var J=_*D-E*P,oe=E*T-y*D,he=y*P-_*T;return z=J*J+oe*oe+he*he,z>0&&(z=1/Math.sqrt(z),J*=z,oe*=z,he*=z),e[0]=J,e[1]=oe,e[2]=he,e[3]=0,e[4]=P*he-D*oe,e[5]=D*J-T*he,e[6]=T*oe-P*J,e[7]=0,e[8]=T,e[9]=P,e[10]=D,e[11]=0,e[12]=o,e[13]=s,e[14]=p,e[15]=1,e}function Jo(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Uo(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function ps(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e[4]=i[4]+r[4],e[5]=i[5]+r[5],e[6]=i[6]+r[6],e[7]=i[7]+r[7],e[8]=i[8]+r[8],e[9]=i[9]+r[9],e[10]=i[10]+r[10],e[11]=i[11]+r[11],e[12]=i[12]+r[12],e[13]=i[13]+r[13],e[14]=i[14]+r[14],e[15]=i[15]+r[15],e}function uo(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e[4]=i[4]-r[4],e[5]=i[5]-r[5],e[6]=i[6]-r[6],e[7]=i[7]-r[7],e[8]=i[8]-r[8],e[9]=i[9]-r[9],e[10]=i[10]-r[10],e[11]=i[11]-r[11],e[12]=i[12]-r[12],e[13]=i[13]-r[13],e[14]=i[14]-r[14],e[15]=i[15]-r[15],e}function gi(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=i[7]*r,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=i[11]*r,e[12]=i[12]*r,e[13]=i[13]*r,e[14]=i[14]*r,e[15]=i[15]*r,e}function Zo(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e[4]=i[4]+r[4]*n,e[5]=i[5]+r[5]*n,e[6]=i[6]+r[6]*n,e[7]=i[7]+r[7]*n,e[8]=i[8]+r[8]*n,e[9]=i[9]+r[9]*n,e[10]=i[10]+r[10]*n,e[11]=i[11]+r[11]*n,e[12]=i[12]+r[12]*n,e[13]=i[13]+r[13]*n,e[14]=i[14]+r[14]*n,e[15]=i[15]+r[15]*n,e}function ra(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]&&e[4]===i[4]&&e[5]===i[5]&&e[6]===i[6]&&e[7]===i[7]&&e[8]===i[8]&&e[9]===i[9]&&e[10]===i[10]&&e[11]===i[11]&&e[12]===i[12]&&e[13]===i[13]&&e[14]===i[14]&&e[15]===i[15]}function jo(e,i){var r=e[0],n=e[1],o=e[2],s=e[3],p=e[4],y=e[5],_=e[6],E=e[7],T=e[8],P=e[9],D=e[10],z=e[11],J=e[12],oe=e[13],he=e[14],De=e[15],it=i[0],ht=i[1],_t=i[2],jt=i[3],Vt=i[4],rr=i[5],yr=i[6],Yr=i[7],fn=i[8],Or=i[9],Tn=i[10],Bn=i[11],hi=i[12],vo=i[13],Cs=i[14],nl=i[15];return Math.abs(r-it)<=Pe.Ib*Math.max(1,Math.abs(r),Math.abs(it))&&Math.abs(n-ht)<=Pe.Ib*Math.max(1,Math.abs(n),Math.abs(ht))&&Math.abs(o-_t)<=Pe.Ib*Math.max(1,Math.abs(o),Math.abs(_t))&&Math.abs(s-jt)<=Pe.Ib*Math.max(1,Math.abs(s),Math.abs(jt))&&Math.abs(p-Vt)<=Pe.Ib*Math.max(1,Math.abs(p),Math.abs(Vt))&&Math.abs(y-rr)<=Pe.Ib*Math.max(1,Math.abs(y),Math.abs(rr))&&Math.abs(_-yr)<=Pe.Ib*Math.max(1,Math.abs(_),Math.abs(yr))&&Math.abs(E-Yr)<=Pe.Ib*Math.max(1,Math.abs(E),Math.abs(Yr))&&Math.abs(T-fn)<=Pe.Ib*Math.max(1,Math.abs(T),Math.abs(fn))&&Math.abs(P-Or)<=Pe.Ib*Math.max(1,Math.abs(P),Math.abs(Or))&&Math.abs(D-Tn)<=Pe.Ib*Math.max(1,Math.abs(D),Math.abs(Tn))&&Math.abs(z-Bn)<=Pe.Ib*Math.max(1,Math.abs(z),Math.abs(Bn))&&Math.abs(J-hi)<=Pe.Ib*Math.max(1,Math.abs(J),Math.abs(hi))&&Math.abs(oe-vo)<=Pe.Ib*Math.max(1,Math.abs(oe),Math.abs(vo))&&Math.abs(he-Cs)<=Pe.Ib*Math.max(1,Math.abs(he),Math.abs(Cs))&&Math.abs(De-nl)<=Pe.Ib*Math.max(1,Math.abs(De),Math.abs(nl))}var ti=vr,Bi=uo,la,Eo,gl=(la=(0,zr.b2)(),la(Eo=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"overridedViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,I.Z)(this,"jitteredProjectionMatrix",void 0),(0,I.Z)(this,"viewMatrixInverse",void 0),(0,I.Z)(this,"cameraPosition",void 0)}return(0,Lt.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=Mt(),Mr(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),n=(0,ie.Z)(r,2),o=n[0],s=n[1];return[o,s]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,n){var o=kr(Mt(),[r,n,0]);this.jitteredProjectionMatrix=vr(Mt(),o,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=vr(Mt(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Eo),Ie,Bt;function Ct(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=vn(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,y=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw y}}}}function vn(e,i){if(!!e){if(typeof e=="string")return Ni(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ni(e,i)}}function Ni(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Se=(Ie=(0,zr.b2)(),Ie(Bt=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"controlCorners",void 0),(0,I.Z)(this,"controlContainer",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"controls",[]),(0,I.Z)(this,"unAddControls",[])}return(0,Lt.Z)(e,[{key:"init",value:function(r,n){this.container=r.container,this.scene=n,this.mapsService=n.get(Qt.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,n){var o=n.get(Qt.IMapService);o.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(n){return n.controlOption.name===r})}},{key:"removeControl",value:function(r){var n=this.controls.indexOf(r);return n>-1&&this.controls.splice(n,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(n){n.addTo(r.scene),r.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=Ct(this.controls),n;try{for(r.s();!(n=r.n()).done;){var o=n.value;o.remove()}}catch(s){r.e(s)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},n="l7-",o=this.controlContainer=pa("div",n+"control-container",this.container);function s(){var p=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],y=p.map(function(_){return n+_}).join(" ");r[p.join("")]=pa("div",y,o)}s(["top","left"]),s(["top","right"]),s(["bottom","left"]),s(["bottom","right"]),s(["top","center"]),s(["right","center"]),s(["left","center"]),s(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&ho(this.controlCorners[r]);this.controlContainer&&ho(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||Bt),ce,Ve,dt=(ce=(0,zr.b2)(),ce(Ve=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"container",void 0),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"markers",[]),(0,I.Z)(this,"markerLayers",[]),(0,I.Z)(this,"unAddMarkers",[]),(0,I.Z)(this,"unAddMarkerLayers",[])}return(0,Lt.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var n=this.markerLayers.indexOf(r);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(n){n.addTo(r.scene),r.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(n){r.markerLayers.push(n),n.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var n=this.markers.indexOf(r);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Qt.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||Ve),It,Je,Ne=(It=(0,zr.b2)(),It(Je=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"scene",void 0),(0,I.Z)(this,"popup",void 0),(0,I.Z)(this,"mapsService",void 0),(0,I.Z)(this,"unAddPopup",void 0)}return(0,Lt.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(Qt.IMapService)}}]),e}())||Je),nt=R(82492),ye=R.n(nt),Ze={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},we=Ze,ft,St;function hr(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Zr(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?hr(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hr(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var jr={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},rn={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Nr=(ft=(0,zr.b2)(),ft(St=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"sceneConfigCache",{}),(0,I.Z)(this,"layerConfigCache",{})}return(0,Lt.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return we[r]}},{key:"setSceneConfig",value:function(r,n){this.sceneConfigCache[r]=Zr(Zr({},jr),n)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,n,o){this.layerConfigCache[n]=Zr({},ye()({},this.sceneConfigCache[r],rn,o))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||St);function mr(e,i,r,n){!r||Object.defineProperty(e,i,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function ur(e,i,r,n,o){var s={};return Object.keys(n).forEach(function(p){s[p]=n[p]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=r.slice().reverse().reduce(function(p,y){return y(e,i,p)||p},s),o&&s.initializer!==void 0&&(s.value=s.initializer?s.initializer.call(o):void 0,s.initializer=void 0),s.initializer===void 0&&(Object.defineProperty(e,i,s),s=null),s}function bn(){var e=new Pe.WT(4);return Pe.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Cn(e){var i=new glMatrix.ARRAY_TYPE(4);return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i}function mn(e,i,r,n){var o=new Pe.WT(4);return o[0]=e,o[1]=i,o[2]=r,o[3]=n,o}function $n(e,i){return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e}function Ma(e,i,r,n,o){return e[0]=i,e[1]=r,e[2]=n,e[3]=o,e}function ds(e,i,r){return e[0]=i[0]+r[0],e[1]=i[1]+r[1],e[2]=i[2]+r[2],e[3]=i[3]+r[3],e}function Va(e,i,r){return e[0]=i[0]-r[0],e[1]=i[1]-r[1],e[2]=i[2]-r[2],e[3]=i[3]-r[3],e}function xa(e,i,r){return e[0]=i[0]*r[0],e[1]=i[1]*r[1],e[2]=i[2]*r[2],e[3]=i[3]*r[3],e}function Dl(e,i,r){return e[0]=i[0]/r[0],e[1]=i[1]/r[1],e[2]=i[2]/r[2],e[3]=i[3]/r[3],e}function Zs(e,i){return e[0]=Math.ceil(i[0]),e[1]=Math.ceil(i[1]),e[2]=Math.ceil(i[2]),e[3]=Math.ceil(i[3]),e}function yl(e,i){return e[0]=Math.floor(i[0]),e[1]=Math.floor(i[1]),e[2]=Math.floor(i[2]),e[3]=Math.floor(i[3]),e}function Ou(e,i,r){return e[0]=Math.min(i[0],r[0]),e[1]=Math.min(i[1],r[1]),e[2]=Math.min(i[2],r[2]),e[3]=Math.min(i[3],r[3]),e}function Kp(e,i,r){return e[0]=Math.max(i[0],r[0]),e[1]=Math.max(i[1],r[1]),e[2]=Math.max(i[2],r[2]),e[3]=Math.max(i[3],r[3]),e}function Ru(e,i){return e[0]=Math.round(i[0]),e[1]=Math.round(i[1]),e[2]=Math.round(i[2]),e[3]=Math.round(i[3]),e}function lc(e,i,r){return e[0]=i[0]*r,e[1]=i[1]*r,e[2]=i[2]*r,e[3]=i[3]*r,e}function Ph(e,i,r,n){return e[0]=i[0]+r[0]*n,e[1]=i[1]+r[1]*n,e[2]=i[2]+r[2]*n,e[3]=i[3]+r[3]*n,e}function xm(e,i){var r=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],s=i[3]-e[3];return Math.hypot(r,n,o,s)}function is(e,i){var r=i[0]-e[0],n=i[1]-e[1],o=i[2]-e[2],s=i[3]-e[3];return r*r+n*n+o*o+s*s}function $p(e){var i=e[0],r=e[1],n=e[2],o=e[3];return Math.hypot(i,r,n,o)}function mf(e){var i=e[0],r=e[1],n=e[2],o=e[3];return i*i+r*r+n*n+o*o}function Ad(e,i){return e[0]=-i[0],e[1]=-i[1],e[2]=-i[2],e[3]=-i[3],e}function Td(e,i){return e[0]=1/i[0],e[1]=1/i[1],e[2]=1/i[2],e[3]=1/i[3],e}function dv(e,i){var r=i[0],n=i[1],o=i[2],s=i[3],p=r*r+n*n+o*o+s*s;return p>0&&(p=1/Math.sqrt(p)),e[0]=r*p,e[1]=n*p,e[2]=o*p,e[3]=s*p,e}function sp(e,i){return e[0]*i[0]+e[1]*i[1]+e[2]*i[2]+e[3]*i[3]}function gf(e,i,r,n){var o=r[0]*n[1]-r[1]*n[0],s=r[0]*n[2]-r[2]*n[0],p=r[0]*n[3]-r[3]*n[0],y=r[1]*n[2]-r[2]*n[1],_=r[1]*n[3]-r[3]*n[1],E=r[2]*n[3]-r[3]*n[2],T=i[0],P=i[1],D=i[2],z=i[3];return e[0]=P*E-D*_+z*y,e[1]=-(T*E)+D*p-z*s,e[2]=T*_-P*p+z*o,e[3]=-(T*y)+P*s-D*o,e}function bm(e,i,r,n){var o=i[0],s=i[1],p=i[2],y=i[3];return e[0]=o+n*(r[0]-o),e[1]=s+n*(r[1]-s),e[2]=p+n*(r[2]-p),e[3]=y+n*(r[3]-y),e}function Em(e,i){i=i||1;var r,n,o,s,p,y;do r=glMatrix.RANDOM()*2-1,n=glMatrix.RANDOM()*2-1,p=r*r+n*n;while(p>=1);do o=glMatrix.RANDOM()*2-1,s=glMatrix.RANDOM()*2-1,y=o*o+s*s;while(y>=1);var _=Math.sqrt((1-p)/y);return e[0]=i*r,e[1]=i*n,e[2]=i*o*_,e[3]=i*s*_,e}function Md(e,i,r){var n=i[0],o=i[1],s=i[2],p=i[3];return e[0]=r[0]*n+r[4]*o+r[8]*s+r[12]*p,e[1]=r[1]*n+r[5]*o+r[9]*s+r[13]*p,e[2]=r[2]*n+r[6]*o+r[10]*s+r[14]*p,e[3]=r[3]*n+r[7]*o+r[11]*s+r[15]*p,e}function xs(e,i,r){var n=i[0],o=i[1],s=i[2],p=r[0],y=r[1],_=r[2],E=r[3],T=E*n+y*s-_*o,P=E*o+_*n-p*s,D=E*s+p*o-y*n,z=-p*n-y*o-_*s;return e[0]=T*E+z*-p+P*-_-D*-y,e[1]=P*E+z*-y+D*-p-T*-_,e[2]=D*E+z*-_+T*-y-P*-p,e[3]=i[3],e}function Xf(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Sm(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function t(e,i){return e[0]===i[0]&&e[1]===i[1]&&e[2]===i[2]&&e[3]===i[3]}function a(e,i){var r=e[0],n=e[1],o=e[2],s=e[3],p=i[0],y=i[1],_=i[2],E=i[3];return Math.abs(r-p)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(n-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(o-_)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(s-E)<=glMatrix.EPSILON*Math.max(1,Math.abs(s),Math.abs(E))}var u=null,h=null,m=null,x=null,S=null,M=null,k=null,U=function(){var e=bn();return function(i,r,n,o,s,p){var y,_;for(r||(r=4),n||(n=0),o?_=Math.min(o*r+n,i.length):_=i.length,y=n;y<_;y+=r)e[0]=i[y],e[1]=i[y+1],e[2]=i[y+2],e[3]=i[y+3],s(e,e,p),i[y]=e[0],i[y+1]=e[1],i[y+2]=e[2],i[y+3]=e[3];return i}}(),j=Math.PI/180,H=512,te=4003e4;function ue(e){var i=e.latitude,r=i===void 0?0:i,n=e.zoom,o=n===void 0?0:n,s=e.scale,p=e.highPrecision,y=p===void 0?!1:p,_=e.flipY,E=_===void 0?!1:_;s=s!==void 0?s:Math.pow(2,o);var T={},P=H*s,D=Math.cos(r*j),z=P/360,J=z/D,oe=P/te/D;if(T.pixelsPerMeter=[oe,-oe,oe],T.metersPerPixel=[1/oe,-1/oe,1/oe],T.pixelsPerDegree=[z,-J,oe],T.degreesPerPixel=[1/z,-1/J,1/oe],y){var he=j*Math.tan(r*j)/D,De=z*he/2,it=P/te*he,ht=it/J*oe;T.pixelsPerDegree2=[0,-De,it],T.pixelsPerMeter2=[ht,0,ht],E&&(T.pixelsPerDegree2[1]=-T.pixelsPerDegree2[1],T.pixelsPerMeter2[1]=-T.pixelsPerMeter2[1])}return E&&(T.pixelsPerMeter[1]=-T.pixelsPerMeter[1],T.metersPerPixel[1]=-T.metersPerPixel[1],T.pixelsPerDegree[1]=-T.pixelsPerDegree[1],T.degreesPerPixel[1]=-T.degreesPerPixel[1]),T}var Te;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Te||(Te={}));var Oe={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Ke,ze,ot,Et,Zt,Ht=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],cr=(Ke=(0,zr.b2)(),ze=(0,zr.f3)(Qt.ICameraService),Ke(ot=(Et=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"needRefresh",!0),mr(this,"cameraService",Zt,this),(0,I.Z)(this,"coordinateSystem",void 0),(0,I.Z)(this,"viewportCenter",void 0),(0,I.Z)(this,"viewportCenterProjection",void 0),(0,I.Z)(this,"pixelsPerDegree",void 0),(0,I.Z)(this,"pixelsPerDegree2",void 0),(0,I.Z)(this,"pixelsPerMeter",void 0)}return(0,Lt.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),o=this.cameraService.getCenter(),s=ue({latitude:o[1],zoom:r}),p=s.pixelsPerMeter,y=s.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=p,this.pixelsPerDegree=y,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Te.LNGLAT||this.coordinateSystem===Te.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Te.LNGLAT_OFFSET?this.calculateLnglatOffset(o,r):this.coordinateSystem===Te.P20_OFFSET&&this.calculateLnglatOffset(o,r,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,n,o,s){var p=ue({latitude:r[1],zoom:n,scale:o,flipY:s,highPrecision:!0}),y=p.pixelsPerMeter,_=p.pixelsPerDegree,E=p.pixelsPerDegree2,T=this.cameraService.getViewMatrix(),P=this.cameraService.getProjectionMatrix(),D=vr([],P,T),z=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,n));this.viewportCenterProjection=Md([],[z[0],z[1],0,1],D),T=this.cameraService.getViewMatrixUncentered()||T,D=vr([],P,T),D=vr([],D,Ht),this.cameraService.setViewProjectionMatrix(D),this.pixelsPerMeter=y,this.pixelsPerDegree=_,this.pixelsPerDegree2=E}}]),e}(),Zt=ur(Et.prototype,"cameraService",[ze],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Et))||ot),Lr=R(20396),Vr=R.n(Lr),gn;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(gn||(gn={}));var cn,Nn,pn,wi,Qn;function Pn(e){var i=Zi();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function Zi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bi={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},na=(cn=(0,zr.b2)(),Nn=(0,zr.f3)(Qt.IMapService),cn(pn=(wi=function(e){(0,xn.Z)(r,e);var i=Pn(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),mr((0,xe.Z)(n),"mapService",Qn,(0,xe.Z)(n)),(0,I.Z)((0,xe.Z)(n),"hammertime",void 0),(0,I.Z)((0,xe.Z)(n),"lastClickTime",0),(0,I.Z)((0,xe.Z)(n),"lastClickXY",[-1,-1]),(0,I.Z)((0,xe.Z)(n),"clickTimer",void 0),(0,I.Z)((0,xe.Z)(n),"$containter",void 0),(0,I.Z)((0,xe.Z)(n),"onDrag",function(y){var _=n.interactionEvent(y);_.type=bi[_.type],n.emit(gn.Drag,_)}),(0,I.Z)((0,xe.Z)(n),"onHammer",function(y){y.srcEvent.stopPropagation();var _=n.interactionEvent(y);n.emit(gn.Hover,_)}),(0,I.Z)((0,xe.Z)(n),"onTouch",function(y){var _=y.touches[0];n.onHover({x:_.pageX,y:_.pageY,type:"touch"})}),(0,I.Z)((0,xe.Z)(n),"onHover",function(y){var _=y.clientX,E=y.clientY,T=_,P=E,D=y.type,z=n.mapService.getMapContainer();if(z)if(Ao)T=T-z.left-0,P=P-z.top-0;else{var J=z.getBoundingClientRect(),oe=J.top,he=J.left;T=T-he-z.clientLeft,P=P-oe-z.clientTop}var De=n.mapService.containerToLngLat([T,P]);if(D==="click"){if(!Ao&&"ontouchstart"in document.documentElement)return;n.isDoubleTap(T,P,De);return}if(D==="touch"){n.isDoubleTap(T,P,De);return}D!=="click"&&D!=="dblclick"&&n.emit(gn.Hover,{x:T,y:P,lngLat:De,type:D,target:y})}),n}return(0,Lt.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(gn.Hover)}},{key:"triggerHover",value:function(o){var s=o.x,p=o.y;this.emit(gn.Hover,{x:s,y:p})}},{key:"triggerSelect",value:function(o){this.emit(gn.Select,{featureId:o})}},{key:"triggerActive",value:function(o){this.emit(gn.Active,{featureId:o})}},{key:"handleMiniEvent",value:function(o){this.onHover({clientX:o.touches[0].pageX,clientY:o.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var o=this.mapService.getMapContainer();if(o)if(Ao)ya.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var s=new(Vr()).Manager(o);s.add(new(Vr()).Tap({event:"dblclick",taps:2})),s.add(new(Vr()).Tap({event:"click"})),s.add(new(Vr()).Pan({threshold:0,pointers:0})),s.add(new(Vr()).Press({})),s.on("dblclick click",this.onHammer),s.on("panstart panmove panend pancancel",this.onDrag),o.addEventListener("mousemove",this.onHover),o.addEventListener("mousedown",this.onHover,!0),o.addEventListener("mouseup",this.onHover),o.addEventListener("contextmenu",this.onHover),this.hammertime=s}}},{key:"removeEventListenerOnMap",value:function(){if(Ao)ya.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var o=this.mapService.getMapContainer();o&&(o.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),o.removeEventListener("mousedown",this.onHover),o.removeEventListener("mouseup",this.onHover),o.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(o){var s=o.type,p=o.pointerType,y,_;p==="touch"?(_=Math.floor(o.pointers[0].clientY),y=Math.floor(o.pointers[0].clientX)):(_=Math.floor(o.srcEvent.y),y=Math.floor(o.srcEvent.x));var E=this.mapService.getMapContainer();if(E){var T=E.getBoundingClientRect(),P=T.top,D=T.left;y-=D,_-=P}var z=this.mapService.containerToLngLat([y,_]);return{x:y,y:_,lngLat:z,type:s,target:o.srcEvent}}},{key:"isDoubleTap",value:function(o,s,p){var y=this,_=new Date().getTime(),E="click";_-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-o)<10&&Math.abs(this.lastClickXY[1]-s)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),E="dblclick",this.emit(gn.Hover,{x:o,y:s,lngLat:p,type:E})):(this.lastClickTime=_,this.lastClickXY=[o,s],this.clickTimer=setTimeout(function(){E="click",y.emit(gn.Hover,{x:o,y:s,lngLat:p,type:E})},400))}}]),r}(Lc()),Qn=ur(wi.prototype,"mapService",[Nn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wi))||pn),An=R(92137),va=R(87757),Ai=R.n(va),Po=0;function So(e){if(Ao)return null;var i=e;if(typeof e=="string"&&(i=document.getElementById(e)),i){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(Po++),r.classList.add("l7-scene"),i.appendChild(r),r}return null}function lo(e){var i,r,n=!0;return e==null||(i=e.target)===null||i===void 0||(r=i.path)===null||r===void 0||r.map(function(o){if(o!=null&&o.classList){var s;o==null||(s=o.classList)===null||s===void 0||s.forEach(function(p){(p==="l7-marker"||p==="l7-popup")&&(n=!1)})}}),n}var ae;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(ae||(ae={}));var Qo,es,Ps,as,Is,Io,Oo,Hi,Fa,Pa,ia;function js(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function bs(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?js(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):js(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Qa=(Qo=(0,zr.b2)(),es=(0,zr.f3)(Qt.IRendererService),Ps=(0,zr.f3)(Qt.IGlobalConfigService),as=(0,zr.f3)(Qt.IInteractionService),Is=(0,zr.f3)(Qt.ILayerService),Qo(Io=(Oo=function(){function e(){var i=this;(0,lt.Z)(this,e),mr(this,"rendererService",Hi,this),mr(this,"configService",Fa,this),mr(this,"interactionService",Pa,this),mr(this,"layerService",ia,this),(0,I.Z)(this,"pickingFBO",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0),(0,I.Z)(this,"alreadyInPicking",!1),(0,I.Z)(this,"pickBufferScale",1),(0,I.Z)(this,"lastPickTime",new Date().getTime()),(0,I.Z)(this,"pickFromPickingFBO",function(r,n){var o,s=n.x,p=n.y,y=n.lngLat,_=n.type,E=n.target,T=!1,P=i.rendererService,D=P.getViewportSize,z=P.readPixels,J=P.getContainer,oe=i.getContainerSize(J()),he=oe.width,De=oe.height;he*=Sa,De*=Sa;var it=r.getLayerConfig(),ht=it.enableHighlight,_t=it.enableSelect,jt=s*Sa,Vt=p*Sa;if(jt>he-1*Sa||jt<0||Vt>De-1*Sa||Vt<0)return!1;var rr;if(rr=z({x:Math.floor(jt/i.pickBufferScale),y:Math.floor((De-(p+1)*Sa)/i.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),rr[0]!==0||rr[1]!==0||rr[2]!==0){var yr=le(rr),Yr=r.getSource().getFeatureById(yr);yr!==r.getCurrentPickId()&&_==="mousemove"&&(_="mouseenter");var fn={x:s,y:p,type:_,lngLat:y,featureId:yr,feature:Yr,target:E};Yr&&(T=!0,r.setCurrentPickId(yr),i.triggerHoverOnLayer(r,fn))}else{var Or={x:s,y:p,lngLat:y,type:r.getCurrentPickId()!==null&&_==="mousemove"?"mouseout":"un"+_,featureId:null,target:E,feature:null};i.triggerHoverOnLayer(r,bs(bs({},Or),{},{type:"unpick"})),i.triggerHoverOnLayer(r,Or),r.setCurrentPickId(null)}if(ht&&i.highlightPickedFeature(r,rr),_t&&_==="click"&&((o=rr)===null||o===void 0?void 0:o.toString())!==[0,0,0,0].toString()){var Tn=le(rr);r.getCurrentSelectedId()===null||Tn!==r.getCurrentSelectedId()?(i.selectFeature(r,rr),r.setCurrentSelectedId(Tn)):(i.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return T})}return(0,Lt.Z)(e,[{key:"init",value:function(r){var n=this.rendererService,o=n.createTexture2D,s=n.createFramebuffer,p=n.getViewportSize,y=n.getContainer,_=this.getContainerSize(y()),E=_.width,T=_.height;E*=Sa,T*=Sa,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=s({color:o({width:Math.round(E/this.pickBufferScale),height:Math.round(T/this.pickBufferScale),wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.interactionService.on(gn.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var i=(0,An.Z)(Ai().mark(function n(o,s,p){var y=this,_,E,T,P;return Ai().wrap(function(z){for(;;)switch(z.prev=z.next){case 0:_=this.rendererService,E=_.useFramebuffer,T=_.clear,P=_.getContainer,this.resizePickingFBO(),E(this.pickingFBO,function(){T({framebuffer:y.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.hooks.beforePickingEncode.call(),o.renderModels(),o.hooks.afterPickingEncode.call();var J=y.pickBox(o,s);p(J)});case 3:case"end":return z.stop()}},n,this)}));function r(n,o,s){return i.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,n){var o=this,s=n.map(function(Or){var Tn=Or<0?0:Or;return Math.floor(Tn*Sa/o.pickBufferScale)}),p=(0,ie.Z)(s,4),y=p[0],_=p[1],E=p[2],T=p[3],P=this.rendererService,D=P.getViewportSize,z=P.readPixels,J=P.getContainer,oe=this.getContainerSize(J()),he=oe.width,De=oe.height;if(he*=Sa,De*=Sa,y>(he-1)*Sa/this.pickBufferScale||E<0||_>(De-1)*Sa/this.pickBufferScale||T<0)return[];var it,ht=Math.min(he/this.pickBufferScale,E)-y,_t=Math.min(De/this.pickBufferScale,T)-_;it=z({x:y,y:Math.floor(De/this.pickBufferScale-(T+1)),width:ht,height:_t,data:new Uint8Array(ht*_t*4),framebuffer:this.pickingFBO});for(var jt=[],Vt={},rr=0;rr<it.length/4;rr=rr+1){var yr=it.slice(rr*4,rr*4+4),Yr=le(yr);if(Yr!==-1&&!Vt[Yr]){var fn=r.getSource().getFeatureById(Yr);jt.push(fn),Vt[Yr]=!0}}return jt}},{key:"getContainerSize",value:function(r){return r.getContext?{width:r.width/Sa,height:r.height/Sa}:r.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var i=(0,An.Z)(Ai().mark(function n(o){var s;return Ai().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.layerService.isMapDragging()||!this.layerService.getShaderPickStat())){y.next=2;break}return y.abrupt("return");case 2:if(this.alreadyInPicking=!0,s=new Date().getTime(),!(s-this.lastPickTime>10||o.type==="contextmenu")){y.next=7;break}return y.next=7,this.pickingLayers(o);case 7:this.lastPickTime=s,this.layerService.renderLayers(),this.alreadyInPicking=!1;case 10:case"end":return y.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,n=this.getContainerSize(r()),o=n.width,s=n.height;o*=Sa,s*=Sa,(this.width!==o||this.height!==s)&&(this.pickingFBO.resize({width:Math.round(o/this.pickBufferScale),height:Math.round(s/this.pickBufferScale)}),this.width=o,this.height=s)}},{key:"pickingLayers",value:function(){var i=(0,An.Z)(Ai().mark(function n(o){var s=this,p,y,_,E,T;return Ai().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:p=this.rendererService,y=p.getViewportSize,_=p.useFramebuffer,E=p.clear,T=p.getContainer,this.resizePickingFBO(),_(this.pickingFBO,function(){var z=s.layerService.getRenderList();z.filter(function(J){return J.needPick(o.type)}).reverse().some(function(J){E({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),J.hooks.beforePickingEncode.call(),J.renderModels(!0),J.hooks.afterPickingEncode.call();var oe=s.pickFromPickingFBO(J,o);return oe&&!J.getLayerConfig().enablePropagation})});case 3:case"end":return D.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,n){lo(n)&&r.emit(n.type,n)}},{key:"highlightPickedFeature",value:function(r,n){var o=(0,ie.Z)(n,3),s=o[0],p=o[1],y=o[2];r.hooks.beforeHighlight.call([s,p,y])}},{key:"selectFeature",value:function(r,n){var o=(0,ie.Z)(n,3),s=o[0],p=o[1],y=o[2];r.hooks.beforeSelect.call([s,p,y])}}]),e}(),Hi=ur(Oo.prototype,"rendererService",[es],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fa=ur(Oo.prototype,"configService",[Ps],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pa=ur(Oo.prototype,"interactionService",[as],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ia=ur(Oo.prototype,"layerService",[Is],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oo))||Io),Vo=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,lt.Z)(this,e),(0,I.Z)(this,"autoStart",void 0),(0,I.Z)(this,"startTime",0),(0,I.Z)(this,"oldTime",0),(0,I.Z)(this,"running",!1),(0,I.Z)(this,"elapsedTime",0),this.autoStart=i}return(0,Lt.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();r=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=r}return r}}]),e}(),Es,ca,Fl,xu,Bl,co,Nl,el,Yf,qf=(Es=(0,zr.b2)(),ca=(0,zr.f3)(Qt.IRendererService),Fl=(0,zr.f3)(Qt.IMapService),xu=(0,zr.f3)(Qt.IGlobalConfigService),Es(Bl=(co=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"clock",new Vo),(0,I.Z)(this,"alreadyInRendering",!1),(0,I.Z)(this,"layers",[]),(0,I.Z)(this,"layerList",[]),(0,I.Z)(this,"layerRenderID",void 0),(0,I.Z)(this,"sceneInited",!1),(0,I.Z)(this,"animateInstanceCount",0),(0,I.Z)(this,"shaderPicking",!0),(0,I.Z)(this,"enableRender",!0),mr(this,"renderService",Nl,this),mr(this,"mapService",el,this),mr(this,"configService",Yf,this)}return(0,Lt.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r),this.updateLayerRenderList()}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()}),this.updateLayerRenderList()}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(n){return n.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(n){return n.name===r})}},{key:"cleanRemove",value:function(r,n){if(n){var o=n.layerChildren.indexOf(r);o>-1&&n.layerChildren.splice(o,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),this.renderLayers()}},{key:"remove",value:function(r,n){if(n){var o=n.layerChildren.indexOf(r);o>-1&&n.layerChildren.splice(o,1)}else{var s=this.layers.indexOf(r);s>-1&&this.layers.splice(s,1)}this.updateLayerRenderList(),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"setEnableRender",value:function(r){this.enableRender=r}},{key:"renderLayers",value:function(){this.alreadyInRendering||!this.enableRender||(this.alreadyInRendering=!0,this.clear(),this.layerList.forEach(function(r){r.hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),r.render(),r.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateLayerRenderList",value:function(){var r=this;this.layerList=[],this.layers.filter(function(n){return n.inited}).filter(function(n){return n.isVisible()}).forEach(function(n){r.layerList.push(n),n.layerChildren.filter(function(o){return o.inited}).filter(function(o){return o.isVisible()}).forEach(function(o){r.layerList.push(o)})}),this.layerList.sort(function(n,o){return n.zIndex-o.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){r.layerChildren&&(r.layerChildren.forEach(function(n){return n.destroy()}),r.layerChildren=[]),r.destroy()}),this.layers=[],this.layerList=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"isMapDragging",value:function(){return this.mapService.dragging}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=ya.requestAnimationFrame(this.runRender.bind(this))}},{key:"clear",value:function(){var r=V(this.mapService.bgColor);this.renderService.clear({color:r,depth:1,stencil:0,framebuffer:null})}},{key:"stopRender",value:function(){ya.cancelAnimationFrame(this.layerRenderID)}}]),e}(),Nl=ur(co.prototype,"renderService",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),el=ur(co.prototype,"mapService",[Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yf=ur(co.prototype,"configService",[xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),co))||Bl),cc=R(81253),zc=R(14293),zl=R.n(zc),Jp=function(){function e(i){var r=this;(0,lt.Z)(this,e),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"type",void 0),(0,I.Z)(this,"scale",void 0),(0,I.Z)(this,"descriptor",void 0),(0,I.Z)(this,"featureBufferLayout",[]),(0,I.Z)(this,"needRescale",!1),(0,I.Z)(this,"needRemapping",!1),(0,I.Z)(this,"needRegenerateVertices",!1),(0,I.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,I.Z)(this,"vertexAttribute",void 0),(0,I.Z)(this,"defaultCallback",function(n){if(n.length===0){var o;return((o=r.scale)===null||o===void 0?void 0:o.defaultValues)||[]}return n.map(function(s,p){var y,_=(y=r.scale)===null||y===void 0?void 0:y.scalers[p].func,E=_(s);return E})}),this.setProps(i)}return(0,Lt.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var o,s=(o=this.scale)===null||o===void 0?void 0:o.callback.apply(o,(0,or.Z)(r));if(!zl()(s))return[s]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Ih=["buffer","update","name"],Uc,up,lp,fc,Kf,$f;function Zc(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function yf(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Zc(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zc(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Pd(e){return new Promise(function(i){return setTimeout(i,e)})}var Qp=(Uc={},(0,I.Z)(Uc,ae.FLOAT,4),(0,I.Z)(Uc,ae.UNSIGNED_BYTE,1),(0,I.Z)(Uc,ae.UNSIGNED_SHORT,2),Uc),cp=(up=(0,zr.b2)(),lp=(0,zr.f3)(Qt.IRendererService),up(fc=(Kf=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"attributesAndIndices",void 0),mr(this,"rendererService",$f,this),(0,I.Z)(this,"attributes",[]),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Lt.Z)(e,[{key:"registerStyleAttribute",value:function(r){var n=this.getLayerStyleAttribute(r.name||"");return n?n.setProps(r):(n=new Jp(r),this.attributes.push(n)),n}},{key:"updateStyleAttribute",value:function(r,n,o){var s=this.getLayerStyleAttribute(r);s||(s=this.registerStyleAttribute(yf(yf({},n),{},{name:r})));var p=n.scale;p&&s&&(s.scale=p,s.needRescale=!0,s.needRemapping=!0,s.needRegenerateVertices=!0,o&&o.featureRange&&(s.featureRange=o.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(n){return n.name===r})}},{key:"getLayerAttributeScale",value:function(r){var n,o=this.getLayerStyleAttribute(r),s=o==null||(n=o.scale)===null||n===void 0?void 0:n.scalers;return s&&s[0]?s[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=arguments.length>3?arguments[3]:void 0,p=this.attributes.find(function(_t){return _t.name===r});if(p&&p.descriptor){var y=p.descriptor,_=y.update,E=y.buffer,T=y.size,P=T===void 0?0:T,D=Qp[E.type||ae.FLOAT];if(_){var z=this.featureLayout,J=z.elements,oe=z.sizePerElement,he=J.slice(o,s);if(!he.length)return;var De=he[0].offset,it=De*P*D,ht=he.map(function(_t,jt){for(var Vt=_t.featureIdx,rr=_t.vertices,yr=_t.normals,Yr=rr.length/oe,fn=[],Or=0;Or<Yr;Or++){var Tn=yr?yr.slice(Or*3,Or*3+3):[];fn.push.apply(fn,(0,or.Z)(_(n[Vt],Vt,rr.slice(Or*oe,Or*oe+oe),jt,Tn)))}return fn}).reduce(function(_t,jt){return _t.push.apply(_t,(0,or.Z)(jt)),_t},[]);p.vertexAttribute.updateBuffer({data:ht,offset:it})}}}},{key:"createAttributesAndIndices",value:function(r,n,o){var s=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var p=this.attributes.map(function(it){return it.resetDescriptor(),it.descriptor}),y=0,_=[],E=[],T=[],P=3;r.forEach(function(it,ht){var _t=s.triangulation(it,o),jt=_t.indices,Vt=_t.vertices,rr=_t.normals,yr=_t.size;jt.forEach(function(Tn){E.push(Tn+y)}),P=yr;var Yr=Vt.length/yr;s.featureLayout.sizePerElement=P,s.featureLayout.elements.push({featureIdx:ht,vertices:Vt,normals:rr,offset:y}),y+=Yr;for(var fn=function(Bn){var hi=(rr==null?void 0:rr.slice(Bn*3,Bn*3+3))||[],vo=Vt.slice(Bn*yr,Bn*yr+yr);p.forEach(function(Cs,nl){if(Cs&&Cs.update){var yc;(yc=Cs.buffer.data).push.apply(yc,(0,or.Z)(Cs.update(it,ht,vo,Bn,hi)))}})},Or=0;Or<Yr;Or++)fn(Or)});var D=this.rendererService,z=D.createAttribute,J=D.createBuffer,oe=D.createElements,he={};p.forEach(function(it,ht){if(it){var _t=it.buffer,jt=it.update,Vt=it.name,rr=(0,cc.Z)(it,Ih),yr=z(yf({buffer:J(_t)},rr));he[it.name||""]=yr,s.attributes[ht].vertexAttribute=yr}});var De=oe({data:E,type:ae.UNSIGNED_INT,count:E.length});return this.attributesAndIndices={attributes:he,elements:De},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),$f=ur(Kf.prototype,"rendererService",[lp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kf))||fc),Oh=R(67709),ed=R.n(Oh),Rh,Lh,kh,fp,Jf,hp,Qf,Dh,_f,Fh,eh,td,Id,rd,Od,nd,vv,vs,Ro,_l,mv,jc,id,Rd,pp,Ul,dp,Bh,vp,mp,ad,Ld,Nh;function gv(e){var i=yv();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function yv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _v=(Rh=(0,zr.b2)(),Lh=(0,zr.f3)(Qt.SceneID),kh=(0,zr.f3)(Qt.IIconService),fp=(0,zr.f3)(Qt.IFontService),Jf=(0,zr.f3)(Qt.IControlService),hp=(0,zr.f3)(Qt.IGlobalConfigService),Qf=(0,zr.f3)(Qt.IMapService),Dh=(0,zr.f3)(Qt.ICoordinateSystemService),_f=(0,zr.f3)(Qt.IRendererService),Fh=(0,zr.f3)(Qt.ILayerService),eh=(0,zr.f3)(Qt.ICameraService),td=(0,zr.f3)(Qt.IInteractionService),Id=(0,zr.f3)(Qt.IPickingService),rd=(0,zr.f3)(Qt.IShaderModuleService),Od=(0,zr.f3)(Qt.IMarkerService),nd=(0,zr.f3)(Qt.IPopupService),Rh(vv=(vs=function(e){(0,xn.Z)(r,e);var i=gv(r);function r(){var n;return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,xe.Z)(n),"destroyed",!1),(0,I.Z)((0,xe.Z)(n),"loaded",!1),(0,I.Z)((0,xe.Z)(n),"loadFont",!1),(0,I.Z)((0,xe.Z)(n),"fontFamily",""),mr((0,xe.Z)(n),"id",Ro,(0,xe.Z)(n)),mr((0,xe.Z)(n),"iconService",_l,(0,xe.Z)(n)),mr((0,xe.Z)(n),"fontService",mv,(0,xe.Z)(n)),mr((0,xe.Z)(n),"controlService",jc,(0,xe.Z)(n)),mr((0,xe.Z)(n),"configService",id,(0,xe.Z)(n)),mr((0,xe.Z)(n),"map",Rd,(0,xe.Z)(n)),mr((0,xe.Z)(n),"coordinateSystemService",pp,(0,xe.Z)(n)),mr((0,xe.Z)(n),"rendererService",Ul,(0,xe.Z)(n)),mr((0,xe.Z)(n),"layerService",dp,(0,xe.Z)(n)),mr((0,xe.Z)(n),"cameraService",Bh,(0,xe.Z)(n)),mr((0,xe.Z)(n),"interactionService",vp,(0,xe.Z)(n)),mr((0,xe.Z)(n),"pickingService",mp,(0,xe.Z)(n)),mr((0,xe.Z)(n),"shaderModuleService",ad,(0,xe.Z)(n)),mr((0,xe.Z)(n),"markerService",Ld,(0,xe.Z)(n)),mr((0,xe.Z)(n),"popupService",Nh,(0,xe.Z)(n)),(0,I.Z)((0,xe.Z)(n),"inited",!1),(0,I.Z)((0,xe.Z)(n),"initPromise",void 0),(0,I.Z)((0,xe.Z)(n),"rendering",!1),(0,I.Z)((0,xe.Z)(n),"$container",void 0),(0,I.Z)((0,xe.Z)(n),"canvas",void 0),(0,I.Z)((0,xe.Z)(n),"markerContainer",void 0),(0,I.Z)((0,xe.Z)(n),"hooks",void 0),(0,I.Z)((0,xe.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),fs(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,I.Z)((0,xe.Z)(n),"handleMapCameraChanged",function(o){n.cameraService.update(o),n.render()}),n.hooks={init:new ic},n}return(0,Lt.Z)(r,[{key:"init",value:function(o){var s=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,An.Z)(Ai().mark(function p(){return Ai().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,new Promise(function(E){s.map.onCameraChanged(function(T){s.cameraService.init(),s.cameraService.update(T),s.map.version!=="GAODE2.x"&&E()}),s.map.version!=="GAODE2.x"?s.map.init():E()});case 2:if(!(s.map.version==="GAODE2.x"&&s.map.initViewPort)){_.next=6;break}return _.next=5,s.map.init();case 5:s.map.initViewPort();case 6:s.map.onCameraChanged(s.handleMapCameraChanged),s.map.addMarkerContainer(),s.markerService.addMarkers(),s.markerService.addMarkerLayers(),s.popupService.initPopup(),s.interactionService.init(),s.interactionService.on(gn.Drag,s.addSceneEvent.bind(s));case 13:case"end":return _.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,An.Z)(Ai().mark(function p(){var y,_;return Ai().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(y=So(s.configService.getSceneConfig(s.id).id||""),s.$container=y,!y){T.next=11;break}return s.canvas=pa("canvas","",y),s.setCanvas(),T.next=7,s.rendererService.init(s.canvas,s.configService.getSceneConfig(s.id));case 7:ed()(s.$container,s.handleWindowResized),ya.matchMedia&&((_=ya.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||_===void 0||_.addListener(s.handleWindowResized)),T.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:s.pickingService.init(s.id);case 13:case"end":return T.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"initMiniScene",value:function(o){var s=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,An.Z)(Ai().mark(function p(){return Ai().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,new Promise(function(E){s.map.onCameraChanged(function(T){s.cameraService.init(),s.cameraService.update(T),s.map.version!=="GAODE2.x"&&E()}),s.map.initMiniMap()});case 2:s.map.onCameraChanged(s.handleMapCameraChanged),s.interactionService.init(),s.interactionService.on(gn.Drag,s.addSceneEvent.bind(s));case 5:case"end":return _.stop()}},p)}))),this.hooks.init.tapPromise("initRenderer",(0,An.Z)(Ai().mark(function p(){var y;return Ai().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:if(y=o.canvas,s.$container=y||null,!s.$container){E.next=7;break}return E.next=5,s.rendererService.init(o.canvas,s.configService.getSceneConfig(s.id));case 5:E.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:s.pickingService.init(s.id);case 9:case"end":return E.stop()}},p)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(o){this.layerService.sceneService=this,this.layerService.add(o),this.render()}},{key:"render",value:function(){var n=(0,An.Z)(Ai().mark(function s(){return Ai().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(this.rendering||this.destroyed)){y.next=2;break}return y.abrupt("return");case 2:if(this.rendering=!0,this.inited){y.next=15;break}return y.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){y.next=10;break}return y.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this.rendering=!1;case 18:case"end":return y.stop()}},s,this)}));function o(){return n.apply(this,arguments)}return o}()},{key:"addFontFace",value:function(o,s){this.fontFamily=o;var p=document.createElement("style");p.type="text/css",p.innerText=`
        @font-face{
            font-family: '`.concat(o,`';
            src: url('`).concat(s,`') format('woff2'),
            url('`).concat(s,`') format('woff'),
            url('`).concat(s,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(p),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(o){var s,p=(s=this.$container)===null||s===void 0?void 0:s.getElementsByTagName("canvas")[0];this.render();var y=o==="jpg"?p==null?void 0:p.toDataURL("image/jpeg"):p==null?void 0:p.toDataURL("image/png");return y}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var o=this.$container.parentElement;o!==null&&(this.markerContainer=pa("div","l7-marker-container",o))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var o=this,s,p;if(!this.inited){this.destroyed=!0;return}if(this.emit("destroy"),this.layerService.destroy(),setTimeout(function(){o.rendererService.destroy()}),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(s=this.$container)===null||s===void 0||(p=s.parentNode)===null||p===void 0||p.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,Oh.unbind)(this.$container,this.handleWindowResized),ya.matchMedia){var y;(y=ya.matchMedia("screen and (min-resolution: 2dppx)"))===null||y===void 0||y.removeListener(this.handleWindowResized)}}},{key:"initContainer",value:function(){var o,s,p=Sa,y=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,_=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,E=this.canvas;E&&(E.width=y*p,E.height=_*p),this.rendererService.viewport({x:0,y:0,width:p*y,height:p*_})}},{key:"setCanvas",value:function(){var o,s,p=Sa,y=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,_=((s=this.$container)===null||s===void 0?void 0:s.clientHeight)||300,E=this.canvas;E.width=y*p,E.height=_*p,E.style.width="100%",E.style.height="100%"}},{key:"addSceneEvent",value:function(o){this.emit(o.type,o)}}]),r}(Da.EventEmitter),Ro=ur(vs.prototype,"id",[Lh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_l=ur(vs.prototype,"iconService",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mv=ur(vs.prototype,"fontService",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jc=ur(vs.prototype,"controlService",[Jf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),id=ur(vs.prototype,"configService",[hp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd=ur(vs.prototype,"map",[Qf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pp=ur(vs.prototype,"coordinateSystemService",[Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ul=ur(vs.prototype,"rendererService",[_f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dp=ur(vs.prototype,"layerService",[Fh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bh=ur(vs.prototype,"cameraService",[eh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vp=ur(vs.prototype,"interactionService",[td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mp=ur(vs.prototype,"pickingService",[Id],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ad=ur(vs.prototype,"shaderModuleService",[rd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ld=ur(vs.prototype,"markerService",[Od],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nh=ur(vs.prototype,"popupService",[nd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vs))||vv),xv=R(44908),kd=R.n(xv);function Lu(e){var i=0;switch(e){case"vec2":case"ivec2":i=2;break;case"vec3":case"ivec3":i=3;break;case"vec4":case"ivec4":case"mat2":i=4;break;case"mat3":i=9;break;case"mat4":i=16;break;default:}return i}var od=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Dd(e){var i={};return e=e.replace(od,function(r,n,o){var s=o.split(":"),p=s[0].trim(),y="";switch(s.length>1&&(y=s[1].trim()),n){case"bool":y=y==="true";break;case"float":case"int":y=Number(y);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":y?y=y.replace("[","").replace("]","").split(",").reduce(function(_,E){return _.push(Number(E.trim())),_},[]):y=new Array(Lu(n)).fill(0);break;default:}return i[p]=y,"uniform ".concat(n," ").concat(p,`;
`)}),{content:e,uniforms:i}}var Zl,bv;function Fd(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function jl(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Fd(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Fd(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var th="#define PI 3.14159265359",zh=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,Uh=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Zh=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Ev=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_shaderPick;

uniform float u_activeMix: 0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

// TODO: \u4F18\u5316\u6C34\u6CE2\u70B9 blend additive \u6A21\u5F0F\u4E0B\u6709\u7684\u62FE\u53D6\u6548\u679C 
vec4 filterColorAnimate(vec4 color) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, color.a));
  }
}

vec4 filterColorWithLight(vec4 color, float lightWeight) {
  // TODO: \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, lightWeight));
  }
}

`,Sv=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;
uniform float u_shaderPick;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Cv=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,wv=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom);
  }
  
  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom));
  }
  return pixel * 2.0;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,Bd=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,Nd=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasThetaOffset() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 thetaOffset \u7684\u6570\u636E
  return u_cellTypeLayout[2][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 1.0, 0.0, 0.0, // offsets thetaOffset
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0 +  // offsets
          u_cellTypeLayout[2][1];         // thetaOffset
}`,Vc=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Av=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,zd=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,Ud=`
// \u8BA1\u7B97 thetaOffset \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calThetaOffsetAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasThetaOffset()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 thetaOffset \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_thetaOffset, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureThetaOffset = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureThetaOffset, textureOffset + 1.0);
  }
}
`,Tv=/precision\s+(high|low|medium)p\s+float/,Zd=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Mv=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Pv=(Zl=(0,zr.b2)(),Zl(bv=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"moduleCache",{}),(0,I.Z)(this,"rawContentCache",{})}return(0,Lt.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:th,fs:th}),this.registerModule("decode",{vs:zh,fs:""}),this.registerModule("projection",{vs:wv,fs:""}),this.registerModule("project",{vs:Cv,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:Bd}),this.registerModule("lighting",{vs:Zh,fs:""}),this.registerModule("light",{vs:Uh,fs:""}),this.registerModule("picking",{vs:Sv,fs:Ev}),this.registerModule("styleMapping",{vs:Nd,fs:""}),this.registerModule("styleMappingCalThetaOffset",{vs:Ud,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:Vc,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Av,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:zd,fs:""})}},{key:"registerModule",value:function(r,n){if(!this.rawContentCache[r]){var o=n.vs,s=n.fs,p=n.uniforms,y=Dd(o),_=y.content,E=y.uniforms,T=Dd(s),P=T.content,D=T.uniforms;this.rawContentCache[r]={fs:P,uniforms:jl(jl(jl({},E),D),p),vs:_}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var n=this;if(this.moduleCache[r])return this.moduleCache[r];var o=this.rawContentCache[r].vs,s=this.rawContentCache[r].fs,p=this.processModule(o,[],"vs"),y=p.content,_=p.includeList,E=this.processModule(s,[],"fs"),T=E.content,P=E.includeList,D=T,z=kd()(_.concat(P).concat(r)).reduce(function(J,oe){return jl(jl({},J),n.rawContentCache[oe].uniforms)},{});return Tv.test(T)||(D=Zd+T),this.moduleCache[r]={fs:D.trim(),uniforms:z,vs:y.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,n,o){var s=this,p=r.replace(Mv,function(y,_){var E=_.split(" "),T=E[0].replace(/"/g,"");if(n.indexOf(T)>-1)return"";var P=s.rawContentCache[T][o];n.push(T);var D=s.processModule(P,n,o),z=D.content;return z});return{content:p,includeList:n}}}]),e}())||bv),jh=R(66213),Gc;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(Gc||(Gc={}));var Vh,jd,rh=(Vh=(0,zr.b2)(),Vh(jd=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"shaderModuleService",void 0),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"config",void 0)}return(0,Lt.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Gc.Normal}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Qt.IRendererService),this.cameraService=r.getContainer().get(Qt.ICameraService),this.mapService=r.getContainer().get(Qt.IMapService),this.interactionService=r.getContainer().get(Qt.IInteractionService),this.layerService=r.getContainer().get(Qt.ILayerService),this.shaderModuleService=r.getContainer().get(Qt.IShaderModuleService)}},{key:"render",value:function(r){}}]),e}())||jd),Iv,Vd;function Cm(e){var i=wm();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function wm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Am=(Iv=(0,zr.b2)(),Iv(Vd=function(e){(0,xn.Z)(r,e);var i=Cm(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(o,s){(0,jh.Z)((0,Kt.Z)(r.prototype),"init",this).call(this,o,s)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(rh))||Vd),Ov,Rv,Lv,Gd,kv;function hc(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=sd(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,y=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw y}}}}function sd(e,i){if(!!e){if(typeof e=="string")return Hd(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Hd(e,i)}}function Hd(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var gp=(Ov=(0,zr.b2)(),Rv=(0,zr.f3)(Qt.IPostProcessor),Ov(Lv=(Gd=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"passes",[]),mr(this,"postProcessor",kv,this),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"renderFlag",void 0),(0,I.Z)(this,"width",0),(0,I.Z)(this,"height",0)}return(0,Lt.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var i=(0,An.Z)(Ai().mark(function n(){var o,s,p;return Ai().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:o=hc(this.passes),_.prev=1,o.s();case 3:if((s=o.n()).done){_.next=9;break}return p=s.value,_.next=7,p.render(this.layer);case 7:_.next=3;break;case 9:_.next=14;break;case 11:_.prev=11,_.t0=_.catch(1),o.e(_.t0);case 14:return _.prev=14,o.f(),_.finish(14);case 17:this.layer.renderModels();case 18:case"end":return _.stop()}},n,this,[[1,11,14,17]])}));function r(){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){(this.width!==r||this.height!==n)&&(this.width=r,this.height=n)}},{key:"add",value:function(r,n){r.getType()===Gc.PostProcessing?this.postProcessor.add(r,this.layer,n):(r.init(this.layer,n),this.passes.push(r))}},{key:"insert",value:function(r,n,o){r.init(this.layer,n),this.passes.splice(o,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),kv=ur(Gd.prototype,"postProcessor",[Rv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd))||Lv),Wd,l0;function c0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function f0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?c0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Mx(e){var i=Px();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function Px(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ix=(Wd=(0,zr.b2)(),Wd(l0=function(e){(0,xn.Z)(r,e);var i=Mx(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"pickingFBO",void 0),(0,I.Z)((0,xe.Z)(n),"layer",void 0),(0,I.Z)((0,xe.Z)(n),"width",0),(0,I.Z)((0,xe.Z)(n),"height",0),(0,I.Z)((0,xe.Z)(n),"alreadyInRendering",!1),(0,I.Z)((0,xe.Z)(n),"pickFromPickingFBO",function(y){var _=y.x,E=y.y,T=y.lngLat,P=y.type;if(!(!n.layer.isVisible()||!n.layer.needPick(P))){var D=n.rendererService,z=D.getViewportSize,J=D.readPixels,oe=D.useFramebuffer,he=z(),De=he.width,it=he.height,ht=n.layer.getLayerConfig(),_t=ht.enableHighlight,jt=ht.enableSelect,Vt=_*Sa,rr=E*Sa;if(!(Vt>De||Vt<0||rr>it||rr<0)){var yr;oe(n.pickingFBO,function(){var Yr;if(yr=J({x:Math.round(Vt),y:Math.round(it-(E+1)*Sa),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),yr[0]!==0||yr[1]!==0||yr[2]!==0){var fn=le(yr),Or=n.layer.getSource().getFeatureById(fn),Tn={x:_,y:E,type:P,lngLat:T,featureId:fn,feature:Or};Or&&(n.layer.setCurrentPickId(fn),n.triggerHoverOnLayer(Tn))}else{var Bn={x:_,y:E,lngLat:T,type:n.layer.getCurrentPickId()===null?"un"+P:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer(f0(f0({},Bn),{},{type:"unpick"})),n.triggerHoverOnLayer(Bn),n.layer.setCurrentPickId(null)}_t&&n.highlightPickedFeature(yr),jt&&P==="click"&&((Yr=yr)===null||Yr===void 0?void 0:Yr.toString())!==[0,0,0,0].toString()&&n.selectFeature(yr)})}}}),n}return(0,Lt.Z)(r,[{key:"getType",value:function(){return Gc.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(o,s){(0,jh.Z)((0,Kt.Z)(r.prototype),"init",this).call(this,o,s),this.layer=o;var p=this.rendererService,y=p.createTexture2D,_=p.createFramebuffer,E=p.getViewportSize,T=E(),P=T.width,D=T.height;this.pickingFBO=_({color:y({width:P,height:D,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.interactionService.on(gn.Hover,this.pickFromPickingFBO),this.interactionService.on(gn.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(gn.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(o){var s=this;if(!this.alreadyInRendering){var p=this.rendererService,y=p.getViewportSize,_=p.useFramebuffer,E=p.clear,T=y(),P=T.width,D=T.height;this.alreadyInRendering=!0,(this.width!==P||this.height!==D)&&(this.pickingFBO.resize({width:P,height:D}),this.width=P,this.height=D),_(this.pickingFBO,function(){E({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var z=s.layer.multiPassRenderer.getRenderFlag();s.layer.multiPassRenderer.setRenderFlag(!1),o.hooks.beforePickingEncode.call(),o.render(),o.hooks.afterPickingEncode.call(),s.layer.multiPassRenderer.setRenderFlag(z),s.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(o){this.layer.emit(o.type,o)}},{key:"highlightPickedFeature",value:function(o){var s=(0,ie.Z)(o,3),p=s[0],y=s[1],_=s[2];this.layer.hooks.beforeHighlight.call([p,y,_]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(o){var s=(0,ie.Z)(o,3),p=s[0],y=s[1],_=s[2];this.layer.hooks.beforeSelect.call([p,y,_]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(o){var s=o.featureId,p=fe(s);this.selectFeature(new Uint8Array(p))}},{key:"highlightFeatureHandle",value:function(o){var s=o.featureId,p=fe(s);this.highlightPickedFeature(new Uint8Array(p))}}]),r}(rh))||l0),Ox=R(11700),Rx=R.n(Ox),Lx=R(68929),kx=R.n(Lx),h0,p0;function d0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Xd(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?d0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var Dx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Gh=(h0=(0,zr.b2)(),h0(p0=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"shaderModuleService",void 0),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"config",void 0),(0,I.Z)(this,"quad",Dx),(0,I.Z)(this,"enabled",!0),(0,I.Z)(this,"renderToScreen",!1),(0,I.Z)(this,"model",void 0),(0,I.Z)(this,"name",void 0),(0,I.Z)(this,"optionsToUpdate",{})}return(0,Lt.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return Gc.PostProcessing}},{key:"init",value:function(r,n){this.config=n,this.rendererService=r.getContainer().get(Qt.IRendererService),this.shaderModuleService=r.getContainer().get(Qt.IShaderModuleService);var o=this.rendererService,s=o.createAttribute,p=o.createBuffer,y=o.createModel,_=this.setupShaders(),E=_.vs,T=_.fs,P=_.uniforms;this.model=y({vs:E,fs:T,attributes:{a_Position:s({buffer:p({data:[-4,-4,4,-4,0,4],type:ae.FLOAT}),size:2})},uniforms:Xd(Xd({u_Texture:null},P),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r){var n=this,o=r.multiPassRenderer.getPostProcessor(),s=this.rendererService,p=s.useFramebuffer,y=s.getViewportSize,_=s.clear,E=y(),T=E.width,P=E.height;p(this.renderToScreen?null:o.getWriteFBO(),function(){_({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),n.model.draw({uniforms:Xd({u_Texture:o.getReadFBO(),u_ViewportSize:[T,P]},n.convertOptionsToUniforms(n.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=Xd(Xd({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var n={};return Object.keys(r).forEach(function(o){zl()(r[o])||(n["u_".concat(Rx()(kx()(o)))]=r[o])}),n}}]),e}())||p0),v0,m0;function g0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function y0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?g0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Fx(e){var i=Bx();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function Bx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Nx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,zx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ux=(v0=(0,zr.b2)(),v0(m0=function(e){(0,xn.Z)(r,e);var i=Fx(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:zx,fs:Nx});var o=this.shaderModuleService.getModule("blur-pass"),s=o.vs,p=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,T=_.height;return{vs:s,fs:p,uniforms:y0(y0({},y),{},{u_ViewportSize:[E,T]})}}},{key:"convertOptionsToUniforms",value:function(o){var s={};return zl()(o.blurRadius)||(s.u_BlurDir=[o.blurRadius,0]),s}}]),r}(Gh))||m0),_0,x0;function b0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function E0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?b0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Zx(e){var i=jx();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function jx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Vx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Gx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Hx=(_0=(0,zr.b2)(),_0(x0=function(e){(0,xn.Z)(r,e);var i=Zx(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Gx,fs:Vx});var o=this.shaderModuleService.getModule("blur-pass"),s=o.vs,p=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,T=_.height;return{vs:s,fs:p,uniforms:E0(E0({},y),{},{u_ViewportSize:[E,T]})}}},{key:"convertOptionsToUniforms",value:function(o){var s={};return zl()(o.blurRadius)||(s.u_BlurDir=[0,o.blurRadius]),s}}]),r}(Gh))||x0),S0,C0;function w0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function A0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?w0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wx(e){var i=Xx();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function Xx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yx=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,qx=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Kx=(S0=(0,zr.b2)(),S0(C0=function(e){(0,xn.Z)(r,e);var i=Wx(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:qx,fs:Yx});var o=this.shaderModuleService.getModule("colorhalftone-pass"),s=o.vs,p=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,T=_.height;return{vs:s,fs:p,uniforms:A0(A0({},y),{},{u_ViewportSize:[E,T]})}}}]),r}(Gh))||C0),T0,M0;function $x(e){var i=Jx();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function Jx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qx=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,eb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,tb=(T0=(0,zr.b2)(),T0(M0=function(e){(0,xn.Z)(r,e);var i=$x(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:eb,fs:Qx}),this.shaderModuleService.getModule("copy-pass")}}]),r}(Gh))||M0),P0,I0;function O0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function R0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?O0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rb(e){var i=nb();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function nb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ib=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,ab=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,ob=(P0=(0,zr.b2)(),P0(I0=function(e){(0,xn.Z)(r,e);var i=rb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:ab,fs:ib});var o=this.shaderModuleService.getModule("hexagonalpixelate-pass"),s=o.vs,p=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,T=_.height;return{vs:s,fs:p,uniforms:R0(R0({},y),{},{u_ViewportSize:[E,T]})}}}]),r}(Gh))||I0),L0,k0;function D0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function F0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?D0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sb(e){var i=ub();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function ub(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var lb=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,cb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,fb=(L0=(0,zr.b2)(),L0(k0=function(e){(0,xn.Z)(r,e);var i=sb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:cb,fs:lb});var o=this.shaderModuleService.getModule("ink-pass"),s=o.vs,p=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),E=_.width,T=_.height;return{vs:s,fs:p,uniforms:F0(F0({},y),{},{u_ViewportSize:[E,T]})}}}]),r}(Gh))||k0),B0,N0;function hb(e){var i=pb();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function pb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var db=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,vb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,mb=(B0=(0,zr.b2)(),B0(N0=function(e){(0,xn.Z)(r,e);var i=hb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:vb,fs:db}),this.shaderModuleService.getModule("noise-pass")}}]),r}(Gh))||N0),z0,U0;function gb(e){var i=yb();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _b=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,xb=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,bb=(z0=(0,zr.b2)(),z0(U0=function(e){(0,xn.Z)(r,e);var i=gb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:_b,fs:xb}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(Gh))||U0),Z0,j0,V0,G0,ud,H0,Eb=(Z0=(0,zr.b2)(),j0=(0,zr.f3)(Qt.IRendererService),V0=(0,zr.zY)(),Z0(G0=(ud=function(){function e(){(0,lt.Z)(this,e),mr(this,"rendererService",H0,this),(0,I.Z)(this,"passes",[]),(0,I.Z)(this,"readFBO",void 0),(0,I.Z)(this,"writeFBO",void 0)}return(0,Lt.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var i=(0,An.Z)(Ai().mark(function n(o){var s,p;return Ai().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:s=0;case 1:if(!(s<this.passes.length)){_.next=10;break}return p=this.passes[s],p.setRenderToScreen(this.isLastEnabledPass(s)),_.next=6,p.render(o);case 6:s!==this.passes.length-1&&this.swap();case 7:s++,_.next=1;break;case 10:case"end":return _.stop()}},n,this)}));function r(n){return i.apply(this,arguments)}return r}()},{key:"resize",value:function(r,n){this.readFBO.resize({width:r,height:n}),this.writeFBO.resize({width:r,height:n})}},{key:"add",value:function(r,n,o){r.init(n,o),this.passes.push(r)}},{key:"insert",value:function(r,n,o,s){r.init(o,s),this.passes.splice(n,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(n){return n.getName()===r})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(r){for(var n=r+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),H0=ur(ud.prototype,"rendererService",[j0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ur(ud.prototype,"init",[V0],Object.getOwnPropertyDescriptor(ud.prototype,"init"),ud.prototype),ud))||G0),W0,X0;function Sb(e){var i=Cb();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function Cb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var wb=(W0=(0,zr.b2)(),W0(X0=function(e){(0,xn.Z)(r,e);var i=Sb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"getType",value:function(){return Gc.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(o,s){(0,jh.Z)((0,Kt.Z)(r.prototype),"init",this).call(this,o,s)}},{key:"render",value:function(o){var s=this.rendererService,p=s.useFramebuffer,y=s.clear;p(null,function(){y({color:[0,0,0,0],depth:1,stencil:0}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)})}}]),r}(rh))||X0),Y0,q0,K0,Tm,$0;function J0(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Q0(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?J0(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J0(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ab(e){var i=Tb();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function Tb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mb=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,eg=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Pb=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function tg(e,i){for(var r=0,n=1/i,o=e;o>0;)r=r+n*(o%i),o=Math.floor(o/i),n=n/i;return r}var Ib=1,Ob=(Y0=(0,zr.b2)(),q0=(0,zr.f3)(Qt.IShaderModuleService),Y0(K0=(Tm=function(e){(0,xn.Z)(r,e);var i=Ab(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),mr((0,xe.Z)(n),"shaderModuleService",$0,(0,xe.Z)(n)),(0,I.Z)((0,xe.Z)(n),"haltonSequence",[]),(0,I.Z)((0,xe.Z)(n),"accumulatingId",0),(0,I.Z)((0,xe.Z)(n),"frame",0),(0,I.Z)((0,xe.Z)(n),"timer",void 0),(0,I.Z)((0,xe.Z)(n),"sampleRenderTarget",void 0),(0,I.Z)((0,xe.Z)(n),"prevRenderTarget",void 0),(0,I.Z)((0,xe.Z)(n),"outputRenderTarget",void 0),(0,I.Z)((0,xe.Z)(n),"copyRenderTarget",void 0),(0,I.Z)((0,xe.Z)(n),"blendModel",void 0),(0,I.Z)((0,xe.Z)(n),"outputModel",void 0),(0,I.Z)((0,xe.Z)(n),"copyModel",void 0),n}return(0,Lt.Z)(r,[{key:"getType",value:function(){return Gc.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(o,s){(0,jh.Z)((0,Kt.Z)(r.prototype),"init",this).call(this,o,s);var p=this.rendererService,y=p.createFramebuffer,_=p.createTexture2D;this.sampleRenderTarget=y({color:_({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.prevRenderTarget=y({color:_({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.outputRenderTarget=y({color:_({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})}),this.copyRenderTarget=y({color:_({width:1,height:1,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE})});for(var E=0;E<30;E++)this.haltonSequence.push([tg(E,2),tg(E,3)]);this.blendModel=this.createTriangleModel("blend-pass",Mb),this.outputModel=this.createTriangleModel("copy-pass",eg,{blend:{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE_MINUS_SRC_ALPHA,srcAlpha:ae.ONE,dstAlpha:ae.ONE_MINUS_SRC_ALPHA},equation:{rgb:ae.FUNC_ADD,alpha:ae.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",eg)}},{key:"render",value:function(o){var s=this,p=this.rendererService,y=p.clear,_=p.getViewportSize,E=p.useFramebuffer,T=_(),P=T.width,D=T.height;this.sampleRenderTarget.resize({width:P,height:D}),this.prevRenderTarget.resize({width:P,height:D}),this.outputRenderTarget.resize({width:P,height:D}),this.copyRenderTarget.resize({width:P,height:D}),this.resetFrame(),this.stopAccumulating();var z=o.multiPassRenderer.getPostProcessor().getReadFBO();E(z,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:z}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)});var J=function oe(he){!s.accumulatingId||he!==s.accumulatingId||s.isFinished()||(s.doRender(o),ya.requestAnimationFrame(function(){oe(he)}))};this.accumulatingId=Ib++,this.timer=ya.setTimeout(function(){J(s.accumulatingId)},50)}},{key:"doRender",value:function(o){var s=this,p=this.rendererService,y=p.clear,_=p.getViewportSize,E=p.useFramebuffer,T=_(),P=T.width,D=T.height,z=o.getLayerConfig(),J=z.jitterScale,oe=J===void 0?1:J,he=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((he[0]*2-1)/P*oe,(he[1]*2-1)/D*oe),o.multiPassRenderer.setRenderFlag(!1),o.hooks.beforeRender.call(),E(this.sampleRenderTarget,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:s.sampleRenderTarget}),o.render()}),o.hooks.afterRender.call(),o.multiPassRenderer.setRenderFlag(!0);var De=o.getLayerConfig();E(this.outputRenderTarget,function(){s.blendModel.draw({uniforms:{u_opacity:De.opacity||1,u_MixRatio:s.frame===0?1:.9,u_Diffuse1:s.sampleRenderTarget,u_Diffuse2:s.frame===0?o.multiPassRenderer.getPostProcessor().getReadFBO():s.prevRenderTarget}})}),this.frame===0&&y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(E(this.copyRenderTarget,function(){s.outputModel.draw({uniforms:{u_Texture:s.outputRenderTarget}})}),E(o.multiPassRenderer.getPostProcessor().getReadFBO(),function(){s.copyModel.draw({uniforms:{u_Texture:s.copyRenderTarget}})}),o.multiPassRenderer.getPostProcessor().render(o));var it=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=it,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,ya.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(o,s,p){this.shaderModuleService.registerModule(o,{vs:Pb,fs:s});var y=this.shaderModuleService.getModule(o),_=y.vs,E=y.fs,T=y.uniforms,P=this.rendererService,D=P.createAttribute,z=P.createBuffer,J=P.createModel;return J(Q0({vs:_,fs:E,attributes:{a_Position:D({buffer:z({data:[-4,-4,4,-4,0,4],type:ae.FLOAT}),size:2})},uniforms:Q0({},T),depth:{enable:!1},count:3},p))}}]),r}(rh),$0=ur(Tm.prototype,"shaderModuleService",[q0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tm))||K0),Yd=new zr.W2;Yd.bind(Qt.IGlobalConfigService).to(Nr).inSingletonScope(),(0,zr.GW)((0,zr.b2)(),Da.EventEmitter),Yd.bind(Qt.IEventEmitter).to(Da.EventEmitter);var rg=(0,Bc.Z)(Yd,!1),Mm=function(i){var r=rg.lazyInject(i);return function(n,o,s){r.call(this,n,o),s&&(s.initializer=function(){return n[o]})}},HP=function(i){var r=rg.lazyMultiInject(i);return function(n,o,s){r.call(this,n,o),s&&(s.initializer=function(){return n[o]})}},Vl=Yd,Rb=0;function Lb(){var e=new zr.W2;return e.parent=Yd,e.bind(Qt.SceneID).toConstantValue("".concat(Rb++)),e.bind(Qt.IShaderModuleService).to(Pv).inSingletonScope(),e.bind(Qt.ILayerService).to(qf).inSingletonScope(),e.bind(Qt.ISceneService).to(_v).inSingletonScope(),e.bind(Qt.ICameraService).to(gl).inSingletonScope(),e.bind(Qt.ICoordinateSystemService).to(cr).inSingletonScope(),e.bind(Qt.IInteractionService).to(na).inSingletonScope(),e.bind(Qt.IPickingService).to(Qa).inSingletonScope(),e.bind(Qt.IControlService).to(Se).inSingletonScope(),e.bind(Qt.IMarkerService).to(dt).inSingletonScope(),e.bind(Qt.IIconService).to(me).inSingletonScope(),e.bind(Qt.IFontService).to(Wf).inSingletonScope(),e.bind(Qt.IPopupService).to(Ne).inSingletonScope(),e.bind(Qt.INormalPass).to(Am).whenTargetNamed("clear"),e.bind(Qt.INormalPass).to(Ix).whenTargetNamed("pixelPicking"),e.bind(Qt.INormalPass).to(wb).whenTargetNamed("render"),e.bind(Qt.INormalPass).to(Ob).whenTargetNamed("taa"),e.bind(Qt.IFactoryNormalPass).toFactory(function(i){return function(r){return i.container.getNamed(Qt.INormalPass,r)}}),e.bind(Qt.IPostProcessingPass).to(tb).whenTargetNamed("copy"),e.bind(Qt.IPostProcessingPass).to(Ux).whenTargetNamed("blurH"),e.bind(Qt.IPostProcessingPass).to(Hx).whenTargetNamed("blurV"),e.bind(Qt.IPostProcessingPass).to(mb).whenTargetNamed("noise"),e.bind(Qt.IPostProcessingPass).to(bb).whenTargetNamed("sepia"),e.bind(Qt.IPostProcessingPass).to(Kx).whenTargetNamed("colorHalftone"),e.bind(Qt.IPostProcessingPass).to(ob).whenTargetNamed("hexagonalPixelate"),e.bind(Qt.IPostProcessingPass).to(fb).whenTargetNamed("ink"),e.bind(Qt.IFactoryPostProcessingPass).toFactory(function(i){return function(r){var n=i.container.getNamed(Qt.IPostProcessingPass,r);return n.setName(r),n}}),e}function kb(e){var i=new zr.W2;return i.parent=e,i.bind(Qt.IStyleAttributeService).to(cp).inSingletonScope(),i.bind(Qt.IMultiPassRenderer).to(gp).inSingletonScope(),i.bind(Qt.IPostProcessor).to(Eb).inSingletonScope(),i}var WP=R(74691),Db=null;function XP(e){return Db.indexOf(e)}var Fb=2,YP=4,Bb=64,qP=128,Nb=256,zb=512,KP=8192,$P=16384,JP=32768,Ub=null,ng=131072,QP=262144,Zb=524288,e3=1048576,jb=2097152,t3=4194304,Vb=8388608,Gb=16777216,Hb=null;function Dv(e,i){return e=_clamp(Math.floor(e),0,255),i=_clamp(Math.floor(i),0,255),256*e+i}function r3(e){var i=e.color,r=e.radius,n=e.tileX,o=e.tileY,s=e.shape,p=e.opacity,y=e.stroke,_=e.strokeWidth,E=e.strokeOpacity,T=[],P=[],D=[],z=[Dv(i[0],i[1]),Dv(i[2],i[3])],J=[Dv(y[0],y[1]),Dv(y[2],y[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(oe){var he=_slicedToArray(oe,2),De=he[0],it=he[1];T.push([].concat(z,[(De+1)*Vb+(it+1)*jb+getShapeIndex(s)*ng+r,(n+512)*Zb+(o+512)*Bb])),P.push([].concat(J,[_,E])),D.push([p,0,0,0])}),{packedBuffer:T,packedBuffer2:P,packedBuffer3:D}}function n3(e,i){if(e===0&&!i)return 0;if(e===1&&i)return 4294967295;var r=i?1:0,n=Math.floor(e*127);return n*Hb+r*Gb+n*ng+r*Ub+n*zb+r*Nb+n*Fb+r}var pc;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(pc||(pc={}));var eu;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(eu||(eu={}));var Hh;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(Hh||(Hh={}));var li;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(li||(li={}));var Wb=["mapload","mapchange"],yp={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Pm=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Wh;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter"})(Wh||(Wh={}));function ig(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function ag(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ig(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ig(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Xb(e){var i=Yb();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function Yb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qb=0,Fv=function(e){(0,xn.Z)(r,e);var i=Xb(r);function r(n){var o;return(0,lt.Z)(this,r),o=i.call(this),(0,I.Z)((0,xe.Z)(o),"controlOption",void 0),(0,I.Z)((0,xe.Z)(o),"container",void 0),(0,I.Z)((0,xe.Z)(o),"sceneContainer",void 0),(0,I.Z)((0,xe.Z)(o),"mapsService",void 0),(0,I.Z)((0,xe.Z)(o),"renderService",void 0),(0,I.Z)((0,xe.Z)(o),"layerService",void 0),(0,I.Z)((0,xe.Z)(o),"controlService",void 0),(0,I.Z)((0,xe.Z)(o),"isShow",void 0),o.controlOption=ag(ag({},o.getDefault()),n||{}),o}return(0,Lt.Z)(r,[{key:"getDefault",value:function(){return{position:Wh.TOPRIGHT,name:"".concat(qb++)}}},{key:"setPosition",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Wh.BOTTOMRIGHT,s=this.controlService;return s&&s.removeControl(this),this.controlOption.position=o,s&&s.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(o){this.mapsService=o.get(Qt.IMapService),this.renderService=o.get(Qt.IRendererService),this.layerService=o.get(Qt.ILayerService),this.controlService=o.get(Qt.IControlService),this.sceneContainer=o,this.isShow=!0,this.container=this.onAdd();var s=this.container,p=this.controlOption.position,y=this.controlService.controlCorners[p];return Fs(s,"l7-control"),p.indexOf("bottom")!==-1?y.insertBefore(s,y.firstChild):y.appendChild(s),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var o=this.container;Fs(o,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var o=this.container;ou(o,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;ho(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(o){if(this.mapsService&&o&&o.screenX>0&&o.screenY>0){var s=this.mapsService.getContainer();s!==null&&s.focus()}}}]),r}(Da.EventEmitter);function Kb(e){var i=$b();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function $b(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var i3=function(e){(0,xn.Z)(r,e);var i=Kb(r);function r(n){var o;return(0,lt.Z)(this,r),o=i.call(this,n),(0,I.Z)((0,xe.Z)(o),"layerControlInputs",void 0),(0,I.Z)((0,xe.Z)(o),"layers",void 0),(0,I.Z)((0,xe.Z)(o),"lastZIndex",void 0),(0,I.Z)((0,xe.Z)(o),"handlingClick",void 0),(0,I.Z)((0,xe.Z)(o),"layersLink",void 0),(0,I.Z)((0,xe.Z)(o),"baseLayersList",void 0),(0,I.Z)((0,xe.Z)(o),"separator",void 0),(0,I.Z)((0,xe.Z)(o),"overlaysList",void 0),(0,I.Z)((0,xe.Z)(o),"form",void 0),o.layerControlInputs=[],o.layers=[],o.lastZIndex=0,o.handlingClick=!1,o.initLayers(),C(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,xe.Z)(o)),o}return(0,Lt.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Wh.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var o=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(s){s.layer.on("remove",o.onLayerChange),s.layer.on("add",o.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(o,s){return this.addLayer(o,s,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var o=this.renderService.getViewportSize(),s=o.height;Fs(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var p=s-(this.container.offsetTop+50);return p<this.form.clientHeight?(Fs(this.form,"l7-control-layers-scrollbar"),this.form.style.height=p+"px"):ou(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return ou(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var o=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(s){s.layer.off("remove",o.onLayerChange),s.layer.off("add",o.onLayerChange)}))}},{key:"initLayout",value:function(){var o="l7-control-layers",s=this.container=pa("div",o),p=this.controlOption.collapsed;s.setAttribute("aria-haspopup","true");var y=this.form=pa("form",o+"-list");p&&(this.mapsService.on("click",this.collapse),s.addEventListener("mouseenter",this.expand),s.addEventListener("mouseleave",this.collapse)),this.layersLink=pa("a",o+"-toggle",s);var _=this.layersLink;_.title="Layers",p||this.expand(),this.baseLayersList=pa("div",o+"-base",y),this.separator=pa("div",o+"-separator",y),this.overlaysList=pa("div",o+"-overlays",y),s.appendChild(y)}},{key:"initLayers",value:function(){var o=this,s=this.controlOption,p=s.baseLayers,y=p===void 0?{}:p,_=s.overlayers,E=_===void 0?{}:_;Object.keys(y).forEach(function(T,P){o.addLayer(y[T],T,!1)}),Object.keys(E).forEach(function(T,P){o.addLayer(E[T],T,!0)})}},{key:"update",value:function(){if(!this.container)return this;On(this.baseLayersList),On(this.overlaysList),this.layerControlInputs=[];var o,s,p,y,_=0;for(p=0;p<this.layers.length;p++)y=this.layers[p],this.addItem(y),s=s||y.overlay,o=o||!y.overlay,_+=y.overlay?0:1;return this.controlOption.hideSingleBase&&(o=o&&_>1,this.baseLayersList.style.display=o?"":"none"),this.separator.style.display=s&&o?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var o=this.layerControlInputs,s,p,y=this.mapsService.getZoom(),_=o.length-1;_>=0;_--)if(s=o[_],p=this.layerService.getLayer(s.layerId),p&&p.inited){var E=p.getMinZoom(),T=p.getMaxZoom();s.disabled=y<E||y>T}}},{key:"addLayer",value:function(o,s,p){this.mapsService&&(o.on("add",this.onLayerChange),o.on("remove",this.onLayerChange)),this.layers.push({layer:o,name:s,overlay:p});var y=this.controlOption,_=y.sortLayers,E=y.sortFunction,T=y.autoZIndex;_&&this.layers.sort(function(P,D){return E(P.layer,D.layer,P.name,D.name)}),T&&o.setZIndex&&(this.lastZIndex++,o.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(o){this.handlingClick||this.update();var s=this.layerService.getLayer(o.target.layerId),p=s!=null&&s.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;p&&this.emit(p,s)}},{key:"createRadioElement",value:function(o,s){var p='<input type="radio" class="l7-control-layers-selector" name="'+o+'"'+(s?' checked="checked"':"")+"/>",y=document.createElement("div");return y.innerHTML=p,y.firstChild}},{key:"addItem",value:function(o){var s=document.createElement("label"),p=this.layerService.getLayer(o.layer.id),y=p&&p.inited&&o.layer.isVisible(),_;o.overlay?(_=document.createElement("input"),_.type="checkbox",_.className="l7-control-layers-selector",_.defaultChecked=y):_=this.createRadioElement("l7-base-layers",y),this.layerControlInputs.push(_),_.layerId=o.layer.id,_.addEventListener("click",this.onInputClick);var E=document.createElement("span");E.innerHTML=" "+o.name;var T=document.createElement("div");s.appendChild(T),T.appendChild(_),T.appendChild(E);var P=o.overlay?this.overlaysList:this.baseLayersList;return P.appendChild(s),this.checkDisabledLayers(),s}},{key:"onInputClick",value:function(){var o=this.layerControlInputs,s,p,y=[],_=[];this.handlingClick=!0;for(var E=o.length-1;E>=0;E--)s=o[E],p=this.layerService.getLayer(s.layerId),s.checked?y.push(p):s.checked||_.push(p);_.forEach(function(T){T.hide()}),y.forEach(function(T){T.show()}),this.handlingClick=!1}}]),r}(Fv);function Jb(e){var i=Qb();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function Qb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eE=function(e){(0,xn.Z)(r,e);var i=Jb(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"getDefault",value:function(){return{position:Wh.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var o="l7-control-logo",s=pa("div",o),p=pa("a","l7-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://antv.alipay.com/l7",p.setAttribute("aria-label","AntV logo"),p.setAttribute("rel","noopener nofollow"),s.appendChild(p),s}},{key:"onRemove",value:function(){return null}}]),r}(Fv);function tE(e){var i=rE();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function rE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a3=function(e){(0,xn.Z)(r,e);var i=tE(r);function r(n){var o;return(0,lt.Z)(this,r),o=i.call(this,n),(0,I.Z)((0,xe.Z)(o),"mScale",void 0),(0,I.Z)((0,xe.Z)(o),"iScale",void 0),C(["update"],(0,xe.Z)(o)),o}return(0,Lt.Z)(r,[{key:"getDefault",value:function(){return{position:Wh.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var o="l7-control-scale",s=pa("div",o);this.addScales(o+"-line",s);var p=this.controlOption.updateWhenIdle;return this.mapsService.on(p?"moveend":"mapmove",this.update),this.mapsService.on(p?"zoomend":"zoomchange",this.update),this.update(),s}},{key:"onRemove",value:function(){var o=this.controlOption.updateWhenIdle;this.mapsService.off(o?"zoomend":"zoomchange",this.update),this.mapsService.off(o?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var o=this.mapsService,s=this.controlOption.maxWidth,p=o.getSize()[1]/2,y=o.containerToLngLat([0,p]),_=o.containerToLngLat([s,p]),E=tc([y.lng,y.lat],[_.lng,_.lat]);this.updateScales(E)}},{key:"updateScales",value:function(o){var s=this.controlOption,p=s.metric,y=s.imperial;p&&o&&this.updateMetric(o),y&&o&&this.updateImperial(o)}},{key:"updateMetric",value:function(o){var s=this.getRoundNum(o),p=s<1e3?s+" m":s/1e3+" km";this.updateScale(this.mScale,p,s/o)}},{key:"updateImperial",value:function(o){var s=o*3.2808399,p,y,_;s>5280?(p=s/5280,y=this.getRoundNum(p),this.updateScale(this.iScale,y+" mi",y/p)):(_=this.getRoundNum(s),this.updateScale(this.iScale,_+" ft",_/s))}},{key:"updateScale",value:function(o,s,p){var y=this.controlOption.maxWidth;o.style.width=Math.round(y*p)+"px",o.innerHTML=s}},{key:"getRoundNum",value:function(o){var s=Math.pow(10,(Math.floor(o)+"").length-1),p=o/s;return p=p>=10?10:p>=5?5:p>=3?3:p>=2?2:1,s*p}},{key:"addScales",value:function(o,s){var p=this.controlOption,y=p.metric,_=p.imperial;y&&(this.mScale=pa("div",o,s)),_&&(this.iScale=pa("div",o,s))}}]),r}(Fv);function nE(e){var i=iE();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function iE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var o3=function(e){(0,xn.Z)(r,e);var i=nE(r);function r(n){var o;return(0,lt.Z)(this,r),o=i.call(this,n),(0,I.Z)((0,xe.Z)(o),"disabled",void 0),(0,I.Z)((0,xe.Z)(o),"zoomInButton",void 0),(0,I.Z)((0,xe.Z)(o),"zoomOutButton",void 0),C(["updateDisabled","zoomIn","zoomOut"],(0,xe.Z)(o)),o}return(0,Lt.Z)(r,[{key:"getDefault",value:function(){return{position:Wh.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var o="l7-control-zoom",s=pa("div",o+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,o+"-in",s,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,o+"-out",s,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),s}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(o,s,p,y,_){var E=pa("a",p,y);return E.innerHTML=o,E.title=s,E.href="javascript:void(0)",E.addEventListener("click",_),E}},{key:"updateDisabled",value:function(){var o=this.mapsService,s="l7-disabled";ou(this.zoomInButton,s),ou(this.zoomOutButton,s),(this.disabled||o.getZoom()<=o.getMinZoom())&&Fs(this.zoomOutButton,s),(this.disabled||o.getZoom()>=o.getMaxZoom())&&Fs(this.zoomInButton,s)}}]),r}(Fv);function og(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function sg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?og(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):og(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aE(e){var i=oE();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function oE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ug=function(e){(0,xn.Z)(r,e);var i=aE(r);function r(n){var o;return(0,lt.Z)(this,r),o=i.call(this),(0,I.Z)((0,xe.Z)(o),"markerOption",void 0),(0,I.Z)((0,xe.Z)(o),"defaultMarker",void 0),(0,I.Z)((0,xe.Z)(o),"popup",void 0),(0,I.Z)((0,xe.Z)(o),"mapsService",void 0),(0,I.Z)((0,xe.Z)(o),"sceneSerive",void 0),(0,I.Z)((0,xe.Z)(o),"lngLat",void 0),(0,I.Z)((0,xe.Z)(o),"scene",void 0),(0,I.Z)((0,xe.Z)(o),"added",!1),(0,I.Z)((0,xe.Z)(o),"eventHandle",function(s){o.emit(s.type,{target:s,data:o.markerOption.extData,lngLat:o.lngLat})}),o.markerOption=sg(sg({},o.getDefault()),n),C(["update","onMove","onUp","addDragHandler","onMapClick"],(0,xe.Z)(o)),o.init(),o}return(0,Lt.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:ke.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(o){this.scene=o,this.mapsService=o.get(Qt.IMapService),this.sceneSerive=o.get(Qt.ISceneService);var s=this.markerOption,p=s.element,y=s.draggable;return this.mapsService.getMarkerContainer().appendChild(p),this.registerMarkerEvent(p),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var o=this.markerOption.element;return o&&ho(o),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(o){var s=this;if(!this.added)return this.once("added",function(){s.setElement(o)}),this;var p=this.markerOption.element;return p&&ho(p),this.markerOption.element=o,this.init(),this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.update(),this}},{key:"openPopup",value:function(){var o=this;if(!this.added)return this.once("added",function(){o.openPopup()}),this;var s=this.popup;return s?(s.isOpen()||s.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var o=this;this.added||this.once("added",function(){o.closePopup()});var s=this.popup;return s&&s.remove(),this}},{key:"setPopup",value:function(o){return this.popup=o,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var o=this.popup;if(o)o.isOpen()?o.remove():o.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(o){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(o){this.markerOption.extData=o}},{key:"update",value:function(){if(!!this.mapsService){var o=this.markerOption,s=o.element,p=o.anchor;this.updatePosition(),Ql(s,"".concat(Re[p]))}}},{key:"onMapClick",value:function(o){var s=this.markerOption.element;this.popup&&s&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.markerOption,s=o.element,p=o.offsets,y=this.lngLat,_=y.lng,E=y.lat,T=this.mapsService.getBounds(),P=this.mapsService.lngLatToContainer([_,E]);if(s){s.style.display="block",s.style.whiteSpace="nowrap";var D=this.mapsService.getContainer(),z=0,J=0;if(D&&(z=D.scrollWidth,J=D.scrollHeight),Math.abs(T[0][0])>180||Math.abs(T[1][0])>180){if(P.x>z){var oe=this.mapsService.lngLatToContainer([_-360,E]);P.x=oe.x}if(P.x<0){var he=this.mapsService.lngLatToContainer([_+360,E]);P.x=he.x}}(P.x>z||P.x<0||P.y>J||P.y<0)&&(s.style.display="none"),s.style.left=P.x+p[0]+"px",s.style.top=P.y-p[1]+"px"}}}},{key:"init",value:function(){var o=this,s=this.markerOption.element,p=this.markerOption,y=p.color,_=p.anchor;if(!s){this.defaultMarker=!0,s=pa("div"),this.markerOption.element=s;var E=document.createElementNS("http://www.w3.org/2000/svg","svg");E.setAttributeNS(null,"display","block"),E.setAttributeNS(null,"height","48px"),E.setAttributeNS(null,"width","48px"),E.setAttributeNS(null,"viewBox","0 0 1024 1024");var T=document.createElementNS("http://www.w3.org/2000/svg","path");T.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),T.setAttributeNS(null,"fill",y),E.appendChild(T),s.appendChild(E)}Fs(s,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(P){var D,z,J=((D=o.markerOption)===null||D===void 0?void 0:D.style)&&((z=o.markerOption)===null||z===void 0?void 0:z.style[P]);s&&(s.style[P]=J)}),s.addEventListener("click",function(P){o.onMapClick(P)}),s.addEventListener("click",this.eventHandle),He(s,_,"marker")}},{key:"registerMarkerEvent",value:function(o){o.addEventListener("mousemove",this.eventHandle),o.addEventListener("click",this.eventHandle),o.addEventListener("mousedown",this.eventHandle),o.addEventListener("mouseup",this.eventHandle),o.addEventListener("dblclick",this.eventHandle),o.addEventListener("contextmenu",this.eventHandle),o.addEventListener("mouseover",this.eventHandle),o.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var o=this.getElement();o.removeEventListener("mousemove",this.eventHandle),o.removeEventListener("click",this.eventHandle),o.removeEventListener("mousedown",this.eventHandle),o.removeEventListener("mouseup",this.eventHandle),o.removeEventListener("dblclick",this.eventHandle),o.removeEventListener("contextmenu",this.eventHandle),o.removeEventListener("mouseover",this.eventHandle),o.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(o){throw new Error("Method not implemented.")}},{key:"onUp",value:function(o){throw new Error("Method not implemented.")}}]),r}(Da.EventEmitter);function lg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function cg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?lg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sE(e){var i=uE();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function uE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var s3=function(e){(0,xn.Z)(r,e);var i=sE(r);function r(n){var o,s;return(0,lt.Z)(this,r),s=i.call(this),(0,I.Z)((0,xe.Z)(s),"markers",[]),(0,I.Z)((0,xe.Z)(s),"markerLayerOption",void 0),(0,I.Z)((0,xe.Z)(s),"clusterIndex",void 0),(0,I.Z)((0,xe.Z)(s),"points",[]),(0,I.Z)((0,xe.Z)(s),"clusterMarkers",[]),(0,I.Z)((0,xe.Z)(s),"mapsService",void 0),(0,I.Z)((0,xe.Z)(s),"scene",void 0),(0,I.Z)((0,xe.Z)(s),"zoom",void 0),(0,I.Z)((0,xe.Z)(s),"bbox",void 0),s.markerLayerOption=ye()(s.getDefault(),n),C(["update"],(0,xe.Z)(s)),s.zoom=((o=s.markerLayerOption.clusterOption)===null||o===void 0?void 0:o.zoom)||-99,s}return(0,Lt.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(o){return this.scene=o,this.mapsService=o.get(Qt.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(o){var s=this.markerLayerOption.cluster;s&&this.addPoint(o,this.markers.length),this.markers.push(o)}},{key:"removeMarker",value:function(o){this.markers.indexOf(o);var s=this.markers.indexOf(o);s>-1&&this.markers.splice(s,1)}},{key:"hide",value:function(){this.markers.map(function(o){o.getElement().style.opacity="0"}),this.clusterMarkers.map(function(o){o.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(o){o.getElement().style.opacity="1"}),this.clusterMarkers.map(function(o){o.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var o=this.markerLayerOption.cluster;return o?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var o=this;this.getMarkers().forEach(function(s){s.addTo(o.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(o){o.remove()}),this.clusterMarkers.forEach(function(o){o.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(o,s){var p=o.getLnglat(),y=p.lng,_=p.lat,E={geometry:{type:"Point",coordinates:[y,_]},properties:cg(cg({},o.getExtData()),{},{marker_id:s})};this.points.push(E)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var o=this.markerLayerOption.clusterOption,s=o.radius,p=o.minZoom,y=p===void 0?0:p,_=o.maxZoom;this.clusterIndex=new(Lf())({radius:s,minZoom:y,maxZoom:_}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(o,s){var p=this,y=o[0].concat(o[1]),_=this.clusterIndex.getClusters(y,s);this.clusterMarkers.forEach(function(E){E.remove()}),this.clusterMarkers=[],_.forEach(function(E){var T,P=p.markerLayerOption.clusterOption,D=P.field,z=P.method;if(E.properties&&(T=E.properties)!==null&&T!==void 0&&T.cluster_id){var J,oe=p.getLeaves((J=E.properties)===null||J===void 0?void 0:J.cluster_id);if(E.properties.clusterData=oe,D&&z){var he=oe==null?void 0:oe.map(function(jt){var Vt=(0,I.Z)({},D,jt.properties[D]);return Vt}),De=$t(he,D),it=gr(z,De),ht="point_"+z;E.properties[ht]=it.toFixed(2)}}var _t=p.clusterMarker(E);p.clusterMarkers.push(_t),_t.addTo(p.scene)})}},{key:"getLeaves",value:function(o){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return o?this.clusterIndex.getLeaves(o,s,p):null}},{key:"clusterMarker",value:function(o){var s=this.markerLayerOption.clusterOption,p=s,y=p.element,_=y===void 0?this.generateElement.bind(this):y,E=new ug({element:_(o)}).setLnglat({lng:o.geometry.coordinates[0],lat:o.geometry.coordinates[1]});return E}},{key:"normalMarker",value:function(o){var s=o.properties.marker_id;return this.markers[s]}},{key:"update",value:function(){var o=this.mapsService.getZoom(),s=this.mapsService.getBounds();(!this.bbox||Math.abs(o-this.zoom)>=1||!c(this.bbox,s))&&(this.bbox=f(s,.5),this.zoom=Math.floor(o),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(o){var s=pa("div","l7-marker-cluster"),p=pa("div","",s),y=pa("span","",p),_=this.markerLayerOption.clusterOption,E=_.field,T=_.method;o.properties.point_count=o.properties.point_count||1;var P=E&&T?o.properties["point_"+T]||o.properties[E]:o.properties.point_count;return y.textContent=P,s}}]),r}(Da.EventEmitter);function fg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function hg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?fg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lE(e){var i=cE();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function cE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pg=function(e){(0,xn.Z)(r,e);var i=lE(r);function r(n){var o;return(0,lt.Z)(this,r),o=i.call(this),(0,I.Z)((0,xe.Z)(o),"popupOption",void 0),(0,I.Z)((0,xe.Z)(o),"mapsService",void 0),(0,I.Z)((0,xe.Z)(o),"sceneSerive",void 0),(0,I.Z)((0,xe.Z)(o),"lngLat",void 0),(0,I.Z)((0,xe.Z)(o),"content",void 0),(0,I.Z)((0,xe.Z)(o),"closeButton",void 0),(0,I.Z)((0,xe.Z)(o),"timeoutInstance",void 0),(0,I.Z)((0,xe.Z)(o),"container",void 0),(0,I.Z)((0,xe.Z)(o),"tip",void 0),(0,I.Z)((0,xe.Z)(o),"scene",void 0),o.popupOption=hg(hg({},o.getdefault()),n),C(["update","onClickClose","remove"],(0,xe.Z)(o)),o}return(0,Lt.Z)(r,[{key:"addTo",value:function(o){var s=this;return this.mapsService=o.get(Qt.IMapService),this.sceneSerive=o.get(Qt.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=o,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){s.mapsService.on("click",s.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(o){var s=window.document.createDocumentFragment(),p=window.document.createElement("body"),y;for(p.innerHTML=o;y=p.firstChild,!!y;)s.appendChild(y);return this.setDOMContent(s)}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(o){return this.setDOMContent(window.document.createTextNode(o))}},{key:"setMaxWidth",value:function(o){return this.popupOption.maxWidth=o,this.update(),this}},{key:"setDOMContent",value:function(o){return this.createContent(),this.content.appendChild(o),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&ho(this.content),this.content=pa("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=pa("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(o,s,p){var y=window.document.createElement(o);return s!==void 0&&(y.className=s),p&&p.appendChild(y),y}},{key:"removeDom",value:function(o){o.parentNode&&o.parentNode.removeChild(o)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:ke.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(o){o.stopPropagation&&o.stopPropagation(),this.remove()}},{key:"update",value:function(){var o=this,s=this.lngLat,p=this.popupOption,y=p.className,_=p.maxWidth,E=p.anchor;if(!(!this.mapsService||!s||!this.content)){var T=this.mapsService.getMarkerContainer();if(!this.container&&T){this.container=this.creatDom("div","l7-popup",T),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),y&&y.split(" ").forEach(function(D){return o.container.classList.add(D)});var P=this.popupOption.stopPropagation;P&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(D){o.container.addEventListener(D,function(z){z.stopPropagation()})}),this.container.style.whiteSpace="nowrap"}_&&this.container.style.maxWidth!==_&&(this.container.style.maxWidth=_),this.updatePosition(),Ql(this.container,"".concat(Re[E])),He(this.container,E,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.lngLat,s=o.lng,p=o.lat,y=this.popupOption.offsets,_=this.mapsService.lngLatToContainer([s,p]);this.container.style.left=_.x+y[0]+"px",this.container.style.top=_.y-y[1]+"px"}}}]),r}(Da.EventEmitter);function fE(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var o=i.head||i.getElementsByTagName("head")[0];if(!o){o=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(o,s):i.documentElement.appendChild(o)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),o.appendChild(p),p}}fE(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var hE=R(88307),pE=R.n(hE),dE=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"attribute",void 0),(0,I.Z)(this,"buffer",void 0);var n=r.buffer,o=r.offset,s=r.stride,p=r.normalized,y=r.size,_=r.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:o||0,stride:s||0,normalized:p||!1,divisor:_||0},y&&(this.attribute.size=y)}return(0,Lt.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),nh,qd,ih,dc,Kd,Xh,$d,Bv,xf,_p,bu,bf,Ef,Nv,vE=(nh={},(0,I.Z)(nh,ae.POINTS,"points"),(0,I.Z)(nh,ae.LINES,"lines"),(0,I.Z)(nh,ae.LINE_LOOP,"line loop"),(0,I.Z)(nh,ae.LINE_STRIP,"line strip"),(0,I.Z)(nh,ae.TRIANGLES,"triangles"),(0,I.Z)(nh,ae.TRIANGLE_FAN,"triangle fan"),(0,I.Z)(nh,ae.TRIANGLE_STRIP,"triangle strip"),nh),dg=(qd={},(0,I.Z)(qd,ae.STATIC_DRAW,"static"),(0,I.Z)(qd,ae.DYNAMIC_DRAW,"dynamic"),(0,I.Z)(qd,ae.STREAM_DRAW,"stream"),qd),Im=(ih={},(0,I.Z)(ih,ae.BYTE,"int8"),(0,I.Z)(ih,ae.UNSIGNED_INT,"int16"),(0,I.Z)(ih,ae.INT,"int32"),(0,I.Z)(ih,ae.UNSIGNED_BYTE,"uint8"),(0,I.Z)(ih,ae.UNSIGNED_SHORT,"uint16"),(0,I.Z)(ih,ae.UNSIGNED_INT,"uint32"),(0,I.Z)(ih,ae.FLOAT,"float"),ih),mE=(dc={},(0,I.Z)(dc,ae.ALPHA,"alpha"),(0,I.Z)(dc,ae.LUMINANCE,"luminance"),(0,I.Z)(dc,ae.LUMINANCE_ALPHA,"luminance alpha"),(0,I.Z)(dc,ae.RGB,"rgb"),(0,I.Z)(dc,ae.RGBA,"rgba"),(0,I.Z)(dc,ae.RGBA4,"rgba4"),(0,I.Z)(dc,ae.RGB5_A1,"rgb5 a1"),(0,I.Z)(dc,ae.RGB565,"rgb565"),(0,I.Z)(dc,ae.DEPTH_COMPONENT,"depth"),(0,I.Z)(dc,ae.DEPTH_STENCIL,"depth stencil"),dc),gE=(Kd={},(0,I.Z)(Kd,ae.DONT_CARE,"dont care"),(0,I.Z)(Kd,ae.NICEST,"nice"),(0,I.Z)(Kd,ae.FASTEST,"fast"),Kd),vg=(Xh={},(0,I.Z)(Xh,ae.NEAREST,"nearest"),(0,I.Z)(Xh,ae.LINEAR,"linear"),(0,I.Z)(Xh,ae.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,I.Z)(Xh,ae.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,I.Z)(Xh,ae.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,I.Z)(Xh,ae.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Xh),mg=($d={},(0,I.Z)($d,ae.REPEAT,"repeat"),(0,I.Z)($d,ae.CLAMP_TO_EDGE,"clamp"),(0,I.Z)($d,ae.MIRRORED_REPEAT,"mirror"),$d),yE=(Bv={},(0,I.Z)(Bv,ae.NONE,"none"),(0,I.Z)(Bv,ae.BROWSER_DEFAULT_WEBGL,"browser"),Bv),_E=(xf={},(0,I.Z)(xf,ae.NEVER,"never"),(0,I.Z)(xf,ae.ALWAYS,"always"),(0,I.Z)(xf,ae.LESS,"less"),(0,I.Z)(xf,ae.LEQUAL,"lequal"),(0,I.Z)(xf,ae.GREATER,"greater"),(0,I.Z)(xf,ae.GEQUAL,"gequal"),(0,I.Z)(xf,ae.EQUAL,"equal"),(0,I.Z)(xf,ae.NOTEQUAL,"notequal"),xf),gg=(_p={},(0,I.Z)(_p,ae.FUNC_ADD,"add"),(0,I.Z)(_p,ae.MIN_EXT,"min"),(0,I.Z)(_p,ae.MAX_EXT,"max"),(0,I.Z)(_p,ae.FUNC_SUBTRACT,"subtract"),(0,I.Z)(_p,ae.FUNC_REVERSE_SUBTRACT,"reverse subtract"),_p),zv=(bu={},(0,I.Z)(bu,ae.ZERO,"zero"),(0,I.Z)(bu,ae.ONE,"one"),(0,I.Z)(bu,ae.SRC_COLOR,"src color"),(0,I.Z)(bu,ae.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,I.Z)(bu,ae.SRC_ALPHA,"src alpha"),(0,I.Z)(bu,ae.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,I.Z)(bu,ae.DST_COLOR,"dst color"),(0,I.Z)(bu,ae.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,I.Z)(bu,ae.DST_ALPHA,"dst alpha"),(0,I.Z)(bu,ae.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,I.Z)(bu,ae.CONSTANT_COLOR,"constant color"),(0,I.Z)(bu,ae.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,I.Z)(bu,ae.CONSTANT_ALPHA,"constant alpha"),(0,I.Z)(bu,ae.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,I.Z)(bu,ae.SRC_ALPHA_SATURATE,"src alpha saturate"),bu),xE=(bf={},(0,I.Z)(bf,ae.NEVER,"never"),(0,I.Z)(bf,ae.ALWAYS,"always"),(0,I.Z)(bf,ae.LESS,"less"),(0,I.Z)(bf,ae.LEQUAL,"lequal"),(0,I.Z)(bf,ae.GREATER,"greater"),(0,I.Z)(bf,ae.GEQUAL,"gequal"),(0,I.Z)(bf,ae.EQUAL,"equal"),(0,I.Z)(bf,ae.NOTEQUAL,"notequal"),bf),ld=(Ef={},(0,I.Z)(Ef,ae.ZERO,"zero"),(0,I.Z)(Ef,ae.KEEP,"keep"),(0,I.Z)(Ef,ae.REPLACE,"replace"),(0,I.Z)(Ef,ae.INVERT,"invert"),(0,I.Z)(Ef,ae.INCR,"increment"),(0,I.Z)(Ef,ae.DECR,"decrement"),(0,I.Z)(Ef,ae.INCR_WRAP,"increment wrap"),(0,I.Z)(Ef,ae.DECR_WRAP,"decrement wrap"),Ef),bE=(Nv={},(0,I.Z)(Nv,ae.FRONT,"front"),(0,I.Z)(Nv,ae.BACK,"back"),Nv),EE=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"buffer",void 0);var n=r.data,o=r.usage,s=r.type;this.buffer=i.buffer({data:n,usage:dg[o||ae.STATIC_DRAW],type:Im[s||ae.UNSIGNED_BYTE]})}return(0,Lt.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var n=r.data,o=r.offset;this.buffer.subdata(n,o)}}]),e}(),SE=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"elements",void 0);var n=r.data,o=r.usage,s=r.type,p=r.count;this.elements=i.elements({data:n,usage:dg[o||ae.STATIC_DRAW],type:Im[s||ae.UNSIGNED_BYTE],count:p})}return(0,Lt.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var n=r.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),CE=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"framebuffer",void 0);var n=r.width,o=r.height,s=r.color,p=r.colors,y=r.depth,_=r.stencil,E={width:n,height:o};Array.isArray(p)&&(E.colors=p.map(function(T){return T.get()})),s&&typeof s!="boolean"&&(E.color=s.get()),this.framebuffer=i.framebuffer(E)}return(0,Lt.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var n=r.width,o=r.height;this.framebuffer.resize(n,o)}}]),e}(),wE=R(36719),AE=R.n(wE),TE=R(68630),ME=R.n(TE);function yg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Yh(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?yg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var PE=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"reGl",void 0),(0,I.Z)(this,"destroyed",!1),(0,I.Z)(this,"drawCommand",void 0),(0,I.Z)(this,"drawPickCommand",void 0),(0,I.Z)(this,"drawParams",void 0),(0,I.Z)(this,"options",void 0),(0,I.Z)(this,"uniforms",{}),this.reGl=i;var n=r.vs,o=r.fs,s=r.attributes,p=r.uniforms,y=r.primitive,_=r.count,E=r.elements,T=r.depth,P=r.blend,D=r.stencil,z=r.cull,J=r.instances,oe={};this.options=r,p&&(this.uniforms=this.extractUniforms(p),Object.keys(p).forEach(function(ht){oe[ht]=i.prop(ht)}));var he={};Object.keys(s).forEach(function(ht){he[ht]=s[ht].get()});var De={attributes:he,frag:o,uniforms:oe,vert:n,blend:{},primitive:vE[y===void 0?ae.TRIANGLES:y]};J&&(De.instances=J),_&&(De.count=_),E&&(De.elements=E.get()),this.initDepthDrawParams({depth:T},De),this.initBlendDrawParams({blend:P},De),this.initStencilDrawParams({stencil:D},De),this.initCullDrawParams({cull:z},De),this.drawCommand=i(De);var it=Yn()(De);it.blend=Yh(Yh({},it.blend),{},{enable:!1}),this.drawPickCommand=i(it),this.drawParams=De}return(0,Lt.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=Yh(Yh({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var o=Yh(Yh({},this.uniforms),this.extractUniforms(r.uniforms||{})),s={};Object.keys(o).forEach(function(p){var y=(0,uh.Z)(o[p]);y==="boolean"||y==="number"||Array.isArray(o[p])||o[p].BYTES_PER_ELEMENT?s[p]=o[p]:s[p]=o[p].get()}),n?this.drawPickCommand(s):this.drawCommand(s)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,n){var o=r.depth;o&&(n.depth={enable:o.enable===void 0?!0:!!o.enable,mask:o.mask===void 0?!0:!!o.mask,func:_E[o.func||ae.LESS],range:o.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,n){var o=r.blend;if(o){var s=o.enable,p=o.func,y=o.equation,_=o.color,E=_===void 0?[0,0,0,0]:_;n.blend={enable:!!s,func:{srcRGB:zv[p&&p.srcRGB||ae.SRC_ALPHA],srcAlpha:zv[p&&p.srcAlpha||ae.SRC_ALPHA],dstRGB:zv[p&&p.dstRGB||ae.ONE_MINUS_SRC_ALPHA],dstAlpha:zv[p&&p.dstAlpha||ae.ONE_MINUS_SRC_ALPHA]},equation:{rgb:gg[y&&y.rgb||ae.FUNC_ADD],alpha:gg[y&&y.alpha||ae.FUNC_ADD]},color:E}}}},{key:"initStencilDrawParams",value:function(r,n){var o=r.stencil;if(o){var s=o.enable,p=o.mask,y=p===void 0?-1:p,_=o.func,E=_===void 0?{cmp:ae.ALWAYS,ref:0,mask:-1}:_,T=o.opFront,P=T===void 0?{fail:ae.KEEP,zfail:ae.KEEP,zpass:ae.KEEP}:T,D=o.opBack,z=D===void 0?{fail:ae.KEEP,zfail:ae.KEEP,zpass:ae.KEEP}:D;n.stencil={enable:!!s,mask:y,func:Yh(Yh({},E),{},{cmp:xE[E.cmp]}),opFront:{fail:ld[P.fail],zfail:ld[P.zfail],zpass:ld[P.zpass]},opBack:{fail:ld[z.fail],zfail:ld[z.zfail],zpass:ld[z.zpass]}}}}},{key:"initCullDrawParams",value:function(r,n){var o=r.cull;if(o){var s=o.enable,p=o.face,y=p===void 0?ae.BACK:p;n.cull={enable:!!s,face:bE[y]}}}},{key:"extractUniforms",value:function(r){var n=this,o={};return Object.keys(r).forEach(function(s){n.extractUniformsRecursively(s,r[s],o,"")}),o}},{key:"extractUniformsRecursively",value:function(r,n,o,s){var p=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||AE()(n)||n===""||"resize"in n){o["".concat(s&&s+".").concat(r)]=n;return}ME()(n)&&Object.keys(n).forEach(function(y){p.extractUniformsRecursively(y,n[y],o,"".concat(s&&s+".").concat(r))}),Array.isArray(n)&&n.forEach(function(y,_){Object.keys(y).forEach(function(E){p.extractUniformsRecursively(E,y[E],o,"".concat(s&&s+".").concat(r,"[").concat(_,"]"))})})}}]),e}(),IE=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"texture",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDistroy",!1);var n=r.data,o=r.type,s=o===void 0?ae.UNSIGNED_BYTE:o,p=r.width,y=r.height,_=r.flipY,E=_===void 0?!1:_,T=r.format,P=T===void 0?ae.RGBA:T,D=r.mipmap,z=D===void 0?!1:D,J=r.wrapS,oe=J===void 0?ae.CLAMP_TO_EDGE:J,he=r.wrapT,De=he===void 0?ae.CLAMP_TO_EDGE:he,it=r.aniso,ht=it===void 0?0:it,_t=r.alignment,jt=_t===void 0?1:_t,Vt=r.premultiplyAlpha,rr=Vt===void 0?!1:Vt,yr=r.mag,Yr=yr===void 0?ae.NEAREST:yr,fn=r.min,Or=fn===void 0?ae.NEAREST:fn,Tn=r.colorSpace,Bn=Tn===void 0?ae.BROWSER_DEFAULT_WEBGL:Tn;this.width=p,this.height=y;var hi={width:p,height:y,type:Im[s],format:mE[P],wrapS:mg[oe],wrapT:mg[De],mag:vg[Yr],min:vg[Or],alignment:jt,flipY:E,colorSpace:yE[Bn],premultiplyAlpha:rr,aniso:ht};n&&(hi.data=n),typeof z=="number"?hi.mipmap=gE[z]:typeof z=="boolean"&&(hi.mipmap=z),this.texture=i.texture(hi)}return(0,Lt.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var n=r.width,o=r.height;this.texture.resize(n,o),this.width=n,this.height=o}},{key:"destroy",value:function(){this.isDistroy||this.texture.destroy(),this.isDistroy=!0}}]),e}(),_g,xg,OE=(_g=(0,zr.b2)(),_g(xg=function(){function e(){var i=this;(0,lt.Z)(this,e),(0,I.Z)(this,"extensionObject",void 0),(0,I.Z)(this,"gl",void 0),(0,I.Z)(this,"$container",void 0),(0,I.Z)(this,"canvas",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"isDirty",void 0),(0,I.Z)(this,"createModel",function(r){return new PE(i.gl,r)}),(0,I.Z)(this,"createAttribute",function(r){return new dE(i.gl,r)}),(0,I.Z)(this,"createBuffer",function(r){return new EE(i.gl,r)}),(0,I.Z)(this,"createElements",function(r){return new SE(i.gl,r)}),(0,I.Z)(this,"createTexture2D",function(r){return new IE(i.gl,r)}),(0,I.Z)(this,"createFramebuffer",function(r){return new CE(i.gl,r)}),(0,I.Z)(this,"useFramebuffer",function(r,n){i.gl({framebuffer:r?r.get():null})(n)}),(0,I.Z)(this,"clear",function(r){var n=r.color,o=r.depth,s=r.stencil,p=r.framebuffer,y=p===void 0?null:p,_={color:n,depth:o,stencil:s};_.framebuffer=y===null?y:y.get(),i.gl.clear(_)}),(0,I.Z)(this,"viewport",function(r){var n=r.x,o=r.y,s=r.width,p=r.height;i.gl._gl.viewport(n,o,s,p),i.width=s,i.height=p,i.gl._refresh()}),(0,I.Z)(this,"readPixels",function(r){var n=r.framebuffer,o=r.x,s=r.y,p=r.width,y=r.height,_={x:o,y:s,width:p,height:y};return n&&(_.framebuffer=n.get()),i.gl.read(_)}),(0,I.Z)(this,"getViewportSize",function(){return{width:i.gl._gl.drawingBufferWidth,height:i.gl._gl.drawingBufferHeight}}),(0,I.Z)(this,"getContainer",function(){if(Ao)return i.canvas;var r;return(r=i.canvas)===null||r===void 0?void 0:r.parentElement}),(0,I.Z)(this,"getCanvas",function(){return i.canvas}),(0,I.Z)(this,"getGLContext",function(){return i.gl._gl}),(0,I.Z)(this,"destroy",function(){i.gl.destroy()})}return(0,Lt.Z)(e,[{key:"init",value:function(){var i=(0,An.Z)(Ai().mark(function n(o,s){var p=this;return Ai().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.canvas=o,_.next=3,new Promise(function(E,T){pE()({canvas:p.canvas,attributes:{alpha:!0,antialias:s.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:s.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(D,z){(D||!z)&&T(D),E(z)}})});case 3:this.gl=_.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return _.stop()}},n,this)}));function r(n,o){return i.apply(this,arguments)}return r}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null})}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||xg);function bg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Eg(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?bg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var RE=function(){function e(i){(0,lt.Z)(this,e),(0,I.Z)(this,"sceneService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"controlService",void 0),(0,I.Z)(this,"layerService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"markerService",void 0),(0,I.Z)(this,"popupService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"interactionService",void 0),(0,I.Z)(this,"container",void 0);var r=i.id,n=i.map,o=i.canvas,s=i.hasBaseMap,p=Lb();this.container=p,n.setContainer(p,r,o,s),p.bind(Qt.IRendererService).to(OE).inSingletonScope(),this.sceneService=p.get(Qt.ISceneService),this.mapService=p.get(Qt.IMapService),this.iconService=p.get(Qt.IIconService),this.fontService=p.get(Qt.IFontService),this.controlService=p.get(Qt.IControlService),this.layerService=p.get(Qt.ILayerService),this.markerService=p.get(Qt.IMarkerService),this.interactionService=p.get(Qt.IInteractionService),this.popupService=p.get(Qt.IPopupService),Ao?this.sceneService.initMiniScene(i):(this.initComponent(r),this.sceneService.init(i),this.initControl())}return(0,Lt.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var n=this;if(this.sceneService.loaded){var o=new r(this);o.init()}else this.on("loaded",function(){var s=new r(n);s.init()})}},{key:"setBgColor",value:function(r){this.mapService.setBgColor(r)}},{key:"addLayer",value:function(r){var n=kb(this.container);r.setContainer(n,this.container),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r,n){this.layerService.remove(r,n)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(r){this.layerService.setEnableRender(r)}},{key:"addIconFont",value:function(r,n){this.fontService.addIconFont(r,n)}},{key:"addIconFonts",value:function(r){var n=this;r.forEach(function(o){var s=(0,ie.Z)(o,2),p=s[0],y=s[1];n.fontService.addIconFont(p,y)})}},{key:"addFontFace",value:function(r,n){this.sceneService.addFontFace(r,n)}},{key:"addImage",value:function(r,n){Ao?this.iconService.addImageMini(r,n,this.sceneService):this.iconService.addImage(r,n)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,n){Pm.indexOf(r)===-1?this.mapService.on(r,n):this.sceneService.on(r,n)}},{key:"once",value:function(r,n){Pm.indexOf(r)===-1?this.mapService.once(r,n):this.sceneService.once(r,n)}},{key:"off",value:function(r,n){Pm.indexOf(r)===-1?this.mapService.off(r,n):this.sceneService.off(r,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,n){return this.mapService.setCenter(r,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r,n){this.mapService.panBy(r,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,n){var o=this.sceneService.getSceneConfig(),s=o.fitBoundsOptions,p=o.animate;this.mapService.fitBounds(r,n||Eg(Eg({},s),{},{animate:p}))}},{key:"setZoomAndCenter",value:function(r,n){this.mapService.setZoomAndCenter(r,n)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,n){this.container.bind(Qt.IPostProcessingPass).to(r).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(r){this.controlService.init({container:Hs(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),n=r.logoVisible,o=r.logoPosition;n&&this.addControl(new eE({position:o}))}}]),e}(),LE=R(13218),ku=R.n(LE),Sg,Cg,wg,Om,Ag;function kE(e){return e.map(function(i){return typeof i=="string"&&(i=[i,{}]),i})}var DE=(Sg=(0,zr.b2)(),Cg=(0,zr.f3)(Qt.IGlobalConfigService),Sg(wg=(Om=function(){function e(){(0,lt.Z)(this,e),mr(this,"configService",Ag,this),(0,I.Z)(this,"enabled",void 0)}return(0,Lt.Z)(e,[{key:"apply",value:function(r,n){var o=this,s=n.rendererService,p=n.postProcessingPassFactory,y=n.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var _=r.getLayerConfig(),E=_.enableMultiPassRenderer,T=_.passes,P=T===void 0?[]:T;o.enabled=!!E&&r.getLayerConfig().enableMultiPassRenderer!==!1,o.enabled&&(r.multiPassRenderer=o.createMultiPassRenderer(r,P,p,y),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(r,n,o,s){var p=r.multiPassRenderer,y=r.getLayerConfig(),_=y.enablePicking,E=y.enableTAA;return _&&p.add(s("pixelPicking")),p}}]),e}(),Ag=ur(Om.prototype,"configService",[Cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Om))||wg),qh,Tg=(qh={},(0,I.Z)(qh,pc.additive,{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(qh,pc.none,{enable:!1}),(0,I.Z)(qh,pc.normal,{enable:!0,func:{srcRGB:ae.SRC_ALPHA,dstRGB:ae.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,I.Z)(qh,pc.subtractive,{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE,srcAlpha:ae.ZERO,dstAlpha:ae.ONE_MINUS_SRC_COLOR},equation:{rgb:ae.FUNC_SUBTRACT,alpha:ae.FUNC_SUBTRACT}}),(0,I.Z)(qh,pc.max,{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE},equation:{rgb:ae.MAX_EXT}}),(0,I.Z)(qh,pc.min,{enable:!0,func:{srcRGB:ae.ONE,dstRGB:ae.ONE},equation:{rgb:ae.MIN_EXT}}),qh),FE=R(81763),Za=R.n(FE),BE=R(1469),xp=R.n(BE),u3=1024;function tl(e,i,r,n,o){i.updateStyleAttribute(e,r,n,o)}function NE(e,i){e.opacity&&Uv("opacity",i,e.opacity),e.strokeWidth&&Uv("strokeWidth",i,e.strokeWidth),e.strokeOpacity&&Uv("strokeOpacity",i,e.strokeOpacity),e.stroke&&zE("stroke",i,e.stroke),e.offsets&&Mg("offsets",i,e.offsets),e.textOffset&&Mg("textOffset",i,e.textOffset),e.thetaOffset&&Uv("thetaOffset",i,e.thetaOffset)}function Uv(e,i,r){ci()(r)?tl(e,i,r,function(n){return n}):Za()(r)?tl(e,i,[r],void 0):xp()(r)&&r.length===2?ci()(r[0])&&Hn()(r[1])||ci()(r[0])&&xp()(r[1])&&Za()(r[1][0])&&Za()(r[1][1])?tl(e,i,r[0],r[1]):tl(e,i,[1],void 0):tl(e,i,[1],void 0)}function Mg(e,i,r){ci()(r)?tl(e,i,r,function(n){return n}):xp()(r)&&r.length===2&&ci()(r[0])&&Hn()(r[1])?tl(e,i,r[0],r[1]):xp()(r)&&r.length===2&&Za()(r[0])&&Za()(r[1])?tl(e,i,r,void 0):tl(e,i,[0,0],void 0)}function zE(e,i,r){ci()(r)?tl(e,i,r,void 0):xp()(r)&&r.length===2&&(ci()(r[0])&&Hn()(r[1])||ci()(r[0])&&xp()(r[1])&&r[1].length>0)?tl(e,i,r[0],r[1]):tl(e,i,"#fff",void 0)}var UE=[["circle","cylinder"],["square","cylinder"],["triangle","cylinder"],["pentagon","cylinder"],["hexagon","cylinder"],["octogon","cylinder"],["hexagram","cylinder"],["rhombus","cylinder"],["vesica","cylinder"]];function ZE(e,i,r){typeof i=="string"&&typeof r=="string"&&i!==r&&UE.map(function(n){n.includes(i)&&n.includes(r)&&(e.dataState.dataSourceNeedUpdate=!0)})}var jE=["passes"],VE=["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"],Pg,Rm,Ig;function GE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=HE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,y=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw y}}}}function HE(e,i){if(!!e){if(typeof e=="string")return Og(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Og(e,i)}}function Og(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function Rg(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function Du(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Rg(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rg(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function WE(e){var i=XE();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function XE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Lg=0,bp=(Pg=Mm(Qt.IGlobalConfigService),Rm=function(e){(0,xn.Z)(r,e);var i=WE(r);function r(){var n,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,lt.Z)(this,r),n=i.call(this),(0,I.Z)((0,xe.Z)(n),"id","".concat(Lg++)),(0,I.Z)((0,xe.Z)(n),"name","".concat(Lg)),(0,I.Z)((0,xe.Z)(n),"type",void 0),(0,I.Z)((0,xe.Z)(n),"visible",!0),(0,I.Z)((0,xe.Z)(n),"zIndex",0),(0,I.Z)((0,xe.Z)(n),"minZoom",void 0),(0,I.Z)((0,xe.Z)(n),"maxZoom",void 0),(0,I.Z)((0,xe.Z)(n),"inited",!1),(0,I.Z)((0,xe.Z)(n),"layerModelNeedUpdate",!1),(0,I.Z)((0,xe.Z)(n),"pickedFeatureID",null),(0,I.Z)((0,xe.Z)(n),"selectedFeatureID",null),(0,I.Z)((0,xe.Z)(n),"styleNeedUpdate",!1),(0,I.Z)((0,xe.Z)(n),"rendering",void 0),(0,I.Z)((0,xe.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,I.Z)((0,xe.Z)(n),"hooks",{init:new $s,afterInit:new $s,beforeRender:new $s,beforeRenderData:new Rc,afterRender:new Us,beforePickingEncode:new Us,afterPickingEncode:new Us,beforeHighlight:new Us(["pickedColor"]),afterHighlight:new Us,beforeSelect:new Us(["pickedColor"]),afterSelect:new Us,beforeDestroy:new Us,afterDestroy:new Us}),(0,I.Z)((0,xe.Z)(n),"models",[]),(0,I.Z)((0,xe.Z)(n),"multiPassRenderer",void 0),(0,I.Z)((0,xe.Z)(n),"plugins",void 0),(0,I.Z)((0,xe.Z)(n),"sourceOption",void 0),(0,I.Z)((0,xe.Z)(n),"layerModel",void 0),(0,I.Z)((0,xe.Z)(n),"sceneContainer",void 0),(0,I.Z)((0,xe.Z)(n),"layerChildren",[]),mr((0,xe.Z)(n),"configService",Ig,(0,xe.Z)(n)),(0,I.Z)((0,xe.Z)(n),"shaderModuleService",void 0),(0,I.Z)((0,xe.Z)(n),"cameraService",void 0),(0,I.Z)((0,xe.Z)(n),"coordinateService",void 0),(0,I.Z)((0,xe.Z)(n),"iconService",void 0),(0,I.Z)((0,xe.Z)(n),"fontService",void 0),(0,I.Z)((0,xe.Z)(n),"pickingService",void 0),(0,I.Z)((0,xe.Z)(n),"rendererService",void 0),(0,I.Z)((0,xe.Z)(n),"layerService",void 0),(0,I.Z)((0,xe.Z)(n),"interactionService",void 0),(0,I.Z)((0,xe.Z)(n),"mapService",void 0),(0,I.Z)((0,xe.Z)(n),"styleAttributeService",void 0),(0,I.Z)((0,xe.Z)(n),"layerSource",void 0),(0,I.Z)((0,xe.Z)(n),"postProcessingPassFactory",void 0),(0,I.Z)((0,xe.Z)(n),"normalPassFactory",void 0),(0,I.Z)((0,xe.Z)(n),"animateOptions",{enable:!1}),(0,I.Z)((0,xe.Z)(n),"container",void 0),(0,I.Z)((0,xe.Z)(n),"encodedData",void 0),(0,I.Z)((0,xe.Z)(n),"configSchema",void 0),(0,I.Z)((0,xe.Z)(n),"currentPickId",null),(0,I.Z)((0,xe.Z)(n),"rawConfig",void 0),(0,I.Z)((0,xe.Z)(n),"needUpdateConfig",void 0),(0,I.Z)((0,xe.Z)(n),"pendingStyleAttributes",[]),(0,I.Z)((0,xe.Z)(n),"scaleOptions",{}),(0,I.Z)((0,xe.Z)(n),"animateStartTime",void 0),(0,I.Z)((0,xe.Z)(n),"aniamateStatus",!1),(0,I.Z)((0,xe.Z)(n),"bottomColor","rgba(0, 0, 0, 0)"),(0,I.Z)((0,xe.Z)(n),"isDestroied",!1),(0,I.Z)((0,xe.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var s=n.getLayerConfig(),p=s.autoFit,y=s.fitBoundsOptions;p&&n.fitBounds(y),n.emit("dataUpdate"),n.reRender()}),n.name=o.name||n.id,n.zIndex=o.zIndex||0,n.rawConfig=o,n}return(0,Lt.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(o){if(!this.inited)this.needUpdateConfig=Du(Du({},this.needUpdateConfig),o);else{var s=this.container.get(Qt.SceneID);NE(o,this),this.configService.setLayerConfig(s,this.id,Du(Du(Du({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),o)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(o,s){this.container=o,this.sceneContainer=s}},{key:"getContainer",value:function(){return this.container}},{key:"setBottomColor",value:function(o){this.bottomColor=o}},{key:"getBottomColor",value:function(){return this.bottomColor}},{key:"addPlugin",value:function(o){return this.plugins.push(o),this}},{key:"init",value:function(){var o=this,s=this.container.get(Qt.SceneID),p=this.rawConfig.enableMultiPassRenderer,y=p===void 0?!1:p;this.configService.setLayerConfig(s,this.id,{enableMultiPassRenderer:y}),this.iconService=this.container.get(Qt.IIconService),this.fontService=this.container.get(Qt.IFontService),this.rendererService=this.container.get(Qt.IRendererService),this.layerService=this.container.get(Qt.ILayerService),this.interactionService=this.container.get(Qt.IInteractionService),this.pickingService=this.container.get(Qt.IPickingService),this.mapService=this.container.get(Qt.IMapService),this.cameraService=this.container.get(Qt.ICameraService),this.coordinateService=this.container.get(Qt.ICoordinateSystemService),this.shaderModuleService=this.container.get(Qt.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Qt.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Qt.IFactoryNormalPass),this.styleAttributeService=this.container.get(Qt.IStyleAttributeService),this.multiPassRenderer=this.container.get(Qt.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(P){var D=P.attributeName,z=P.attributeField,J=P.attributeValues,oe=P.updateOptions;o.styleAttributeService.updateStyleAttribute(D,{scale:Du({field:z},o.splitValuesAndCallbackInAttribute(J,o.getLayerConfig()[D]))},oe)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Qt.ILayerPlugin);var _=GE(this.plugins),E;try{for(_.s();!(E=_.n()).done;){var T=E.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(P){_.e(P)}finally{_.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Du(Du({},this.getDefaultConfig()),this.rawConfig));var o=this.getLayerConfig(),s=o.animateOption;s!=null&&s.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(o,s,p){return this.updateStyleAttribute("color",o,s,p),this}},{key:"texture",value:function(o,s,p){return this.updateStyleAttribute("texture",o,s,p),this}},{key:"rotate",value:function(o,s,p){return this.updateStyleAttribute("rotate",o,s,p),this}},{key:"size",value:function(o,s,p){return this.updateStyleAttribute("size",o,s,p),this}},{key:"filter",value:function(o,s,p){return this.updateStyleAttribute("filter",o,s,p),this}},{key:"shape",value:function(o,s,p){var y,_,E,T=(y=this.styleAttributeService)===null||y===void 0||(_=y.getLayerStyleAttribute("shape"))===null||_===void 0||(E=_.scale)===null||E===void 0?void 0:E.field,P=o;return this.updateStyleAttribute("shape",o,s,p),ZE(this,T,P),this}},{key:"label",value:function(o,s,p){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:o,attributeValues:s,updateOptions:p}),this}},{key:"animate",value:function(o){var s={};return ku()(o)?(s.enable=!0,s=Du(Du({},s),o)):s.enable=o,this.updateLayerConfig({animateOption:s}),this}},{key:"source",value:function(o,s){return o!=null&&o.data?(this.setSource(o),this):(this.sourceOption={data:o,options:s},this)}},{key:"setData",value:function(o,s){var p=this;return this.inited?this.layerSource.setData(o,s):this.on("inited",function(){p.layerSource.setData(o,s)}),this}},{key:"style",value:function(o){var s=this,p=o.passes,y=(0,cc.Z)(o,jE);return p&&kE(p).forEach(function(_){var E=s.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(_[0]);E&&E.updateOptions(_[1])}),this.rawConfig=Du(Du({},this.rawConfig),y),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(o,s){return ku()(o)?this.scaleOptions=Du(Du({},this.scaleOptions),o):this.scaleOptions[o]=s,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(o){var s={};return s.enableHighlight=ku()(o)?!0:o,ku()(o)?(s.enableHighlight=!0,o.color&&(s.highlightColor=o.color),o.mix&&(s.activeMix=o.mix)):s.enableHighlight=!!o,this.updateLayerConfig(s),this}},{key:"setActive",value:function(o,s){var p=this;if(ku()(o)){var y=o.x,_=y===void 0?0:y,E=o.y,T=E===void 0?0:E;this.updateLayerConfig({highlightColor:ku()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:ku()(s)?s.mix:this.getLayerConfig().activeMix}),this.pick({x:_,y:T})}else this.updateLayerConfig({pickedFeatureID:o,highlightColor:ku()(s)?s.color:this.getLayerConfig().highlightColor,activeMix:ku()(s)?s.mix:this.getLayerConfig().activeMix}),this.hooks.beforeSelect.call(fe(o)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"select",value:function(o){var s={};return s.enableSelect=ku()(o)?!0:o,ku()(o)?(s.enableSelect=!0,o.color&&(s.selectColor=o.color),o.mix&&(s.selectMix=o.mix)):s.enableSelect=!!o,this.updateLayerConfig(s),this}},{key:"setSelect",value:function(o,s){var p=this;if(ku()(o)){var y=o.x,_=y===void 0?0:y,E=o.y,T=E===void 0?0:E;this.updateLayerConfig({selectColor:ku()(s)?s.color:this.getLayerConfig().selectColor,selectMix:ku()(s)?s.mix:this.getLayerConfig().selectMix}),this.pick({x:_,y:T})}else this.updateLayerConfig({pickedFeatureID:o,selectColor:ku()(s)?s.color:this.getLayerConfig().selectColor,selectMix:ku()(s)?s.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(fe(o)).then(function(){setTimeout(function(){p.reRender()},1)})}},{key:"setBlend",value:function(o){this.updateLayerConfig({blend:o}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(o){return this.zIndex=o,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(o){this.currentPickId=o}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(o){this.selectedFeatureID=o}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var o=this.mapService.getZoom(),s=this.getLayerConfig(),p=s.visible,y=s.minZoom,_=y===void 0?-Infinity:y,E=s.maxZoom,T=E===void 0?Infinity:E;return!!p&&o>=_&&o<=T}},{key:"setMinZoom",value:function(o){return this.updateLayerConfig({minZoom:o}),this}},{key:"getMinZoom",value:function(){var o=this.getLayerConfig(),s=o.minZoom;return s}},{key:"getMaxZoom",value:function(){var o=this.getLayerConfig(),s=o.maxZoom;return s}},{key:"get",value:function(o){var s=this.getLayerConfig();return s[o]}},{key:"setMaxZoom",value:function(o){return this.updateLayerConfig({maxZoom:o}),this}},{key:"fitBounds",value:function(o){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var s=this.getSource(),p=s.extent,y=p.some(function(_){return Math.abs(_)===Infinity});return y?this:(this.mapService.fitBounds([[p[0],p[1]],[p[2],p[3]]],o),this)}},{key:"destroy",value:function(){this.isDestroied||(this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.models=[],this.layerService.cleanRemove(this),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroied=!0)}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(o){return o.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(o){return o.needRescale||o.needRemapping||o.needRegenerateVertices}).length}},{key:"setSource",value:function(o){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=o,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(o){this.encodedData=o}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(o){var s=this.styleAttributeService.getLayerAttributeScale(o);if(s){if(s.ticks){var p=s.ticks().map(function(_){return(0,I.Z)({value:_},o,s(_))});return p}else if(s.invertExtent){var y=s.range().map(function(_){return(0,I.Z)({value:s.invertExtent(_)},o,_)});return y}}else return[]}},{key:"pick",value:function(o){var s=o.x,p=o.y;this.interactionService.triggerHover({x:s,y:p})}},{key:"boxSelect",value:function(o,s){this.pickingService.boxPickLayer(this,o,s)}},{key:"buildLayerModel",value:function(o){var s=o.moduleName,p=o.vertexShader,y=o.fragmentShader,_=o.triangulation,E=o.segmentNumber,T=(0,cc.Z)(o,VE);this.shaderModuleService.registerModule(s,{vs:p,fs:y});var P=this.shaderModuleService.getModule(s),D=P.vs,z=P.fs,J=P.uniforms,oe=this.rendererService.createModel,he=this.styleAttributeService.createAttributesAndIndices(this.encodedData,_,E),De=he.attributes,it=he.elements;return oe(Du({attributes:De,uniforms:J,fs:z,vs:D,elements:it,blend:Tg[pc.normal]},T))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(o){var s=this.getLayerConfig(),p=s.enableHighlight,y=p===void 0?!0:p,_=s.enableSelect,E=_===void 0?!0:_,T=this.eventNames().indexOf(o)!==-1||this.eventNames().indexOf("un"+o)!==-1;return(o==="click"||o==="dblclick")&&E&&(T=!0),o==="mousemove"&&(y||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(T=!0),this.isVisible()&&T}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(o){var s=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){p.draw({uniforms:s.layerModel.getUninforms()},o)})),this}},{key:"updateStyleAttribute",value:function(o,s,p,y){this.inited?this.styleAttributeService.updateStyleAttribute(o,{scale:Du({field:s},this.splitValuesAndCallbackInAttribute(p,this.getLayerConfig()[s]))},y):this.pendingStyleAttributes.push({attributeName:o,attributeField:s,attributeValues:p,updateOptions:y})}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(o){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&(this.layerService.updateLayerRenderList(),this.layerService.renderLayers())}},{key:"splitValuesAndCallbackInAttribute",value:function(o,s){return{values:Hn()(o)?void 0:o||s,callback:Hn()(o)?o:void 0}}}]),r}(Da.EventEmitter),Ig=ur(Rm.prototype,"configService",[Pg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rm),YE=R(18446),cd=R.n(YE),kg,Lm,Dg;function qE(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=KE(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,y=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw y}}}}function KE(e,i){if(!!e){if(typeof e=="string")return Fg(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fg(e,i)}}function Fg(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var Ss=(kg=Mm(Qt.IGlobalConfigService),Lm=function(){function e(i){(0,lt.Z)(this,e),(0,I.Z)(this,"triangulation",void 0),(0,I.Z)(this,"createTexture2D",void 0),(0,I.Z)(this,"layer",void 0),(0,I.Z)(this,"dataTexture",void 0),(0,I.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,I.Z)(this,"rowCount",void 0),(0,I.Z)(this,"cacheStyleProperties",void 0),(0,I.Z)(this,"cellLength",void 0),(0,I.Z)(this,"cellProperties",void 0),(0,I.Z)(this,"cellTypeLayout",void 0),(0,I.Z)(this,"stylePropertyesExist",void 0),(0,I.Z)(this,"dataTextureTest",void 0),mr(this,"configService",Dg,this),(0,I.Z)(this,"shaderModuleService",void 0),(0,I.Z)(this,"rendererService",void 0),(0,I.Z)(this,"iconService",void 0),(0,I.Z)(this,"fontService",void 0),(0,I.Z)(this,"styleAttributeService",void 0),(0,I.Z)(this,"mapService",void 0),(0,I.Z)(this,"cameraService",void 0),(0,I.Z)(this,"layerService",void 0),this.layer=i,this.rendererService=i.getContainer().get(Qt.IRendererService),this.shaderModuleService=i.getContainer().get(Qt.IShaderModuleService),this.styleAttributeService=i.getContainer().get(Qt.IStyleAttributeService),this.mapService=i.getContainer().get(Qt.IMapService),this.iconService=i.getContainer().get(Qt.IIconService),this.fontService=i.getContainer().get(Qt.IFontService),this.cameraService=i.getContainer().get(Qt.ICameraService),this.layerService=i.getContainer().get(Qt.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={thetaOffset:void 0,opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new Uint8ClampedArray(4),mag:ae.NEAREST,min:ae.NEAREST,width:1,height:1}))}return(0,Lt.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasThetaOffset:0,hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,this.stylePropertyesExist.hasThetaOffset,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var n=!1;return cd()(r.thetaOffset,this.cacheStyleProperties.thetaOffset)||(n=!0,this.cacheStyleProperties.thetaOffset=r.thetaOffset),cd()(r.opacity,this.cacheStyleProperties.opacity)||(n=!0,this.cacheStyleProperties.opacity=r.opacity),cd()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(n=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),cd()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(n=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),cd()(r.stroke,this.cacheStyleProperties.stroke)||(n=!0,this.cacheStyleProperties.stroke=r.stroke),cd()(r.offsets,this.cacheStyleProperties.offsets)||(n=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(n=!0),n}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!Za()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!Za()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!Za()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2),r.thetaOffset!==void 0&&!Za()(r.thetaOffset)&&(this.cellProperties.push({attr:"thetaOffset",count:1}),this.stylePropertyesExist.hasThetaOffset=1,this.cellLength+=1)}},{key:"isStaticColor",value:function(r){return ci()(r)?!!(0,L.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var n=V(r);return n[0]=n[0]?n[0]:0,n[1]=n[1]?n[1]:0,n[2]=n[2]?n[2]:0,n[3]=n[3]?n[3]:0,n}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(xp()(r)&&r.length===2&&Za()(r[0])&&Za()(r[1]))}},{key:"patchMod",value:function(r,n){for(var o=0;o<n;o++)r.push(-1)}},{key:"patchData",value:function(r,n,o){var s=qE(o),p;try{for(s.s();!(p=s.n()).done;){var y=p.value,_=y.attr,E=y.count,T=n[_];T!==void 0?_==="stroke"?r.push.apply(r,(0,or.Z)(V(T))):_==="offsets"?this.isOffsetStatic(T)?r.push(-T[0],T[1]):r.push(0,0):r.push(Za()(T)?T:1):this.patchMod(r,E)}}catch(P){s.e(P)}finally{s.f()}}},{key:"calDataFrame",value:function(r,n,o){for(var s=n.length,p=Math.ceil(s*r/this.DATA_TEXTURE_WIDTH),y=p*this.DATA_TEXTURE_WIDTH,_=[],E=0;E<s;E++){var T=n[E];this.patchData(_,T,o)}for(var P=_.length;P<y;P++)_.push(-1);return{data:_,width:this.DATA_TEXTURE_WIDTH,height:p}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),n=r.blend,o=n===void 0?"normal":n;return Tg[pc[o]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),n=r.animateOption;n.enable&&this.layer.setAnimateStartTime()}}]),e}(),Dg=ur(Lm.prototype,"configService",[kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lm),$E=R(9187),Sf=R.n($E),Bg=100,l3=36,c3=40;function Ng(e){return e/180*Math.acos(-1)}function zg(e){var i=Ng(e[0])+Math.PI/2,r=Ng(e[1]),n=Bg+Math.random()*.4,o=n*Math.cos(r)*Math.cos(i),s=n*Math.cos(r)*Math.sin(i),p=n*Math.sin(r);return[s,p,o]}function f3(e,i){var r=mat4.create(),n=mat4.create(),o=vec3.fromValues(0,1,0),s=vec3.fromValues(0,0,0);i=i||{},e=typeof e!="undefined"?e:1;for(var p=typeof i.segments!="undefined"?i.segments:32,y=2+p,_=2*y,E=[],T=[],P=[],D=[],z=[],J=[],oe=0;oe<=y;oe++){for(var he=oe/y,De=he*Math.PI,it=0;it<=_;it++){var ht=it/_,_t=ht*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-De),mat4.identity(r),mat4.rotateY(r,r,_t),vec3.transformMat4(s,o,n),vec3.transformMat4(s,s,r),vec3.scale(s,s,-e),P.push(s.slice()),D.push.apply(D,_toConsumableArray(s.slice())),vec3.normalize(s,s),z.push.apply(z,_toConsumableArray(s.slice())),J.push([ht,1-he]),D.push(ht,1-he)}if(oe>0)for(var jt=P.length,Vt=jt-2*(_+1);Vt+_+2<jt;Vt++)E.push([Vt,Vt+1,Vt+_+1]),T.push(Vt,Vt+1,Vt+_+1),E.push([Vt+_+1,Vt+1,Vt+_+2]),T.push(Vt+_+1,Vt+1,Vt+_+2)}return{cells:E,positions:P,uvs:J,positionsArr:D,indicesArr:T,normalArr:z}}var zi=R(31437),Zv=zi.Ue(),h3=zi.Ue(),Fu=zi.Ue(),fd=zi.Ue(),jv=zi.Ue();function Ug(e,i,r,n,o){zi.IH(e,r,n),zi.Fv(e,e),i=zi.al(-e[1],e[0]);var s=zi.al(-r[1],r[0]);return[o/zi.AK(i,s),i]}function hd(e,i){return zi.t8(e,-i[1],i[0])}function Vv(e,i,r){return zi.lu(e,i,r),zi.Fv(e,e),e}function Zg(e,i){return e[0]===i[0]&&e[1]===i[1]}function p3(e){for(var i=new Map,r=0;r<e.length;r++){var n=e[0].toString()+"-"+e[1].toString();i.get(n)?(e.splice(r,1),r++):i.set(n,n)}return e}var JE=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,lt.Z)(this,e),(0,I.Z)(this,"complex",void 0),(0,I.Z)(this,"join",void 0),(0,I.Z)(this,"cap",void 0),(0,I.Z)(this,"miterLimit",void 0),(0,I.Z)(this,"thickness",void 0),(0,I.Z)(this,"normal",void 0),(0,I.Z)(this,"lastFlip",-1),(0,I.Z)(this,"miter",zi.al(0,0)),(0,I.Z)(this,"started",!1),(0,I.Z)(this,"dash",!1),(0,I.Z)(this,"totalDistance",0),this.join=i.join||"miter",this.cap=i.cap||"butt",this.miterLimit=i.miterLimit||10,this.thickness=i.thickness||1,this.dash=i.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,Lt.Z)(e,[{key:"extrude_gaode2",value:function(r,n){var o=this.complex;if(r.length<=1)return o;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var s=r.length,p=o.startIndex,y=1;y<s;y++){var _=r[y-1],E=n[y-1],T=r[y],P=n[y],D=y<r.length-1?r[y+1]:null,z=y<n.length-1?n[y+1]:null,J=this.segment_gaode2(o,p,_,T,D,E,P,z);p+=J}if(this.dash)for(var oe=0;oe<o.positions.length/6;oe++)o.positions[oe*6+5]=this.totalDistance;return o.startIndex=o.positions.length/6,o}},{key:"extrude",value:function(r){var n=this.complex;if(r.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,s=n.startIndex,p=1;p<o;p++){var y=r[p-1],_=r[p],E=p<r.length-1?r[p+1]:null,T=this.segment(n,s,y,_,E);s+=T}if(this.dash)for(var P=0;P<n.positions.length/6;P++)n.positions[P*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(r,n,o,s,p,y,_,E){var T=0,P=r.indices,D=r.positions,z=r.normals,J=this.cap==="square",oe=this.join==="bevel",he=_u([_[0],_[1]]),De=_u([y[0],y[1]]);Vv(Fu,s,o);var it=0;if(this.dash&&(it=this.lineSegmentDistance(he,De),this.totalDistance+=it),this.normal||(this.normal=zi.Ue(),hd(this.normal,Fu)),!this.started)if(this.started=!0,J){var ht=zi.Ue(),_t=zi.Ue();zi.IH(ht,this.normal,Fu),zi.IH(_t,this.normal,Fu),z.push(_t[0],_t[1],0),z.push(ht[0],ht[1],0),D.push(o[0],o[1],o[2]|0,this.totalDistance-it,-this.thickness,o[2]|0),D.push(o[0],o[1],o[2]|0,this.totalDistance-it,this.thickness,o[2]|0)}else this.extrusions(D,z,o,this.normal,this.thickness,this.totalDistance-it);if(P.push(n+0,n+1,n+2),p){Zg(s,p)&&zi.IH(p,s,zi.Fv(p,zi.$X(p,s,o))),Vv(fd,p,s);var rr=Ug(jv,zi.Ue(),Fu,fd,this.thickness),yr=(0,ie.Z)(rr,2),Yr=yr[0],fn=yr[1],Or=zi.AK(jv,this.normal)<0?-1:1,Tn=oe;if(!Tn&&this.join==="miter"){var Bn=Yr;Bn>this.miterLimit&&(Tn=!0)}Tn?(z.push(this.normal[0],this.normal[1],0),z.push(fn[0],fn[1],0),D.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Or,s[2]|0),D.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Or,s[2]|0),P.push.apply(P,(0,or.Z)(this.lastFlip!==-Or?[n,n+2,n+3]:[n+2,n+1,n+3])),P.push(n+2,n+3,n+4),hd(Zv,fd),zi.JG(this.normal,Zv),z.push(this.normal[0],this.normal[1],0),D.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Or,s[2]|0),T+=3):(this.extrusions(D,z,s,fn,Yr,this.totalDistance),P.push.apply(P,(0,or.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Or=-1,zi.JG(this.normal,fn),T+=2),this.lastFlip=Or}else{if(hd(this.normal,Fu),J){var jt=zi.Ue(),Vt=zi.Ue();zi.lu(Vt,Fu,this.normal),zi.IH(jt,Fu,this.normal),z.push(Vt[0],Vt[1],0),z.push(jt[0],jt[1],0),D.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),D.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(D,z,s,this.normal,this.thickness,this.totalDistance);P.push.apply(P,(0,or.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),T+=2}return T}},{key:"segment",value:function(r,n,o,s,p){var y=0,_=r.indices,E=r.positions,T=r.normals,P=this.cap==="square",D=this.join==="bevel",z=_u([s[0],s[1]]),J=_u([o[0],o[1]]);Vv(Fu,z,J);var oe=0;if(this.dash&&(oe=this.lineSegmentDistance(z,J),this.totalDistance+=oe),this.normal||(this.normal=zi.Ue(),hd(this.normal,Fu)),!this.started)if(this.started=!0,P){var he=zi.Ue(),De=zi.Ue();zi.IH(he,this.normal,Fu),zi.IH(De,this.normal,Fu),T.push(De[0],De[1],0),T.push(he[0],he[1],0),E.push(o[0],o[1],o[2]|0,this.totalDistance-oe,-this.thickness,o[2]|0),E.push(o[0],o[1],o[2]|0,this.totalDistance-oe,this.thickness,o[2]|0)}else this.extrusions(E,T,o,this.normal,this.thickness,this.totalDistance-oe);if(_.push(n+0,n+1,n+2),p){var _t=_u([p[0],p[1]]);Zg(z,_t)&&zi.IH(_t,z,zi.Fv(_t,zi.$X(_t,z,J))),Vv(fd,_t,z);var jt=Ug(jv,zi.Ue(),Fu,fd,this.thickness),Vt=(0,ie.Z)(jt,2),rr=Vt[0],yr=Vt[1],Yr=zi.AK(jv,this.normal)<0?-1:1,fn=D;if(!fn&&this.join==="miter"){var Or=rr;Or>this.miterLimit&&(fn=!0)}fn?(T.push(this.normal[0],this.normal[1],0),T.push(yr[0],yr[1],0),E.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Yr,s[2]|0),E.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness*Yr,s[2]|0),_.push.apply(_,(0,or.Z)(this.lastFlip!==-Yr?[n,n+2,n+3]:[n+2,n+1,n+3])),_.push(n+2,n+3,n+4),hd(Zv,fd),zi.JG(this.normal,Zv),T.push(this.normal[0],this.normal[1],0),E.push(s[0],s[1],s[2]|0,this.totalDistance,-this.thickness*Yr,s[2]|0),y+=3):(this.extrusions(E,T,s,yr,rr,this.totalDistance),_.push.apply(_,(0,or.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Yr=-1,zi.JG(this.normal,yr),y+=2),this.lastFlip=Yr}else{if(hd(this.normal,Fu),P){var it=zi.Ue(),ht=zi.Ue();zi.lu(ht,Fu,this.normal),zi.IH(it,Fu,this.normal),T.push(ht[0],ht[1],0),T.push(it[0],it[1],0),E.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0),E.push(s[0],s[1],s[2]|0,this.totalDistance,this.thickness,s[2]|0)}else this.extrusions(E,T,s,this.normal,this.thickness,this.totalDistance);_.push.apply(_,(0,or.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),y+=2}return y}},{key:"extrusions",value:function(r,n,o,s,p,y){n.push(s[0],s[1],0),n.push(s[0],s[1],0),r.push(o[0],o[1],o[2]|0,y,-p,o[2]|0),r.push(o[0],o[1],o[2]|0,y,p,o[2]|0)}},{key:"lineSegmentDistance",value:function(r,n){var o=n[0]-r[0],s=n[1]-r[1];return Math.sqrt(o*o+s*s)}}]),e}();function Ep(e){if(Za()(e[0]))return e;if(Za()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Za()(e[0][0][0])){var i=e,r=0,n=0,o=0;return i.forEach(function(s){s.forEach(function(p){r+=p[0],n+=p[1],o++})}),[r/o,n/o,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function QE(e){for(var i=e[0],r=e[1],n=e[0],o=e[1],s=0,p=0,y=0,_=0;_<e.length;_+=2){var E=e[_],T=e[_+1];E&&T&&(i=Math.max(E,i),r=Math.max(T,r),n=Math.min(E,n),o=Math.min(T,o),s+=E,p+=T,y++)}return{center:[s/y,p/y],radius:Math.sqrt(Math.pow(i-n,2)+Math.pow(r-o,2))/2}}var Ka=R(77160);function e2(e){var i=e[0][0],r=e[0][e[0].length-1];i[0]===r[0]&&i[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,o=Sf().flatten(e),s=o.vertices,p=o.dimensions,y=[],_=[],E=0;E<s.length/p;E++)p===2?y.push(s[E*2],s[E*2+1],1):y.push(s[E*3],s[E*3+1],1);var T=Sf()(o.vertices,o.holes,o.dimensions);_.push.apply(_,(0,or.Z)(T));for(var P=function(J){var oe=o.vertices.slice(J*p,(J+1)*p),he=o.vertices.slice((J+1)*p,(J+2)*p);he.length===0&&(he=o.vertices.slice(0,p));var De=y.length/3;y.push(oe[0],oe[1],1,he[0],he[1],1,oe[0],oe[1],0,he[0],he[1],0),_.push.apply(_,(0,or.Z)([0,2,1,2,3,1].map(function(it){return it+De})))},D=0;D<n;D++)P(D);return{positions:y,index:_}}function t2(e){var i=Sf().flatten(e),r=Sf()(i.vertices,i.holes,i.dimensions);return{positions:i.vertices,index:r}}function jg(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],n=e[0][e[0].length-1];r[0]===n[0]&&r[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var o=e[0].length,s=Sf().flatten(e),p=s.vertices,y=s.dimensions,_=[],E=[],T=[],P=0;P<p.length/y;P++)y===2?_.push(p[P*2],p[P*2+1],1,-1,-1):_.push(p[P*3],p[P*3+1],1,-1,-1),T.push(0,0,1);var D=Sf()(s.vertices,s.holes,s.dimensions);E.push.apply(E,(0,or.Z)(D));for(var z=function(he){var De=s.vertices.slice(he*y,(he+1)*y),it=s.vertices.slice((he+1)*y,(he+2)*y);it.length===0&&(it=s.vertices.slice(0,y));var ht=_.length/5;_.push(De[0],De[1],1,0,0,it[0],it[1],1,.1,0,De[0],De[1],0,0,.8,it[0],it[1],0,.1,.8);var _t=r2([it[0],it[1],1],[De[0],De[1],0],[De[0],De[1],1],i);T.push.apply(T,(0,or.Z)(_t).concat((0,or.Z)(_t),(0,or.Z)(_t),(0,or.Z)(_t))),E.push.apply(E,(0,or.Z)([1,2,0,3,2,1].map(function(jt){return jt+ht})))},J=0;J<o;J++)z(J);return{positions:_,index:E,normals:T}}function r2(e,i,r){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=Ka.create(),s=Ka.create(),p=Ka.create();n&&(e=Tu(e),i=Tu(i),r=Tu(r));var y=Ka.fromValues.apply(Ka,(0,or.Z)(e)),_=Ka.fromValues.apply(Ka,(0,or.Z)(i)),E=Ka.fromValues.apply(Ka,(0,or.Z)(r));Ka.sub(o,E,_),Ka.sub(s,y,_),Ka.cross(p,o,s);var T=Ka.create();return Ka.normalize(T,p),T}var vc,Sp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Sp||(Sp={}));var Cp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Cp||(Cp={}));function Jd(e){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,n=[],o=0;o<e;o++)n.push(r*o+i*Math.PI/12);var s=n.map(function(p){var y=Math.sin(p+Math.PI/4),_=Math.cos(p+Math.PI/4);return[y,_,0]});return s}function Vg(){return Jd(30)}function Gg(){return Jd(4)}function Hg(){return Jd(3)}function Wg(){return Jd(6,1)}function Xg(){return Jd(5)}var pd=(vc={},(0,I.Z)(vc,Cp.CIRCLE,Vg),(0,I.Z)(vc,Cp.HEXAGON,Wg),(0,I.Z)(vc,Cp.TRIANGLE,Hg),(0,I.Z)(vc,Cp.SQUARE,Gg),(0,I.Z)(vc,Cp.PENTAGON,Xg),(0,I.Z)(vc,Sp.CYLINDER,Vg),(0,I.Z)(vc,Sp.HEXAGONCOLUMN,Wg),(0,I.Z)(vc,Sp.TRIANGLECOLUMN,Hg),(0,I.Z)(vc,Sp.SQUARECOLUMN,Gg),(0,I.Z)(vc,Sp.PENTAGONCOLUMN,Xg),vc),Gv={};function Yg(e){var i=Ep(e.coordinates);return{vertices:[].concat((0,or.Z)(i),(0,or.Z)(i),(0,or.Z)(i),(0,or.Z)(i)),indices:[0,1,2,2,3,0],size:i.length}}function n2(e){var i=Ep(e.coordinates),r=zg(i);return{vertices:[].concat((0,or.Z)(r),(0,or.Z)(r),(0,or.Z)(r),(0,or.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function qg(e){var i=e.shape,r=u2(i,!1),n=r.positions,o=r.index,s=r.normals;return{vertices:n,indices:o,normals:s,size:5}}function Kg(e){var i=Ep(e.coordinates);return{vertices:(0,or.Z)(i),indices:[0],size:i.length}}function $g(e){var i=e.coordinates,r=e.originCoordinates,n=e.version,o=new JE({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var s=i;Array.isArray(s[0][0])||(s=[i]);var p=r;Array.isArray(p[0][0])||(p=[r]);for(var y=0;y<s.length;y++){var _=s[y],E=p[y];o.extrude_gaode2(_,E)}}else{var T=i;Array.isArray(T[0][0])||(T=[i]),T.forEach(function(D){o.extrude(D)})}var P=o.complex;return{vertices:P.positions,indices:P.indices,normals:P.normals,size:6}}function i2(e){var i=e.coordinates,r=Sf().flatten(i),n=r.vertices,o=r.dimensions,s=r.holes;return{indices:Sf()(n,s,o),vertices:n,size:o}}function a2(e){var i=e.coordinates,r=Sf().flatten(i),n=r.vertices,o=r.dimensions,s=r.holes;return{indices:Sf()(n,s,o),vertices:o2(n),size:o+4}}function o2(e){for(var i=[],r=QE(e),n=r.center,o=r.radius,s=0;s<e.length;s+=2){var p=e[s],y=e[s+1];i.push.apply(i,[p,y,0].concat((0,or.Z)(n),[o]))}return i}function Jg(e){var i=e.coordinates,r=jg(i,!0),n=r.positions,o=r.index,s=r.normals;return{vertices:n,indices:o,normals:s,size:5}}function Qg(e){var i=e.shape,r=c2(i),n=r.positions,o=r.index;return{vertices:n,indices:o,size:3}}function ey(e){var i=e.coordinates,r=[].concat((0,or.Z)(i[0]),[0,0,1,i[1][0],i[0][1],0,1,1],(0,or.Z)(i[1]),[0,1,0],(0,or.Z)(i[0]),[0,0,1],(0,or.Z)(i[1]),[0,1,0,i[0][0],i[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:r,indices:n,size:5}}function Hv(e,i){for(var r=i||30,n=e.coordinates,o=[],s=[],p=function(E){o.push(E,1,E,n[0][0],n[0][1],n[1][0],n[1][1],E,-1,E,n[0][0],n[0][1],n[1][0],n[1][1]),E!==r-1&&s.push.apply(s,(0,or.Z)([0,1,2,1,3,2].map(function(T){return E*2+T})))},y=0;y<r;y++)p(y);return{vertices:o,indices:s,size:7}}function s2(e){var i=e.coordinates;i.length===2&&i.push(0);var r=e.size,n=Wv(-1,1),o=Wv(1,1),s=Wv(-1,-1),p=Wv(1,-1),y=[].concat((0,or.Z)(i),(0,or.Z)(n),(0,or.Z)(i),(0,or.Z)(s),(0,or.Z)(i),(0,or.Z)(p),(0,or.Z)(i),(0,or.Z)(o)),_=[0,1,2,3,0,2];return{vertices:y,indices:_,size:5}}function u2(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Gv&&Gv[e])return Gv[e];var r=pd[e]?pd[e]():pd.cylinder(),n=jg([r],i);return Gv[e]=n,n}function d3(e,i){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=new Float32Array(e.length/r*3),s,p,y,_=vec3.create(),E=vec3.create(),T=vec3.create(),P=0,D=i.length;P<D;P+=3){s=i[P+0]*3,p=i[P+1]*3,y=i[P+2]*3;var z=[e[s],e[s+1]],J=[e[p],e[p+1]],oe=[e[y],e[y+1]];n&&(z=lngLatToMeters(z),J=lngLatToMeters(J),oe=lngLatToMeters(oe));var he=z,De=_slicedToArray(he,2),it=De[0],ht=De[1],_t=vec3.fromValues(it,ht,e[s+2]),jt=J,Vt=_slicedToArray(jt,2),rr=Vt[0],yr=Vt[1],Yr=vec3.fromValues(rr,yr,e[p+2]),fn=oe,Or=_slicedToArray(fn,2),Tn=Or[0],Bn=Or[1],hi=vec3.fromValues(Tn,Bn,e[y+2]);vec3.sub(_,hi,Yr),vec3.sub(E,_t,Yr),vec3.cross(T,_,E),o[s]+=_[0],o[s+1]+=_[1],o[s+2]+=_[2],o[p]+=_[0],o[p+1]+=_[1],o[p+2]+=_[2],o[y]+=_[0],o[y+1]+=_[1],o[y+2]+=_[2]}return l2(o),o}function l2(e){for(var i=0,r=e.length;i<r;i+=3){var n=vec3.fromValues(e[i],e[i+1],e[i+2]),o=vec3.create();vec3.normalize(o,n),e.set(o,i)}}function v3(e){var i=e[0][0],r=e[0][e[0].length-1];return i[0]===r[0]&&i[1]===r[1]}function c2(e){var i=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=pd[e]?pd[e]():pd.circle(),n=i.indexOf(e)===-1?t2([r]):e2([r]);return n}function Wv(e,i){var r=(e+1)/2,n=(i+1)/2;return[r,n]}function m3(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function g3(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),i=e.positionsArr,r=e.indicesArr,n=e.normalArr;return{vertices:i,indices:r,size:5,normals:n}}function f2(e){var i=h2();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function h2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var p2=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

uniform float u_circleSweep;
uniform float u_cityMinSize;
uniform vec3 u_circleSweepColor;
uniform float u_circleSweepSpeed;

varying float v_worldDis;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    gl_FragColor.rgb += r * r * u_circleSweepColor;
  }
   
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,d2=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

uniform float u_circleSweep;
uniform vec2 u_cityCenter;

varying float v_worldDis;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,v2=function(e){(0,xn.Z)(r,e);var i=f2(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"cityCenter",void 0),(0,I.Z)((0,xe.Z)(n),"cityMinSize",void 0),n}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=s===void 0?1:s,y=o.baseColor,_=y===void 0?"rgb(16,16,16)":y,E=o.brightColor,T=E===void 0?"rgb(255,176,38)":E,P=o.windowColor,D=P===void 0?"rgb(30,60,89)":P,z=o.time,J=z===void 0?0:z,oe=o.sweep,he=oe===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:oe;return{u_cityCenter:he.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*he.sweepRadius,u_circleSweep:he.enable?1:0,u_circleSweepColor:V(he.sweepColor).slice(0,3),u_circleSweepSpeed:he.sweepSpeed,u_opacity:p,u_baseColor:V(_),u_brightColor:V(T),u_windowColor:V(D),u_time:this.layer.getLayerAnimateTime()||J}}},{key:"calCityGeo",value:function(){var o=(0,ie.Z)(this.layer.getSource().extent,4),s=o[0],p=o[1],y=o[2],_=o[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(y+s)/2,(_+p)/2]);var E=this.mapService.lngLatToCoord([y,_]),T=this.mapService.lngLatToCoord([s,p]);this.cityMinSize=Math.sqrt(Math.pow(E[0]-T[0],2)+Math.pow(E[1]-T[1],2))/4}else{var P=y-s,D=_-p;this.cityCenter=[(y+s)/2,(_+p)/2],this.cityMinSize=Math.sqrt(Math.pow(P,2)+Math.pow(D,2))/4}}},{key:"initModels",value:function(){return this.calCityGeo(),this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:d2,fragmentShader:p2,triangulation:Jg})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:li.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(s,p,y,_,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(s,p,y,_){var E=s.size,T=E===void 0?10:E;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:li.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(s,p,y,_){var E=s.size;return[y[3],y[4]]}}})}}]),r}(Ss);function m2(e){var i=g2();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function g2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var y2=function(e){(0,xn.Z)(r,e);var i=m2(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","PolygonLayer"),n}return(0,Lt.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new v2(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(o){this.updateLayerConfig({time:o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(bp);function _2(e){var i=x2();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function x2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var b2=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,E2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,S2=function(e){(0,xn.Z)(r,e);var i=_2(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=o.coverage,y=o.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:b2,fragmentShader:E2,triangulation:Qg,depth:{enable:!1},primitive:ae.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:li.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(s,p){var y=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[y[0],y[1],0]}}})}}]),r}(Ss);function C2(e){var i=w2();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function w2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A2=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,T2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,M2=function(e){(0,xn.Z)(r,e);var i=C2(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=o.coverage,y=o.angle;return{u_opacity:s||1,u_coverage:p||1,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:A2,fragmentShader:T2,triangulation:qg,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(s,p,y,_){var E=s.size;return Array.isArray(E)?[E[0]]:[E]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:li.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(s,p,y,_,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:li.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(s,p){var y=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[y[0],y[1],0]}}})}}]),r}(Ss);function P2(e,i){for(var r=[],n=[],o=[],s=e+1,p=i+1,y=e/2,_=i/2,E=0;E<p;E++)for(var T=E-_,P=0;P<s;P++){var D=P-y;n.push(D/y,-T/_,0),o.push(P/e),o.push(1-E/i)}for(var z=0;z<i;z++)for(var J=0;J<e;J++){var oe=J+s*z,he=J+s*(z+1),De=J+1+s*(z+1),it=J+1+s*z;r.push(oe,he,it),r.push(he,De,it)}return{vertices:n,indices:r,uvs:o}}var ty,ry;function ny(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function iy(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ny(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ny(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function I2(e){var i=O2();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function O2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R2=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,L2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,k2=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,D2=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,F2=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,B2=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,ay=(ty=(0,zr.b2)(),ty(ry=function(e){(0,xn.Z)(r,e);var i=I2(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"colorTexture",void 0),(0,I.Z)((0,xe.Z)(n),"heatmapFramerBuffer",void 0),(0,I.Z)((0,xe.Z)(n),"intensityModel",void 0),(0,I.Z)((0,xe.Z)(n),"colorModel",void 0),(0,I.Z)((0,xe.Z)(n),"shapeType",void 0),n}return(0,Lt.Z)(r,[{key:"render",value:function(){var o=this,s=this.rendererService,p=s.clear,y=s.useFramebuffer;y(this.heatmapFramerBuffer,function(){p({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var o,s=this.rendererService,p=s.createFramebuffer,y=s.clear,_=s.getViewportSize,E=s.createTexture2D,T=s.useFramebuffer,P=this.styleAttributeService.getLayerStyleAttribute("shape"),D=(P==null||(o=P.scale)===null||o===void 0?void 0:o.field)||"heatmap";this.shapeType=D,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=D==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var z=_(),J=z.width,oe=z.height;return this.heatmapFramerBuffer=p({color:E({width:Math.floor(J/4),height:Math.floor(oe/4),wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE,min:ae.LINEAR,mag:ae.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:li.Attribute,descriptor:{name:"a_Dir",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(s,p,y,_){return[y[3],y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(s,p,y,_){var E=s.size,T=E===void 0?1:E;return[T]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:F2,fragmentShader:D2,triangulation:s2,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:ae.ONE,srcAlpha:1,dstRGB:ae.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:B2,fs:k2});var o=this.shaderModuleService.getModule("heatmapColor"),s=o.vs,p=o.fs,y=o.uniforms,_=this.rendererService,E=_.createAttribute,T=_.createElements,P=_.createBuffer,D=_.createModel;return D({vs:s,fs:p,attributes:{a_Position:E({buffer:P({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:ae.FLOAT}),size:3}),a_Uv:E({buffer:P({data:[0,1,1,1,0,0,1,0],type:ae.FLOAT}),size:2})},uniforms:iy({},y),depth:{enable:!1},blend:this.getBlend(),count:6,elements:T({data:[0,2,1,2,3,1],type:ae.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=o.intensity,y=p===void 0?10:p,_=o.radius,E=_===void 0?5:_;this.intensityModel.draw({uniforms:{u_opacity:s||1,u_radius:E,u_intensity:y}})}},{key:"drawColorMode",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity;this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=Mt();Mr(p,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:s||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,or.Z)(p)}})}},{key:"build3dHeatMap",value:function(){var o=this.rendererService.getViewportSize,s=o(),p=s.width,y=s.height,_=P2(p/4,y/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:L2,fs:R2});var E=this.shaderModuleService.getModule("heatmap3dColor"),T=E.vs,P=E.fs,D=E.uniforms,z=this.rendererService,J=z.createAttribute,oe=z.createElements,he=z.createBuffer,De=z.createModel;return De({vs:T,fs:P,attributes:{a_Position:J({buffer:he({data:_.vertices,type:ae.FLOAT}),size:3}),a_Uv:J({buffer:he({data:_.uvs,type:ae.FLOAT}),size:2})},primitive:ae.TRIANGLES,uniforms:iy({},D),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:ae.SRC_ALPHA,srcAlpha:1,dstRGB:ae.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:oe({data:_.indices,type:ae.UNSIGNED_INT,count:_.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var o=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var s=this.layer.getLayerConfig(),p=s.rampColors,y=de(p);this.colorTexture=o({data:new Uint8Array(y.data),width:y.width,height:y.height,wrapS:ae.CLAMP_TO_EDGE,wrapT:ae.CLAMP_TO_EDGE,min:ae.NEAREST,mag:ae.NEAREST,flipY:!1})}}]),r}(Ss))||ry);function N2(e){var i=z2();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function z2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U2=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,Z2=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,j2=function(e){(0,xn.Z)(r,e);var i=N2(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=o.coverage,y=o.angle;return{u_opacity:s||1,u_coverage:p||.9,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:Z2,fragmentShader:U2,triangulation:Qg,depth:{enable:!1},primitive:ae.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:li.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(s,p){var y=s.version==="GAODE2.x"?s.originCoordinates:s.coordinates;return[y[0],y[1],0]}}})}}]),r}(Ss),V2={heatmap:ay,heatmap3d:ay,grid:S2,grid3d:M2,hexagon:j2},G2=V2;function H2(e){var i=W2();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function W2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X2=function(e){(0,xn.Z)(r,e);var i=H2(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","HeatMapLayer"),n}return(0,Lt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new G2[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var o=this,s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){return p.draw({uniforms:o.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=this.getLayerConfig(),y=p.shape3d,_=this.getSource(),E=_.data.type,T=(s==null||(o=s.scale)===null||o===void 0?void 0:o.field)||"heatmap";return T==="heatmap"||T==="heatmap3d"?"heatmap":E==="hexagon"?(y==null?void 0:y.indexOf(T))===-1?"hexagon":"grid3d":E==="grid"?(y==null?void 0:y.indexOf(T))===-1?"grid":"grid3d":"heatmap"}}]),r}(bp);function Y2(e){var i=q2();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var K2=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,$2=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,J2=function(e){(0,xn.Z)(r,e);var i=Y2(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),n}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity;return{u_opacity:s||1,u_texture:this.texture}}},{key:"initModels",value:function(){var o=this,s=this.layer.getSource(),p=this.rendererService.createTexture2D;if(this.texture=p({height:0,width:0}),Ao){var y=this.layerService.sceneService.getSceneConfig().canvas,_=y.createImage();_.crossOrigin="anonymous",_.src=s.data.originData,_.onload=function(){o.texture=p({data:_,width:_.width,height:_.height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()}}else s.data.images.then(function(E){o.texture=p({data:E[0],width:E[0].width,height:E[0].height}),o.layerService.updateLayerRenderList(),o.layerService.renderLayers()});return[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:$2,fragmentShader:K2,triangulation:ey,primitive:ae.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:li.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(s,p,y,_){return[y[3],y[4]]}}})}}]),r}(Ss),Q2={image:J2},eS=Q2;function tS(e){var i=rS();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function rS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nS=function(e){(0,xn.Z)(r,e);var i=tS(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","ImageLayer"),n}return(0,Lt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new eS[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),s={image:{}};return s[o]}},{key:"getModelType",value:function(){return"image"}}]),r}(bp);function iS(e){var i=aS();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function aS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var oS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = styleMappingMat[3].r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = styleMappingMat[3].b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = styleMappingMat[3].g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = styleMappingMat[3].a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,sS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalThetaOffset"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke -> thetaOffset... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 thetaOffsetAndOffset = calThetaOffsetAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = thetaOffsetAndOffset.r;
  textureOffset = thetaOffsetAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

   styleMappingMat[3].b = d_distance_ratio;

  // styleMappingMat[0][1] - arcThetaOffset
  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, styleMappingMat[0][1]), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  styleMappingMat[3].r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
     styleMappingMat[3].g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
     styleMappingMat[3].a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,uS={solid:0,dash:1},lS=function(e){(0,xn.Z)(r,e);var i=iS(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"updateTexture",function(){var y=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=y({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=o.sourceColor,y=o.targetColor,_=o.textureBlend,E=_===void 0?"normal":_,T=o.lineType,P=T===void 0?"solid":T,D=o.dashArray,z=D===void 0?[10,5]:D,J=o.forward,oe=J===void 0?!0:J,he=o.lineTexture,De=he===void 0?!1:he,it=o.iconStep,ht=it===void 0?100:it,_t=o.segmentNumber,jt=_t===void 0?30:_t,Vt=o.thetaOffset,rr=Vt===void 0?.314:Vt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,thetaOffset:rr})){this.judgeStyleAttributes({opacity:s,thetaOffset:rr});var yr=this.layer.getEncodedData(),Yr=this.calDataFrame(this.cellLength,yr,this.cellProperties),fn=Yr.data,Or=Yr.width,Tn=Yr.height;this.rowCount=Tn,this.dataTexture=this.cellLength>0&&fn.length>0?this.createTexture2D({flipY:!0,data:fn,format:ae.LUMINANCE,type:ae.FLOAT,width:Or,height:Tn}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}z.length===2&&z.push(0,0);var Bn=0,hi=[0,0,0,0],vo=[0,0,0,0];return p&&y&&(hi=V(p),vo=V(y),Bn=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_thetaOffset:Za()(rr)?rr:0,u_opacity:Za()(s)?s:1,u_textureBlend:E==="normal"?0:1,segmentNumber:jt,u_line_type:uS[P||"solid"],u_dash_array:z,u_blur:.9,u_lineDir:oe?1:-1,u_texture:this.texture,u_line_texture:De?1:0,u_icon_step:ht,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Bn,u_sourceColor:hi,u_targetColor:vo}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,s;(o=this.texture)===null||o===void 0||o.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),s=o.segmentNumber,p=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:sS,fragmentShader:oS,triangulation:Hv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(p,y,_,E){var T=p.size,P=T===void 0?1:T;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:li.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(p,y,_,E){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:li.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(p,y,_,E){var T=o.iconService.getIconMap(),P=p.texture,D=T[P]||{x:0,y:0},z=D.x,J=D.y;return[z,J]}}})}}]),r}(Ss);function cS(e){var i=fS();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function fS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;

      // u_aimate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_aimate.x == Animate) {
      time = u_time / u_aimate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_aimate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_aimate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
}
`,pS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  styleMappingMat[3].g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    styleMappingMat[3].b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,dS={solid:0,dash:1},vS=function(e){(0,xn.Z)(r,e);var i=cS(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"updateTexture",function(){var y=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=y({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=o.sourceColor,y=o.targetColor,_=o.textureBlend,E=_===void 0?"normal":_,T=o.lineType,P=T===void 0?"solid":T,D=o.dashArray,z=D===void 0?[10,5]:D,J=o.lineTexture,oe=J===void 0?!1:J,he=o.iconStep,De=he===void 0?100:he,it=o.segmentNumber,ht=it===void 0?30:it,_t=o.globalArcHeight,jt=_t===void 0?10:_t;z.length===2&&z.push(0,0);var Vt=0,rr=[0,0,0,0],yr=[0,0,0,0];if(p&&y&&(rr=V(p),yr=V(y),Vt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Yr=this.layer.getEncodedData(),fn=this.calDataFrame(this.cellLength,Yr,this.cellProperties),Or=fn.data,Tn=fn.width,Bn=fn.height;this.rowCount=Bn,this.dataTexture=this.cellLength>0&&Or.length>0?this.createTexture2D({flipY:!0,data:Or,format:ae.LUMINANCE,type:ae.FLOAT,width:Tn,height:Bn}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:Bg,u_global_height:jt,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(s)?s:1,u_textureBlend:E==="normal"?0:1,segmentNumber:ht,u_line_type:dS[P]||0,u_dash_array:z,u_texture:this.texture,u_line_texture:oe?1:0,u_icon_step:De,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Vt,u_sourceColor:rr,u_targetColor:yr}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,s;(o=this.texture)===null||o===void 0||o.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),s=o.segmentNumber,p=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:pS,fragmentShader:hS,triangulation:Hv,blend:this.getBlend(),segmentNumber:p})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(p,y,_,E){var T=p.size,P=T===void 0?1:T;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:li.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(p,y,_,E){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:li.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(p,y,_,E){var T=o.iconService.getIconMap(),P=p.texture,D=T[P]||{x:0,y:0},z=D.x,J=D.y;return[z,J]}}})}}]),r}(Ss);function mS(e){var i=gS();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function gS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yS=`#define LineTypeSolid 0.0
#define Animate 0.0

uniform float u_opacity;
uniform float u_blur : 0.9;
// varying vec2 v_normal;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float segmentNumber;
varying float v_distance_ratio;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
 
  gl_FragColor.a *= u_opacity;

  if(u_aimate.x == Animate) {
      float animateSpeed = u_time / u_aimate.y; // \u8FD0\u52A8\u901F\u5EA6
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }
}`,_S=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_lineDir: 1.0;

// \u504F\u79FB\u91CF
uniform float u_thetaOffset: 0.314;

uniform float u_opacity: 1.0;
varying float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);

  v_distance_ratio = segmentIndex / segmentNumber;
  
  if(u_aimate.x == Animate && u_lineDir != 1.0) {
      v_distance_ratio = 1.0 - v_distance_ratio;
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
}
`,xS=function(e){(0,xn.Z)(r,e);var i=mS(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=o.sourceColor,y=o.targetColor,_=o.forward,E=_===void 0?!0:_,T=o.segmentNumber,P=T===void 0?30:T,D=o.thetaOffset,z=D===void 0?.314:D,J=0,oe=[0,0,0,0],he=[0,0,0,0];return p&&y&&(oe=V(p),he=V(y),J=1),{u_thetaOffset:z,u_opacity:Za()(s)?s:1,segmentNumber:P,u_blur:.9,u_lineDir:E?1:-1,u_linearColor:J,u_sourceColor:oe,u_targetColor:he}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),s=o.segmentNumber,p=s===void 0?30:s;return[this.layer.buildLayerModel({moduleName:"arc2dminiline",vertexShader:_S,fragmentShader:yS,triangulation:Hv,depth:{enable:!1},blend:this.getBlend(),segmentNumber:p})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(s,p,y,_){var E=s.size,T=E===void 0?1:E;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:li.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(s,p,y,_){return[y[3],y[4],y[5],y[6]]}}})}}]),r}(Ss);function bS(e){var i=ES();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function ES(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var SS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = styleMappingMat[3].g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = styleMappingMat[3].b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = styleMappingMat[3].a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,CS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // dataset \u6570\u636E\u96C6
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  styleMappingMat[3].g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    styleMappingMat[3].b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    styleMappingMat[3].a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,wS={solid:0,dash:1},AS=function(e){(0,xn.Z)(r,e);var i=bS(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"updateTexture",function(){var y=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=y({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=o.sourceColor,y=o.targetColor,_=o.textureBlend,E=_===void 0?"normal":_,T=o.lineType,P=T===void 0?"solid":T,D=o.dashArray,z=D===void 0?[10,5]:D,J=o.lineTexture,oe=J===void 0?!1:J,he=o.iconStep,De=he===void 0?100:he,it=o.segmentNumber,ht=it===void 0?30:it;z.length===2&&z.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var _t=0,jt=[0,0,0,0],Vt=[0,0,0,0];if(p&&y&&(jt=V(p),Vt=V(y),_t=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var rr=this.layer.getEncodedData(),yr=this.calDataFrame(this.cellLength,rr,this.cellProperties),Yr=yr.data,fn=yr.width,Or=yr.height;this.rowCount=Or,this.dataTexture=this.cellLength>0&&Yr.length>0?this.createTexture2D({flipY:!0,data:Yr,format:ae.LUMINANCE,type:ae.FLOAT,width:fn,height:Or}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(s)?s:1,u_textureBlend:E==="normal"?0:1,segmentNumber:ht,u_line_type:wS[P]||0,u_dash_array:z,u_texture:this.texture,u_line_texture:oe?1:0,u_icon_step:De,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_t,u_sourceColor:jt,u_targetColor:Vt}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,s;(o=this.texture)===null||o===void 0||o.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:CS,fragmentShader:SS,triangulation:Hv,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(p,y,_,E){var T=p.size,P=T===void 0?1:T;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:li.Attribute,descriptor:{name:"a_Instance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(p,y,_,E){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:li.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(p,y,_,E){var T=o.iconService.getIconMap(),P=p.texture,D=T[P]||{x:0,y:0},z=D.x,J=D.y;return[z,J]}}})}}]),r}(Ss);function TS(e){var i=MS();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function MS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;

uniform float u_borderWidth: 0.0;
uniform vec4 u_borderColor;
varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {

    float v = styleMappingMat[3].a;
    float borderWidth = min(0.5, u_borderWidth);
    // \u7ED8\u5236 border
    if(borderWidth > 0.0) {
      float borderOuterWidth = borderWidth/2.0;

      if(v >= 1.0 - borderWidth || v <= borderWidth) {
        if(v > borderWidth) {
          float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);
          gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);
        } else if(v <= borderWidth) {
          float linear = smoothstep(0.0, 1.0, v/borderWidth);
          gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);
        }
      }

      if(v < borderOuterWidth) {
        gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);
      } else if(v > 1.0 - borderOuterWidth) {
        gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
      }
    }

    gl_FragColor = filterColor(gl_FragColor);
  }

  
  
  
}
`,IS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

uniform float u_vertexScale: 1.0;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float((a_Position.z)) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0 + h, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,OS={solid:0,dash:1},oy=function(e){(0,xn.Z)(r,e);var i=TS(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"updateTexture",function(){var y=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=y({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=o.sourceColor,y=o.targetColor,_=o.textureBlend,E=_===void 0?"normal":_,T=o.lineType,P=T===void 0?"solid":T,D=o.dashArray,z=D===void 0?[10,5,0,0]:D,J=o.lineTexture,oe=J===void 0?!1:J,he=o.iconStep,De=he===void 0?100:he,it=o.vertexHeightScale,ht=it===void 0?20:it,_t=o.borderWidth,jt=_t===void 0?0:_t,Vt=o.borderColor,rr=Vt===void 0?"#ccc":Vt;z.length===2&&z.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var yr=0,Yr=[0,0,0,0],fn=[0,0,0,0];if(p&&y&&(Yr=V(p),fn=V(y),yr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var Or=this.layer.getEncodedData(),Tn=this.calDataFrame(this.cellLength,Or,this.cellProperties),Bn=Tn.data,hi=Tn.width,vo=Tn.height;this.rowCount=vo,this.dataTexture=this.cellLength>0&&Bn.length>0?this.createTexture2D({flipY:!0,data:Bn,format:ae.LUMINANCE,type:ae.FLOAT,width:hi,height:vo}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(s)?s:1,u_textureBlend:E==="normal"?0:1,u_line_type:OS[P],u_dash_array:z,u_texture:this.texture,u_line_texture:oe?1:0,u_icon_step:De,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:jt,u_borderColor:V(rr),u_linearColor:yr,u_sourceColor:Yr,u_targetColor:fn,u_vertexScale:ht}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,s;(o=this.texture)===null||o===void 0||o.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:IS,fragmentShader:PS,triangulation:$g,primitive:ae.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var o=this,s=this.layer.getLayerConfig(),p=s.lineType,y=p===void 0?"solid":p;this.styleAttributeService.registerStyleAttribute({name:"distance",type:li.Attribute,descriptor:{name:"a_Distance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(E,T,P,D){return[P[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:li.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(E,T,P,D){return[P[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(E,T,P,D){var z=E.size,J=z===void 0?1:z;return Array.isArray(J)?[J[0],J[1]]:[J,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:li.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(E,T,P,D,z){return z}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:li.Attribute,descriptor:{name:"a_Miter",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(E,T,P,D){return[P[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:li.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(E,T,P,D){var z=o.iconService.getIconMap(),J=E.texture,oe=z[J]||{x:0,y:0},he=oe.x,De=oe.y;return[he,De]}}})}},{key:"loadImage",value:function(o){return new Promise(function(s,p){if(o instanceof HTMLImageElement){s(o);return}var y=new Image;y.crossOrigin="anonymous",y.onload=function(){s(y)},y.onerror=function(){p(new Error("Could not load image at "+o))},y.src=o instanceof File?URL.createObjectURL(o):o})}}]),r}(Ss);function RS(e){var i=LS();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function LS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kS=`#define LineTypeSolid 0.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity : 1.0;
uniform float u_textureBlend;
uniform float u_iconStepCount;

varying vec4 v_color;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;

varying vec2 v_iconMapUV;
varying float v_blur;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = styleMappingMat[3].r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = styleMappingMat[3].a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = styleMappingMat[3].g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = styleMappingMat[3].b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = styleMappingMat[3].a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  gl_FragColor = filterColor(gl_FragColor);

    
  
  
}
`,DS=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;
attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;
uniform float u_heightfixed;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying vec4 v_color;
varying float v_blur;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;


uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "light"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0  // distance_ratio/distance/pixelLen/texV
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  styleMappingMat[3][0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  styleMappingMat[3][1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  styleMappingMat[3][2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  styleMappingMat[3][3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    originSize = project_pixel(a_Size.x);
  }

  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_pixel(2.0) / originSize, 0.05);

  // v_lightWeight = lightWeight;
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);
  // v_color = a_Color;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,FS=function(e){(0,xn.Z)(r,e);var i=RS(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"updateTexture",function(){var y=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=y({data:n.iconService.getCanvas(),mag:ae.NEAREST,min:ae.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=o.sourceColor,y=o.targetColor,_=o.textureBlend,E=_===void 0?"normal":_,T=o.heightfixed,P=T===void 0?!1:T,D=o.lineTexture,z=D===void 0?!1:D,J=o.iconStep,oe=J===void 0?100:J,he=o.iconStepCount,De=he===void 0?1:he;this.rendererService.getDirty()&&this.texture.bind();var it=0,ht=[0,0,0,0],_t=[0,0,0,0];if(p&&y&&(ht=V(p),_t=V(y),it=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s})){this.judgeStyleAttributes({opacity:s});var jt=this.layer.getEncodedData(),Vt=this.calDataFrame(this.cellLength,jt,this.cellProperties),rr=Vt.data,yr=Vt.width,Yr=Vt.height;this.rowCount=Yr,this.dataTexture=this.cellLength>0&&rr.length>0?this.createTexture2D({flipY:!0,data:rr,format:ae.LUMINANCE,type:ae.FLOAT,width:yr,height:Yr}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_heightfixed:Number(P),u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(s)?s:1,u_textureBlend:E==="normal"?0:1,u_texture:this.texture,u_line_texture:z?1:0,u_iconStepCount:De,u_icon_step:oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:it,u_sourceColor:ht,u_targetColor:_t}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,s;(o=this.texture)===null||o===void 0||o.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"linewall",vertexShader:DS,fragmentShader:kS,triangulation:$g,primitive:ae.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var o=this,s=this.layer.getLayerConfig(),p=s.lineType,y=p===void 0?"solid":p;this.styleAttributeService.registerStyleAttribute({name:"distance",type:li.Attribute,descriptor:{name:"a_Distance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(E,T,P,D){return[P[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:li.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(E,T,P,D){return[P[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(E,T,P,D){var z=E.size,J=z===void 0?1:z;return Array.isArray(J)?[J[0],J[1]]:[J,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:li.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(E,T,P,D,z){return z}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:li.Attribute,descriptor:{name:"a_Miter",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(E,T,P,D){return[P[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:li.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(E,T,P,D){var z=o.iconService.getIconMap(),J=E.texture,oe=z[J]||{x:0,y:0},he=oe.x,De=oe.y;return[he,De]}}})}}]),r}(Ss),BS={arc:lS,arcmini:xS,arc3d:vS,greatcircle:AS,wall:FS,line:oy},NS=BS;function zS(e){var i=US();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function US(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ZS=function(e){(0,xn.Z)(r,e);var i=zS(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","LineLayer"),n}return(0,Lt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new NS[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),s={line:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},arcmini:{blend:"additive"},greatcircle:{blend:"additive"}};return s[o]}},{key:"getModelType",value:function(){var o,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(o=s.scale)===null||o===void 0?void 0:o.field;return p||"line"}}]),r}(bp);function jS(e){var i=VS();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function VS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GS=`varying vec4 v_color;
uniform float u_opacity: 1.0;

varying float v_z;
varying float v_lightWeight;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

uniform float u_opacitylinear: 0.0;
uniform float u_opacitylinear_dir: 1.0;

void main() {
  float opacity = styleMappingMat[0][0];

  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_z);
    gl_FragColor.rgb *= v_lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // \u5E94\u7528\u900F\u660E\u5EA6
  gl_FragColor.a *= opacity;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_z): v_z;
  }

  // picking
  gl_FragColor = filterColor(gl_FragColor);
}
`,HS=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform float u_r;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform float u_lightEnable: 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

varying float v_z;
varying float v_lightWeight;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_z = a_Position.z;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z) * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = u_lightEnable > 0.0 ? calc_lighting(pos): 1.0;
  v_lightWeight = lightWeight;
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,sy=function(e){(0,xn.Z)(r,e);var i=jS(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"raiseCount",0),(0,I.Z)((0,xe.Z)(n),"raiserepeat",0),n}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption,p=s===void 0?{enable:!1,speed:.01,repeat:!1}:s,y=o.opacity,_=y===void 0?1:y,E=o.sourceColor,T=o.targetColor,P=o.opacityLinear,D=P===void 0?{enable:!1,dir:"up"}:P,z=o.lightEnable,J=z===void 0?!0:z;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var oe=this.layer.getEncodedData(),he=this.calDataFrame(this.cellLength,oe,this.cellProperties),De=he.data,it=he.width,ht=he.height;this.rowCount=ht,this.dataTexture=this.cellLength>0&&De.length>0?this.createTexture2D({flipY:!0,data:De,format:ae.LUMINANCE,type:ae.FLOAT,width:it,height:ht}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}var _t=0,jt=[0,0,0,0],Vt=[0,0,0,0];if(E&&T&&(jt=V(E),Vt=V(T),_t=1),this.raiseCount<1&&this.raiserepeat>0&&p.enable){var rr=p.speed,yr=rr===void 0?.01:rr,Yr=p.repeat,fn=Yr===void 0?!1:Yr;this.raiseCount+=yr,this.raiseCount>=1&&(this.raiserepeat>1?(this.raiseCount=0,this.raiserepeat--):this.raiseCount=1)}return{u_r:p.enable&&this.raiserepeat>0?this.raiseCount:1,u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(_)?_:1,u_linearColor:_t,u_sourceColor:jt,u_targetColor:Vt,u_opacitylinear:Number(D.enable),u_opacitylinear_dir:D.dir==="up"?1:0,u_lightEnable:Number(J)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),s=o.depth,p=s===void 0?!0:s,y=o.animateOption.repeat,_=y===void 0?1:y;return this.raiserepeat=_,[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:HS,fragmentShader:GS,triangulation:qg,blend:this.getBlend(),cull:{enable:!0,face:this.mapService.version==="MAPBOX"?ae.FRONT:ae.BACK},depth:{enable:p}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(p,y,_,E){var T=p.size;if(T){var P=[];return Array.isArray(T)&&(P=T.length===2?[T[0],T[0],T[1]]:T),Array.isArray(T)||(P=[T,T,T]),P}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:li.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(p,y,_,E,T){return T}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:li.Attribute,descriptor:{name:"a_Pos",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(p,y){var _=Ep(p.coordinates);return o?zg([_[0],_[1]]):[_[0],_[1],0]}}})}}]),r}(Ss),wp;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP",e.GLOBEL="GLOBEL"})(wp||(wp={}));function WS(e){var i=XS();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function XS(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YS=`#define Animate 0.0

uniform float u_globel;
uniform float u_additive;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiasblur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(strokeWidth < 0.01) {
    gl_FragColor = vec4(v_color.rgb, v_color.a * opacity);
  } else {
    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);
  }

  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    
    // TODO: \u6839\u636E\u53E0\u52A0\u6A21\u5F0F\u9009\u62E9\u6548\u679C
    if(u_additive > 0.0) {
      gl_FragColor *= intensity;
    } else {
      gl_FragColor = vec4(gl_FragColor.xyz, intensity);
    }
  
    // TODO: \u4F18\u5316\u5728\u6C34\u6CE2\u7EB9\u60C5\u51B5\u4E0B\u7684\u62FE\u53D6\uFF08a == 0 \u65F6\u65E0\u6CD5\u62FE\u53D6\uFF09
    if(d < 0.7) {
      gl_FragColor.a = max(gl_FragColor.a, 0.001);
    }

    if(u_additive > 0.0) {
      gl_FragColor = filterColorAnimate(gl_FragColor);
    } else {
      gl_FragColor = filterColor(gl_FragColor);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
    
  }

  if(u_additive > 0.0) {
    gl_FragColor *= opacity_t;
  } else {
    gl_FragColor.a *= opacity_t;
  }
}
`,qS=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_isMeter;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

uniform float u_blur : 0.0;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, u_blur);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  if(u_isMeter < 1.0) {
    // \u4E0D\u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    offset = project_pixel(offset);
  } else {
    // \u4EE5\u7C73\u4E3A\u5B9E\u9645\u5355\u4F4D
    antialiasblur *= pow(19.0 - u_Zoom, 2.0);
  }
  
  

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,uy=function(e){(0,xn.Z)(r,e);var i=WS(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"meter2coord",1),(0,I.Z)((0,xe.Z)(n),"isMeter",!1),n}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=s===void 0?1:s,y=o.strokeOpacity,_=y===void 0?1:y,E=o.strokeWidth,T=E===void 0?0:E,P=o.stroke,D=P===void 0?"rgba(0,0,0,0)":P,z=o.offsets,J=z===void 0?[0,0]:z,oe=o.blend;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeOpacity:_,strokeWidth:T,stroke:D,offsets:J})){this.judgeStyleAttributes({opacity:p,strokeOpacity:_,strokeWidth:T,stroke:D,offsets:J});var he=this.layer.getEncodedData(),De=this.calDataFrame(this.cellLength,he,this.cellProperties),it=De.data,ht=De.width,_t=De.height;this.rowCount=_t,this.dataTexture=this.cellLength>0&&it.length>0?this.createTexture2D({flipY:!0,data:it,format:ae.LUMINANCE,type:ae.FLOAT,width:ht,height:_t}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_isMeter:Number(this.isMeter),u_additive:oe==="additive"?1:0,u_globel:this.mapService.version===wp.GLOBEL?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(p)?p:1,u_stroke_opacity:Za()(_)?_:1,u_stroke_width:Za()(T)?T:0,u_stroke_color:this.getStrokeColor(D),u_offsets:this.isOffsetStatic(J)?J:[0,0]}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),s=o.animateOption;return{u_aimate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Yg)}},{key:"initModels",value:function(){var o=this.layer.getLayerConfig(),s=o.unit,p=s===void 0?"l7size":s,y=this.mapService.version;return p==="meter"&&y!==wp.L7MAP&&y!==wp.GLOBEL&&y!==wp.MAPBOX&&(this.isMeter=!0,this.calMeter2Coord()),this.buildModels()}},{key:"calMeter2Coord",value:function(){var o=(0,ie.Z)(this.layer.getSource().extent,4),s=o[0],p=o[1],y=o[2],_=o[3],E=[(s+y)/2,(p+_)/2],T=this.mapService.meterToCoord(E,[s,p]),P=this.mapService.meterToCoord(E,[y===s?y+.1:y,_===p?p+.1:_]);this.meter2coord=(T+P)/2}},{key:"buildModels",value:function(){var o=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:qS,fragmentShader:YS,triangulation:o?n2:Yg,depth:{enable:o},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.speed||1,o.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var o=this,s=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:li.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(y,_,E,T){var P;if(s){var D=(0,ie.Z)(E,3),z=D[0],J=D[1],oe=D[2],he=Ka.fromValues(0,0,1),De=Ka.fromValues(z,0,oe),it=z>=0?Ka.angle(he,De):Math.PI*2-Ka.angle(he,De),ht=Math.PI*2-Math.asin(J/100),_t=Mt();Ur(_t,_t,it),Sr(_t,_t,ht);var jt=Ka.fromValues(1,1,0);Ka.transformMat4(jt,jt,_t),Ka.normalize(jt,jt);var Vt=Ka.fromValues(-1,1,0);Ka.transformMat4(Vt,Vt,_t),Ka.normalize(Vt,Vt);var rr=Ka.fromValues(-1,-1,0);Ka.transformMat4(rr,rr,_t),Ka.normalize(rr,rr);var yr=Ka.fromValues(1,-1,0);Ka.transformMat4(yr,yr,_t),Ka.normalize(yr,yr),P=[].concat((0,or.Z)(jt),(0,or.Z)(Vt),(0,or.Z)(rr),(0,or.Z)(yr))}else P=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var Yr=T%4*3;return[P[Yr],P[Yr+1],P[Yr+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(y,_,E,T){var P=y.size,D=P===void 0?5:P;return Array.isArray(D)?[D[0]*o.meter2coord]:[D*o.meter2coord]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:li.Attribute,descriptor:{name:"a_Shape",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(y,_,E,T){var P=y.shape,D=P===void 0?2:P,z=o.layer.getLayerConfig().shape2d,J=z.indexOf(D);return[J]}}})}}]),r}(Ss);function KS(e){var i=$S();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function $S(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var JS=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = max(styleMappingMat[1][0] - 2.0, 0.0);
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6

     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,QS=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,eC=function(e){(0,xn.Z)(r,e);var i=KS(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),n}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity;return{u_opacity:s||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var o=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){o.updateTexture(),o.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:QS,fragmentShader:JS,triangulation:Kg,primitive:ae.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(p,y,_,E){var T=p.size;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:li.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(p,y,_,E){var T=o.fontService.mapping,P=p.shape,D=o.fontService.getGlyph(P),z=T[D],J=z.x,oe=z.y;return[J,oe]}}})}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,s=this.fontService.canvas;this.texture=o({data:s,mag:ae.LINEAR,min:ae.LINEAR,width:s.width,height:s.height})}},{key:"initIconFontGlyphs",value:function(){var o=this,s=this.layer.getLayerConfig(),p=s.fontWeight,y=p===void 0?"normal":p,_=s.fontFamily,E=_===void 0?"sans-serif":_,T=this.layer.getEncodedData(),P=[];T.forEach(function(D){var z=D.shape,J=z===void 0?"":z;J=J.toString();var oe=o.fontService.getGlyph(J);P.indexOf(oe)===-1&&P.push(oe)}),this.fontService.setFontOptions({characterSet:P,fontWeight:y,fontFamily:E,fontSize:48})}}]),r}(Ss);function tC(e){var i=rC();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function rC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nC=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main(){
      float opacity = styleMappingMat[0][0];
      float size = max(styleMappingMat[1][0] - 2.0, 0.0);
      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor;

      // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6

     
      textureColor = texture2D(u_texture, pos);

      // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
      if(fragmengTocenter >= 0.5) {
            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
            textureColor.a *= luma;
      }
      
      

      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }

      gl_FragColor.a = gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,iC=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  styleMappingMat[1][0] = a_Size;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,ly=function(e){(0,xn.Z)(r,e);var i=tC(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"updateTexture",function(){var y=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layer.renderLayers();return}n.texture=y({data:n.iconService.getCanvas(),mag:ae.LINEAR,min:ae.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=o.offsets,y=p===void 0?[0,0]:p;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:s,offsets:y})){this.judgeStyleAttributes({opacity:s,offsets:y});var _=this.layer.getEncodedData(),E=this.calDataFrame(this.cellLength,_,this.cellProperties),T=E.data,P=E.width,D=E.height;this.rowCount=D,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:ae.LUMINANCE,type:ae.FLOAT,width:P,height:D}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Za()(s)?s:1,u_offsets:this.isOffsetStatic(y)?y:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,s;(o=this.texture)===null||o===void 0||o.destroy(),(s=this.dataTexture)===null||s===void 0||s.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:iC,fragmentShader:nC,triangulation:Kg,primitive:ae.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(p,y,_,E){var T=p.size,P=T===void 0?5:T;return Array.isArray(P)?[P[0]]:[P]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:li.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(p,y,_,E){var T=o.iconService.getIconMap(),P=p.shape,D=T[P]||{x:0,y:0},z=D.x,J=D.y;return[z,J]}}})}}]),r}(Ss);function aC(e){var i=oC();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function oC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sC=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,uC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function lC(e){var i=e.coordinates;return{vertices:(0,or.Z)(i),indices:[0],size:i.length}}var cy=function(e){(0,xn.Z)(r,e);var i=aC(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=s===void 0?1:s,y=o.offsets,_=y===void 0?[0,0]:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:_})){this.judgeStyleAttributes({opacity:p,offsets:_});var E=this.layer.getEncodedData(),T=this.calDataFrame(this.cellLength,E,this.cellProperties),P=T.data,D=T.width,z=T.height;this.rowCount=z,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:ae.LUMINANCE,type:ae.FLOAT,width:D,height:z}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(p)?p:1,u_offsets:this.isOffsetStatic(_)?_:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:uC,fragmentShader:sC,triangulation:lC,depth:{enable:!1},primitive:ae.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(s,p,y,_){var E=s.size,T=E===void 0?1:E;return Array.isArray(T)?[T[0]]:[T]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:pc.additive}}}]),r}(Ss);function cC(e){var i=fC();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function fC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hC=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_additive;

uniform float u_stroke_opacity : 1;

uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
varying float v_blur;
varying float v_innerRadius;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  float opacity = styleMappingMat[0][0];
  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      gl_FragColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      gl_FragColor = mix(v_color, stroke, mixR);
    } else {
      gl_FragColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    gl_FragColor = v_color;
  }

  gl_FragColor.a *= opacity;

  gl_FragColor = filterColor(gl_FragColor);

  

  
  
  if(u_additive > 0.0) {
    gl_FragColor *= circleClipOpacity;
  } else {
    gl_FragColor.a *= circleClipOpacity;
  }

}
`,pC=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;
uniform float u_stroke_width;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143
varying float v_blur;
varying float v_innerRadius;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function dC(e){var i=e.coordinates;return{vertices:(0,or.Z)(i),indices:[0],size:i.length}}var vC=function(e){(0,xn.Z)(r,e);var i=cC(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=s===void 0?1:s,y=o.offsets,_=y===void 0?[0,0]:y,E=o.blend,T=o.strokeOpacity,P=T===void 0?1:T,D=o.strokeWidth,z=D===void 0?0:D,J=o.stroke,oe=J===void 0?"#fff":J;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:_})){this.judgeStyleAttributes({opacity:p,offsets:_});var he=this.layer.getEncodedData(),De=this.calDataFrame(this.cellLength,he,this.cellProperties),it=De.data,ht=De.width,_t=De.height;this.rowCount=_t,this.dataTexture=this.cellLength>0&&it.length>0?this.createTexture2D({flipY:!0,data:it,format:ae.LUMINANCE,type:ae.FLOAT,width:ht,height:_t}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_additive:E==="additive"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(p)?p:1,u_offsets:this.isOffsetStatic(_)?_:[0,0],u_stroke_opacity:Za()(P)?P:1,u_stroke_width:Za()(z)?z:0,u_stroke_color:this.getStrokeColor(oe)}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"simplepoint",vertexShader:pC,fragmentShader:hC,triangulation:dC,depth:{enable:!1},primitive:ae.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(s,p,y,_){var E=s.size,T=E===void 0?1:E;return Array.isArray(T)?[T[0]]:[T]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:pc.additive}}}]),r}(Ss);function mC(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=gC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,y=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw y}}}}function gC(e,i){if(!!e){if(typeof e=="string")return fy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return fy(e,i)}}function fy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}var yC=function(){function e(i,r,n){(0,lt.Z)(this,e),(0,I.Z)(this,"boxCells",[]),(0,I.Z)(this,"xCellCount",void 0),(0,I.Z)(this,"yCellCount",void 0),(0,I.Z)(this,"boxKeys",void 0),(0,I.Z)(this,"bboxes",void 0),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"xScale",void 0),(0,I.Z)(this,"yScale",void 0),(0,I.Z)(this,"boxUid",void 0);var o=this.boxCells;this.xCellCount=Math.ceil(i/n),this.yCellCount=Math.ceil(r/n);for(var s=0;s<this.xCellCount*this.yCellCount;s++)o.push([]);this.boxKeys=[],this.bboxes=[],this.width=i,this.height=r,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Lt.Z)(e,[{key:"insert",value:function(r,n,o,s,p){this.forEachCell(n,o,s,p,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(s),this.bboxes.push(p)}},{key:"query",value:function(r,n,o,s,p){return this.queryHitTest(r,n,o,s,!1,p)}},{key:"hitTest",value:function(r,n,o,s,p){return this.queryHitTest(r,n,o,s,!0,p)}},{key:"insertBoxCell",value:function(r,n,o,s,p,y){this.boxCells[p].push(y)}},{key:"queryHitTest",value:function(r,n,o,s,p,y){if(o<0||r>this.width||s<0||n>this.height)return p?!1:[];var _=[];if(r<=0&&n<=0&&this.width<=o&&this.height<=s){if(p)return!0;for(var E=0;E<this.boxKeys.length;E++)_.push({key:this.boxKeys[E],x1:this.bboxes[E*4],y1:this.bboxes[E*4+1],x2:this.bboxes[E*4+2],y2:this.bboxes[E*4+3]});return y?_.filter(y):_}var T={hitTest:p,seenUids:{box:{},circle:{}}};return this.forEachCell(r,n,o,s,this.queryCell,_,T,y),p?_.length>0:_}},{key:"queryCell",value:function(r,n,o,s,p,y,_,E){var T=_.seenUids,P=this.boxCells[p];if(P!==null){var D=this.bboxes,z=mC(P),J;try{for(z.s();!(J=z.n()).done;){var oe=J.value;if(!T.box[oe]){T.box[oe]=!0;var he=oe*4;if(r<=D[he+2]&&n<=D[he+3]&&o>=D[he+0]&&s>=D[he+1]&&(!E||E(this.boxKeys[oe]))){if(_.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[oe],x1:D[he],y1:D[he+1],x2:D[he+2],y2:D[he+3]})}}}}catch(De){z.e(De)}finally{z.f()}}return!1}},{key:"forEachCell",value:function(r,n,o,s,p,y,_,E){for(var T=this.convertToXCellCoord(r),P=this.convertToYCellCoord(n),D=this.convertToXCellCoord(o),z=this.convertToYCellCoord(s),J=T;J<=D;J++)for(var oe=P;oe<=z;oe++){var he=this.xCellCount*oe+J;if(p.call(this,r,n,o,s,he,y,_,E))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),_C=yC,xC=function(){function e(i,r){(0,lt.Z)(this,e),(0,I.Z)(this,"width",void 0),(0,I.Z)(this,"height",void 0),(0,I.Z)(this,"grid",void 0),(0,I.Z)(this,"viewportPadding",100),(0,I.Z)(this,"screenRightBoundary",void 0),(0,I.Z)(this,"screenBottomBoundary",void 0),(0,I.Z)(this,"gridRightBoundary",void 0),(0,I.Z)(this,"gridBottomBoundary",void 0),this.width=i,this.height=r,this.viewportPadding=Math.max(i,r),this.grid=new _C(i+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=i+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=i+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Lt.Z)(e,[{key:"placeCollisionBox",value:function(r){var n=r.x1+r.anchorPointX+this.viewportPadding,o=r.y1+r.anchorPointY+this.viewportPadding,s=r.x2+r.anchorPointX+this.viewportPadding,p=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,o,s,p)||this.grid.hitTest(n,o,s,p)?{box:[]}:{box:[n,o,s,p]}}},{key:"insertCollisionBox",value:function(r,n){var o={featureIndex:n};this.grid.insert(o,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,n,o){var s=mn(n,o,0,1),p=bn(),y=er.apply(Y,(0,or.Z)(r));return Md(p,s,y),{x:(p[0]/p[3]+1)/2*this.width+this.viewportPadding,y:(-p[1]/p[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,n,o,s){return o>=0&&r<this.gridRightBoundary&&s>=0&&n<this.gridBottomBoundary}}]),e}();function hy(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=bC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,y=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw y}}}}function bC(e,i){if(!!e){if(typeof e=="string")return py(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return py(e,i)}}function py(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function dy(e){var i=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0;break;default:i=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:i,verticalAlign:r}}function vy(e,i,r,n,o){if(!!o){var s=e[n],p=s.glyph;if(p)for(var y=i[p].advance*s.scale,_=(e[n].x+y)*o,E=r;E<=n;E++)e[E].x-=_}}function gy(e,i,r,n,o,s,p){var y=(i-r)*o,_=(-n*p+.5)*s,E=hy(e),T;try{for(E.s();!(T=E.n()).done;){var P=T.value;P.x+=y,P.y+=_}}catch(D){E.e(D)}finally{E.f()}}function EC(e,i,r,n,o,s,p){var y=-8,_=0,E=y,T=0,P=e.positionedGlyphs,D=s==="right"?1:s==="left"?0:.5,z=P.length;r.forEach(function(it){if(it.split("").forEach(function(_t){var jt=i[_t],Vt=0;jt&&(P.push({glyph:_t,x:_,y:E+Vt,vertical:!1,scale:1,metrics:jt}),_+=jt.advance+p)}),P.length!==z){var ht=_-p;T=Math.max(ht,T),vy(P,i,z,P.length-1,D)}_=0,E-=n+5});var J=dy(o),oe=J.horizontalAlign,he=J.verticalAlign;gy(P,D,oe,he,T,n,r.length);var De=E-y;e.top+=-he*De,e.bottom=e.top-De,e.left+=-oe*T,e.right=e.left+T}function SC(e,i,r,n,o,s,p){var y=-8,_=0,E=y,T=0,P=e.positionedGlyphs,D=s==="right"?1:s==="left"?0:.5,z=P.length;r.forEach(function(it){var ht=i[it],_t=0;if(ht&&(P.push({glyph:it,x:_,y:E+_t,vertical:!1,scale:1,metrics:ht}),_+=ht.advance+p),P.length!==z){var jt=_-p;T=Math.max(jt,T),vy(P,i,z,P.length-1,D)}_=0,E-=n+5});var J=dy(o),oe=J.horizontalAlign,he=J.verticalAlign;gy(P,D,oe,he,T,n,r.length);var De=E-y;e.top+=-he*De,e.bottom=e.top-De,e.left+=-oe*T,e.right=e.left+T}function CC(e,i,r,n,o,s){var p=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],y=arguments.length>7?arguments[7]:void 0,_=e.split(`
`),E=[],T={positionedGlyphs:E,top:p[1],bottom:p[1],left:p[0],right:p[0],lineCount:_.length,text:e};return y?SC(T,i,_,r,n,o,s):EC(T,i,_,r,n,o,s),E.length?T:!1}function wC(e){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,o=n===void 0?[]:n,s=[],p=hy(o),y;try{for(p.s();!(y=p.n()).done;){var _=y.value,E=_.metrics,T=4,P=E.advance*_.scale/2,D=r?[_.x+P,_.y]:[0,0],z=r?[0,0]:[_.x+P+i[0],_.y+i[1]],J=(0-T)*_.scale-P+z[0],oe=(0-T)*_.scale+z[1],he=J+E.width*_.scale,De=oe+E.height*_.scale,it={x:J,y:oe},ht={x:he,y:oe},_t={x:J,y:De},jt={x:he,y:De};s.push({tl:it,tr:ht,bl:_t,br:jt,tex:E,glyphOffset:D})}}catch(Vt){p.e(Vt)}finally{p.f()}return s}function AC(e,i){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=TC(e))||i&&e&&typeof e.length=="number"){r&&(e=r);var n=0,o=function(){};return{s:o,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(E){throw E},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var s=!0,p=!1,y;return{s:function(){r=r.call(e)},n:function(){var E=r.next();return s=E.done,E},e:function(E){p=!0,y=E},f:function(){try{!s&&r.return!=null&&r.return()}finally{if(p)throw y}}}}function TC(e,i){if(!!e){if(typeof e=="string")return yy(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yy(e,i)}}function yy(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function MC(e){var i=PC();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function PC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _y=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,xy=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function by(e){var i=this,r=e.id,n=[],o=[];if(!i.glyphInfoMap||!i.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var s=i.glyphInfoMap[r].centroid,p=s.length===2?[s[0],s[1],0]:s;return i.glyphInfoMap[r].glyphQuads.forEach(function(y,_){n.push.apply(n,(0,or.Z)(p).concat([y.tex.x,y.tex.y+y.tex.height,y.tl.x,y.tl.y],(0,or.Z)(p),[y.tex.x+y.tex.width,y.tex.y+y.tex.height,y.tr.x,y.tr.y],(0,or.Z)(p),[y.tex.x+y.tex.width,y.tex.y,y.br.x,y.br.y],(0,or.Z)(p),[y.tex.x,y.tex.y,y.bl.x,y.bl.y])),o.push(0+_*4,1+_*4,2+_*4,2+_*4,3+_*4,0+_*4)}),{vertices:n,indices:o,size:7}}var Ey=function(e){(0,xn.Z)(r,e);var i=MC(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"glyphInfo",void 0),(0,I.Z)((0,xe.Z)(n),"glyphInfoMap",{}),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"currentZoom",-1),(0,I.Z)((0,xe.Z)(n),"extent",void 0),(0,I.Z)((0,xe.Z)(n),"textureHeight",0),(0,I.Z)((0,xe.Z)(n),"textCount",0),(0,I.Z)((0,xe.Z)(n),"preTextStyle",{}),(0,I.Z)((0,xe.Z)(n),"buildModels",function(){return n.initGlyph(),n.updateTexture(),n.filterGlyphs(),n.reBuildModel(),[n.layer.buildLayerModel({moduleName:"pointText",vertexShader:xy,fragmentShader:_y,triangulation:by.bind((0,xe.Z)(n)),depth:{enable:!1},blend:n.getBlend()})]}),n}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=s===void 0?1:s,y=o.stroke,_=y===void 0?"#fff":y,E=o.strokeWidth,T=E===void 0?0:E,P=o.textAnchor,D=P===void 0?"center":P,z=o.textAllowOverlap,J=z===void 0?!1:z,oe=o.halo,he=oe===void 0?.5:oe,De=o.gamma,it=De===void 0?2:De,ht=this.fontService,_t=ht.canvas,jt=ht.mapping;if(Object.keys(jt).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(jt).length),this.preTextStyle={textAnchor:D,textAllowOverlap:J},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,strokeWidth:T,stroke:_})){this.judgeStyleAttributes({opacity:p,strokeWidth:T,stroke:_});var Vt=this.layer.getEncodedData(),rr=this.calDataFrame(this.cellLength,Vt,this.cellProperties),yr=rr.data,Yr=rr.width,fn=rr.height;this.rowCount=fn,this.dataTexture=this.cellLength>0&&yr.length>0?this.createTexture2D({flipY:!0,data:yr,format:ae.LUMINANCE,type:ae.FLOAT,width:Yr,height:fn}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(p)?p:1,u_stroke_width:Za()(T)?T:0,u_stroke_color:this.getStrokeColor(_),u_sdf_map:this.texture,u_halo_blur:he,u_gamma_scale:it,u_sdf_map_size:[_t.width,_t.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),s=o.textAnchor,p=s===void 0?"center":s,y=o.textAllowOverlap,_=y===void 0?!0:y;return this.preTextStyle={textAnchor:p,textAllowOverlap:_},this.buildModels()}},{key:"needUpdate",value:function(){var o=this.layer.getLayerConfig(),s=o.textAllowOverlap,p=s===void 0?!1:s,y=this.mapService.getZoom(),_=this.mapService.getBounds(),E=c(this.extent,_);return!p&&(Math.abs(this.currentZoom-y)>1||!E)||p!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:li.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(s,p,y,_){var E=s.rotate,T=E===void 0?0:E;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:li.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(s,p,y,_){return[y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(s,p,y,_){var E=s.size,T=E===void 0?12:E;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:li.Attribute,descriptor:{name:"a_tex",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(s,p,y,_){return[y[3],y[4]]}}})}},{key:"textExtent",value:function(){var o=this.mapService.getBounds();return f(o,.5)}},{key:"initTextFont",value:function(){var o=this.layer.getLayerConfig(),s=o.fontWeight,p=s===void 0?"400":s,y=o.fontFamily,_=y===void 0?"sans-serif":y,E=this.layer.getEncodedData(),T=[];E.forEach(function(P){var D=P.shape,z=D===void 0?"":D;z=z.toString();var J=AC(z),oe;try{for(J.s();!(oe=J.n()).done;){var he=oe.value;T.indexOf(he)===-1&&T.push(he)}}catch(De){J.e(De)}finally{J.f()}}),this.fontService.setFontOptions({characterSet:T,fontWeight:p,fontFamily:_,iconfont:!1})}},{key:"initIconFontTex",value:function(){var o=this.layer.getLayerConfig(),s=o.fontWeight,p=s===void 0?"400":s,y=o.fontFamily,_=y===void 0?"sans-serif":y,E=this.layer.getEncodedData(),T=[];E.forEach(function(P){var D=P.shape,z=D===void 0?"":D;z="".concat(z),T.indexOf(z)===-1&&T.push(z)}),this.fontService.setFontOptions({characterSet:T,fontWeight:p,fontFamily:_,iconfont:!0})}},{key:"generateGlyphLayout",value:function(o){var s=this,p=this.fontService.mapping,y=this.layer.getLayerConfig(),_=y.spacing,E=_===void 0?2:_,T=y.textAnchor,P=T===void 0?"center":T,D=this.layer.getEncodedData();this.glyphInfo=D.map(function(z){var J=z.shape,oe=J===void 0?"":J,he=z.id,De=z.size,it=De===void 0?1:De,ht=z.textOffset,_t=ht===void 0?[0,0]:ht,jt=CC(oe.toString(),p,it,P,"left",E,_t,o),Vt=wC(jt,_t,!1);return z.shaping=jt,z.glyphQuads=Vt,z.centroid=Ep(z.coordinates),z.originCentroid=z.version==="GAODE2.x"?Ep(z.originCoordinates):z.originCentroid=z.centroid,s.glyphInfoMap[he]={shaping:jt,glyphQuads:Vt,centroid:Ep(z.coordinates)},z})}},{key:"filterGlyphs",value:function(){var o=this,s=this.layer.getLayerConfig(),p=s.padding,y=p===void 0?[4,4]:p,_=s.textAllowOverlap,E=_===void 0?!1:_;if(!E){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var T=this.rendererService.getViewportSize(),P=T.width,D=T.height,z=new xC(P,D),J=this.glyphInfo.filter(function(oe){var he=oe.shaping,De=oe.id,it=De===void 0?0:De,ht=oe.version==="GAODE2.x"?oe.originCentroid:oe.centroid,_t=oe.size,jt=_t/24,Vt=o.mapService.lngLatToContainer(ht),rr=z.placeCollisionBox({x1:he.left*jt-y[0],x2:he.right*jt+y[0],y1:he.top*jt-y[1],y2:he.bottom*jt+y[1],anchorPointX:Vt.x,anchorPointY:Vt.y}),yr=rr.box;return yr&&yr.length?(z.insertCollisionBox(yr,it),!0):!1});J.forEach(function(oe){o.glyphInfoMap[oe.id]=oe})}}},{key:"initGlyph",value:function(){var o=this.layer.getLayerConfig(),s=o.iconfont,p=s===void 0?!1:s;p?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(p)}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,s=this.fontService.canvas;this.textureHeight=s.height,this.texture&&this.texture.destroy(),this.texture=o({data:s,mag:ae.LINEAR,min:ae.LINEAR,width:s.width,height:s.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:xy,fragmentShader:_y,triangulation:by.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),r}(Ss),IC={fill:uy,image:ly,normal:cy,simplePoint:vC,extrude:sy,text:Ey,icon:eC},OC=IC;function RC(e){var i=LC();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function LC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kC=function(e){(0,xn.Z)(r,e);var i=RC(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","PointLayer"),n}return(0,Lt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new OC[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),s={normal:{blend:"additive"},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return s[o]}},{key:"getModelType",value:function(){var o=this.getEncodedData(),s=this.getLayerConfig(),p=s.shape2d,y=s.shape3d,_=this.iconService.getIconMap(),E=o.find(function(P){return P.hasOwnProperty("shape")});if(E){var T=E.shape;return T==="dot"?"normal":T==="simple"?"simplePoint":(p==null?void 0:p.indexOf(T))!==-1?"fill":(y==null?void 0:y.indexOf(T))!==-1?"extrude":_.hasOwnProperty(T)?"image":this.fontService.getGlyph(T)!==""?"icon":"text"}else return"normal"}}]),r}(bp);function DC(e){var i=FC();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function FC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BC=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,NC=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"
varying float v_lightWeight;

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColorWithLight(gl_FragColor, v_lightWeight);
}
`,zC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

varying float v_lightWeight;

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  v_lightWeight = lightWeight;
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,UC=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,ZC=function(e){(0,xn.Z)(r,e);var i=DC(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=s===void 0?1:s;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var y=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,y,this.cellProperties),E=_.data,T=_.width,P=_.height;this.rowCount=P,this.dataTexture=this.cellLength>0&&E.length>0?this.createTexture2D({flipY:!0,data:E,format:ae.LUMINANCE,type:ae.FLOAT,width:T,height:P}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(p)?p:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),s=o.pickLight,p=s===void 0?!1:s;return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:p?zC:UC,fragmentShader:p?NC:BC,triangulation:Jg})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:li.Attribute,descriptor:{name:"a_Normal",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(s,p,y,_,E){return E}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:li.Attribute,descriptor:{name:"a_Size",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(s,p,y,_){var E=s.size,T=E===void 0?10:E;return Array.isArray(T)?[T[0]]:[T]}}})}}]),r}(Ss);function jC(e){var i=VC();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function VC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GC=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,HC=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
uniform float u_opacitylinear: 0.0;
uniform float u_dir: 1.0;
varying vec3 v_linear;
varying vec2 v_pos;


void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  
  if(u_opacitylinear > 0.0) {
    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }

  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,WC=`attribute vec4 a_Color;
attribute vec3 a_Position;



uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

uniform float u_opacitylinear: 0.0;

attribute vec3 a_linear;
varying vec3 v_linear;
varying vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}`,XC=`attribute vec4 a_Color;
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,YC=function(e){(0,xn.Z)(r,e);var i=jC(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=s===void 0?1:s,y=o.opacityLinear,_=y===void 0?{enable:!1,dir:"in"}:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var E=this.layer.getEncodedData(),T=this.calDataFrame(this.cellLength,E,this.cellProperties),P=T.data,D=T.width,z=T.height;this.rowCount=z,this.dataTexture=this.cellLength>0&&P.length>0?this.createTexture2D({flipY:!0,data:P,format:ae.LUMINANCE,type:ae.FLOAT,width:D,height:z}):this.createTexture2D({flipY:!0,data:[1],format:ae.LUMINANCE,type:ae.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Za()(p)?p:1,u_opacitylinear:Number(_.enable),u_dir:_.dir==="in"?1:0}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var o=this.layer.getLayerConfig(),s=o.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s;return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:p.enable?WC:XC,fragmentShader:p.enable?HC:GC,triangulation:p.enable?a2:i2,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this.layer.getLayerConfig(),s=o.opacityLinear,p=s===void 0?{enable:!1,dir:"in"}:s;p.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:li.Attribute,descriptor:{name:"a_linear",buffer:{usage:ae.STATIC_DRAW,data:[],type:ae.FLOAT},size:3,update:function(_,E,T,P,D){return[T[3],T[4],T[5]]}}})}}]),r}(Ss),qC={fill:YC,line:oy,extrude:ZC,text:Ey,point_fill:uy,point_image:ly,point_normal:cy,point_extrude:sy},KC=qC;function $C(e){var i=JC();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function JC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sy=function(e){(0,xn.Z)(r,e);var i=$C(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","PolygonLayer"),n}return(0,Lt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new KC[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,s=this.styleAttributeService.getLayerStyleAttribute("shape"),p=s==null||(o=s.scale)===null||o===void 0?void 0:o.field;return p==="fill"?"fill":p==="extrude"?"extrude":p==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var o=this.getEncodedData(),s=this.getLayerConfig(),p=s.shape2d,y=s.shape3d,_=this.iconService.getIconMap(),E=o.find(function(P){return P.hasOwnProperty("shape")});if(E){var T=E.shape;return T==="dot"?"point_normal":(p==null?void 0:p.indexOf(T))!==-1?"point_fill":(y==null?void 0:y.indexOf(T))!==-1?"point_extrude":_.hasOwnProperty(T)?"point_image":"text"}else return"fill"}}]),r}(bp);function QC(e){var i=ew();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function ew(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tw=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,rw=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Cy=function(e){(0,xn.Z)(r,e);var i=QC(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"texture",void 0),(0,I.Z)((0,xe.Z)(n),"colorTexture",void 0),n}return(0,Lt.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),s=o.opacity,p=s===void 0?1:s,y=o.clampLow,_=y===void 0?!0:y,E=o.clampHigh,T=E===void 0?!0:E,P=o.noDataValue,D=P===void 0?-9999999:P,z=o.domain,J=z===void 0?[0,1]:z;return this.updateColorTexure(),{u_opacity:p||1,u_texture:this.texture,u_domain:J,u_clampLow:_,u_clampHigh:typeof T!="undefined"?T:_,u_noDataValue:D,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var o=this.layer.getSource(),s=this.rendererService.createTexture2D,p=o.data.dataArray[0];this.texture=s({data:p.data,width:p.width,height:p.height,format:ae.LUMINANCE,type:ae.FLOAT});var y=this.layer.getLayerConfig(),_=y.rampColors,E=de(_);return this.colorTexture=s({data:E.data,width:E.width,height:E.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:rw,fragmentShader:tw,triangulation:ey,primitive:ae.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:li.Attribute,descriptor:{name:"a_Uv",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:2,update:function(s,p,y,_){return[y[3],y[4]]}}})}},{key:"updateColorTexure",value:function(){var o=this.rendererService.createTexture2D,s=this.layer.getLayerConfig(),p=s.rampColors,y=de(p);this.colorTexture=o({data:y.data,width:y.width,height:y.height,flipY:!1})}}]),r}(Ss),nw={raster:Cy,raster3d:Cy},iw=nw;function aw(e){var i=ow();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function ow(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sw=function(e){(0,xn.Z)(r,e);var i=aw(r);function r(){var n;(0,lt.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),(0,I.Z)((0,xe.Z)(n),"type","RasterLayer"),n}return(0,Lt.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new iw[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),s={raster:{},raster3d:{}};return s[o]}},{key:"getModelType",value:function(){return"raster"}}]),r}(bp),wy,Ay,Ty,My,Py,Qd,Iy,Oy,Ry;function Ly(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function uw(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Ly(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ly(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var lw=(wy=(0,zr.b2)(),Ay=(0,zr.f3)(Qt.IGlobalConfigService),Ty=(0,zr.f3)(Qt.IMapService),My=(0,zr.f3)(Qt.IFontService),wy(Py=(Qd=function(){function e(){(0,lt.Z)(this,e),mr(this,"configService",Iy,this),mr(this,"mapService",Oy,this),mr(this,"fontService",Ry,this)}return(0,Lt.Z)(e,[{key:"apply",value:function(r,n){var o=this,s=n.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){o.generateMaping(r,{styleAttributeService:s})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,o.generateMaping(r,{styleAttributeService:s}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var p=r.getBottomColor(),y=s.getLayerStyleAttributes()||[],_=s.getLayerStyleAttribute("filter"),E=r.getSource().data.dataArray,T=y.filter(function(D){return D.needRemapping}),P=E;_!=null&&_.needRemapping&&_!==null&&_!==void 0&&_.scale&&(P=E.filter(function(D){return o.applyAttributeMapping(_,D,p)[0]})),T.length&&(_!=null&&_.needRemapping?(r.setEncodedData(o.mapping(y,P,void 0,p)),_.needRemapping=!1):r.setEncodedData(o.mapping(T,P,r.getEncodedData(),p)),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,n){var o=this,s=n.styleAttributeService,p=r.getBottomColor(),y=s.getLayerStyleAttributes()||[],_=s.getLayerStyleAttribute("filter"),E=r.getSource().data.dataArray,T=E;_!=null&&_.scale&&(T=E.filter(function(P){return o.applyAttributeMapping(_,P,p)[0]})),r.setEncodedData(this.mapping(y,T,void 0,p))}},{key:"mapping",value:function(r,n,o,s){var p=this,y=n.map(function(_,E){var T=o?o[E]:{},P=uw({id:_._id,coordinates:_.coordinates},T);return r.filter(function(D){return D.scale!==void 0}).forEach(function(D){var z=p.applyAttributeMapping(D,_,s);D.needRemapping=!1,D.name==="color"&&(z=z.map(function(J){return V(J)})),P[D.name]=Array.isArray(z)&&z.length===1?z[0]:z,D.name==="shape"&&(P.shape=p.fontService.getIconFontKey(P[D.name]))}),P});return y.length>0&&this.mapService.version==="GAODE2.x"&&(typeof y[0].coordinates[0]=="number"?y.filter(function(_){return!_.originCoordinates}).map(function(_){_.version="GAODE2.x",_.originCoordinates=Yn()(_.coordinates),_.coordinates=p.mapService.lngLatToCoord(_.coordinates)}):y.filter(function(_){return!_.originCoordinates}).map(function(_){_.version="GAODE2.x",_.originCoordinates=Yn()(_.coordinates),_.coordinates=p.mapService.lngLatToCoords(_.coordinates)})),y}},{key:"applyAttributeMapping",value:function(r,n,o){var s;if(!r.scale)return[];var p=(r==null||(s=r.scale)===null||s===void 0?void 0:s.scalers)||[],y=[];p.forEach(function(E){var T,P=E.field;(n.hasOwnProperty(P)||((T=r.scale)===null||T===void 0?void 0:T.type)==="variable")&&y.push(n[P])});var _=r.mapping?r.mapping(y):[];return r.name==="color"&&!Z(_[0])?[o]:_}}]),e}(),Iy=ur(Qd.prototype,"configService",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oy=ur(Qd.prototype,"mapService",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ry=ur(Qd.prototype,"fontService",[My],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qd))||Py),ky,Dy,cw=(ky=(0,zr.b2)(),ky(Dy=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"mapService",void 0)}return(0,Lt.Z)(e,[{key:"apply",value:function(r){var n=this;this.mapService=r.getContainer().get(Qt.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var o=r.getSource();if(!o){var s=r.sourceOption||{data:zf,options:Uf},p=s.data,y=s.options;r.setSource(new Zf(p,y))}n.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var o=n.updateClusterData(r),s=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,o||s})}},{key:"updateClusterData",value:function(r){var n=r.getSource(),o=n.cluster,s=n.clusterOptions,p=s.zoom,y=p===void 0?0:p,_=s.maxZoom,E=_===void 0?16:_,T=this.mapService.getZoom()-1,P=r.dataState.dataSourceNeedUpdate;return o&&(P||Math.abs(y-T)>1)&&E>y?(n.updateClusterData(Math.floor(T)),!0):!1}}]),e}())||Dy);function km(e,i){return e<i?-1:e>i?1:e>=i?0:NaN}function Fy(e){return e.length===1&&(e=fw(e)),{left:function(i,r,n,o){for(n==null&&(n=0),o==null&&(o=i.length);n<o;){var s=n+o>>>1;e(i[s],r)<0?n=s+1:o=s}return n},right:function(i,r,n,o){for(n==null&&(n=0),o==null&&(o=i.length);n<o;){var s=n+o>>>1;e(i[s],r)>0?o=s:n=s+1}return n}}}function fw(e){return function(i,r){return km(e(i),r)}}var By=Fy(km),hw=By.right,y3=By.left,Xv=hw;function pw(e,i){var r=e.length,n=-1,o,s,p;if(i==null){for(;++n<r;)if((o=e[n])!=null&&o>=o)for(s=p=o;++n<r;)(o=e[n])!=null&&(s>o&&(s=o),p<o&&(p=o))}else for(;++n<r;)if((o=i(e[n],n,e))!=null&&o>=o)for(s=p=o;++n<r;)(o=i(e[n],n,e))!=null&&(s>o&&(s=o),p<o&&(p=o));return[s,p]}var Ny=Array.prototype,_3=Ny.slice,x3=Ny.map,Dm=Math.sqrt(50),Fm=Math.sqrt(10),Bm=Math.sqrt(2);function zy(e,i,r){var n,o=-1,s,p,y;if(i=+i,e=+e,r=+r,e===i&&r>0)return[e];if((n=i<e)&&(s=e,e=i,i=s),(y=Yv(e,i,r))===0||!isFinite(y))return[];if(y>0)for(e=Math.ceil(e/y),i=Math.floor(i/y),p=new Array(s=Math.ceil(i-e+1));++o<s;)p[o]=(e+o)*y;else for(e=Math.floor(e*y),i=Math.ceil(i*y),p=new Array(s=Math.ceil(e-i+1));++o<s;)p[o]=(e-o)/y;return n&&p.reverse(),p}function Yv(e,i,r){var n=(i-e)/Math.max(0,r),o=Math.floor(Math.log(n)/Math.LN10),s=n/Math.pow(10,o);return o>=0?(s>=Dm?10:s>=Fm?5:s>=Bm?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(s>=Dm?10:s>=Fm?5:s>=Bm?2:1)}function Nm(e,i,r){var n=Math.abs(i-e)/Math.max(0,r),o=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),s=n/o;return s>=Dm?o*=10:s>=Fm?o*=5:s>=Bm&&(o*=2),i<e?-o:o}function b3(){var e=identity,i=extent,r=sturges;function n(o){var s,p=o.length,y,_=new Array(p);for(s=0;s<p;++s)_[s]=e(o[s],s,o);var E=i(_),T=E[0],P=E[1],D=r(_,T,P);Array.isArray(D)||(D=tickStep(T,P,D),D=range(Math.ceil(T/D)*D,P,D));for(var z=D.length;D[0]<=T;)D.shift(),--z;for(;D[z-1]>P;)D.pop(),--z;var J=new Array(z+1),oe;for(s=0;s<=z;++s)oe=J[s]=[],oe.x0=s>0?D[s-1]:T,oe.x1=s<z?D[s]:P;for(s=0;s<p;++s)y=_[s],T<=y&&y<=P&&J[bisect(D,y,0,z)].push(o[s]);return J}return n.value=function(o){return arguments.length?(e=typeof o=="function"?o:constant(o),n):e},n.domain=function(o){return arguments.length?(i=typeof o=="function"?o:constant([o[0],o[1]]),n):i},n.thresholds=function(o){return arguments.length?(r=typeof o=="function"?o:Array.isArray(o)?constant(slice.call(o)):constant(o),n):r},n}function E3(e,i,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-i)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function dw(e){return e===null?NaN:+e}function vw(e,i,r){if(r==null&&(r=dw),!!(n=e.length)){if((i=+i)<=0||n<2)return+r(e[0],0,e);if(i>=1)return+r(e[n-1],n-1,e);var n,o=(n-1)*i,s=Math.floor(o),p=+r(e[s],s,e),y=+r(e[s+1],s+1,e);return p+(y-p)*(o-s)}}var mc="$";function qv(){}qv.prototype=Uy.prototype={constructor:qv,has:function(e){return mc+e in this},get:function(e){return this[mc+e]},set:function(e,i){return this[mc+e]=i,this},remove:function(e){var i=mc+e;return i in this&&delete this[i]},clear:function(){for(var e in this)e[0]===mc&&delete this[e]},keys:function(){var e=[];for(var i in this)i[0]===mc&&e.push(i.slice(1));return e},values:function(){var e=[];for(var i in this)i[0]===mc&&e.push(this[i]);return e},entries:function(){var e=[];for(var i in this)i[0]===mc&&e.push({key:i.slice(1),value:this[i]});return e},size:function(){var e=0;for(var i in this)i[0]===mc&&++e;return e},empty:function(){for(var e in this)if(e[0]===mc)return!1;return!0},each:function(e){for(var i in this)i[0]===mc&&e(this[i],i.slice(1),this)}};function Uy(e,i){var r=new qv;if(e instanceof qv)e.each(function(y,_){r.set(_,y)});else if(Array.isArray(e)){var n=-1,o=e.length,s;if(i==null)for(;++n<o;)r.set(n,e[n]);else for(;++n<o;)r.set(i(s=e[n],n,e),s)}else if(e)for(var p in e)r.set(p,e[p]);return r}var zm=Uy;function S3(){var e=[],i=[],r,n,o;function s(y,_,E,T){if(_>=e.length)return r!=null&&y.sort(r),n!=null?n(y):y;for(var P=-1,D=y.length,z=e[_++],J,oe,he=map(),De,it=E();++P<D;)(De=he.get(J=z(oe=y[P])+""))?De.push(oe):he.set(J,[oe]);return he.each(function(ht,_t){T(it,_t,s(ht,_,E,T))}),it}function p(y,_){if(++_>e.length)return y;var E,T=i[_-1];return n!=null&&_>=e.length?E=y.entries():(E=[],y.each(function(P,D){E.push({key:D,values:p(P,_)})})),T!=null?E.sort(function(P,D){return T(P.key,D.key)}):E}return o={object:function(y){return s(y,0,mw,gw)},map:function(y){return s(y,0,Zy,jy)},entries:function(y){return p(s(y,0,Zy,jy),0)},key:function(y){return e.push(y),o},sortKeys:function(y){return i[e.length-1]=y,o},sortValues:function(y){return r=y,o},rollup:function(y){return n=y,o}}}function mw(){return{}}function gw(e,i,r){e[i]=r}function Zy(){return map()}function jy(e,i,r){e.set(i,r)}function Kv(){}var Ap=zm.prototype;Kv.prototype=yw.prototype={constructor:Kv,has:Ap.has,add:function(e){return e+="",this[mc+e]=e,this},remove:Ap.remove,clear:Ap.clear,values:Ap.keys,size:Ap.size,empty:Ap.empty,each:Ap.each};function yw(e,i){var r=new Kv;if(e instanceof Kv)e.each(function(s){r.add(s)});else if(e){var n=-1,o=e.length;if(i==null)for(;++n<o;)r.add(e[n]);else for(;++n<o;)r.add(i(e[n],n,e))}return r}var C3=null,Vy=Array.prototype,$v=Vy.map,Tp=Vy.slice;function Kh(e,i){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(i).domain(e);break}return this}function w3(e,i){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(i).domain(e);break}return this}var Gy={name:"implicit"};function Jv(){var e=zm(),i=[],r=[],n=Gy;function o(s){var p=s+"",y=e.get(p);if(!y){if(n!==Gy)return n;e.set(p,y=i.push(s))}return r[(y-1)%r.length]}return o.domain=function(s){if(!arguments.length)return i.slice();i=[],e=zm();for(var p=-1,y=s.length,_,E;++p<y;)e.has(E=(_=s[p])+"")||e.set(E,i.push(_));return o},o.range=function(s){return arguments.length?(r=Tp.call(s),o):r.slice()},o.unknown=function(s){return arguments.length?(n=s,o):n},o.copy=function(){return Jv(i,r).unknown(n)},Kh.apply(o,arguments),o}function Hy(){var e=ordinal().unknown(void 0),i=e.domain,r=e.range,n=[0,1],o,s,p=!1,y=0,_=0,E=.5;delete e.unknown;function T(){var P=i().length,D=n[1]<n[0],z=n[D-0],J=n[1-D];o=(J-z)/Math.max(1,P-y+_*2),p&&(o=Math.floor(o)),z+=(J-z-o*(P-y))*E,s=o*(1-y),p&&(z=Math.round(z),s=Math.round(s));var oe=sequence(P).map(function(he){return z+o*he});return r(D?oe.reverse():oe)}return e.domain=function(P){return arguments.length?(i(P),T()):i()},e.range=function(P){return arguments.length?(n=[+P[0],+P[1]],T()):n.slice()},e.rangeRound=function(P){return n=[+P[0],+P[1]],p=!0,T()},e.bandwidth=function(){return s},e.step=function(){return o},e.round=function(P){return arguments.length?(p=!!P,T()):p},e.padding=function(P){return arguments.length?(y=Math.min(1,_=+P),T()):y},e.paddingInner=function(P){return arguments.length?(y=Math.min(1,P),T()):y},e.paddingOuter=function(P){return arguments.length?(_=+P,T()):_},e.align=function(P){return arguments.length?(E=Math.max(0,Math.min(1,P)),T()):E},e.copy=function(){return Hy(i(),n).round(p).paddingInner(y).paddingOuter(_).align(E)},initRange.apply(T(),arguments)}function Wy(e){var i=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Wy(i())},e}function A3(){return Wy(Hy.apply(null,arguments).paddingInner(1))}var _w=R(26257),xw=R(73626);function bw(e,i){return e=+e,i=+i,function(r){return Math.round(e*(1-r)+i*r)}}function Ew(e){return function(){return e}}function Um(e){return+e}var Xy=[0,1];function gc(e){return e}function Zm(e,i){return(i-=e=+e)?function(r){return(r-e)/i}:Ew(isNaN(i)?NaN:.5)}function Yy(e){var i=e[0],r=e[e.length-1],n;return i>r&&(n=i,i=r,r=n),function(o){return Math.max(i,Math.min(r,o))}}function Sw(e,i,r){var n=e[0],o=e[1],s=i[0],p=i[1];return o<n?(n=Zm(o,n),s=r(p,s)):(n=Zm(n,o),s=r(s,p)),function(y){return s(n(y))}}function Cw(e,i,r){var n=Math.min(e.length,i.length)-1,o=new Array(n),s=new Array(n),p=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),i=i.slice().reverse());++p<n;)o[p]=Zm(e[p],e[p+1]),s[p]=r(i[p],i[p+1]);return function(y){var _=Xv(e,y,1,n)-1;return s[_](o[_](y))}}function Qv(e,i){return i.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function jm(){var e=Xy,i=Xy,r=_w.Z,n,o,s,p=gc,y,_,E;function T(){return y=Math.min(e.length,i.length)>2?Cw:Sw,_=E=null,P}function P(D){return isNaN(D=+D)?s:(_||(_=y(e.map(n),i,r)))(n(p(D)))}return P.invert=function(D){return p(o((E||(E=y(i,e.map(n),xw.Z)))(D)))},P.domain=function(D){return arguments.length?(e=$v.call(D,Um),p===gc||(p=Yy(e)),T()):e.slice()},P.range=function(D){return arguments.length?(i=Tp.call(D),T()):i.slice()},P.rangeRound=function(D){return i=Tp.call(D),r=bw,T()},P.clamp=function(D){return arguments.length?(p=D?Yy(e):gc,P):p!==gc},P.interpolate=function(D){return arguments.length?(r=D,T()):r},P.unknown=function(D){return arguments.length?(s=D,P):s},function(D,z){return n=D,o=z,T()}}function qy(e,i){return jm()(e,i)}var ww=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function em(e){if(!(i=ww.exec(e)))throw new Error("invalid format: "+e);var i;return new Vm({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}em.prototype=Vm.prototype;function Vm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}Vm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Aw(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function tm(e,i){if((r=(e=i?e.toExponential(i-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function dd(e){return e=tm(Math.abs(e)),e?e[1]:NaN}function Tw(e,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(dd(i)/3)))*3-dd(Math.abs(e)))}function Mw(e,i){return function(r,n){for(var o=r.length,s=[],p=0,y=e[0],_=0;o>0&&y>0&&(_+y+1>n&&(y=Math.max(1,n-_)),s.push(r.substring(o-=y,o+y)),!((_+=y+1)>n));)y=e[p=(p+1)%e.length];return s.reverse().join(i)}}function Pw(e){return function(i){return i.replace(/[0-9]/g,function(r){return e[+r]})}}function Iw(e){e:for(var i=e.length,r=1,n=-1,o;r<i;++r)switch(e[r]){case".":n=o=r;break;case"0":n===0&&(n=r),o=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(o+1):e}var Ky;function Ow(e,i){var r=tm(e,i);if(!r)return e+"";var n=r[0],o=r[1],s=o-(Ky=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,p=n.length;return s===p?n:s>p?n+new Array(s-p+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+tm(e,Math.max(0,i+s-1))[0]}function $y(e,i){var r=tm(e,i);if(!r)return e+"";var n=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+n:n.length>o+1?n.slice(0,o+1)+"."+n.slice(o+1):n+new Array(o-n.length+2).join("0")}var Jy={"%":function(e,i){return(e*100).toFixed(i)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:Aw,e:function(e,i){return e.toExponential(i)},f:function(e,i){return e.toFixed(i)},g:function(e,i){return e.toPrecision(i)},o:function(e){return Math.round(e).toString(8)},p:function(e,i){return $y(e*100,i)},r:$y,s:Ow,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Qy(e){return e}var e_=Array.prototype.map,t_=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function Rw(e){var i=e.grouping===void 0||e.thousands===void 0?Qy:Mw(e_.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?Qy:Pw(e_.call(e.numerals,String)),p=e.percent===void 0?"%":e.percent+"",y=e.minus===void 0?"-":e.minus+"",_=e.nan===void 0?"NaN":e.nan+"";function E(P){P=em(P);var D=P.fill,z=P.align,J=P.sign,oe=P.symbol,he=P.zero,De=P.width,it=P.comma,ht=P.precision,_t=P.trim,jt=P.type;jt==="n"?(it=!0,jt="g"):Jy[jt]||(ht===void 0&&(ht=12),_t=!0,jt="g"),(he||D==="0"&&z==="=")&&(he=!0,D="0",z="=");var Vt=oe==="$"?r:oe==="#"&&/[boxX]/.test(jt)?"0"+jt.toLowerCase():"",rr=oe==="$"?n:/[%p]/.test(jt)?p:"",yr=Jy[jt],Yr=/[defgprs%]/.test(jt);ht=ht===void 0?6:/[gprs]/.test(jt)?Math.max(1,Math.min(21,ht)):Math.max(0,Math.min(20,ht));function fn(Or){var Tn=Vt,Bn=rr,hi,vo,Cs;if(jt==="c")Bn=yr(Or)+Bn,Or="";else{Or=+Or;var nl=Or<0||1/Or<0;if(Or=isNaN(Or)?_:yr(Math.abs(Or),ht),_t&&(Or=Iw(Or)),nl&&+Or==0&&J!=="+"&&(nl=!1),Tn=(nl?J==="("?J:y:J==="-"||J==="("?"":J)+Tn,Bn=(jt==="s"?t_[8+Ky/3]:"")+Bn+(nl&&J==="("?")":""),Yr){for(hi=-1,vo=Or.length;++hi<vo;)if(Cs=Or.charCodeAt(hi),48>Cs||Cs>57){Bn=(Cs===46?o+Or.slice(hi+1):Or.slice(hi))+Bn,Or=Or.slice(0,hi);break}}}it&&!he&&(Or=i(Or,Infinity));var yc=Tn.length+Or.length+Bn.length,xl=yc<De?new Array(De-yc+1).join(D):"";switch(it&&he&&(Or=i(xl+Or,xl.length?De-Bn.length:Infinity),xl=""),z){case"<":Or=Tn+Or+Bn+xl;break;case"=":Or=Tn+xl+Or+Bn;break;case"^":Or=xl.slice(0,yc=xl.length>>1)+Tn+Or+Bn+xl.slice(yc);break;default:Or=xl+Tn+Or+Bn;break}return s(Or)}return fn.toString=function(){return P+""},fn}function T(P,D){var z=E((P=em(P),P.type="f",P)),J=Math.max(-8,Math.min(8,Math.floor(dd(D)/3)))*3,oe=Math.pow(10,-J),he=t_[8+J/3];return function(De){return z(oe*De)+he}}return{format:E,formatPrefix:T}}var rm,Gm,r_;Lw({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Lw(e){return rm=Rw(e),Gm=rm.format,r_=rm.formatPrefix,rm}function kw(e,i){return e=Math.abs(e),i=Math.abs(i)-e,Math.max(0,dd(i)-dd(e))+1}function Dw(e){return Math.max(0,-dd(Math.abs(e)))}function Fw(e,i,r,n){var o=Nm(e,i,r),s;switch(n=em(n==null?",f":n),n.type){case"s":{var p=Math.max(Math.abs(e),Math.abs(i));return n.precision==null&&!isNaN(s=Tw(o,p))&&(n.precision=s),r_(n,p)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=kw(o,Math.max(Math.abs(e),Math.abs(i))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=Dw(o))&&(n.precision=s-(n.type==="%")*2);break}}return Gm(n)}function nm(e){var i=e.domain;return e.ticks=function(r){var n=i();return zy(n[0],n[n.length-1],r==null?10:r)},e.tickFormat=function(r,n){var o=i();return Fw(o[0],o[o.length-1],r==null?10:r,n)},e.nice=function(r){r==null&&(r=10);var n=i(),o=0,s=n.length-1,p=n[o],y=n[s],_;return y<p&&(_=p,p=y,y=_,_=o,o=s,s=_),_=Yv(p,y,r),_>0?(p=Math.floor(p/_)*_,y=Math.ceil(y/_)*_,_=Yv(p,y,r)):_<0&&(p=Math.ceil(p*_)/_,y=Math.floor(y*_)/_,_=Yv(p,y,r)),_>0?(n[o]=Math.floor(p/_)*_,n[s]=Math.ceil(y/_)*_,i(n)):_<0&&(n[o]=Math.ceil(p*_)/_,n[s]=Math.floor(y*_)/_,i(n)),e},e}function n_(){var e=qy(gc,gc);return e.copy=function(){return Qv(e,n_())},Kh.apply(e,arguments),nm(e)}function i_(e){var i;function r(n){return isNaN(n=+n)?i:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=$v.call(n,Um),r):e.slice()},r.unknown=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return i_(e).unknown(i)},e=arguments.length?$v.call(e,Um):[0,1],nm(r)}function a_(e,i){e=e.slice();var r=0,n=e.length-1,o=e[r],s=e[n],p;return s<o&&(p=r,r=n,n=p,p=o,o=s,s=p),e[r]=i.floor(o),e[n]=i.ceil(s),e}function o_(e){return Math.log(e)}function s_(e){return Math.exp(e)}function Bw(e){return-Math.log(-e)}function Nw(e){return-Math.exp(-e)}function zw(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Uw(e){return e===10?zw:e===Math.E?Math.exp:function(i){return Math.pow(e,i)}}function Zw(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(i){return Math.log(i)/e})}function u_(e){return function(i){return-e(-i)}}function jw(e){var i=e(o_,s_),r=i.domain,n=10,o,s;function p(){return o=Zw(n),s=Uw(n),r()[0]<0?(o=u_(o),s=u_(s),e(Bw,Nw)):e(o_,s_),i}return i.base=function(y){return arguments.length?(n=+y,p()):n},i.domain=function(y){return arguments.length?(r(y),p()):r()},i.ticks=function(y){var _=r(),E=_[0],T=_[_.length-1],P;(P=T<E)&&(D=E,E=T,T=D);var D=o(E),z=o(T),J,oe,he,De=y==null?10:+y,it=[];if(!(n%1)&&z-D<De){if(D=Math.round(D)-1,z=Math.round(z)+1,E>0){for(;D<z;++D)for(oe=1,J=s(D);oe<n;++oe)if(he=J*oe,!(he<E)){if(he>T)break;it.push(he)}}else for(;D<z;++D)for(oe=n-1,J=s(D);oe>=1;--oe)if(he=J*oe,!(he<E)){if(he>T)break;it.push(he)}}else it=zy(D,z,Math.min(z-D,De)).map(s);return P?it.reverse():it},i.tickFormat=function(y,_){if(_==null&&(_=n===10?".0e":","),typeof _!="function"&&(_=Gm(_)),y===Infinity)return _;y==null&&(y=10);var E=Math.max(1,n*y/i.ticks().length);return function(T){var P=T/s(Math.round(o(T)));return P*n<n-.5&&(P*=n),P<=E?_(T):""}},i.nice=function(){return r(a_(r(),{floor:function(y){return s(Math.floor(o(y)))},ceil:function(y){return s(Math.ceil(o(y)))}}))},i}function l_(){var e=jw(jm()).domain([1,10]);return e.copy=function(){return Qv(e,l_()).base(e.base())},Kh.apply(e,arguments),e}function c_(e){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/e))}}function f_(e){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*e}}function Vw(e){var i=1,r=e(c_(i),f_(i));return r.constant=function(n){return arguments.length?e(c_(i=+n),f_(i)):i},linearish(r)}function Gw(){var e=Vw(transformer());return e.copy=function(){return copy(e,Gw()).constant(e.constant())},initRange.apply(e,arguments)}function h_(e){return function(i){return i<0?-Math.pow(-i,e):Math.pow(i,e)}}function Hw(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Ww(e){return e<0?-e*e:e*e}function Xw(e){var i=e(gc,gc),r=1;function n(){return r===1?e(gc,gc):r===.5?e(Hw,Ww):e(h_(r),h_(1/r))}return i.exponent=function(o){return arguments.length?(r=+o,n()):r},nm(i)}function Hm(){var e=Xw(jm());return e.copy=function(){return Qv(e,Hm()).exponent(e.exponent())},Kh.apply(e,arguments),e}function T3(){return Hm.apply(null,arguments).exponent(.5)}function p_(){var e=[],i=[],r=[],n;function o(){var p=0,y=Math.max(1,i.length);for(r=new Array(y-1);++p<y;)r[p-1]=vw(e,p/y);return s}function s(p){return isNaN(p=+p)?n:i[Xv(r,p)]}return s.invertExtent=function(p){var y=i.indexOf(p);return y<0?[NaN,NaN]:[y>0?r[y-1]:e[0],y<r.length?r[y]:e[e.length-1]]},s.domain=function(p){if(!arguments.length)return e.slice();e=[];for(var y=0,_=p.length,E;y<_;++y)E=p[y],E!=null&&!isNaN(E=+E)&&e.push(E);return e.sort(km),o()},s.range=function(p){return arguments.length?(i=Tp.call(p),o()):i.slice()},s.unknown=function(p){return arguments.length?(n=p,s):n},s.quantiles=function(){return r.slice()},s.copy=function(){return p_().domain(e).range(i).unknown(n)},Kh.apply(s,arguments)}function d_(){var e=0,i=1,r=1,n=[.5],o=[0,1],s;function p(_){return _<=_?o[Xv(n,_,0,r)]:s}function y(){var _=-1;for(n=new Array(r);++_<r;)n[_]=((_+1)*i-(_-r)*e)/(r+1);return p}return p.domain=function(_){return arguments.length?(e=+_[0],i=+_[1],y()):[e,i]},p.range=function(_){return arguments.length?(r=(o=Tp.call(_)).length-1,y()):o.slice()},p.invertExtent=function(_){var E=o.indexOf(_);return E<0?[NaN,NaN]:E<1?[e,n[0]]:E>=r?[n[r-1],i]:[n[E-1],n[E]]},p.unknown=function(_){return arguments.length&&(s=_),p},p.thresholds=function(){return n.slice()},p.copy=function(){return d_().domain([e,i]).range(o).unknown(s)},Kh.apply(nm(p),arguments)}function v_(){var e=[.5],i=[0,1],r,n=1;function o(s){return s<=s?i[Xv(e,s,0,n)]:r}return o.domain=function(s){return arguments.length?(e=Tp.call(s),n=Math.min(e.length,i.length-1),o):e.slice()},o.range=function(s){return arguments.length?(i=Tp.call(s),n=Math.min(e.length,i.length-1),o):i.slice()},o.invertExtent=function(s){var p=i.indexOf(s);return[e[p-1],e[p]]},o.unknown=function(s){return arguments.length?(r=s,o):r},o.copy=function(){return v_().domain(e).range(i).unknown(r)},Kh.apply(o,arguments)}var Wm=new Date,Xm=new Date;function rl(e,i,r,n){function o(s){return e(s=arguments.length===0?new Date:new Date(+s)),s}return o.floor=function(s){return e(s=new Date(+s)),s},o.ceil=function(s){return e(s=new Date(s-1)),i(s,1),e(s),s},o.round=function(s){var p=o(s),y=o.ceil(s);return s-p<y-s?p:y},o.offset=function(s,p){return i(s=new Date(+s),p==null?1:Math.floor(p)),s},o.range=function(s,p,y){var _=[],E;if(s=o.ceil(s),y=y==null?1:Math.floor(y),!(s<p)||!(y>0))return _;do _.push(E=new Date(+s)),i(s,y),e(s);while(E<s&&s<p);return _},o.filter=function(s){return rl(function(p){if(p>=p)for(;e(p),!s(p);)p.setTime(p-1)},function(p,y){if(p>=p)if(y<0)for(;++y<=0;)for(;i(p,-1),!s(p););else for(;--y>=0;)for(;i(p,1),!s(p););})},r&&(o.count=function(s,p){return Wm.setTime(+s),Xm.setTime(+p),e(Wm),e(Xm),Math.floor(r(Wm,Xm))},o.every=function(s){return s=Math.floor(s),!isFinite(s)||!(s>0)?null:s>1?o.filter(n?function(p){return n(p)%s==0}:function(p){return o.count(0,p)%s==0}):o}),o}var Ym=rl(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i)},function(e,i){return i.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});Ym.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:rl(function(i){i.setFullYear(Math.floor(i.getFullYear()/e)*e),i.setMonth(0,1),i.setHours(0,0,0,0)},function(i,r){i.setFullYear(i.getFullYear()+r*e)})};var vd=Ym,M3=Ym.range,m_=rl(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,i){e.setMonth(e.getMonth()+i)},function(e,i){return i.getMonth()-e.getMonth()+(i.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),Yw=m_,P3=m_.range,im=1e3,ev=6e4,g_=36e5,y_=864e5,__=6048e5;function Mp(e){return rl(function(i){i.setDate(i.getDate()-(i.getDay()+7-e)%7),i.setHours(0,0,0,0)},function(i,r){i.setDate(i.getDate()+r*7)},function(i,r){return(r-i-(r.getTimezoneOffset()-i.getTimezoneOffset())*ev)/__})}var qm=Mp(0),am=Mp(1),qw=Mp(2),Kw=Mp(3),md=Mp(4),$w=Mp(5),Jw=Mp(6),I3=qm.range,O3=am.range,R3=qw.range,L3=Kw.range,k3=md.range,D3=$w.range,F3=Jw.range,x_=rl(function(e){e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*ev)/y_},function(e){return e.getDate()-1}),Km=x_,B3=x_.range,b_=rl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*im-e.getMinutes()*ev)},function(e,i){e.setTime(+e+i*g_)},function(e,i){return(i-e)/g_},function(e){return e.getHours()}),Qw=b_,N3=b_.range,E_=rl(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*im)},function(e,i){e.setTime(+e+i*ev)},function(e,i){return(i-e)/ev},function(e){return e.getMinutes()}),eA=E_,z3=E_.range,S_=rl(function(e){e.setTime(e-e.getMilliseconds())},function(e,i){e.setTime(+e+i*im)},function(e,i){return(i-e)/im},function(e){return e.getUTCSeconds()}),tA=S_,U3=S_.range,om=rl(function(){},function(e,i){e.setTime(+e+i)},function(e,i){return i-e});om.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?rl(function(i){i.setTime(Math.floor(i/e)*e)},function(i,r){i.setTime(+i+r*e)},function(i,r){return(r-i)/e}):om};var rA=om,Z3=om.range;function Pp(e){return rl(function(i){i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-e)%7),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCDate(i.getUTCDate()+r*7)},function(i,r){return(r-i)/__})}var C_=Pp(0),sm=Pp(1),nA=Pp(2),iA=Pp(3),gd=Pp(4),aA=Pp(5),oA=Pp(6),j3=C_.range,V3=sm.range,G3=nA.range,H3=iA.range,W3=gd.range,X3=aA.range,Y3=oA.range,w_=rl(function(e){e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i)},function(e,i){return(i-e)/y_},function(e){return e.getUTCDate()-1}),A_=w_,q3=w_.range,$m=rl(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i)},function(e,i){return i.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});$m.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:rl(function(i){i.setUTCFullYear(Math.floor(i.getUTCFullYear()/e)*e),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},function(i,r){i.setUTCFullYear(i.getUTCFullYear()+r*e)})};var tv=$m,K3=$m.range;function Jm(e){if(0<=e.y&&e.y<100){var i=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return i.setFullYear(e.y),i}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Qm(e){if(0<=e.y&&e.y<100){var i=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return i.setUTCFullYear(e.y),i}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function rv(e,i,r){return{y:e,m:i,d:r,H:0,M:0,S:0,L:0}}function sA(e){var i=e.dateTime,r=e.date,n=e.time,o=e.periods,s=e.days,p=e.shortDays,y=e.months,_=e.shortMonths,E=nv(o),T=iv(o),P=nv(s),D=iv(s),z=nv(p),J=iv(p),oe=nv(y),he=iv(y),De=nv(_),it=iv(_),ht={a:nl,A:yc,b:xl,B:FP,c:null,d:R_,e:R_,f:IA,g:UA,G:jA,H:TA,I:MA,j:PA,L:L_,m:OA,M:RA,p:BP,q:NP,Q:z_,s:U_,S:LA,u:kA,U:DA,V:FA,w:BA,W:NA,x:null,X:null,y:zA,Y:ZA,Z:VA,"%":N_},_t={a:zP,A:UP,b:ZP,B:jP,c:null,d:D_,e:D_,f:XA,g:nT,G:aT,H:GA,I:HA,j:WA,L:F_,m:YA,M:qA,p:VP,q:GP,Q:z_,s:U_,S:KA,u:$A,U:JA,V:QA,w:eT,W:tT,x:null,X:null,y:rT,Y:iT,Z:oT,"%":N_},jt={a:fn,A:Or,b:Tn,B:Bn,c:hi,d:I_,e:I_,f:SA,g:P_,G:M_,H:O_,I:O_,j:_A,L:EA,m:yA,M:xA,p:Yr,q:gA,Q:wA,s:AA,S:bA,u:hA,U:pA,V:dA,w:fA,W:vA,x:vo,X:Cs,y:P_,Y:M_,Z:mA,"%":CA};ht.x=Vt(r,ht),ht.X=Vt(n,ht),ht.c=Vt(i,ht),_t.x=Vt(r,_t),_t.X=Vt(n,_t),_t.c=Vt(i,_t);function Vt(ii,Ba){return function(to){var _n=[],bl=-1,Go=0,Gl=ii.length,Hl,Rp,Tx;for(to instanceof Date||(to=new Date(+to));++bl<Gl;)ii.charCodeAt(bl)===37&&(_n.push(ii.slice(Go,bl)),(Rp=T_[Hl=ii.charAt(++bl)])!=null?Hl=ii.charAt(++bl):Rp=Hl==="e"?" ":"0",(Tx=Ba[Hl])&&(Hl=Tx(to,Rp)),_n.push(Hl),Go=bl+1);return _n.push(ii.slice(Go,bl)),_n.join("")}}function rr(ii,Ba){return function(to){var _n=rv(1900,void 0,1),bl=yr(_n,ii,to+="",0),Go,Gl;if(bl!=to.length)return null;if("Q"in _n)return new Date(_n.Q);if("s"in _n)return new Date(_n.s*1e3+("L"in _n?_n.L:0));if(Ba&&!("Z"in _n)&&(_n.Z=0),"p"in _n&&(_n.H=_n.H%12+_n.p*12),_n.m===void 0&&(_n.m="q"in _n?_n.q:0),"V"in _n){if(_n.V<1||_n.V>53)return null;"w"in _n||(_n.w=1),"Z"in _n?(Go=Qm(rv(_n.y,0,1)),Gl=Go.getUTCDay(),Go=Gl>4||Gl===0?sm.ceil(Go):sm(Go),Go=A_.offset(Go,(_n.V-1)*7),_n.y=Go.getUTCFullYear(),_n.m=Go.getUTCMonth(),_n.d=Go.getUTCDate()+(_n.w+6)%7):(Go=Jm(rv(_n.y,0,1)),Gl=Go.getDay(),Go=Gl>4||Gl===0?am.ceil(Go):am(Go),Go=Km.offset(Go,(_n.V-1)*7),_n.y=Go.getFullYear(),_n.m=Go.getMonth(),_n.d=Go.getDate()+(_n.w+6)%7)}else("W"in _n||"U"in _n)&&("w"in _n||(_n.w="u"in _n?_n.u%7:"W"in _n?1:0),Gl="Z"in _n?Qm(rv(_n.y,0,1)).getUTCDay():Jm(rv(_n.y,0,1)).getDay(),_n.m=0,_n.d="W"in _n?(_n.w+6)%7+_n.W*7-(Gl+5)%7:_n.w+_n.U*7-(Gl+6)%7);return"Z"in _n?(_n.H+=_n.Z/100|0,_n.M+=_n.Z%100,Qm(_n)):Jm(_n)}}function yr(ii,Ba,to,_n){for(var bl=0,Go=Ba.length,Gl=to.length,Hl,Rp;bl<Go;){if(_n>=Gl)return-1;if(Hl=Ba.charCodeAt(bl++),Hl===37){if(Hl=Ba.charAt(bl++),Rp=jt[Hl in T_?Ba.charAt(bl++):Hl],!Rp||(_n=Rp(ii,to,_n))<0)return-1}else if(Hl!=to.charCodeAt(_n++))return-1}return _n}function Yr(ii,Ba,to){var _n=E.exec(Ba.slice(to));return _n?(ii.p=T[_n[0].toLowerCase()],to+_n[0].length):-1}function fn(ii,Ba,to){var _n=z.exec(Ba.slice(to));return _n?(ii.w=J[_n[0].toLowerCase()],to+_n[0].length):-1}function Or(ii,Ba,to){var _n=P.exec(Ba.slice(to));return _n?(ii.w=D[_n[0].toLowerCase()],to+_n[0].length):-1}function Tn(ii,Ba,to){var _n=De.exec(Ba.slice(to));return _n?(ii.m=it[_n[0].toLowerCase()],to+_n[0].length):-1}function Bn(ii,Ba,to){var _n=oe.exec(Ba.slice(to));return _n?(ii.m=he[_n[0].toLowerCase()],to+_n[0].length):-1}function hi(ii,Ba,to){return yr(ii,i,Ba,to)}function vo(ii,Ba,to){return yr(ii,r,Ba,to)}function Cs(ii,Ba,to){return yr(ii,n,Ba,to)}function nl(ii){return p[ii.getDay()]}function yc(ii){return s[ii.getDay()]}function xl(ii){return _[ii.getMonth()]}function FP(ii){return y[ii.getMonth()]}function BP(ii){return o[+(ii.getHours()>=12)]}function NP(ii){return 1+~~(ii.getMonth()/3)}function zP(ii){return p[ii.getUTCDay()]}function UP(ii){return s[ii.getUTCDay()]}function ZP(ii){return _[ii.getUTCMonth()]}function jP(ii){return y[ii.getUTCMonth()]}function VP(ii){return o[+(ii.getUTCHours()>=12)]}function GP(ii){return 1+~~(ii.getUTCMonth()/3)}return{format:function(ii){var Ba=Vt(ii+="",ht);return Ba.toString=function(){return ii},Ba},parse:function(ii){var Ba=rr(ii+="",!1);return Ba.toString=function(){return ii},Ba},utcFormat:function(ii){var Ba=Vt(ii+="",_t);return Ba.toString=function(){return ii},Ba},utcParse:function(ii){var Ba=rr(ii+="",!0);return Ba.toString=function(){return ii},Ba}}}var T_={"-":"",_:" ","0":"0"},fu=/^\s*\d+/,uA=/^%/,lA=/[\\^$*+?|[\]().{}]/g;function eo(e,i,r){var n=e<0?"-":"",o=(n?-e:e)+"",s=o.length;return n+(s<r?new Array(r-s+1).join(i)+o:o)}function cA(e){return e.replace(lA,"\\$&")}function nv(e){return new RegExp("^(?:"+e.map(cA).join("|")+")","i")}function iv(e){for(var i={},r=-1,n=e.length;++r<n;)i[e[r].toLowerCase()]=r;return i}function fA(e,i,r){var n=fu.exec(i.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function hA(e,i,r){var n=fu.exec(i.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function pA(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function dA(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function vA(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function M_(e,i,r){var n=fu.exec(i.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function P_(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function mA(e,i,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function gA(e,i,r){var n=fu.exec(i.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function yA(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function I_(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function _A(e,i,r){var n=fu.exec(i.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function O_(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function xA(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function bA(e,i,r){var n=fu.exec(i.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function EA(e,i,r){var n=fu.exec(i.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function SA(e,i,r){var n=fu.exec(i.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function CA(e,i,r){var n=uA.exec(i.slice(r,r+1));return n?r+n[0].length:-1}function wA(e,i,r){var n=fu.exec(i.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function AA(e,i,r){var n=fu.exec(i.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function R_(e,i){return eo(e.getDate(),i,2)}function TA(e,i){return eo(e.getHours(),i,2)}function MA(e,i){return eo(e.getHours()%12||12,i,2)}function PA(e,i){return eo(1+Km.count(vd(e),e),i,3)}function L_(e,i){return eo(e.getMilliseconds(),i,3)}function IA(e,i){return L_(e,i)+"000"}function OA(e,i){return eo(e.getMonth()+1,i,2)}function RA(e,i){return eo(e.getMinutes(),i,2)}function LA(e,i){return eo(e.getSeconds(),i,2)}function kA(e){var i=e.getDay();return i===0?7:i}function DA(e,i){return eo(qm.count(vd(e)-1,e),i,2)}function k_(e){var i=e.getDay();return i>=4||i===0?md(e):md.ceil(e)}function FA(e,i){return e=k_(e),eo(md.count(vd(e),e)+(vd(e).getDay()===4),i,2)}function BA(e){return e.getDay()}function NA(e,i){return eo(am.count(vd(e)-1,e),i,2)}function zA(e,i){return eo(e.getFullYear()%100,i,2)}function UA(e,i){return e=k_(e),eo(e.getFullYear()%100,i,2)}function ZA(e,i){return eo(e.getFullYear()%1e4,i,4)}function jA(e,i){var r=e.getDay();return e=r>=4||r===0?md(e):md.ceil(e),eo(e.getFullYear()%1e4,i,4)}function VA(e){var i=e.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+eo(i/60|0,"0",2)+eo(i%60,"0",2)}function D_(e,i){return eo(e.getUTCDate(),i,2)}function GA(e,i){return eo(e.getUTCHours(),i,2)}function HA(e,i){return eo(e.getUTCHours()%12||12,i,2)}function WA(e,i){return eo(1+A_.count(tv(e),e),i,3)}function F_(e,i){return eo(e.getUTCMilliseconds(),i,3)}function XA(e,i){return F_(e,i)+"000"}function YA(e,i){return eo(e.getUTCMonth()+1,i,2)}function qA(e,i){return eo(e.getUTCMinutes(),i,2)}function KA(e,i){return eo(e.getUTCSeconds(),i,2)}function $A(e){var i=e.getUTCDay();return i===0?7:i}function JA(e,i){return eo(C_.count(tv(e)-1,e),i,2)}function B_(e){var i=e.getUTCDay();return i>=4||i===0?gd(e):gd.ceil(e)}function QA(e,i){return e=B_(e),eo(gd.count(tv(e),e)+(tv(e).getUTCDay()===4),i,2)}function eT(e){return e.getUTCDay()}function tT(e,i){return eo(sm.count(tv(e)-1,e),i,2)}function rT(e,i){return eo(e.getUTCFullYear()%100,i,2)}function nT(e,i){return e=B_(e),eo(e.getUTCFullYear()%100,i,2)}function iT(e,i){return eo(e.getUTCFullYear()%1e4,i,4)}function aT(e,i){var r=e.getUTCDay();return e=r>=4||r===0?gd(e):gd.ceil(e),eo(e.getUTCFullYear()%1e4,i,4)}function oT(){return"+0000"}function N_(){return"%"}function z_(e){return+e}function U_(e){return Math.floor(+e/1e3)}var yd,Z_,sT,uT,lT;cT({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function cT(e){return yd=sA(e),Z_=yd.format,sT=yd.parse,uT=yd.utcFormat,lT=yd.utcParse,yd}var av=1e3,ov=av*60,sv=ov*60,uv=sv*24,fT=uv*7,j_=uv*30,e0=uv*365;function hT(e){return new Date(e)}function pT(e){return e instanceof Date?+e:+new Date(+e)}function V_(e,i,r,n,o,s,p,y,_){var E=qy(gc,gc),T=E.invert,P=E.domain,D=_(".%L"),z=_(":%S"),J=_("%I:%M"),oe=_("%I %p"),he=_("%a %d"),De=_("%b %d"),it=_("%B"),ht=_("%Y"),_t=[[p,1,av],[p,5,5*av],[p,15,15*av],[p,30,30*av],[s,1,ov],[s,5,5*ov],[s,15,15*ov],[s,30,30*ov],[o,1,sv],[o,3,3*sv],[o,6,6*sv],[o,12,12*sv],[n,1,uv],[n,2,2*uv],[r,1,fT],[i,1,j_],[i,3,3*j_],[e,1,e0]];function jt(rr){return(p(rr)<rr?D:s(rr)<rr?z:o(rr)<rr?J:n(rr)<rr?oe:i(rr)<rr?r(rr)<rr?he:De:e(rr)<rr?it:ht)(rr)}function Vt(rr,yr,Yr,fn){if(rr==null&&(rr=10),typeof rr=="number"){var Or=Math.abs(Yr-yr)/rr,Tn=Fy(function(Bn){return Bn[2]}).right(_t,Or);Tn===_t.length?(fn=Nm(yr/e0,Yr/e0,rr),rr=e):Tn?(Tn=_t[Or/_t[Tn-1][2]<_t[Tn][2]/Or?Tn-1:Tn],fn=Tn[1],rr=Tn[0]):(fn=Math.max(Nm(yr,Yr,rr),1),rr=y)}return fn==null?rr:rr.every(fn)}return E.invert=function(rr){return new Date(T(rr))},E.domain=function(rr){return arguments.length?P($v.call(rr,pT)):P().map(hT)},E.ticks=function(rr,yr){var Yr=P(),fn=Yr[0],Or=Yr[Yr.length-1],Tn=Or<fn,Bn;return Tn&&(Bn=fn,fn=Or,Or=Bn),Bn=Vt(rr,fn,Or,yr),Bn=Bn?Bn.range(fn,Or+1):[],Tn?Bn.reverse():Bn},E.tickFormat=function(rr,yr){return yr==null?jt:_(yr)},E.nice=function(rr,yr){var Yr=P();return(rr=Vt(rr,Yr[0],Yr[Yr.length-1],yr))?P(a_(Yr,rr)):E},E.copy=function(){return Qv(E,V_(e,i,r,n,o,s,p,y,_))},E}function dT(){return Kh.apply(V_(vd,Yw,qm,Km,Qw,eA,tA,rA,Z_).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function $3(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function um(){var e=0,i=1,r,n,o,s,p=identity,y=!1,_;function E(T){return isNaN(T=+T)?_:p(o===0?.5:(T=(s(T)-r)*o,y?Math.max(0,Math.min(1,T)):T))}return E.domain=function(T){return arguments.length?(r=s(e=+T[0]),n=s(i=+T[1]),o=r===n?0:1/(n-r),E):[e,i]},E.clamp=function(T){return arguments.length?(y=!!T,E):y},E.interpolator=function(T){return arguments.length?(p=T,E):p},E.unknown=function(T){return arguments.length?(_=T,E):_},function(T){return s=T,r=T(e),n=T(i),o=r===n?0:1/(n-r),E}}function lm(e,i){return i.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function vT(){var e=linearish(um()(identity));return e.copy=function(){return lm(e,vT())},initInterpolator.apply(e,arguments)}function mT(){var e=loggish(um()).domain([1,10]);return e.copy=function(){return lm(e,mT()).base(e.base())},initInterpolator.apply(e,arguments)}function gT(){var e=symlogish(um());return e.copy=function(){return lm(e,gT()).constant(e.constant())},initInterpolator.apply(e,arguments)}function G_(){var e=powish(um());return e.copy=function(){return lm(e,G_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function J3(){return G_.apply(null,arguments).exponent(.5)}function yT(){var e=[],i=identity;function r(n){if(!isNaN(n=+n))return i((bisect(e,n)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var o=0,s=n.length,p;o<s;++o)p=n[o],p!=null&&!isNaN(p=+p)&&e.push(p);return e.sort(ascending),r},r.interpolator=function(n){return arguments.length?(i=n,r):i},r.copy=function(){return yT(i).domain(e)},initInterpolator.apply(r,arguments)}function cm(){var e=0,i=.5,r=1,n,o,s,p,y,_=identity,E,T=!1,P;function D(z){return isNaN(z=+z)?P:(z=.5+((z=+E(z))-o)*(z<o?p:y),_(T?Math.max(0,Math.min(1,z)):z))}return D.domain=function(z){return arguments.length?(n=E(e=+z[0]),o=E(i=+z[1]),s=E(r=+z[2]),p=n===o?0:.5/(o-n),y=o===s?0:.5/(s-o),D):[e,i,r]},D.clamp=function(z){return arguments.length?(T=!!z,D):T},D.interpolator=function(z){return arguments.length?(_=z,D):_},D.unknown=function(z){return arguments.length?(P=z,D):P},function(z){return E=z,n=z(e),o=z(i),s=z(r),p=n===o?0:.5/(o-n),y=o===s?0:.5/(s-o),D}}function _T(){var e=linearish(cm()(identity));return e.copy=function(){return copy(e,_T())},initInterpolator.apply(e,arguments)}function xT(){var e=loggish(cm()).domain([.1,1,10]);return e.copy=function(){return copy(e,xT()).base(e.base())},initInterpolator.apply(e,arguments)}function bT(){var e=symlogish(cm());return e.copy=function(){return copy(e,bT()).constant(e.constant())},initInterpolator.apply(e,arguments)}function H_(){var e=powish(cm());return e.copy=function(){return copy(e,H_()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function Q3(){return H_.apply(null,arguments).exponent(.5)}var Hc,W_,X_,Y_,t0,q_,ET=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,ST=(Hc={},(0,I.Z)(Hc,eu.LINEAR,n_),(0,I.Z)(Hc,eu.POWER,Hm),(0,I.Z)(Hc,eu.LOG,l_),(0,I.Z)(Hc,eu.IDENTITY,i_),(0,I.Z)(Hc,eu.TIME,dT),(0,I.Z)(Hc,eu.QUANTILE,p_),(0,I.Z)(Hc,eu.QUANTIZE,d_),(0,I.Z)(Hc,eu.THRESHOLD,v_),(0,I.Z)(Hc,eu.CAT,Jv),Hc),CT=(W_=(0,zr.b2)(),X_=(0,zr.f3)(Qt.IGlobalConfigService),W_(Y_=(t0=function(){function e(){(0,lt.Z)(this,e),mr(this,"configService",q_,this),(0,I.Z)(this,"scaleCache",{}),(0,I.Z)(this,"scaleOptions",{})}return(0,Lt.Z)(e,[{key:"apply",value:function(r,n){var o=this,s=n.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),y=r.getSource().data.dataArray;y.length!==0&&o.caculateScalesForAttributes(p||[],y)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes(),y=r.getSource().data.dataArray;return o.caculateScalesForAttributes(p||[],y),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){o.scaleOptions=r.getScaleOptions();var p=s.getLayerStyleAttributes();if(p){var y=r.getSource().data.dataArray;if(y.length===0)return;var _=p.filter(function(E){return E.needRescale});_.length&&o.caculateScalesForAttributes(_,y)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,n){var o=this;this.scaleCache={},r.forEach(function(s){if(s.scale){var p=s.scale,y=s.name;p.names=o.parseFields(s.scale.field||[]);var _=[];p.names.forEach(function(E){_.push(o.getOrCreateScale(E,s,n))}),_.some(function(E){return E.type===Hh.VARIABLE})?(p.type=Hh.VARIABLE,_.forEach(function(E){if(!p.callback){var T;if(p.values&&p.values!=="text"){var P;if(((P=E.option)===null||P===void 0?void 0:P.type)==="linear"&&p.values.length>2){var D=E.scale.ticks(p.values.length);y==="color"&&E.scale.domain(D)}E.scale.range(p.values)}else((T=E.option)===null||T===void 0?void 0:T.type)==="cat"&&E.scale.range(E.option.domain)}})):(p.type=Hh.CONSTANT,p.defaultValues=_.map(function(E,T){return E.scale(p.names[T])})),p.scalers=_.map(function(E){return{field:E.field,func:E.scale,option:E.option}}),s.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,n,o){var s,p=[r,n.name].join("_"),y=(s=n.scale)===null||s===void 0?void 0:s.values,_=this.createScale(r,n.name,y,o);return _}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:ci()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,n,o,s){var p,y,_=this.scaleOptions[n]&&((p=this.scaleOptions[n])===null||p===void 0?void 0:p.field)===r?this.scaleOptions[n]:this.scaleOptions[r],E={field:r,scale:void 0,type:Hh.VARIABLE,option:_};if(!s||!s.length)return _&&_.type?E.scale=this.createDefaultScale(_):(E.scale=Jv([r]),E.type=Hh.CONSTANT),E;var T=(y=s.find(function(z){return!zl()(z[r])}))===null||y===void 0?void 0:y[r];if(this.isNumber(r)||zl()(T)&&!_)E.scale=Jv([r]),E.type=Hh.CONSTANT;else{var P=_&&_.type||this.getDefaultType(T);o==="text"&&(P=eu.CAT);var D=this.createDefaultScaleConfig(P,r,s);Object.assign(D,_),E.scale=this.createDefaultScale(D),E.option=D}return E}},{key:"getDefaultType",value:function(r){var n=eu.LINEAR;return typeof r=="string"&&(n=ET.test(r)?eu.TIME:eu.CAT),n}},{key:"createDefaultScaleConfig",value:function(r,n,o){var s={type:r},p=(o==null?void 0:o.map(function(y){return y[n]}))||[];return r!==eu.CAT&&r!==eu.QUANTILE?s.domain=pw(p):r===eu.CAT?s.domain=kd()(p):r===eu.QUANTILE&&(s.domain=p),s}},{key:"createDefaultScale",value:function(r){var n=r.type,o=r.domain,s=ST[n]();return o&&s.domain(o),s}}]),e}(),q_=ur(t0.prototype,"configService",[X_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t0))||Y_),K_,$_,J_,Q_,fm,e1,t1;function r1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function wT(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?r1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):r1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var AT=(K_=(0,zr.b2)(),$_=(0,zr.f3)(Qt.ICameraService),J_=(0,zr.f3)(Qt.IRendererService),K_(Q_=(fm=function(){function e(){(0,lt.Z)(this,e),mr(this,"cameraService",e1,this),mr(this,"rendererService",t1,this)}return(0,Lt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(n){n.addUniforms(wT({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),e1=ur(fm.prototype,"cameraService",[$_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),t1=ur(fm.prototype,"rendererService",[J_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fm))||Q_),n1,i1,TT=(n1=(0,zr.b2)(),n1(i1=function(){function e(){(0,lt.Z)(this,e)}return(0,Lt.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||i1),a1,o1,MT=(a1=(0,zr.b2)(),a1(o1=function(){function e(){(0,lt.Z)(this,e)}return(0,Lt.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var n=r.getLayerConfig(),o=n.autoFit,s=n.fitBoundsOptions;o&&setTimeout(function(){r.fitBounds(s)},100)})}}]),e}())||o1),s1,u1,PT=["type"];function l1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function lv(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?l1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var c1={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},IT={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},OT={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},RT={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},e5=null;function LT(e){var i={u_DirectionalLights:new Array(3).fill(lv({},OT)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(lv({},RT)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[IT]),e.forEach(function(r,n){var o=r.type,s=o===void 0?"directional":o,p=(0,cc.Z)(r,PT),y=c1[s].lights,_=c1[s].num,E=i[_];i[y][E]=lv(lv({},i[y][E]),p),i[_]++}),i}var kT=(s1=(0,zr.b2)(),s1(u1=function(){function e(){(0,lt.Z)(this,e)}return(0,Lt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var n=r.getLayerConfig(),o=n.enableLighting;o&&r.models.forEach(function(s){return s.addUniforms(lv({},LT()))})})}}]),e}())||u1),f1,h1,hm={NONE:0,ENCODE:1,HIGHLIGHT:2},DT=(f1=(0,zr.b2)(),f1(h1=function(){function e(){(0,lt.Z)(this,e)}return(0,Lt.Z)(e,[{key:"apply",value:function(r,n){var o=n.rendererService,s=n.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),y=p.enablePicking;s.registerStyleAttribute({name:"pickingColor",type:li.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:ae.FLOAT},size:3,update:function(E,T){var P=E.id;return y?fe(P):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),y=p.enablePicking;y&&r.isVisible()&&r.models.forEach(function(_){return _.addUniforms({u_PickingStage:hm.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var p=r.getLayerConfig(),y=p.enablePicking;y&&r.isVisible()&&r.models.forEach(function(_){return _.addUniforms({u_PickingStage:hm.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(p){var y=r.getLayerConfig(),_=y.highlightColor,E=y.activeMix,T=E===void 0?0:E,P=typeof _=="string"?V(_):_||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:le(new Uint8Array(p))}),r.models.forEach(function(D){return D.addUniforms({u_PickingStage:hm.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:P.map(function(z){return z*255}),u_activeMix:T})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(p){var y=r.getLayerConfig(),_=y.selectColor,E=y.selectMix,T=E===void 0?0:E,P=typeof _=="string"?V(_):_||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:le(new Uint8Array(p))}),r.models.forEach(function(D){return D.addUniforms({u_PickingStage:hm.HIGHLIGHT,u_PickingColor:p,u_HighlightColor:P.map(function(z){return z*255}),u_activeMix:T})})})}}]),e}())||h1),p1,d1,FT=(p1=(0,zr.b2)(),p1(d1=function(){function e(){(0,lt.Z)(this,e)}return(0,Lt.Z)(e,[{key:"apply",value:function(r,n){var o=this,s=n.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){o.registerBuiltinAttributes(s)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:li.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:ae.FLOAT},size:3,update:function(o,s,p){return p.length===2?[p[0],p[1],0]:[p[0],p[1],p[2]]}}}),r.registerStyleAttribute({name:"filter",type:li.Attribute,descriptor:{name:"filter",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(o,s){var p=o.filter;return p?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:li.Attribute,descriptor:{name:"a_Color",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:4,update:function(o,s){var p=o.color;return!p||!p.length?[1,1,1,1]:p}}}),r.registerStyleAttribute({name:"vertexId",type:li.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:ae.DYNAMIC_DRAW,data:[],type:ae.FLOAT},size:1,update:function(o,s,p,y){return[s]}}})}}]),e}())||d1),v1,m1,g1,y1,_1,x1,_d,b1,E1,S1,C1,BT=(v1=(0,zr.b2)(),m1=(0,zr.f3)(Qt.ICameraService),g1=(0,zr.f3)(Qt.ICoordinateSystemService),y1=(0,zr.f3)(Qt.IRendererService),_1=(0,zr.f3)(Qt.IMapService),v1(x1=(_d=function(){function e(){(0,lt.Z)(this,e),mr(this,"cameraService",b1,this),mr(this,"coordinateSystemService",E1,this),mr(this,"rendererService",S1,this),mr(this,"mapService",C1,this)}return(0,Lt.Z)(e,[{key:"apply",value:function(r){var n=this,o=this.mapService.version,s=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],p=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){n.coordinateSystemService.refresh(),o==="GAODE2.x"&&(s=n.mapService.map.customCoords.getMVPMatrix(),p=n.mapService.getCustomCoordCenter());var y=n.rendererService.getViewportSize(),_=y.width,E=y.height;r.models.forEach(function(T){var P;T.addUniforms((P={},(0,I.Z)(P,yp.ProjectionMatrix,n.cameraService.getProjectionMatrix()),(0,I.Z)(P,yp.ViewMatrix,n.cameraService.getViewMatrix()),(0,I.Z)(P,yp.ViewProjectionMatrix,n.cameraService.getViewProjectionMatrix()),(0,I.Z)(P,yp.Zoom,n.cameraService.getZoom()),(0,I.Z)(P,yp.ZoomScale,n.cameraService.getZoomScale()),(0,I.Z)(P,yp.FocalDistance,n.cameraService.getFocalDistance()),(0,I.Z)(P,yp.CameraPosition,n.cameraService.getCameraPosition()),(0,I.Z)(P,Oe.CoordinateSystem,n.coordinateSystemService.getCoordinateSystem()),(0,I.Z)(P,Oe.ViewportCenter,n.coordinateSystemService.getViewportCenter()),(0,I.Z)(P,Oe.ViewportCenterProjection,n.coordinateSystemService.getViewportCenterProjection()),(0,I.Z)(P,Oe.PixelsPerDegree,n.coordinateSystemService.getPixelsPerDegree()),(0,I.Z)(P,Oe.PixelsPerDegree2,n.coordinateSystemService.getPixelsPerDegree2()),(0,I.Z)(P,Oe.PixelsPerMeter,n.coordinateSystemService.getPixelsPerMeter()),(0,I.Z)(P,Oe.Mvp,s),(0,I.Z)(P,"u_SceneCenterMKT",p),(0,I.Z)(P,"u_ViewportSize",[_,E]),(0,I.Z)(P,"u_ModelMatrix",n.cameraService.getModelMatrix()),(0,I.Z)(P,"u_DevicePixelRatio",ya.devicePixelRatio),(0,I.Z)(P,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),(0,I.Z)(P,"u_shaderPick",Number(r.getShaderPickStat())),P))})})}}]),e}(),b1=ur(_d.prototype,"cameraService",[m1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E1=ur(_d.prototype,"coordinateSystemService",[g1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S1=ur(_d.prototype,"rendererService",[y1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C1=ur(_d.prototype,"mapService",[_1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d))||x1),w1,A1,NT=(w1=(0,zr.b2)(),w1(A1=function(){function e(){(0,lt.Z)(this,e)}return(0,Lt.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||A1),T1,M1,zT=(T1=(0,zr.b2)(),T1(M1=function(){function e(){(0,lt.Z)(this,e)}return(0,Lt.Z)(e,[{key:"apply",value:function(r,n){var o=this,s=n.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){o.initStyleAttribute(r,{styleAttributeService:s})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||o.updateStyleAtrribute(r,{styleAttributeService:s})})}},{key:"updateStyleAtrribute",value:function(r,n){var o=n.styleAttributeService,s=o.getLayerStyleAttributes()||[],p=o.getLayerStyleAttribute("filter"),y=o.getLayerStyleAttribute("shape");if(p&&p.needRegenerateVertices){r.layerModelNeedUpdate=!0,s.forEach(function(_){return _.needRegenerateVertices=!1});return}s.filter(function(_){return _.needRegenerateVertices}).forEach(function(_){o.updateAttributeByFeatureRange(_.name,r.getEncodedData(),_.featureRange.startIndex,_.featureRange.endIndex),_.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,n){var o=n.styleAttributeService,s=o.getLayerStyleAttributes()||[];s.filter(function(p){return p.needRegenerateVertices}).forEach(function(p){o.updateAttributeByFeatureRange(p.name,r.getEncodedData(),p.featureRange.startIndex,p.featureRange.endIndex),p.needRegenerateVertices=!1})}}]),e}())||M1);Vl.bind(Qt.ILayerPlugin).to(cw).inRequestScope(),Vl.bind(Qt.ILayerPlugin).to(FT).inRequestScope(),Vl.bind(Qt.ILayerPlugin).to(CT).inRequestScope(),Vl.bind(Qt.ILayerPlugin).to(lw).inRequestScope(),Vl.bind(Qt.ILayerPlugin).to(MT).inRequestScope(),Vl.bind(Qt.ILayerPlugin).to(zT).inRequestScope(),Vl.bind(Qt.ILayerPlugin).to(NT).inRequestScope(),Vl.bind(Qt.ILayerPlugin).to(DE).inRequestScope(),Vl.bind(Qt.ILayerPlugin).to(BT).inRequestScope(),Vl.bind(Qt.ILayerPlugin).to(AT).inRequestScope(),Vl.bind(Qt.ILayerPlugin).to(kT).inRequestScope(),Vl.bind(Qt.ILayerPlugin).to(DT).inRequestScope(),Vl.bind(Qt.ILayerPlugin).to(TT).inRequestScope();var t5="2.6.33";function P1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function r5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?P1(Object(r),!0).forEach(function(n){UT(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function UT(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function n5(e,i){return GT(e)||VT(e,i)||jT(e,i)||ZT()}function ZT(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jT(e,i){if(!!e){if(typeof e=="string")return I1(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return I1(e,i)}}function I1(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function VT(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,s=!1,p,y;try{for(r=r.call(e);!(o=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));o=!0);}catch(_){s=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(s)throw y}}return n}}function GT(e){if(Array.isArray(e))return e}var i5=null,a5=null,O1,r0,R1;function L1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function k1(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?L1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}var HT=(O1=Mm(Qt.IGlobalConfigService),r0=function(){function e(i){(0,lt.Z)(this,e),mr(this,"configService",R1,this),(0,I.Z)(this,"config",void 0),this.config=i}return(0,Lt.Z)(e,[{key:"setContainer",value:function(r,n,o,s){r.bind(Qt.MapConfig).toConstantValue(k1(k1({},this.config),{},{id:n,canvas:o,hasBaseMap:s})),r.bind(Qt.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),R1=ur(r0.prototype,"configService",[O1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r0),WT=R(6158),cv=R.n(WT);function fv(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function pm(e,i){var r=Md([],i,e);return lc(r,r,1/r[3]),r}function o5(e,i){var r=e%i;return r<0?i+r:r}function s5(e,i,r){return r*i+(1-r)*e}function Ip(e,i){if(!e)throw new Error(i||"viewport-mercator-project: assertion failed.")}var Wc=Math.PI,D1=Wc/4,ah=Wc/180,F1=180/Wc,n0=512,i0=4003e4,XT=1.5;function B1(e){return Math.pow(2,e)}function YT(e){return Math.log2(e)}function dm(e,i){var r=(0,ie.Z)(e,2),n=r[0],o=r[1];Ip(Number.isFinite(n)&&Number.isFinite(i)),Ip(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude"),i*=n0;var s=n*ah,p=o*ah,y=i*(s+Wc)/(2*Wc),_=i*(Wc-Math.log(Math.tan(D1+p*.5)))/(2*Wc);return[y,_]}function a0(e,i){var r=(0,ie.Z)(e,2),n=r[0],o=r[1];i*=n0;var s=n/i*(2*Wc)-Wc,p=2*(Math.atan(Math.exp(Wc-o/i*(2*Wc)))-D1);return[s*F1,p*F1]}function u5(e){var i=e.latitude;assert(Number.isFinite(i));var r=Math.cos(i*ah);return YT(i0*r)-9}function N1(e){var i=e.latitude,r=e.longitude,n=e.zoom,o=e.scale,s=e.highPrecision,p=s===void 0?!1:s;o=o!==void 0?o:B1(n),Ip(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(o));var y={},_=n0*o,E=Math.cos(i*ah),T=_/360,P=T/E,D=_/i0/E;if(y.pixelsPerMeter=[D,-D,D],y.metersPerPixel=[1/D,-1/D,1/D],y.pixelsPerDegree=[T,-P,D],y.degreesPerPixel=[1/T,-1/P,1/D],p){var z=ah*Math.tan(i*ah)/E,J=T*z/2,oe=_/i0*z,he=oe/P*D;y.pixelsPerDegree2=[0,-J,oe],y.pixelsPerMeter2=[he,0,he]}return y}function l5(e,i){var r=_slicedToArray(e,3),n=r[0],o=r[1],s=r[2],p=_slicedToArray(i,3),y=p[0],_=p[1],E=p[2],T=1,P=N1({longitude:n,latitude:o,scale:T,highPrecision:!0}),D=P.pixelsPerMeter,z=P.pixelsPerMeter2,J=dm(e,T);J[0]+=y*(D[0]+z[0]*_),J[1]+=_*(D[1]+z[1]*_);var oe=a0(J,T),he=(s||0)+(E||0);return Number.isFinite(s)||Number.isFinite(E)?[oe[0],oe[1],he]:oe}function qT(e){var i=e.height,r=e.pitch,n=e.bearing,o=e.altitude,s=e.center,p=s===void 0?null:s,y=e.flipY,_=y===void 0?!1:y,E=fv();return Ar(E,E,[0,0,-o]),at(E,E,[1,1,1/i]),Sr(E,E,-r*ah),fr(E,E,n*ah),_&&at(E,E,[1,-1,1]),p&&Ar(E,E,Ka.negate([],p)),E}function KT(e){var i=e.width,r=e.height,n=e.altitude,o=n===void 0?XT:n,s=e.pitch,p=s===void 0?0:s,y=e.nearZMultiplier,_=y===void 0?1:y,E=e.farZMultiplier,T=E===void 0?1:E,P=p*ah,D=Math.atan(.5/o),z=Math.sin(D)*o/Math.sin(Math.PI/2-P-D),J=Math.cos(Math.PI/2-P)*z+o;return{fov:2*Math.atan(r/2/o),aspect:i/r,focalDistance:o,near:_,far:J*T}}function $T(e){var i=e.width,r=e.height,n=e.pitch,o=e.altitude,s=e.nearZMultiplier,p=e.farZMultiplier,y=KT({width:i,height:r,altitude:o,pitch:n,nearZMultiplier:s,farZMultiplier:p}),_=y.fov,E=y.aspect,T=y.near,P=y.far,D=Fi([],_,E,T,P);return D}function JT(e,i){var r=(0,ie.Z)(e,3),n=r[0],o=r[1],s=r[2],p=s===void 0?0:s;return Ip(Number.isFinite(n)&&Number.isFinite(o)&&Number.isFinite(p)),pm(i,[n,o,p,1])}function z1(e,i){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,ie.Z)(e,3),o=n[0],s=n[1],p=n[2];if(Ip(Number.isFinite(o)&&Number.isFinite(s),"invalid pixel coordinate"),Number.isFinite(p)){var y=pm(i,[o,s,p,1]);return y}var _=pm(i,[o,s,0,1]),E=pm(i,[o,s,1,1]),T=_[2],P=E[2],D=T===P?0:((r||0)-T)/(P-T);return zi.t7([],_,E,D)}var U1=fv(),QT=function(){function e(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=i.width,n=i.height,o=i.viewMatrix,s=o===void 0?U1:o,p=i.projectionMatrix,y=p===void 0?U1:p;(0,lt.Z)(this,e),this.width=r||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=s,this.projectionMatrix=y;var _=fv();vr(_,_,this.projectionMatrix),vr(_,_,this.viewMatrix),this.viewProjectionMatrix=_;var E=fv();at(E,E,[this.width/2,-this.height/2,1]),Ar(E,E,[1,-1,0]),vr(E,E,this.viewProjectionMatrix);var T=Mr(fv(),E);if(!T)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=E,this.pixelUnprojectionMatrix=T,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Lt.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&jo(r.projectionMatrix,this.projectionMatrix)&&jo(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n.topLeft,s=o===void 0?!0:o,p=this.projectPosition(r),y=JT(p,this.pixelProjectionMatrix),_=(0,ie.Z)(y,2),E=_[0],T=_[1],P=s?T:this.height-T;return r.length===2?[E,P]:[E,P,y[2]]}},{key:"unproject",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=n.topLeft,s=o===void 0?!0:o,p=n.targetZ,y=(0,ie.Z)(r,3),_=y[0],E=y[1],T=y[2],P=s?E:this.height-E,D=p&&p*this.pixelsPerMeter,z=z1([_,P,T],this.pixelUnprojectionMatrix,D),J=this.unprojectPosition(z),oe=(0,ie.Z)(J,3),he=oe[0],De=oe[1],it=oe[2];return Number.isFinite(T)?[he,De,it]:Number.isFinite(p)?[he,De,p]:[he,De]}},{key:"projectPosition",value:function(r){var n=this.projectFlat(r),o=(0,ie.Z)(n,2),s=o[0],p=o[1],y=(r[2]||0)*this.pixelsPerMeter;return[s,p,y]}},{key:"unprojectPosition",value:function(r){var n=this.unprojectFlat(r),o=(0,ie.Z)(n,2),s=o[0],p=o[1],y=(r[2]||0)/this.pixelsPerMeter;return[s,p,y]}},{key:"projectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function eM(e){var i=e.width,r=e.height,n=e.bounds,o=e.minExtent,s=o===void 0?0:o,p=e.maxZoom,y=p===void 0?24:p,_=e.padding,E=_===void 0?0:_,T=e.offset,P=T===void 0?[0,0]:T,D=(0,ie.Z)(n,2),z=(0,ie.Z)(D[0],2),J=z[0],oe=z[1],he=(0,ie.Z)(D[1],2),De=he[0],it=he[1];if(Number.isFinite(E)){var ht=E;E={top:ht,bottom:ht,left:ht,right:ht}}else Ip(Number.isFinite(E.top)&&Number.isFinite(E.bottom)&&Number.isFinite(E.left)&&Number.isFinite(E.right));var _t=new Z1({width:i,height:r,longitude:0,latitude:0,zoom:0}),jt=_t.project([J,it]),Vt=_t.project([De,oe]),rr=[Math.max(Math.abs(Vt[0]-jt[0]),s),Math.max(Math.abs(Vt[1]-jt[1]),s)],yr=[i-E.left-E.right-Math.abs(P[0])*2,r-E.top-E.bottom-Math.abs(P[1])*2];Ip(yr[0]>0&&yr[1]>0);var Yr=yr[0]/rr[0],fn=yr[1]/rr[1],Or=(E.right-E.left)/2/Yr,Tn=(E.bottom-E.top)/2/fn,Bn=[(Vt[0]+jt[0])/2+Or,(Vt[1]+jt[1])/2+Tn],hi=_t.unproject(Bn),vo=_t.zoom+Math.log2(Math.abs(Math.min(Yr,fn)));return{longitude:hi[0],latitude:hi[1],zoom:Math.min(vo,y)}}var Z1=function(e){(0,xn.Z)(i,e);function i(){var r,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=n.width,s=n.height,p=n.latitude,y=p===void 0?0:p,_=n.longitude,E=_===void 0?0:_,T=n.zoom,P=T===void 0?0:T,D=n.pitch,z=D===void 0?0:D,J=n.bearing,oe=J===void 0?0:J,he=n.altitude,De=he===void 0?1.5:he,it=n.nearZMultiplier,ht=n.farZMultiplier;(0,lt.Z)(this,i),o=o||1,s=s||1;var _t=B1(P);De=Math.max(.75,De);var jt=dm([E,y],_t);jt[2]=0;var Vt=$T({width:o,height:s,pitch:z,bearing:oe,altitude:De,nearZMultiplier:it||1/s,farZMultiplier:ht||1.01}),rr=qT({height:s,center:jt,pitch:z,bearing:oe,altitude:De,flipY:!0});return r=(0,dn.Z)(this,(0,Kt.Z)(i).call(this,{width:o,height:s,viewMatrix:rr,projectionMatrix:Vt})),r.latitude=y,r.longitude=E,r.zoom=P,r.pitch=z,r.bearing=oe,r.altitude=De,r.scale=_t,r.center=jt,r.pixelsPerMeter=N1((0,xe.Z)((0,xe.Z)(r))).pixelsPerMeter[2],Object.freeze((0,xe.Z)((0,xe.Z)(r))),r}return(0,Lt.Z)(i,[{key:"projectFlat",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return dm(n,o)}},{key:"unprojectFlat",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a0(n,o)}},{key:"getMapCenterByLngLatPosition",value:function(n){var o=n.lngLat,s=n.pos,p=z1(s,this.pixelUnprojectionMatrix),y=dm(o,this.scale),_=zi.IH([],y,zi.tk([],p)),E=zi.IH([],this.center,_);return a0(E,this.scale)}},{key:"getLocationAtPoint",value:function(n){var o=n.lngLat,s=n.pos;return this.getMapCenterByLngLatPosition({lngLat:o,pos:s})}},{key:"fitBounds",value:function(n){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=this.width,p=this.height,y=eM(Object.assign({width:s,height:p,bounds:n},o)),_=y.longitude,E=y.latitude,T=y.zoom;return new i({width:s,height:p,longitude:_,latitude:E,zoom:T})}}]),i}(QT),tM=function(){function e(){(0,lt.Z)(this,e),(0,I.Z)(this,"viewport",void 0)}return(0,Lt.Z)(e,[{key:"syncWithMapCamera",value:function(r){var n=r.center,o=r.zoom,s=r.pitch,p=r.bearing,y=r.viewportHeight,_=r.viewportWidth;this.viewport=new Z1({width:_,height:y,longitude:n&&n[0],latitude:n&&n[1],zoom:o,pitch:s,bearing:p})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,n){return this.viewport.projectFlat(r,n)}}]),e}(),j1={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},rM=["id","attributionControl","style","token","rotation","mapInstance"],V1,G1,H1,W1,X1,Y1,xd,q1,K1,$1,J1;function Q1(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function nM(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?Q1(Object(r),!0).forEach(function(n){(0,I.Z)(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q1(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var o=i.head||i.getElementsByTagName("head")[0];if(!o){o=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(o,s):i.documentElement.appendChild(o)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),o.appendChild(p),p}}iM(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=cv();var ex={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},aM=0,oM=12,tx="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",sM=(V1=(0,zr.b2)(),G1=(0,zr.f3)(Qt.MapConfig),H1=(0,zr.f3)(Qt.IGlobalConfigService),W1=(0,zr.f3)(Qt.ICoordinateSystemService),X1=(0,zr.f3)(Qt.IEventEmitter),V1(Y1=(xd=function(){function e(){var i=this;(0,lt.Z)(this,e),(0,I.Z)(this,"version",wp.MAPBOX),(0,I.Z)(this,"map",void 0),(0,I.Z)(this,"dragging",!1),(0,I.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),mr(this,"config",q1,this),mr(this,"configService",K1,this),mr(this,"coordinateSystemService",$1,this),mr(this,"eventEmitter",J1,this),(0,I.Z)(this,"viewport",void 0),(0,I.Z)(this,"markerContainer",void 0),(0,I.Z)(this,"cameraChangedCallback",void 0),(0,I.Z)(this,"$mapContainer",void 0),(0,I.Z)(this,"handleCameraChanged",function(){var r=i.map.getCenter().wrap(),n=r.lat,o=r.lng;i.emit("mapchange"),i.viewport.syncWithMapCamera({bearing:i.map.getBearing(),center:[o,n],viewportHeight:i.map.transform.height,pitch:i.map.getPitch(),viewportWidth:i.map.transform.width,zoom:i.map.getZoom(),cameraHeight:0});var s=i.config.offsetZoom,p=s===void 0?oM:s;i.viewport.getZoom()>p?i.coordinateSystemService.setCoordinateSystem(Te.LNGLAT_OFFSET):i.coordinateSystemService.setCoordinateSystem(Te.LNGLAT),i.cameraChangedCallback(i.viewport)})}return(0,Lt.Z)(e,[{key:"setBgColor",value:function(r){this.bgColor=r}},{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=pa("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,n){Wb.indexOf(r)!==-1?this.eventEmitter.on(r,n):this.map.on(ex[r]||r,n)}},{key:"off",value:function(r,n){this.map.off(ex[r]||r,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,n){this.map.zoomIn(r,n)}},{key:"zoomOut",value:function(r,n){this.map.zoomOut(r,n)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r,n){this.panTo([r,n])}},{key:"fitBounds",value:function(r,n){this.map.fitBounds(r,n)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,n){this.map.flyTo({zoom:r,center:n})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToCoord",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},o=this.lngLatToMercator(r,0),s=o.x,p=o.y;return[s-n.x,p-n.y]}},{key:"lngLatToMercator",value:function(r,n){var o=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),s=o.x,p=s===void 0?0:s,y=o.y,_=y===void 0?0:y,E=o.z,T=E===void 0?0:E;return{x:p,y:_,z:T}}},{key:"getModelMatrix",value:function(r,n,o){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],p=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},y=window.mapboxgl.MercatorCoordinate.fromLngLat(r,n),_=y.meterInMercatorCoordinateUnits(),E=Mt();return Ar(E,E,Ka.fromValues(y.x-p.x,y.y-p.y,y.z||0-p.z)),at(E,E,Ka.fromValues(_*s[0],-_*s[1],_*s[2])),Sr(E,E,o[0]),Ur(E,E,o[1]),fr(E,E,o[2]),E}},{key:"init",value:function(){var i=(0,An.Z)(Ai().mark(function n(){var o=this,s,p,y,_,E,T,P,D,z,J,oe,he,De;return Ai().wrap(function(ht){for(;;)switch(ht.prev=ht.next){case 0:s=this.config,p=s.id,y=p===void 0?"map":p,_=s.attributionControl,E=_===void 0?!1:_,T=s.style,P=T===void 0?"light":T,D=s.token,z=D===void 0?tx:D,J=s.rotation,oe=J===void 0?0:J,he=s.mapInstance,De=(0,cc.Z)(s,rM),this.viewport=new tM,!he&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),z===tx&&P!=="blank"&&!window.mapboxgl.accessToken&&!he&&console.warn(this.configService.getSceneWarninfo("MapToken")),!he&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=z),he?(this.map=he,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(y),this.map=new window.mapboxgl.Map(nM({container:this.$mapContainer,style:this.getMapStyle(P),attributionControl:E,bearing:oe},De))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.map.on("dragstart",function(){return o.dragging=!0,""}),this.map.on("dragend",function(){return o.dragging=!1,""}),this.handleCameraChanged();case 11:case"end":return ht.stop()}},n,this)}));function r(){return i.apply(this,arguments)}return r}()},{key:"destroy",value:function(){var r,n;(r=this.$mapContainer)===null||r===void 0||(n=r.parentNode)===null||n===void 0||n.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var n,o=arguments.length,s=new Array(o>1?o-1:0),p=1;p<o;p++)s[p-1]=arguments[p];(n=this.eventEmitter).emit.apply(n,[r].concat(s))}},{key:"once",value:function(r){for(var n,o=arguments.length,s=new Array(o>1?o-1:0),p=1;p<o;p++)s[p-1]=arguments[p];(n=this.eventEmitter).once.apply(n,[r].concat(s))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(r,n){var o=new(cv()).LngLat(r[0],r[1]),s=new(cv()).LngLat(n[0],n[1]),p=o.distanceTo(s),y=cv().MercatorCoordinate.fromLngLat({lng:r[0],lat:r[1]}),_=cv().MercatorCoordinate.fromLngLat({lng:n[0],lat:n[1]}),E=y.x,T=y.y,P=_.x,D=_.y,z=Math.sqrt(Math.pow(E-P,2)+Math.pow(T-D,2))*4194304*2;return z/p}},{key:"exportMap",value:function(r){var n=this.map.getCanvas(),o=r==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return o}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var n=r;typeof r=="string"&&(n=document.getElementById(r));var o=document.createElement("div");return o.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,o.id="l7_mapbox_div"+aM++,n.appendChild(o),o}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:j1[r]?j1[r]:r}}]),e}(),q1=ur(xd.prototype,"config",[G1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),K1=ur(xd.prototype,"configService",[H1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$1=ur(xd.prototype,"coordinateSystemService",[W1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),J1=ur(xd.prototype,"eventEmitter",[X1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd))||Y1);function uM(e){var i=lM();return function(){var n=(0,Kt.Z)(e),o;if(i){var s=(0,Kt.Z)(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return(0,dn.Z)(this,o)}}function lM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function cM(e,i){var r=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(r||n)&&(i||(i=document),!!i)){var o=i.head||i.getElementsByTagName("head")[0];if(!o){o=i.createElement("head");var s=i.body||i.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(o,s):i.documentElement.appendChild(o)}var p=i.createElement("style");return p.type="text/css",p.styleSheet?p.styleSheet.cssText=e:p.appendChild(i.createTextNode(e)),o.appendChild(p),p}}cM(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var fM=function(e){(0,xn.Z)(r,e);var i=uM(r);function r(){return(0,lt.Z)(this,r),i.apply(this,arguments)}return(0,Lt.Z)(r,[{key:"getServiceConstructor",value:function(){return sM}}]),r}(HT);function rx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function nx(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?rx(Object(r),!0).forEach(function(n){hM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function pM(e,i){return gM(e)||mM(e,i)||vM(e,i)||dM()}function dM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vM(e,i){if(!!e){if(typeof e=="string")return ix(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ix(e,i)}}function ix(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function mM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,s=!1,p,y;try{for(r=r.call(e);!(o=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));o=!0);}catch(_){s=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(s)throw y}}return n}}function gM(e){if(Array.isArray(e))return e}var yM=Ce.memo(function(e){var i=e.style,r=e.className,n=e.map,o=e.option,s=e.onSceneLoaded,p=(0,Ce.createRef)(),y=(0,Ce.useState)(),_=pM(y,2),E=_[0],T=_[1];return(0,Ce.useEffect)(function(){var P=new RE(nx(nx({id:p.current},o),{},{map:new fM(n)}));return P.on("loaded",function(){T(P),s&&s(P)}),function(){P.destroy()}},[]),(0,Ce.useEffect)(function(){E&&n.style&&E.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,Ce.useEffect)(function(){E&&n.zoom&&E.setZoom(n.zoom)},[n.zoom]),(0,Ce.useEffect)(function(){E&&n.center&&E.setCenter(n.center)},[JSON.stringify(n.center)]),(0,Ce.useEffect)(function(){E&&n.pitch!==void 0&&E.setPitch(n.pitch||0)},[n.pitch]),(0,Ce.useEffect)(function(){E&&n.rotation&&E.setRotation(n.rotation)},[n.rotation]),Ce.createElement(Cr.Provider,{value:E},(0,Ce.createElement)("div",{ref:p,style:i,className:r},E&&e.children))}),_M=yM;function ax(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function c5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?ax(Object(r),!0).forEach(function(n){xM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ax(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function xM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function f5(e,i){return CM(e)||SM(e,i)||EM(e,i)||bM()}function bM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EM(e,i){if(!!e){if(typeof e=="string")return ox(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ox(e,i)}}function ox(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function SM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,s=!1,p,y;try{for(r=r.call(e);!(o=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));o=!0);}catch(_){s=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(s)throw y}}return n}}function CM(e){if(Array.isArray(e))return e}var h5=null,p5=null;function sx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function d5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?sx(Object(r),!0).forEach(function(n){wM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function wM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function v5(e,i){return PM(e)||MM(e,i)||TM(e,i)||AM()}function AM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TM(e,i){if(!!e){if(typeof e=="string")return ux(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ux(e,i)}}function ux(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function MM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,s=!1,p,y;try{for(r=r.call(e);!(o=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));o=!0);}catch(_){s=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(s)throw y}}return n}}function PM(e){if(Array.isArray(e))return e}var m5=null,g5=null;function y5(e,i){return LM(e)||RM(e,i)||OM(e,i)||IM()}function IM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function OM(e,i){if(!!e){if(typeof e=="string")return lx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lx(e,i)}}function lx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function RM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,s=!1,p,y;try{for(r=r.call(e);!(o=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));o=!0);}catch(_){s=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(s)throw y}}return n}}function LM(e){if(Array.isArray(e))return e}var _5=null,x5=null;function cx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function b5(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?cx(Object(r),!0).forEach(function(n){kM(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kM(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function E5(e,i){if(e==null)return{};var r=DM(e,i),n,o;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)n=s[o],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function DM(e,i){if(e==null)return{};var r={},n=Object.keys(e),o,s;for(s=0;s<n.length;s++)o=n[s],!(i.indexOf(o)>=0)&&(r[o]=e[o]);return r}var S5=null,fx=R(73935);function hx(e,i){return zM(e)||NM(e,i)||BM(e,i)||FM()}function FM(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function BM(e,i){if(!!e){if(typeof e=="string")return px(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return px(e,i)}}function px(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function NM(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,s=!1,p,y;try{for(r=r.call(e);!(o=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));o=!0);}catch(_){s=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(s)throw y}}return n}}function zM(e){if(Array.isArray(e))return e}var dx=Ce.useEffect,vx=Ce.useState,UM=/\B([A-Z])/g,ZM=function(i){return i.replace(UM,"-$1").toLowerCase()};function C5(e){var i=e.className,r=e.style,n=e.children,o=e.position,s=vx(),p=hx(s,2),y=p[0],_=p[1],E=useSceneValue(),T=vx(function(){return document.createElement("div")}),P=hx(T,1),D=P[0];return dx(function(){var z=new Control({position:o});return z.onAdd=function(){if(i&&(D.className=i),r){var J=Object.keys(r).map(function(oe){return"".concat(ZM(oe),":").concat(r[oe])}).join(";");D.style.cssText=J}return D},z.onRemove=function(){},_(z),E.addControl(z),function(){E.removeControl(z)}},[]),dx(function(){y&&y.setPosition(o||"bottomleft")},[o]),createPortal(n,D)}var mx=(0,Ce.createContext)({});function w5(){return useContext(mx)}var Cf=R(96486),A5=Ce.useEffect,jM=Ce.memo(function(i){var r=i.layer,n=i.active;return r.active(n.option),null},Cf.isEqual),T5=Ce.useEffect,VM=Ce.memo(function(i){var r=i.layer,n=i.animate;return r.animate(n),null},Cf.isEqual),M5=Ce.useEffect,GM=Ce.memo(function(i){var r=i.layer,n=i.color;return n.field?r.color(n.field,n.values):r.color(n.values),null},Cf.isEqual),HM=Ce.memo(function(i){var r=i.layer,n=i.filter;return n.field&&r.filter(n.field,n.values),null},Cf.isEqual),WM=Ce.memo(function(i){var r=i.layer,n=i.scale;return r.scale(n.values),null},Cf.isEqual),P5=Ce.useEffect,XM=Ce.memo(function(i){var r=i.layer,n=i.select;return r.select(n.option),null},Cf.isEqual),YM=Ce.memo(function(i){var r=i.layer,n=i.shape;return n.field?r.shape(n.field,n.values):r.shape(n.values),null},Cf.isEqual),qM=Ce.memo(function(i){var r=i.layer,n=i.size;return n.field?r.size(n.field,n.values):r.size(n.values),null},Cf.isEqual),KM=["data"];function $M(e,i){if(e==null)return{};var r=JM(e,i),n,o;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)n=s[o],!(i.indexOf(n)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,n)||(r[n]=e[n]))}return r}function JM(e,i){if(e==null)return{};var r={},n=Object.keys(e),o,s;for(s=0;s<n.length;s++)o=n[s],!(i.indexOf(o)>=0)&&(r[o]=e[o]);return r}var QM=Ce.memo(function(i){var r=i.layer,n=i.source,o=n.data,s=$M(n,KM);return r.inited?r.setData(o,s):r.source(o,s),s.autoFit&&r.fitBounds(s&&s.fitBoundsOptions),null},Cf.isEqual),I5=Ce.useEffect,eP=Ce.memo(function(i){var r=i.layer,n=i.style;return r.style(n),null},Cf.isEqual);function tP(e,i){return aP(e)||iP(e,i)||nP(e,i)||rP()}function rP(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nP(e,i){if(!!e){if(typeof e=="string")return gx(e,i);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gx(e,i)}}function gx(e,i){(i==null||i>e.length)&&(i=e.length);for(var r=0,n=new Array(i);r<i;r++)n[r]=e[r];return n}function iP(e,i){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n=[],o=!0,s=!1,p,y;try{for(r=r.call(e);!(o=(p=r.next()).done)&&(n.push(p.value),!(i&&n.length===i));o=!0);}catch(_){s=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(s)throw y}}return n}}function aP(e){if(Array.isArray(e))return e}var hv=Ce.useEffect,oP=Ce.useState;function yx(e,i){var r=i.source,n=i.color,o=i.shape,s=i.style,p=i.size,y=i.scale,_=i.active,E=i.select,T=i.filter,P=i.animate,D=i.options,z=i.onLayerLoaded,J=Wn(),oe=oP(function(){var it;switch(e){case"polygonLayer":it=new Sy(D);break;case"lineLayer":it=new ZS(D);break;case"pointLayer":it=new kC(D);break;case"heatmapLayer":it=new X2(D);break;case"rasterLayer":it=new sw(D);break;case"imageLayer":it=new nS(D);break;case"citybuildingLayer":it=new y2(D);break;default:it=new Sy(D)}return it.on("inited",function(){z&&z(it,J)}),it}),he=tP(oe,1),De=he[0];return hv(function(){return J.addLayer(De),function(){J.removeLayer(De)}},[]),hv(function(){De.inited&&D&&De.updateLayerConfig(D)},[D==null?void 0:D.minZoom,D==null?void 0:D.maxZoom,D==null?void 0:D.visible]),hv(function(){De.inited&&(D==null?void 0:D.zIndex)&&De.setIndex(D.zIndex)},[D==null?void 0:D.zIndex]),hv(function(){De.inited&&(D==null?void 0:D.blend)&&De.setBlend(D.blend)},[D==null?void 0:D.blend]),hv(function(){J.render()}),Ce.createElement(mx.Provider,{value:De},Ce.createElement(QM,{layer:De,source:r}),y&&Ce.createElement(WM,{layer:De,scale:y}),n&&Ce.createElement(GM,{layer:De,color:n}),p&&Ce.createElement(qM,{layer:De,size:p}),o&&Ce.createElement(YM,{layer:De,shape:o}),s&&Ce.createElement(eP,{layer:De,style:s}),_&&Ce.createElement(jM,{layer:De,active:_}),E&&Ce.createElement(XM,{layer:De,select:E}),T&&Ce.createElement(HM,{layer:De,filter:T}),P&&Ce.createElement(VM,{layer:De,animate:P}),i.children)}var O5=null,R5=null,_x=Ce.memo(function(i){return yx("pointLayer",i)}),sP=Ce.memo(function(i){return yx("heatmapLayer",i)}),L5=null,k5=null,D5=null,F5=Ce.useEffect,B5=null,N5=null;function vm(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vm=function(r){return typeof r}:vm=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},vm(e)}function xx(e,i){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);i&&(n=n.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,n)}return r}function mm(e){for(var i=1;i<arguments.length;i++){var r=arguments[i]!=null?arguments[i]:{};i%2?xx(Object(r),!0).forEach(function(n){uP(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xx(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function uP(e,i,r){return i in e?Object.defineProperty(e,i,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[i]=r,e}function lP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function bx(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function cP(e,i,r){return i&&bx(e.prototype,i),r&&bx(e,r),e}function fP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&o0(e,i)}function o0(e,i){return o0=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},o0(e,i)}function hP(e){var i=vP();return function(){var n=gm(e),o;if(i){var s=gm(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return pP(this,o)}}function pP(e,i){if(i&&(vm(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dP(e)}function dP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function gm(e){return gm=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},gm(e)}var z5=function(e){fP(r,e);var i=hP(r);function r(n){var o;return lP(this,r),o=i.call(this,n),o.el=void 0,o.scene=void 0,o.popup=void 0,o.el=document.createElement("div"),o}return cP(r,[{key:"componentDidMount",value:function(){var o,s=this.props,p=s.lnglat,y=s.children,_=s.option,E=s.lngLat,T=new pg(mm(mm({},_),{},{stopPropagation:(o=this.props.option)===null||o===void 0?void 0:o.stopPropagation}));p&&T.setLnglat(p),E&&T.setLnglat(E),y&&T.setDOMContent(this.el),this.popup=T,this.scene.addPopup(T)}},{key:"componentDidUpdate",value:function(o){var s,p,y,_,E,T,P=Array.isArray(o.lnglat)?o.lnglat:[o==null||(s=o.lnglat)===null||s===void 0?void 0:s.lng,o==null||(p=o.lnglat)===null||p===void 0?void 0:p.lat],D=Array.isArray(this.props.lnglat)?this.props.lnglat:[(y=this.props)===null||y===void 0||(_=y.lnglat)===null||_===void 0?void 0:_.lng,(E=this.props)===null||E===void 0||(T=E.lnglat)===null||T===void 0?void 0:T.lat],z=P.toString()!==D.toString();if(z){var J;this.popup.remove(),this.popup=new pg(mm(mm({},this.props.option),{},{stopPropagation:(J=this.props.option)===null||J===void 0?void 0:J.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var o=this;return Ce.createElement(Cr.Consumer,{},function(s){return s&&(o.scene=s),(0,fx.createPortal)(o.props.children,o.el)})}}]),r}(Ce.PureComponent);function ym(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ym=function(r){return typeof r}:ym=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},ym(e)}function mP(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function Ex(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function gP(e,i,r){return i&&Ex(e.prototype,i),r&&Ex(e,r),e}function yP(e,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&s0(e,i)}function s0(e,i){return s0=Object.setPrototypeOf||function(n,o){return n.__proto__=o,n},s0(e,i)}function _P(e){var i=EP();return function(){var n=_m(e),o;if(i){var s=_m(this).constructor;o=Reflect.construct(n,arguments,s)}else o=n.apply(this,arguments);return xP(this,o)}}function xP(e,i){if(i&&(ym(i)==="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return bP(e)}function bP(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function EP(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function _m(e){return _m=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},_m(e)}var U5=function(e){yP(r,e);var i=_P(r);function r(n){var o;return mP(this,r),o=i.call(this,n),o.el=void 0,o.scene=void 0,o.marker=void 0,o.el=document.createElement("div"),o}return gP(r,[{key:"componentDidMount",value:function(){var o=this.props,s=o.lnglat,p=o.children,y=o.option,_=o.onMarkerLoaded,E=new ug(y);s&&E.setLnglat(s),p&&E.setElement(this.el),this.marker=E,_&&_(E),this.scene.addMarker(E)}},{key:"componentDidUpdate",value:function(o){var s,p=(o==null?void 0:o.lnglat.toString())!==((s=this.props)===null||s===void 0?void 0:s.lnglat.toString());p&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var o=this;return Ce.createElement(Cr.Consumer,{},function(s){return s&&(o.scene=s),(0,fx.createPortal)(o.props.children,o.el)})}}]),r}(Ce.PureComponent),Z5=Ce.useEffect,j5=null,V5=null,G5=Ce.useEffect,H5=null,SP=R(83832),pi=R(85893),CP=["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],wP=function(e){(0,At.Z)(r,e);var i=(0,gt.Z)(r);function r(){var n;(0,Ye.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),n.state={data:null,grid:null,loading:!1},n}return(0,Fe.Z)(r,[{key:"componentDidMount",value:function(){var n=(0,Me.Z)(qt().mark(function s(){var p,y,_,E;return qt().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return P.next=2,Promise.all([fetch("https://gw.alipayobjects.com/os/bmw-prod/c5dba875-b6ea-4e88-b778-66a862906c93.json").then(function(D){return D.json()}),fetch("https://gw.alipayobjects.com/os/bmw-prod/8990e8b4-c58e-419b-afb9-8ea3daff2dd1.json").then(function(D){return D.json()})]);case 2:p=P.sent,y=(0,Wr.Z)(p,2),_=y[0],E=y[1],this.setState({data:_,grid:E,loading:!0});case 7:case"end":return P.stop()}},s,this)}));function o(){return n.apply(this,arguments)}return o}()},{key:"render",value:function(){var o=this.state,s=o.data,p=o.grid,y=o.loading;return y===!1?(0,pi.jsx)(SP.Z,{}):(0,pi.jsxs)(_M,{map:{center:[110.19382669582967,50.258134],pitch:0,style:"blank",zoom:1},style:{position:"relative",width:"100%",height:"452px"},children:[p&&(0,pi.jsx)(sP,{source:{data:p,transforms:[{type:"hexagon",size:8e5,field:"capacity",method:"sum"}]},color:{values:"#ddd"},shape:{values:"hexagon"},style:{coverage:.7,opacity:.8}},"1"),s&&[(0,pi.jsx)(_x,{options:{autoFit:!0},source:{data:s},scale:{values:{color:{field:"cum_conf",type:"quantile"},size:{field:"cum_conf",type:"log"}}},color:{field:"cum_conf",values:CP},shape:{values:"circle"},active:{option:{color:"#0c2c84"}},size:{field:"cum_conf",values:[0,30]},style:{opacity:.8}},"2"),(0,pi.jsx)(_x,{source:{data:s},color:{values:"#fff"},shape:{field:"Short_Name_ZH",values:"text"},filter:{field:"cum_conf",values:function(E){return E>2e3}},size:{values:12},style:{opacity:1,strokeOpacity:1,strokeWidth:0}},"5")]]})}}]),r}(Ce.Component),Sx=R(86582),AP=R(93343),TP=R(70499),Op=R.n(TP);function MP(e){return e*1<10?"0".concat(e):e}function Cx(){for(var e=[],i=0;i<24;i+=1)e.push({x:"".concat(MP(i),":00"),y:Math.floor(Math.random()*200)+i*50});return e}var PP=function(e){(0,At.Z)(r,e);var i=(0,gt.Z)(r);function r(){var n;(0,Ye.Z)(this,r);for(var o=arguments.length,s=new Array(o),p=0;p<o;p++)s[p]=arguments[p];return n=i.call.apply(i,[this].concat(s)),n.state={activeData:Cx()},n.timer=void 0,n.requestRef=void 0,n.loopData=function(){n.requestRef=requestAnimationFrame(function(){n.timer=window.setTimeout(function(){n.setState({activeData:Cx()},function(){n.loopData()})},1e3)})},n}return(0,Fe.Z)(r,[{key:"componentDidMount",value:function(){this.loopData()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.requestRef&&cancelAnimationFrame(this.requestRef)}},{key:"render",value:function(){var o=this.state.activeData,s=o===void 0?[]:o;return(0,pi.jsxs)("div",{className:Op().activeChart,children:[(0,pi.jsx)(ne.Z,{title:"\u76EE\u6807\u8BC4\u4F30",value:"\u6709\u671B\u8FBE\u5230\u9884\u671F"}),(0,pi.jsx)("div",{style:{marginTop:32},children:(0,pi.jsx)(AP.Z,{autoFit:!0,data:s.map(function(p){return p.y}),height:84})}),s&&(0,pi.jsxs)("div",{children:[(0,pi.jsxs)("div",{className:Op().activeChartGrid,children:[(0,pi.jsxs)("p",{children:[(0,Sx.Z)(s).sort()[s.length-1].y+200," \u4EBF\u5143"]}),(0,pi.jsxs)("p",{children:[(0,Sx.Z)(s).sort()[Math.floor(s.length/2)].y," \u4EBF\u5143"]})]}),(0,pi.jsx)("div",{className:Op().dashedLine,children:(0,pi.jsx)("div",{className:Op().line})}),(0,pi.jsx)("div",{className:Op().dashedLine,children:(0,pi.jsx)("div",{className:Op().line})})]}),s&&(0,pi.jsxs)("div",{className:Op().activeChartLegend,children:[(0,pi.jsx)("span",{children:"00:00"}),(0,pi.jsx)("span",{children:s[Math.floor(s.length/2)].x}),(0,pi.jsx)("span",{children:s[s.length-1].x})]})]})}}]),r}(Ce.Component);function IP(){return u0.apply(this,arguments)}function u0(){return u0=(0,Me.Z)(qt().mark(function e(){return qt().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,je.WY)("/api/tags"));case 1:case"end":return r.stop()}},e)})),u0.apply(this,arguments)}var OP=R(19134),Ax=R.n(OP),RP=ne.Z.Countdown,LP=Date.now()+1e3*60*60*24*2+1e3*30,kP=function(){var i=(0,je.QT)(IP),r=i.loading,n=i.data,o=(n==null?void 0:n.list)||[];return(0,pi.jsx)(kt.Z,{children:(0,pi.jsxs)(pi.Fragment,{children:[(0,pi.jsxs)(F.Z,{gutter:24,children:[(0,pi.jsx)(re.Z,{xl:18,lg:24,md:24,sm:24,xs:24,style:{marginBottom:24},children:(0,pi.jsxs)(v.Z,{title:"\u6D3B\u52A8\u5B9E\u65F6\u4EA4\u6613\u60C5\u51B5",bordered:!1,children:[(0,pi.jsxs)(F.Z,{children:[(0,pi.jsx)(re.Z,{md:6,sm:12,xs:24,children:(0,pi.jsx)(ne.Z,{title:"\u4ECA\u65E5\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:Ir()(124543233).format("0,0")})}),(0,pi.jsx)(re.Z,{md:6,sm:12,xs:24,children:(0,pi.jsx)(ne.Z,{title:"\u9500\u552E\u76EE\u6807\u5B8C\u6210\u7387",value:"92%"})}),(0,pi.jsx)(re.Z,{md:6,sm:12,xs:24,children:(0,pi.jsx)(RP,{title:"\u6D3B\u52A8\u5269\u4F59\u65F6\u95F4",value:LP,format:"HH:mm:ss:SSS"})}),(0,pi.jsx)(re.Z,{md:6,sm:12,xs:24,children:(0,pi.jsx)(ne.Z,{title:"\u6BCF\u79D2\u4EA4\u6613\u603B\u989D",suffix:"\u5143",value:Ir()(234).format("0,0")})})]}),(0,pi.jsx)("div",{className:Ax().mapChart,children:(0,pi.jsx)(wP,{})})]})}),(0,pi.jsxs)(re.Z,{xl:6,lg:24,md:24,sm:24,xs:24,children:[(0,pi.jsx)(v.Z,{title:"\u6D3B\u52A8\u60C5\u51B5\u9884\u6D4B",style:{marginBottom:24},bordered:!1,children:(0,pi.jsx)(PP,{})}),(0,pi.jsx)(v.Z,{title:"\u5238\u6838\u6548\u7387",style:{marginBottom:24},bodyStyle:{textAlign:"center"},bordered:!1,children:(0,pi.jsx)(ut,{height:180,autoFit:!0,percent:.87,range:{ticks:[0,1/4,2/4,3/4,1]},axis:{label:{formatter:function(p){return Number(p)*100}}},statistic:{content:{content:"\u4F18",style:{color:"#30bf78"}}}})})]})]}),(0,pi.jsxs)(F.Z,{gutter:24,children:[(0,pi.jsx)(re.Z,{xl:12,lg:24,sm:24,xs:24,style:{marginBottom:24},children:(0,pi.jsx)(v.Z,{title:"\u5404\u54C1\u7C7B\u5360\u6BD4",bordered:!1,className:Ax().pieCard,children:(0,pi.jsxs)(F.Z,{style:{padding:"16px 0"},children:[(0,pi.jsx)(re.Z,{span:8,children:(0,pi.jsx)($e.Z,{autoFit:!0,height:128,percent:.28})}),(0,pi.jsx)(re.Z,{span:8,children:(0,pi.jsx)($e.Z,{color:"#5DDECF",autoFit:!0,height:128,percent:.22})}),(0,pi.jsx)(re.Z,{span:8,children:(0,pi.jsx)($e.Z,{color:"#2FC25B",autoFit:!0,height:128,percent:.32})})]})})}),(0,pi.jsx)(re.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,pi.jsx)(v.Z,{title:"\u70ED\u95E8\u641C\u7D22",loading:r,bordered:!1,bodyStyle:{overflow:"hidden"},children:(0,pi.jsx)(Xt,{data:o,autoFit:!0,wordField:"name",weightField:"value",colorField:"name",height:162,wordStyle:{fontSize:[10,20]}})})}),(0,pi.jsx)(re.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,pi.jsx)(v.Z,{title:"\u8D44\u6E90\u5269\u4F59",bodyStyle:{textAlign:"center",fontSize:0},bordered:!1,children:(0,pi.jsx)(pt,{height:161,percent:.35,autoFit:!0,outline:{border:2,distance:4},padding:[0,0,0,0],statistic:{content:{style:{fontSize:"16px"}}}})})})]})]})})},DP=kP},9187:function(Ue){"use strict";Ue.exports=W,Ue.exports.default=W;function W(Me,Ye,Fe){Fe=Fe||2;var At=Ye&&Ye.length,gt=At?Ye[0]*Fe:Me.length,Nt=R(Me,0,gt,Fe,!0),qt=[];if(!Nt||Nt.next===Nt.prev)return qt;var Cr,Wn,hn,Yi,Un,Gn,di;if(At&&(Nt=re(Me,Ye,Nt,Fe)),Me.length>80*Fe){Cr=hn=Me[0],Wn=Yi=Me[1];for(var Xn=Fe;Xn<gt;Xn+=Fe)Un=Me[Xn],Gn=Me[Xn+1],Un<Cr&&(Cr=Un),Gn<Wn&&(Wn=Gn),Un>hn&&(hn=Un),Gn>Yi&&(Yi=Gn);di=Math.max(hn-Cr,Yi-Wn),di=di!==0?1/di:0}return $(Nt,qt,Fe,Cr,Wn,di),qt}function R(Me,Ye,Fe,At,gt){var Nt,qt;if(gt===Wr(Me,Ye,Fe,At)>0)for(Nt=Ye;Nt<Fe;Nt+=At)qt=kt(Nt,Me[Nt],Me[Nt+1],qt);else for(Nt=Fe-At;Nt>=Ye;Nt-=At)qt=kt(Nt,Me[Nt],Me[Nt+1],qt);return qt&&ut(qt,qt.next)&&(xr(qt),qt=qt.next),qt}function Y(Me,Ye){if(!Me)return Me;Ye||(Ye=Me);var Fe=Me,At;do if(At=!1,!Fe.steiner&&(ut(Fe,Fe.next)||st(Fe.prev,Fe,Fe.next)===0)){if(xr(Fe),Fe=Ye=Fe.prev,Fe===Fe.next)break;At=!0}else Fe=Fe.next;while(At||Fe!==Ye);return Ye}function $(Me,Ye,Fe,At,gt,Nt,qt){if(!!Me){!qt&&Nt&&et(Me,At,gt,Nt);for(var Cr=Me,Wn,hn;Me.prev!==Me.next;){if(Wn=Me.prev,hn=Me.next,Nt?ee(Me,At,gt,Nt):v(Me)){Ye.push(Wn.i/Fe),Ye.push(Me.i/Fe),Ye.push(hn.i/Fe),xr(Me),Me=hn.next,Cr=hn.next;continue}if(Me=hn,Me===Cr){qt?qt===1?(Me=F(Y(Me),Ye,Fe),$(Me,Ye,Fe,At,gt,Nt,2)):qt===2&&Q(Me,Ye,Fe,At,gt,Nt):$(Y(Me),Ye,Fe,At,gt,Nt,1);break}}}}function v(Me){var Ye=Me.prev,Fe=Me,At=Me.next;if(st(Ye,Fe,At)>=0)return!1;for(var gt=Me.next.next;gt!==Me.prev;){if(Wt(Ye.x,Ye.y,Fe.x,Fe.y,At.x,At.y,gt.x,gt.y)&&st(gt.prev,gt,gt.next)>=0)return!1;gt=gt.next}return!0}function ee(Me,Ye,Fe,At){var gt=Me.prev,Nt=Me,qt=Me.next;if(st(gt,Nt,qt)>=0)return!1;for(var Cr=gt.x<Nt.x?gt.x<qt.x?gt.x:qt.x:Nt.x<qt.x?Nt.x:qt.x,Wn=gt.y<Nt.y?gt.y<qt.y?gt.y:qt.y:Nt.y<qt.y?Nt.y:qt.y,hn=gt.x>Nt.x?gt.x>qt.x?gt.x:qt.x:Nt.x>qt.x?Nt.x:qt.x,Yi=gt.y>Nt.y?gt.y>qt.y?gt.y:qt.y:Nt.y>qt.y?Nt.y:qt.y,Un=nr(Cr,Wn,Ye,Fe,At),Gn=nr(hn,Yi,Ye,Fe,At),di=Me.prevZ,Xn=Me.nextZ;di&&di.z>=Un&&Xn&&Xn.z<=Gn;){if(di!==Me.prev&&di!==Me.next&&Wt(gt.x,gt.y,Nt.x,Nt.y,qt.x,qt.y,di.x,di.y)&&st(di.prev,di,di.next)>=0||(di=di.prevZ,Xn!==Me.prev&&Xn!==Me.next&&Wt(gt.x,gt.y,Nt.x,Nt.y,qt.x,qt.y,Xn.x,Xn.y)&&st(Xn.prev,Xn,Xn.next)>=0))return!1;Xn=Xn.nextZ}for(;di&&di.z>=Un;){if(di!==Me.prev&&di!==Me.next&&Wt(gt.x,gt.y,Nt.x,Nt.y,qt.x,qt.y,di.x,di.y)&&st(di.prev,di,di.next)>=0)return!1;di=di.prevZ}for(;Xn&&Xn.z<=Gn;){if(Xn!==Me.prev&&Xn!==Me.next&&Wt(gt.x,gt.y,Nt.x,Nt.y,qt.x,qt.y,Xn.x,Xn.y)&&st(Xn.prev,Xn,Xn.next)>=0)return!1;Xn=Xn.nextZ}return!0}function F(Me,Ye,Fe){var At=Me;do{var gt=At.prev,Nt=At.next.next;!ut(gt,Nt)&&Jt(gt,At,At.next,Nt)&&qe(gt,Nt)&&qe(Nt,gt)&&(Ye.push(gt.i/Fe),Ye.push(At.i/Fe),Ye.push(Nt.i/Fe),xr(At),xr(At.next),At=Me=Nt),At=At.next}while(At!==Me);return Y(At)}function Q(Me,Ye,Fe,At,gt,Nt){var qt=Me;do{for(var Cr=qt.next.next;Cr!==qt.prev;){if(qt.i!==Cr.i&&wt(qt,Cr)){var Wn=$e(qt,Cr);qt=Y(qt,qt.next),Wn=Y(Wn,Wn.next),$(qt,Ye,Fe,At,gt,Nt),$(Wn,Ye,Fe,At,gt,Nt);return}Cr=Cr.next}qt=qt.next}while(qt!==Me)}function re(Me,Ye,Fe,At){var gt=[],Nt,qt,Cr,Wn,hn;for(Nt=0,qt=Ye.length;Nt<qt;Nt++)Cr=Ye[Nt]*At,Wn=Nt<qt-1?Ye[Nt+1]*At:Me.length,hn=R(Me,Cr,Wn,At,!1),hn===hn.next&&(hn.steiner=!0),gt.push(xt(hn));for(gt.sort(Ee),Nt=0;Nt<gt.length;Nt++)Fe=ne(gt[Nt],Fe),Fe=Y(Fe,Fe.next);return Fe}function Ee(Me,Ye){return Me.x-Ye.x}function ne(Me,Ye){var Fe=je(Me,Ye);if(!Fe)return Ye;var At=$e(Fe,Me),gt=Y(Fe,Fe.next);return Y(At,At.next),Ye===Fe?gt:Ye}function je(Me,Ye){var Fe=Ye,At=Me.x,gt=Me.y,Nt=-Infinity,qt;do{if(gt<=Fe.y&&gt>=Fe.next.y&&Fe.next.y!==Fe.y){var Cr=Fe.x+(gt-Fe.y)*(Fe.next.x-Fe.x)/(Fe.next.y-Fe.y);if(Cr<=At&&Cr>Nt){if(Nt=Cr,Cr===At){if(gt===Fe.y)return Fe;if(gt===Fe.next.y)return Fe.next}qt=Fe.x<Fe.next.x?Fe:Fe.next}}Fe=Fe.next}while(Fe!==Ye);if(!qt)return null;if(At===Nt)return qt;var Wn=qt,hn=qt.x,Yi=qt.y,Un=Infinity,Gn;Fe=qt;do At>=Fe.x&&Fe.x>=hn&&At!==Fe.x&&Wt(gt<Yi?At:Nt,gt,hn,Yi,gt<Yi?Nt:At,gt,Fe.x,Fe.y)&&(Gn=Math.abs(gt-Fe.y)/(At-Fe.x),qe(Fe,Me)&&(Gn<Un||Gn===Un&&(Fe.x>qt.x||Fe.x===qt.x&&Ce(qt,Fe)))&&(qt=Fe,Un=Gn)),Fe=Fe.next;while(Fe!==Wn);return qt}function Ce(Me,Ye){return st(Me.prev,Me,Ye.prev)<0&&st(Ye.next,Me,Me.next)<0}function et(Me,Ye,Fe,At){var gt=Me;do gt.z===null&&(gt.z=nr(gt.x,gt.y,Ye,Fe,At)),gt.prevZ=gt.prev,gt.nextZ=gt.next,gt=gt.next;while(gt!==Me);gt.prevZ.nextZ=null,gt.prevZ=null,Pt(gt)}function Pt(Me){var Ye,Fe,At,gt,Nt,qt,Cr,Wn,hn=1;do{for(Fe=Me,Me=null,Nt=null,qt=0;Fe;){for(qt++,At=Fe,Cr=0,Ye=0;Ye<hn&&(Cr++,At=At.nextZ,!!At);Ye++);for(Wn=hn;Cr>0||Wn>0&&At;)Cr!==0&&(Wn===0||!At||Fe.z<=At.z)?(gt=Fe,Fe=Fe.nextZ,Cr--):(gt=At,At=At.nextZ,Wn--),Nt?Nt.nextZ=gt:Me=gt,gt.prevZ=Nt,Nt=gt;Fe=At}Nt.nextZ=null,hn*=2}while(qt>1);return Me}function nr(Me,Ye,Fe,At,gt){return Me=32767*(Me-Fe)*gt,Ye=32767*(Ye-At)*gt,Me=(Me|Me<<8)&16711935,Me=(Me|Me<<4)&252645135,Me=(Me|Me<<2)&858993459,Me=(Me|Me<<1)&1431655765,Ye=(Ye|Ye<<8)&16711935,Ye=(Ye|Ye<<4)&252645135,Ye=(Ye|Ye<<2)&858993459,Ye=(Ye|Ye<<1)&1431655765,Me|Ye<<1}function xt(Me){var Ye=Me,Fe=Me;do(Ye.x<Fe.x||Ye.x===Fe.x&&Ye.y<Fe.y)&&(Fe=Ye),Ye=Ye.next;while(Ye!==Me);return Fe}function Wt(Me,Ye,Fe,At,gt,Nt,qt,Cr){return(gt-qt)*(Ye-Cr)-(Me-qt)*(Nt-Cr)>=0&&(Me-qt)*(At-Cr)-(Fe-qt)*(Ye-Cr)>=0&&(Fe-qt)*(Nt-Cr)-(gt-qt)*(At-Cr)>=0}function wt(Me,Ye){return Me.next.i!==Ye.i&&Me.prev.i!==Ye.i&&!vt(Me,Ye)&&(qe(Me,Ye)&&qe(Ye,Me)&&pt(Me,Ye)&&(st(Me.prev,Me,Ye.prev)||st(Me,Ye.prev,Ye))||ut(Me,Ye)&&st(Me.prev,Me,Me.next)>0&&st(Ye.prev,Ye,Ye.next)>0)}function st(Me,Ye,Fe){return(Ye.y-Me.y)*(Fe.x-Ye.x)-(Ye.x-Me.x)*(Fe.y-Ye.y)}function ut(Me,Ye){return Me.x===Ye.x&&Me.y===Ye.y}function Jt(Me,Ye,Fe,At){var gt=Xt(st(Me,Ye,Fe)),Nt=Xt(st(Me,Ye,At)),qt=Xt(st(Fe,At,Me)),Cr=Xt(st(Fe,At,Ye));return!!(gt!==Nt&&qt!==Cr||gt===0&&X(Me,Fe,Ye)||Nt===0&&X(Me,At,Ye)||qt===0&&X(Fe,Me,At)||Cr===0&&X(Fe,Ye,At))}function X(Me,Ye,Fe){return Ye.x<=Math.max(Me.x,Fe.x)&&Ye.x>=Math.min(Me.x,Fe.x)&&Ye.y<=Math.max(Me.y,Fe.y)&&Ye.y>=Math.min(Me.y,Fe.y)}function Xt(Me){return Me>0?1:Me<0?-1:0}function vt(Me,Ye){var Fe=Me;do{if(Fe.i!==Me.i&&Fe.next.i!==Me.i&&Fe.i!==Ye.i&&Fe.next.i!==Ye.i&&Jt(Fe,Fe.next,Me,Ye))return!0;Fe=Fe.next}while(Fe!==Me);return!1}function qe(Me,Ye){return st(Me.prev,Me,Me.next)<0?st(Me,Ye,Me.next)>=0&&st(Me,Me.prev,Ye)>=0:st(Me,Ye,Me.prev)<0||st(Me,Me.next,Ye)<0}function pt(Me,Ye){var Fe=Me,At=!1,gt=(Me.x+Ye.x)/2,Nt=(Me.y+Ye.y)/2;do Fe.y>Nt!=Fe.next.y>Nt&&Fe.next.y!==Fe.y&&gt<(Fe.next.x-Fe.x)*(Nt-Fe.y)/(Fe.next.y-Fe.y)+Fe.x&&(At=!At),Fe=Fe.next;while(Fe!==Me);return At}function $e(Me,Ye){var Fe=new Ir(Me.i,Me.x,Me.y),At=new Ir(Ye.i,Ye.x,Ye.y),gt=Me.next,Nt=Ye.prev;return Me.next=Ye,Ye.prev=Me,Fe.next=gt,gt.prev=Fe,At.next=Fe,Fe.prev=At,Nt.next=At,At.prev=Nt,At}function kt(Me,Ye,Fe,At){var gt=new Ir(Me,Ye,Fe);return At?(gt.next=At.next,gt.prev=At,At.next.prev=gt,At.next=gt):(gt.prev=gt,gt.next=gt),gt}function xr(Me){Me.next.prev=Me.prev,Me.prev.next=Me.next,Me.prevZ&&(Me.prevZ.nextZ=Me.nextZ),Me.nextZ&&(Me.nextZ.prevZ=Me.prevZ)}function Ir(Me,Ye,Fe){this.i=Me,this.x=Ye,this.y=Fe,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}W.deviation=function(Me,Ye,Fe,At){var gt=Ye&&Ye.length,Nt=gt?Ye[0]*Fe:Me.length,qt=Math.abs(Wr(Me,0,Nt,Fe));if(gt)for(var Cr=0,Wn=Ye.length;Cr<Wn;Cr++){var hn=Ye[Cr]*Fe,Yi=Cr<Wn-1?Ye[Cr+1]*Fe:Me.length;qt-=Math.abs(Wr(Me,hn,Yi,Fe))}var Un=0;for(Cr=0;Cr<At.length;Cr+=3){var Gn=At[Cr]*Fe,di=At[Cr+1]*Fe,Xn=At[Cr+2]*Fe;Un+=Math.abs((Me[Gn]-Me[Xn])*(Me[di+1]-Me[Gn+1])-(Me[Gn]-Me[di])*(Me[Xn+1]-Me[Gn+1]))}return qt===0&&Un===0?0:Math.abs((Un-qt)/qt)};function Wr(Me,Ye,Fe,At){for(var gt=0,Nt=Ye,qt=Fe-At;Nt<Fe;Nt+=At)gt+=(Me[qt]-Me[Nt])*(Me[Nt+1]+Me[qt+1]),qt=Nt;return gt}W.flatten=function(Me){for(var Ye=Me[0][0].length,Fe={vertices:[],holes:[],dimensions:Ye},At=0,gt=0;gt<Me.length;gt++){for(var Nt=0;Nt<Me[gt].length;Nt++)for(var qt=0;qt<Ye;qt++)Fe.vertices.push(Me[gt][Nt][qt]);gt>0&&(At+=Me[gt-1].length,Fe.holes.push(At))}return Fe}},67709:function(Ue){function W(Y){var $=Y.target||Y.srcElement;$.__resizeRAF__&&cancelAnimationFrame($.__resizeRAF__),$.__resizeRAF__=requestAnimationFrame(function(){var v=$.__resizeTrigger__,ee=v&&v.__resizeListeners__;ee&&ee.forEach(function(F){F.call(v,Y)})})}var R=function($,v){var ee=this,F=ee.document,Q,re=F.attachEvent;typeof navigator!="undefined"&&(Q=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ee(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",W)}if(!$.__resizeListeners__)if($.__resizeListeners__=[],re)$.__resizeTrigger__=$,$.attachEvent("onresize",W);else{getComputedStyle($).position==="static"&&($.style.position="relative");var ne=$.__resizeTrigger__=F.createElement("object");ne.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),ne.setAttribute("class","resize-sensor"),ne.setAttribute("tabindex","-1"),ne.setAttribute("title",""),ne.__resizeElement__=$,ne.onload=Ee,ne.type="text/html",Q&&$.appendChild(ne),ne.data="about:blank",Q||$.appendChild(ne)}$.__resizeListeners__.push(v)};Ue.exports=typeof window=="undefined"?R:R.bind(window),Ue.exports.unbind=function(Y,$){var v=document.attachEvent,ee=Y.__resizeListeners__||[];if($){var F=ee.indexOf($);F!==-1&&ee.splice(F,1)}else ee=Y.__resizeListeners__=[];if(!ee.length){if(v)Y.detachEvent("onresize",W);else if(Y.__resizeTrigger__){var Q=Y.__resizeTrigger__.contentDocument,re=Q&&Q.defaultView;re&&(re.removeEventListener("resize",W),delete re.__resizeTrigger__),Y.__resizeTrigger__=!Y.removeChild(Y.__resizeTrigger__)}delete Y.__resizeListeners__}}},26729:function(Ue){"use strict";var W=Object.prototype.hasOwnProperty,R="~";function Y(){}Object.create&&(Y.prototype=Object.create(null),new Y().__proto__||(R=!1));function $(Q,re,Ee){this.fn=Q,this.context=re,this.once=Ee||!1}function v(Q,re,Ee,ne,je){if(typeof Ee!="function")throw new TypeError("The listener must be a function");var Ce=new $(Ee,ne||Q,je),et=R?R+re:re;return Q._events[et]?Q._events[et].fn?Q._events[et]=[Q._events[et],Ce]:Q._events[et].push(Ce):(Q._events[et]=Ce,Q._eventsCount++),Q}function ee(Q,re){--Q._eventsCount==0?Q._events=new Y:delete Q._events[re]}function F(){this._events=new Y,this._eventsCount=0}F.prototype.eventNames=function(){var re=[],Ee,ne;if(this._eventsCount===0)return re;for(ne in Ee=this._events)W.call(Ee,ne)&&re.push(R?ne.slice(1):ne);return Object.getOwnPropertySymbols?re.concat(Object.getOwnPropertySymbols(Ee)):re},F.prototype.listeners=function(re){var Ee=R?R+re:re,ne=this._events[Ee];if(!ne)return[];if(ne.fn)return[ne.fn];for(var je=0,Ce=ne.length,et=new Array(Ce);je<Ce;je++)et[je]=ne[je].fn;return et},F.prototype.listenerCount=function(re){var Ee=R?R+re:re,ne=this._events[Ee];return ne?ne.fn?1:ne.length:0},F.prototype.emit=function(re,Ee,ne,je,Ce,et){var Pt=R?R+re:re;if(!this._events[Pt])return!1;var nr=this._events[Pt],xt=arguments.length,Wt,wt;if(nr.fn){switch(nr.once&&this.removeListener(re,nr.fn,void 0,!0),xt){case 1:return nr.fn.call(nr.context),!0;case 2:return nr.fn.call(nr.context,Ee),!0;case 3:return nr.fn.call(nr.context,Ee,ne),!0;case 4:return nr.fn.call(nr.context,Ee,ne,je),!0;case 5:return nr.fn.call(nr.context,Ee,ne,je,Ce),!0;case 6:return nr.fn.call(nr.context,Ee,ne,je,Ce,et),!0}for(wt=1,Wt=new Array(xt-1);wt<xt;wt++)Wt[wt-1]=arguments[wt];nr.fn.apply(nr.context,Wt)}else{var st=nr.length,ut;for(wt=0;wt<st;wt++)switch(nr[wt].once&&this.removeListener(re,nr[wt].fn,void 0,!0),xt){case 1:nr[wt].fn.call(nr[wt].context);break;case 2:nr[wt].fn.call(nr[wt].context,Ee);break;case 3:nr[wt].fn.call(nr[wt].context,Ee,ne);break;case 4:nr[wt].fn.call(nr[wt].context,Ee,ne,je);break;default:if(!Wt)for(ut=1,Wt=new Array(xt-1);ut<xt;ut++)Wt[ut-1]=arguments[ut];nr[wt].fn.apply(nr[wt].context,Wt)}}return!0},F.prototype.on=function(re,Ee,ne){return v(this,re,Ee,ne,!1)},F.prototype.once=function(re,Ee,ne){return v(this,re,Ee,ne,!0)},F.prototype.removeListener=function(re,Ee,ne,je){var Ce=R?R+re:re;if(!this._events[Ce])return this;if(!Ee)return ee(this,Ce),this;var et=this._events[Ce];if(et.fn)et.fn===Ee&&(!je||et.once)&&(!ne||et.context===ne)&&ee(this,Ce);else{for(var Pt=0,nr=[],xt=et.length;Pt<xt;Pt++)(et[Pt].fn!==Ee||je&&!et[Pt].once||ne&&et[Pt].context!==ne)&&nr.push(et[Pt]);nr.length?this._events[Ce]=nr.length===1?nr[0]:nr:ee(this,Ce)}return this},F.prototype.removeAllListeners=function(re){var Ee;return re?(Ee=R?R+re:re,this._events[Ee]&&ee(this,Ee)):(this._events=new Y,this._eventsCount=0),this},F.prototype.off=F.prototype.removeListener,F.prototype.addListener=F.prototype.on,F.prefixed=R,F.EventEmitter=F,Ue.exports=F},7375:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0});var R=Symbol.for("INJECTION");function Y(Q,re,Ee,ne){function je(){return ne&&!Reflect.hasMetadata(R,this,re)&&Reflect.defineMetadata(R,Ee(),this,re),Reflect.hasMetadata(R,this,re)?Reflect.getMetadata(R,this,re):Ee()}function Ce(et){Reflect.defineMetadata(R,et,this,re)}Object.defineProperty(Q,re,{configurable:!0,enumerable:!0,get:je,set:Ce})}function $(Q,re){return function(Ee){return function(ne,je){var Ce=function(){return Q.get(Ee)};Y(ne,je,Ce,re)}}}W.makePropertyInjectDecorator=$;function v(Q,re){return function(Ee,ne){return function(je,Ce){var et=function(){return Q.getNamed(Ee,ne)};Y(je,Ce,et,re)}}}W.makePropertyInjectNamedDecorator=v;function ee(Q,re){return function(Ee,ne,je){return function(Ce,et){var Pt=function(){return Q.getTagged(Ee,ne,je)};Y(Ce,et,Pt,re)}}}W.makePropertyInjectTaggedDecorator=ee;function F(Q,re){return function(Ee){return function(ne,je){var Ce=function(){return Q.getAll(Ee)};Y(ne,je,Ce,re)}}}W.makePropertyMultiInjectDecorator=F},84879:function(Ue,W,R){"use strict";var Y;Y={value:!0};var $=R(7375);function v(ee,F){F===void 0&&(F=!0);var Q=$.makePropertyInjectDecorator(ee,F),re=$.makePropertyInjectNamedDecorator(ee,F),Ee=$.makePropertyInjectTaggedDecorator(ee,F),ne=$.makePropertyMultiInjectDecorator(ee,F);return{lazyInject:Q,lazyInjectNamed:re,lazyInjectTagged:Ee,lazyMultiInject:ne}}W.Z=v},99934:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.tagProperty=W.tagParameter=W.decorate=void 0;var Y=R(16674),$=R(6867);function v(ne,je,Ce,et){var Pt=$.TAGGED;F(Pt,ne,je,et,Ce)}W.tagParameter=v;function ee(ne,je,Ce){var et=$.TAGGED_PROP;F(et,ne.constructor,je,Ce)}W.tagProperty=ee;function F(ne,je,Ce,et,Pt){var nr={},xt=typeof Pt=="number",Wt=Pt!==void 0&&xt?Pt.toString():Ce;if(xt&&Ce!==void 0)throw new Error(Y.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(ne,je)&&(nr=Reflect.getMetadata(ne,je));var wt=nr[Wt];if(!Array.isArray(wt))wt=[];else for(var st=0,ut=wt;st<ut.length;st++){var Jt=ut[st];if(Jt.key===et.key)throw new Error(Y.DUPLICATED_METADATA+" "+Jt.key.toString())}wt.push(et),nr[Wt]=wt,Reflect.defineMetadata(ne,nr,je)}function Q(ne,je){Reflect.decorate(ne,je)}function re(ne,je){return function(Ce,et){je(Ce,et,ne)}}function Ee(ne,je,Ce){typeof Ce=="number"?Q([re(Ce,ne)],je):typeof Ce=="string"?Reflect.decorate([ne],je,Ce):Q([ne],je)}W.decorate=Ee},5744:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.inject=W.LazyServiceIdentifer=void 0;var Y=R(16674),$=R(6867),v=R(47738),ee=R(99934),F=function(){function re(Ee){this._cb=Ee}return re.prototype.unwrap=function(){return this._cb()},re}();W.LazyServiceIdentifer=F;function Q(re){return function(Ee,ne,je){if(re===void 0)throw new Error(Y.UNDEFINED_INJECT_ANNOTATION(Ee.name));var Ce=new v.Metadata($.INJECT_TAG,re);typeof je=="number"?ee.tagParameter(Ee,ne,je,Ce):ee.tagProperty(Ee,ne,Ce)}}W.inject=Q},64315:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.injectable=void 0;var Y=R(16674),$=R(6867);function v(){return function(ee){if(Reflect.hasOwnMetadata($.PARAM_TYPES,ee))throw new Error(Y.DUPLICATED_INJECTABLE_DECORATOR);var F=Reflect.getMetadata($.DESIGN_PARAM_TYPES,ee)||[];return Reflect.defineMetadata($.PARAM_TYPES,F,ee),ee}}W.injectable=v},71693:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.multiInject=void 0;var Y=R(6867),$=R(47738),v=R(99934);function ee(F){return function(Q,re,Ee){var ne=new $.Metadata(Y.MULTI_INJECT_TAG,F);typeof Ee=="number"?v.tagParameter(Q,re,Ee,ne):v.tagProperty(Q,re,ne)}}W.multiInject=ee},38085:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.named=void 0;var Y=R(6867),$=R(47738),v=R(99934);function ee(F){return function(Q,re,Ee){var ne=new $.Metadata(Y.NAMED_TAG,F);typeof Ee=="number"?v.tagParameter(Q,re,Ee,ne):v.tagProperty(Q,re,ne)}}W.named=ee},6515:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.optional=void 0;var Y=R(6867),$=R(47738),v=R(99934);function ee(){return function(F,Q,re){var Ee=new $.Metadata(Y.OPTIONAL_TAG,!0);typeof re=="number"?v.tagParameter(F,Q,re,Ee):v.tagProperty(F,Q,Ee)}}W.optional=ee},7014:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.postConstruct=void 0;var Y=R(16674),$=R(6867),v=R(47738);function ee(){return function(F,Q,re){var Ee=new v.Metadata($.POST_CONSTRUCT,Q);if(Reflect.hasOwnMetadata($.POST_CONSTRUCT,F.constructor))throw new Error(Y.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata($.POST_CONSTRUCT,Ee,F.constructor)}}W.postConstruct=ee},32052:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.tagged=void 0;var Y=R(47738),$=R(99934);function v(ee,F){return function(Q,re,Ee){var ne=new Y.Metadata(ee,F);typeof Ee=="number"?$.tagParameter(Q,re,Ee,ne):$.tagProperty(Q,re,ne)}}W.tagged=v},55638:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.targetName=void 0;var Y=R(6867),$=R(47738),v=R(99934);function ee(F){return function(Q,re,Ee){var ne=new $.Metadata(Y.NAME_TAG,F);v.tagParameter(Q,re,Ee,ne)}}W.targetName=ee},86757:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.unmanaged=void 0;var Y=R(6867),$=R(47738),v=R(99934);function ee(){return function(F,Q,re){var Ee=new $.Metadata(Y.UNMANAGED_TAG,!0);v.tagParameter(F,Q,re,Ee)}}W.unmanaged=ee},44290:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Binding=void 0;var Y=R(28421),$=R(37791),v=function(){function ee(F,Q){this.id=$.id(),this.activated=!1,this.serviceIdentifier=F,this.scope=Q,this.type=Y.BindingTypeEnum.Invalid,this.constraint=function(re){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return ee.prototype.clone=function(){var F=new ee(this.serviceIdentifier,this.scope);return F.activated=F.scope===Y.BindingScopeEnum.Singleton?this.activated:!1,F.implementationType=this.implementationType,F.dynamicValue=this.dynamicValue,F.scope=this.scope,F.type=this.type,F.factory=this.factory,F.provider=this.provider,F.constraint=this.constraint,F.onActivation=this.onActivation,F.cache=this.cache,F},ee}();W.Binding=v},23184:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingCount=void 0;var R={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};W.BindingCount=R},16674:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.STACK_OVERFLOW=W.CIRCULAR_DEPENDENCY_IN_FACTORY=W.POST_CONSTRUCT_ERROR=W.MULTIPLE_POST_CONSTRUCT_METHODS=W.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=W.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=W.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=W.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=W.ARGUMENTS_LENGTH_MISMATCH=W.INVALID_DECORATOR_OPERATION=W.INVALID_TO_SELF_VALUE=W.INVALID_FUNCTION_BINDING=W.INVALID_MIDDLEWARE_RETURN=W.NO_MORE_SNAPSHOTS_AVAILABLE=W.INVALID_BINDING_TYPE=W.NOT_IMPLEMENTED=W.CIRCULAR_DEPENDENCY=W.UNDEFINED_INJECT_ANNOTATION=W.MISSING_INJECT_ANNOTATION=W.MISSING_INJECTABLE_ANNOTATION=W.NOT_REGISTERED=W.CANNOT_UNBIND=W.AMBIGUOUS_MATCH=W.KEY_NOT_FOUND=W.NULL_ARGUMENT=W.DUPLICATED_METADATA=W.DUPLICATED_INJECTABLE_DECORATOR=void 0,W.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",W.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",W.NULL_ARGUMENT="NULL argument",W.KEY_NOT_FOUND="Key Not Found",W.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",W.CANNOT_UNBIND="Could not unbind serviceIdentifier:",W.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",W.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",W.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var R=function(ee){return"@inject called with undefined this could mean that the class "+ee+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};W.UNDEFINED_INJECT_ANNOTATION=R,W.CIRCULAR_DEPENDENCY="Circular dependency found:",W.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",W.INVALID_BINDING_TYPE="Invalid binding type:",W.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",W.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",W.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",W.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",W.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Y=function(){for(var ee=[],F=0;F<arguments.length;F++)ee[F]=arguments[F];return"The number of constructor arguments in the derived class "+(ee[0]+" must be >= than the number of constructor arguments of its base class.")};W.ARGUMENTS_LENGTH_MISMATCH=Y,W.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",W.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",W.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",W.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",W.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var $=function(){for(var ee=[],F=0;F<arguments.length;F++)ee[F]=arguments[F];return"@postConstruct error in class "+ee[0]+": "+ee[1]};W.POST_CONSTRUCT_ERROR=$;var v=function(){for(var ee=[],F=0;F<arguments.length;F++)ee[F]=arguments[F];return"It looks like there is a circular dependency "+("in one of the '"+ee[0]+"' bindings. Please investigate bindings with")+("service identifier '"+ee[1]+"'.")};W.CIRCULAR_DEPENDENCY_IN_FACTORY=v,W.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.TargetTypeEnum=W.BindingTypeEnum=W.BindingScopeEnum=void 0;var R={Request:"Request",Singleton:"Singleton",Transient:"Transient"};W.BindingScopeEnum=R;var Y={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};W.BindingTypeEnum=Y;var $={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};W.TargetTypeEnum=$},6867:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.NON_CUSTOM_TAG_KEYS=W.POST_CONSTRUCT=W.DESIGN_PARAM_TYPES=W.PARAM_TYPES=W.TAGGED_PROP=W.TAGGED=W.MULTI_INJECT_TAG=W.INJECT_TAG=W.OPTIONAL_TAG=W.UNMANAGED_TAG=W.NAME_TAG=W.NAMED_TAG=void 0,W.NAMED_TAG="named",W.NAME_TAG="name",W.UNMANAGED_TAG="unmanaged",W.OPTIONAL_TAG="optional",W.INJECT_TAG="inject",W.MULTI_INJECT_TAG="multi_inject",W.TAGGED="inversify:tagged",W.TAGGED_PROP="inversify:tagged_props",W.PARAM_TYPES="inversify:paramtypes",W.DESIGN_PARAM_TYPES="design:paramtypes",W.POST_CONSTRUCT="post_construct";function R(){return[W.INJECT_TAG,W.MULTI_INJECT_TAG,W.NAME_TAG,W.UNMANAGED_TAG,W.NAMED_TAG,W.OPTIONAL_TAG]}W.NON_CUSTOM_TAG_KEYS=R()},51389:function(Ue,W,R){"use strict";var Y=this&&this.__awaiter||function(wt,st,ut,Jt){function X(Xt){return Xt instanceof ut?Xt:new ut(function(vt){vt(Xt)})}return new(ut||(ut=Promise))(function(Xt,vt){function qe(kt){try{$e(Jt.next(kt))}catch(xr){vt(xr)}}function pt(kt){try{$e(Jt.throw(kt))}catch(xr){vt(xr)}}function $e(kt){kt.done?Xt(kt.value):X(kt.value).then(qe,pt)}$e((Jt=Jt.apply(wt,st||[])).next())})},$=this&&this.__generator||function(wt,st){var ut={label:0,sent:function(){if(Xt[0]&1)throw Xt[1];return Xt[1]},trys:[],ops:[]},Jt,X,Xt,vt;return vt={next:qe(0),throw:qe(1),return:qe(2)},typeof Symbol=="function"&&(vt[Symbol.iterator]=function(){return this}),vt;function qe($e){return function(kt){return pt([$e,kt])}}function pt($e){if(Jt)throw new TypeError("Generator is already executing.");for(;ut;)try{if(Jt=1,X&&(Xt=$e[0]&2?X.return:$e[0]?X.throw||((Xt=X.return)&&Xt.call(X),0):X.next)&&!(Xt=Xt.call(X,$e[1])).done)return Xt;switch(X=0,Xt&&($e=[$e[0]&2,Xt.value]),$e[0]){case 0:case 1:Xt=$e;break;case 4:return ut.label++,{value:$e[1],done:!1};case 5:ut.label++,X=$e[1],$e=[0];continue;case 7:$e=ut.ops.pop(),ut.trys.pop();continue;default:if(Xt=ut.trys,!(Xt=Xt.length>0&&Xt[Xt.length-1])&&($e[0]===6||$e[0]===2)){ut=0;continue}if($e[0]===3&&(!Xt||$e[1]>Xt[0]&&$e[1]<Xt[3])){ut.label=$e[1];break}if($e[0]===6&&ut.label<Xt[1]){ut.label=Xt[1],Xt=$e;break}if(Xt&&ut.label<Xt[2]){ut.label=Xt[2],ut.ops.push($e);break}Xt[2]&&ut.ops.pop(),ut.trys.pop();continue}$e=st.call(wt,ut)}catch(kt){$e=[6,kt],X=0}finally{Jt=Xt=0}if($e[0]&5)throw $e[1];return{value:$e[0]?$e[1]:void 0,done:!0}}},v=this&&this.__spreadArray||function(wt,st){for(var ut=0,Jt=st.length,X=wt.length;ut<Jt;ut++,X++)wt[X]=st[ut];return wt};Object.defineProperty(W,"__esModule",{value:!0}),W.Container=void 0;var ee=R(44290),F=R(16674),Q=R(28421),re=R(6867),Ee=R(51377),ne=R(86311),je=R(31927),Ce=R(15451),et=R(37791),Pt=R(55800),nr=R(85700),xt=R(80175),Wt=function(){function wt(st){this._appliedMiddleware=[];var ut=st||{};if(typeof ut!="object")throw new Error(""+F.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(ut.defaultScope===void 0)ut.defaultScope=Q.BindingScopeEnum.Transient;else if(ut.defaultScope!==Q.BindingScopeEnum.Singleton&&ut.defaultScope!==Q.BindingScopeEnum.Transient&&ut.defaultScope!==Q.BindingScopeEnum.Request)throw new Error(""+F.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(ut.autoBindInjectable===void 0)ut.autoBindInjectable=!1;else if(typeof ut.autoBindInjectable!="boolean")throw new Error(""+F.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(ut.skipBaseClassChecks===void 0)ut.skipBaseClassChecks=!1;else if(typeof ut.skipBaseClassChecks!="boolean")throw new Error(""+F.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:ut.autoBindInjectable,defaultScope:ut.defaultScope,skipBaseClassChecks:ut.skipBaseClassChecks},this.id=et.id(),this._bindingDictionary=new xt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ee.MetadataReader}return wt.merge=function(st,ut){for(var Jt=[],X=2;X<arguments.length;X++)Jt[X-2]=arguments[X];var Xt=new wt,vt=v([st,ut],Jt).map(function($e){return ne.getBindingDictionary($e)}),qe=ne.getBindingDictionary(Xt);function pt($e,kt){$e.traverse(function(xr,Ir){Ir.forEach(function(Wr){kt.add(Wr.serviceIdentifier,Wr.clone())})})}return vt.forEach(function($e){pt($e,qe)}),Xt},wt.prototype.load=function(){for(var st=[],ut=0;ut<arguments.length;ut++)st[ut]=arguments[ut];for(var Jt=this._getContainerModuleHelpersFactory(),X=0,Xt=st;X<Xt.length;X++){var vt=Xt[X],qe=Jt(vt.id);vt.registry(qe.bindFunction,qe.unbindFunction,qe.isboundFunction,qe.rebindFunction)}},wt.prototype.loadAsync=function(){for(var st=[],ut=0;ut<arguments.length;ut++)st[ut]=arguments[ut];return Y(this,void 0,void 0,function(){var Jt,X,Xt,vt,qe;return $(this,function(pt){switch(pt.label){case 0:Jt=this._getContainerModuleHelpersFactory(),X=0,Xt=st,pt.label=1;case 1:return X<Xt.length?(vt=Xt[X],qe=Jt(vt.id),[4,vt.registry(qe.bindFunction,qe.unbindFunction,qe.isboundFunction,qe.rebindFunction)]):[3,4];case 2:pt.sent(),pt.label=3;case 3:return X++,[3,1];case 4:return[2]}})})},wt.prototype.unload=function(){for(var st=this,ut=[],Jt=0;Jt<arguments.length;Jt++)ut[Jt]=arguments[Jt];var X=function(Xt){return function(vt){return vt.moduleId===Xt}};ut.forEach(function(Xt){var vt=X(Xt.id);st._bindingDictionary.removeByCondition(vt)})},wt.prototype.bind=function(st){var ut=this.options.defaultScope||Q.BindingScopeEnum.Transient,Jt=new ee.Binding(st,ut);return this._bindingDictionary.add(st,Jt),new Ce.BindingToSyntax(Jt)},wt.prototype.rebind=function(st){return this.unbind(st),this.bind(st)},wt.prototype.unbind=function(st){try{this._bindingDictionary.remove(st)}catch(ut){throw new Error(F.CANNOT_UNBIND+" "+Pt.getServiceIdentifierAsString(st))}},wt.prototype.unbindAll=function(){this._bindingDictionary=new xt.Lookup},wt.prototype.isBound=function(st){var ut=this._bindingDictionary.hasKey(st);return!ut&&this.parent&&(ut=this.parent.isBound(st)),ut},wt.prototype.isBoundNamed=function(st,ut){return this.isBoundTagged(st,re.NAMED_TAG,ut)},wt.prototype.isBoundTagged=function(st,ut,Jt){var X=!1;if(this._bindingDictionary.hasKey(st)){var Xt=this._bindingDictionary.get(st),vt=ne.createMockRequest(this,st,ut,Jt);X=Xt.some(function(qe){return qe.constraint(vt)})}return!X&&this.parent&&(X=this.parent.isBoundTagged(st,ut,Jt)),X},wt.prototype.snapshot=function(){this._snapshots.push(nr.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},wt.prototype.restore=function(){var st=this._snapshots.pop();if(st===void 0)throw new Error(F.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=st.bindings,this._middleware=st.middleware},wt.prototype.createChild=function(st){var ut=new wt(st||this.options);return ut.parent=this,ut},wt.prototype.applyMiddleware=function(){for(var st=[],ut=0;ut<arguments.length;ut++)st[ut]=arguments[ut];this._appliedMiddleware=this._appliedMiddleware.concat(st);var Jt=this._middleware?this._middleware:this._planAndResolve();this._middleware=st.reduce(function(X,Xt){return Xt(X)},Jt)},wt.prototype.applyCustomMetadataReader=function(st){this._metadataReader=st},wt.prototype.get=function(st){return this._get(!1,!1,Q.TargetTypeEnum.Variable,st)},wt.prototype.getTagged=function(st,ut,Jt){return this._get(!1,!1,Q.TargetTypeEnum.Variable,st,ut,Jt)},wt.prototype.getNamed=function(st,ut){return this.getTagged(st,re.NAMED_TAG,ut)},wt.prototype.getAll=function(st){return this._get(!0,!0,Q.TargetTypeEnum.Variable,st)},wt.prototype.getAllTagged=function(st,ut,Jt){return this._get(!1,!0,Q.TargetTypeEnum.Variable,st,ut,Jt)},wt.prototype.getAllNamed=function(st,ut){return this.getAllTagged(st,re.NAMED_TAG,ut)},wt.prototype.resolve=function(st){var ut=this.createChild();return ut.bind(st).toSelf(),this._appliedMiddleware.forEach(function(Jt){ut.applyMiddleware(Jt)}),ut.get(st)},wt.prototype._getContainerModuleHelpersFactory=function(){var st=this,ut=function(qe,pt){qe._binding.moduleId=pt},Jt=function(qe){return function(pt){var $e=st.bind.bind(st),kt=$e(pt);return ut(kt,qe),kt}},X=function(qe){return function(pt){var $e=st.unbind.bind(st);$e(pt)}},Xt=function(qe){return function(pt){var $e=st.isBound.bind(st);return $e(pt)}},vt=function(qe){return function(pt){var $e=st.rebind.bind(st),kt=$e(pt);return ut(kt,qe),kt}};return function(qe){return{bindFunction:Jt(qe),isboundFunction:Xt(qe),rebindFunction:vt(qe),unbindFunction:X(qe)}}},wt.prototype._get=function(st,ut,Jt,X,Xt,vt){var qe=null,pt={avoidConstraints:st,contextInterceptor:function($e){return $e},isMultiInject:ut,key:Xt,serviceIdentifier:X,targetType:Jt,value:vt};if(this._middleware){if(qe=this._middleware(pt),qe==null)throw new Error(F.INVALID_MIDDLEWARE_RETURN)}else qe=this._planAndResolve()(pt);return qe},wt.prototype._planAndResolve=function(){var st=this;return function(ut){var Jt=ne.plan(st._metadataReader,st,ut.isMultiInject,ut.targetType,ut.serviceIdentifier,ut.key,ut.value,ut.avoidConstraints);Jt=ut.contextInterceptor(Jt);var X=je.resolve(Jt);return X}},wt}();W.Container=Wt},33244:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.AsyncContainerModule=W.ContainerModule=void 0;var Y=R(37791),$=function(){function ee(F){this.id=Y.id(),this.registry=F}return ee}();W.ContainerModule=$;var v=function(){function ee(F){this.id=Y.id(),this.registry=F}return ee}();W.AsyncContainerModule=v},85700:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.ContainerSnapshot=void 0;var R=function(){function Y(){}return Y.of=function($,v){var ee=new Y;return ee.bindings=$,ee.middleware=v,ee},Y}();W.ContainerSnapshot=R},80175:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Lookup=void 0;var Y=R(16674),$=function(){function v(){this._map=new Map}return v.prototype.getMap=function(){return this._map},v.prototype.add=function(ee,F){if(ee==null)throw new Error(Y.NULL_ARGUMENT);if(F==null)throw new Error(Y.NULL_ARGUMENT);var Q=this._map.get(ee);Q!==void 0?(Q.push(F),this._map.set(ee,Q)):this._map.set(ee,[F])},v.prototype.get=function(ee){if(ee==null)throw new Error(Y.NULL_ARGUMENT);var F=this._map.get(ee);if(F!==void 0)return F;throw new Error(Y.KEY_NOT_FOUND)},v.prototype.remove=function(ee){if(ee==null)throw new Error(Y.NULL_ARGUMENT);if(!this._map.delete(ee))throw new Error(Y.KEY_NOT_FOUND)},v.prototype.removeByCondition=function(ee){var F=this;this._map.forEach(function(Q,re){var Ee=Q.filter(function(ne){return!ee(ne)});Ee.length>0?F._map.set(re,Ee):F._map.delete(re)})},v.prototype.hasKey=function(ee){if(ee==null)throw new Error(Y.NULL_ARGUMENT);return this._map.has(ee)},v.prototype.clone=function(){var ee=new v;return this._map.forEach(function(F,Q){F.forEach(function(re){return ee.add(Q,re.clone())})}),ee},v.prototype.traverse=function(ee){this._map.forEach(function(F,Q){ee(Q,F)})},v}();W.Lookup=$},86700:function(Ue,W,R){"use strict";var Y;Y={value:!0},Y=Y=Y=Y=Y=Y=W.GW=Y=Y=W.zY=Y=Y=Y=Y=Y=W.f3=Y=Y=W.b2=Y=Y=Y=Y=Y=W.W2=Y=void 0;var $=R(6867);Y=$;var v=R(51389);Object.defineProperty(W,"W2",{enumerable:!0,get:function(){return v.Container}});var ee=R(28421);Y={enumerable:!0,get:function(){return ee.BindingScopeEnum}},Y={enumerable:!0,get:function(){return ee.BindingTypeEnum}},Y={enumerable:!0,get:function(){return ee.TargetTypeEnum}};var F=R(33244);Y={enumerable:!0,get:function(){return F.AsyncContainerModule}},Y={enumerable:!0,get:function(){return F.ContainerModule}};var Q=R(64315);Object.defineProperty(W,"b2",{enumerable:!0,get:function(){return Q.injectable}});var re=R(32052);Y={enumerable:!0,get:function(){return re.tagged}};var Ee=R(38085);Y={enumerable:!0,get:function(){return Ee.named}};var ne=R(5744);Object.defineProperty(W,"f3",{enumerable:!0,get:function(){return ne.inject}}),Y={enumerable:!0,get:function(){return ne.LazyServiceIdentifer}};var je=R(6515);Y={enumerable:!0,get:function(){return je.optional}};var Ce=R(86757);Y={enumerable:!0,get:function(){return Ce.unmanaged}};var et=R(71693);Y={enumerable:!0,get:function(){return et.multiInject}};var Pt=R(55638);Y={enumerable:!0,get:function(){return Pt.targetName}};var nr=R(7014);Object.defineProperty(W,"zY",{enumerable:!0,get:function(){return nr.postConstruct}});var xt=R(51377);Y={enumerable:!0,get:function(){return xt.MetadataReader}};var Wt=R(37791);Y={enumerable:!0,get:function(){return Wt.id}};var wt=R(99934);Object.defineProperty(W,"GW",{enumerable:!0,get:function(){return wt.decorate}});var st=R(80758);Y={enumerable:!0,get:function(){return st.traverseAncerstors}},Y={enumerable:!0,get:function(){return st.taggedConstraint}},Y={enumerable:!0,get:function(){return st.namedConstraint}},Y={enumerable:!0,get:function(){return st.typeConstraint}};var ut=R(55800);Y={enumerable:!0,get:function(){return ut.getServiceIdentifierAsString}};var Jt=R(70600);Y={enumerable:!0,get:function(){return Jt.multiBindToService}}},95228:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Context=void 0;var Y=R(37791),$=function(){function v(ee){this.id=Y.id(),this.container=ee}return v.prototype.addPlan=function(ee){this.plan=ee},v.prototype.setCurrentRequest=function(ee){this.currentRequest=ee},v}();W.Context=$},47738:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Metadata=void 0;var Y=R(6867),$=function(){function v(ee,F){this.key=ee,this.value=F}return v.prototype.toString=function(){return this.key===Y.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},v}();W.Metadata=$},51377:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.MetadataReader=void 0;var Y=R(6867),$=function(){function v(){}return v.prototype.getConstructorMetadata=function(ee){var F=Reflect.getMetadata(Y.PARAM_TYPES,ee),Q=Reflect.getMetadata(Y.TAGGED,ee);return{compilerGeneratedMetadata:F,userGeneratedMetadata:Q||{}}},v.prototype.getPropertiesMetadata=function(ee){var F=Reflect.getMetadata(Y.TAGGED_PROP,ee)||[];return F},v}();W.MetadataReader=$},55314:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Plan=void 0;var R=function(){function Y($,v){this.parentContext=$,this.rootRequest=v}return Y}();W.Plan=R},86311:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.getBindingDictionary=W.createMockRequest=W.plan=void 0;var Y=R(23184),$=R(16674),v=R(28421),ee=R(6867),F=R(85265),Q=R(55800),re=R(95228),Ee=R(47738),ne=R(55314),je=R(6e3),Ce=R(6748),et=R(18924);function Pt(X){return X._bindingDictionary}W.getBindingDictionary=Pt;function nr(X,Xt,vt,qe,pt,$e){var kt=X?ee.MULTI_INJECT_TAG:ee.INJECT_TAG,xr=new Ee.Metadata(kt,vt),Ir=new et.Target(Xt,qe,vt,xr);if(pt!==void 0){var Wr=new Ee.Metadata(pt,$e);Ir.metadata.push(Wr)}return Ir}function xt(X,Xt,vt,qe,pt){var $e=st(vt.container,pt.serviceIdentifier),kt=[];return $e.length===Y.BindingCount.NoBindingsAvailable&&vt.container.options.autoBindInjectable&&typeof pt.serviceIdentifier=="function"&&X.getConstructorMetadata(pt.serviceIdentifier).compilerGeneratedMetadata&&(vt.container.bind(pt.serviceIdentifier).toSelf(),$e=st(vt.container,pt.serviceIdentifier)),Xt?kt=$e:kt=$e.filter(function(xr){var Ir=new Ce.Request(xr.serviceIdentifier,vt,qe,xr,pt);return xr.constraint(Ir)}),Wt(pt.serviceIdentifier,kt,pt,vt.container),kt}function Wt(X,Xt,vt,qe){switch(Xt.length){case Y.BindingCount.NoBindingsAvailable:if(vt.isOptional())return Xt;var pt=Q.getServiceIdentifierAsString(X),$e=$.NOT_REGISTERED;throw $e+=Q.listMetadataForTarget(pt,vt),$e+=Q.listRegisteredBindingsForServiceIdentifier(qe,pt,st),new Error($e);case Y.BindingCount.OnlyOneBindingAvailable:if(!vt.isArray())return Xt;case Y.BindingCount.MultipleBindingsAvailable:default:if(vt.isArray())return Xt;var pt=Q.getServiceIdentifierAsString(X),$e=$.AMBIGUOUS_MATCH+" "+pt;throw $e+=Q.listRegisteredBindingsForServiceIdentifier(qe,pt,st),new Error($e)}}function wt(X,Xt,vt,qe,pt,$e){var kt,xr;if(pt===null){kt=xt(X,Xt,qe,null,$e),xr=new Ce.Request(vt,qe,null,kt,$e);var Ir=new ne.Plan(qe,xr);qe.addPlan(Ir)}else kt=xt(X,Xt,qe,pt,$e),xr=pt.addChildRequest($e.serviceIdentifier,kt,$e);kt.forEach(function(Wr){var Me=null;if($e.isArray())Me=xr.addChildRequest(Wr.serviceIdentifier,Wr,$e);else{if(Wr.cache)return;Me=xr}if(Wr.type===v.BindingTypeEnum.Instance&&Wr.implementationType!==null){var Ye=je.getDependencies(X,Wr.implementationType);if(!qe.container.options.skipBaseClassChecks){var Fe=je.getBaseClassDependencyCount(X,Wr.implementationType);if(Ye.length<Fe){var At=$.ARGUMENTS_LENGTH_MISMATCH(je.getFunctionName(Wr.implementationType));throw new Error(At)}}Ye.forEach(function(gt){wt(X,!1,gt.serviceIdentifier,qe,Me,gt)})}})}function st(X,Xt){var vt=[],qe=Pt(X);return qe.hasKey(Xt)?vt=qe.get(Xt):X.parent!==null&&(vt=st(X.parent,Xt)),vt}function ut(X,Xt,vt,qe,pt,$e,kt,xr){xr===void 0&&(xr=!1);var Ir=new re.Context(Xt),Wr=nr(vt,qe,pt,"",$e,kt);try{return wt(X,xr,pt,Ir,null,Wr),Ir}catch(Me){throw F.isStackOverflowExeption(Me)&&Ir.plan&&Q.circularDependencyToException(Ir.plan.rootRequest),Me}}W.plan=ut;function Jt(X,Xt,vt,qe){var pt=new et.Target(v.TargetTypeEnum.Variable,"",Xt,new Ee.Metadata(vt,qe)),$e=new re.Context(X),kt=new Ce.Request(Xt,$e,null,[],pt);return kt}W.createMockRequest=Jt},88460:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.QueryableString=void 0;var R=function(){function Y($){this.str=$}return Y.prototype.startsWith=function($){return this.str.indexOf($)===0},Y.prototype.endsWith=function($){var v="",ee=$.split("").reverse().join("");return v=this.str.split("").reverse().join(""),this.startsWith.call({str:v},ee)},Y.prototype.contains=function($){return this.str.indexOf($)!==-1},Y.prototype.equals=function($){return this.str===$},Y.prototype.value=function(){return this.str},Y}();W.QueryableString=R},6e3:function(Ue,W,R){"use strict";var Y=this&&this.__spreadArray||function(xt,Wt){for(var wt=0,st=Wt.length,ut=xt.length;wt<st;wt++,ut++)xt[ut]=Wt[wt];return xt};Object.defineProperty(W,"__esModule",{value:!0}),W.getFunctionName=W.getBaseClassDependencyCount=W.getDependencies=void 0;var $=R(5744),v=R(16674),ee=R(28421),F=R(6867),Q=R(55800);Object.defineProperty(W,"getFunctionName",{enumerable:!0,get:function(){return Q.getFunctionName}});var re=R(18924);function Ee(xt,Wt){var wt=Q.getFunctionName(Wt),st=ne(xt,wt,Wt,!1);return st}W.getDependencies=Ee;function ne(xt,Wt,wt,st){var ut=xt.getConstructorMetadata(wt),Jt=ut.compilerGeneratedMetadata;if(Jt===void 0){var X=v.MISSING_INJECTABLE_ANNOTATION+" "+Wt+".";throw new Error(X)}var Xt=ut.userGeneratedMetadata,vt=Object.keys(Xt),qe=wt.length===0&&vt.length>0,pt=vt.length>wt.length,$e=qe||pt?vt.length:wt.length,kt=Ce(st,Wt,Jt,Xt,$e),xr=et(xt,wt),Ir=Y(Y([],kt),xr);return Ir}function je(xt,Wt,wt,st,ut){var Jt=ut[xt.toString()]||[],X=nr(Jt),Xt=X.unmanaged!==!0,vt=st[xt],qe=X.inject||X.multiInject;if(vt=qe||vt,vt instanceof $.LazyServiceIdentifer&&(vt=vt.unwrap()),Xt){var pt=vt===Object,$e=vt===Function,kt=vt===void 0,xr=pt||$e||kt;if(!Wt&&xr){var Ir=v.MISSING_INJECT_ANNOTATION+" argument "+xt+" in class "+wt+".";throw new Error(Ir)}var Wr=new re.Target(ee.TargetTypeEnum.ConstructorArgument,X.targetName,vt);return Wr.metadata=Jt,Wr}return null}function Ce(xt,Wt,wt,st,ut){for(var Jt=[],X=0;X<ut;X++){var Xt=X,vt=je(Xt,xt,Wt,wt,st);vt!==null&&Jt.push(vt)}return Jt}function et(xt,Wt){for(var wt=xt.getPropertiesMetadata(Wt),st=[],ut=Object.keys(wt),Jt=0,X=ut;Jt<X.length;Jt++){var Xt=X[Jt],vt=wt[Xt],qe=nr(wt[Xt]),pt=qe.targetName||Xt,$e=qe.inject||qe.multiInject,kt=new re.Target(ee.TargetTypeEnum.ClassProperty,pt,$e);kt.metadata=vt,st.push(kt)}var xr=Object.getPrototypeOf(Wt.prototype).constructor;if(xr!==Object){var Ir=et(xt,xr);st=Y(Y([],st),Ir)}return st}function Pt(xt,Wt){var wt=Object.getPrototypeOf(Wt.prototype).constructor;if(wt!==Object){var st=Q.getFunctionName(wt),ut=ne(xt,st,wt,!0),Jt=ut.map(function(vt){return vt.metadata.filter(function(qe){return qe.key===F.UNMANAGED_TAG})}),X=[].concat.apply([],Jt).length,Xt=ut.length-X;return Xt>0?Xt:Pt(xt,wt)}else return 0}W.getBaseClassDependencyCount=Pt;function nr(xt){var Wt={};return xt.forEach(function(wt){Wt[wt.key.toString()]=wt.value}),{inject:Wt[F.INJECT_TAG],multiInject:Wt[F.MULTI_INJECT_TAG],targetName:Wt[F.NAME_TAG],unmanaged:Wt[F.UNMANAGED_TAG]}}},6748:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Request=void 0;var Y=R(37791),$=function(){function v(ee,F,Q,re,Ee){this.id=Y.id(),this.serviceIdentifier=ee,this.parentContext=F,this.parentRequest=Q,this.target=Ee,this.childRequests=[],this.bindings=Array.isArray(re)?re:[re],this.requestScope=Q===null?new Map:null}return v.prototype.addChildRequest=function(ee,F,Q){var re=new v(ee,this.parentContext,this,F,Q);return this.childRequests.push(re),re},v}();W.Request=$},18924:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.Target=void 0;var Y=R(6867),$=R(37791),v=R(47738),ee=R(88460),F=function(){function Q(re,Ee,ne,je){this.id=$.id(),this.type=re,this.serviceIdentifier=ne,this.name=new ee.QueryableString(Ee||""),this.metadata=new Array;var Ce=null;typeof je=="string"?Ce=new v.Metadata(Y.NAMED_TAG,je):je instanceof v.Metadata&&(Ce=je),Ce!==null&&this.metadata.push(Ce)}return Q.prototype.hasTag=function(re){for(var Ee=0,ne=this.metadata;Ee<ne.length;Ee++){var je=ne[Ee];if(je.key===re)return!0}return!1},Q.prototype.isArray=function(){return this.hasTag(Y.MULTI_INJECT_TAG)},Q.prototype.matchesArray=function(re){return this.matchesTag(Y.MULTI_INJECT_TAG)(re)},Q.prototype.isNamed=function(){return this.hasTag(Y.NAMED_TAG)},Q.prototype.isTagged=function(){return this.metadata.some(function(re){return Y.NON_CUSTOM_TAG_KEYS.every(function(Ee){return re.key!==Ee})})},Q.prototype.isOptional=function(){return this.matchesTag(Y.OPTIONAL_TAG)(!0)},Q.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(re){return re.key===Y.NAMED_TAG})[0]:null},Q.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(re){return Y.NON_CUSTOM_TAG_KEYS.every(function(Ee){return re.key!==Ee})}):null},Q.prototype.matchesNamedTag=function(re){return this.matchesTag(Y.NAMED_TAG)(re)},Q.prototype.matchesTag=function(re){var Ee=this;return function(ne){for(var je=0,Ce=Ee.metadata;je<Ce.length;je++){var et=Ce[je];if(et.key===re&&et.value===ne)return!0}return!1}},Q}();W.Target=F},52279:function(Ue,W,R){"use strict";var Y=this&&this.__spreadArray||function(ne,je){for(var Ce=0,et=je.length,Pt=ne.length;Ce<et;Ce++,Pt++)ne[Pt]=je[Ce];return ne};Object.defineProperty(W,"__esModule",{value:!0}),W.resolveInstance=void 0;var $=R(16674),v=R(28421),ee=R(6867);function F(ne,je,Ce){var et=je.filter(function(nr){return nr.target!==null&&nr.target.type===v.TargetTypeEnum.ClassProperty}),Pt=et.map(Ce);return et.forEach(function(nr,xt){var Wt="";Wt=nr.target.name.value();var wt=Pt[xt];ne[Wt]=wt}),ne}function Q(ne,je){return new(ne.bind.apply(ne,Y([void 0],je)))}function re(ne,je){if(Reflect.hasMetadata(ee.POST_CONSTRUCT,ne)){var Ce=Reflect.getMetadata(ee.POST_CONSTRUCT,ne);try{je[Ce.value]()}catch(et){throw new Error($.POST_CONSTRUCT_ERROR(ne.name,et.message))}}}function Ee(ne,je,Ce){var et=null;if(je.length>0){var Pt=je.filter(function(xt){return xt.target!==null&&xt.target.type===v.TargetTypeEnum.ConstructorArgument}),nr=Pt.map(Ce);et=Q(ne,nr),et=F(et,je,Ce)}else et=new ne;return re(ne,et),et}W.resolveInstance=Ee},31927:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.resolve=void 0;var Y=R(16674),$=R(28421),v=R(85265),ee=R(55800),F=R(52279),Q=function(ne,je,Ce){try{return Ce()}catch(et){throw v.isStackOverflowExeption(et)?new Error(Y.CIRCULAR_DEPENDENCY_IN_FACTORY(ne,je.toString())):et}},re=function(ne){return function(je){je.parentContext.setCurrentRequest(je);var Ce=je.bindings,et=je.childRequests,Pt=je.target&&je.target.isArray(),nr=!je.parentRequest||!je.parentRequest.target||!je.target||!je.parentRequest.target.matchesArray(je.target.serviceIdentifier);if(Pt&&nr)return et.map(function(Jt){var X=re(ne);return X(Jt)});var xt=null;if(je.target.isOptional()&&Ce.length===0)return;var Wt=Ce[0],wt=Wt.scope===$.BindingScopeEnum.Singleton,st=Wt.scope===$.BindingScopeEnum.Request;if(wt&&Wt.activated)return Wt.cache;if(st&&ne!==null&&ne.has(Wt.id))return ne.get(Wt.id);if(Wt.type===$.BindingTypeEnum.ConstantValue)xt=Wt.cache,Wt.activated=!0;else if(Wt.type===$.BindingTypeEnum.Function)xt=Wt.cache,Wt.activated=!0;else if(Wt.type===$.BindingTypeEnum.Constructor)xt=Wt.implementationType;else if(Wt.type===$.BindingTypeEnum.DynamicValue&&Wt.dynamicValue!==null)xt=Q("toDynamicValue",Wt.serviceIdentifier,function(){return Wt.dynamicValue(je.parentContext)});else if(Wt.type===$.BindingTypeEnum.Factory&&Wt.factory!==null)xt=Q("toFactory",Wt.serviceIdentifier,function(){return Wt.factory(je.parentContext)});else if(Wt.type===$.BindingTypeEnum.Provider&&Wt.provider!==null)xt=Q("toProvider",Wt.serviceIdentifier,function(){return Wt.provider(je.parentContext)});else if(Wt.type===$.BindingTypeEnum.Instance&&Wt.implementationType!==null)xt=F.resolveInstance(Wt.implementationType,et,re(ne));else{var ut=ee.getServiceIdentifierAsString(je.serviceIdentifier);throw new Error(Y.INVALID_BINDING_TYPE+" "+ut)}return typeof Wt.onActivation=="function"&&(xt=Wt.onActivation(je.parentContext,xt)),wt&&(Wt.cache=xt,Wt.activated=!0),st&&ne!==null&&!ne.has(Wt.id)&&ne.set(Wt.id,xt),xt}};function Ee(ne){var je=re(ne.plan.rootRequest.requestScope);return je(ne.plan.rootRequest)}W.resolve=Ee},83366:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingInSyntax=void 0;var Y=R(28421),$=R(71325),v=function(){function ee(F){this._binding=F}return ee.prototype.inRequestScope=function(){return this._binding.scope=Y.BindingScopeEnum.Request,new $.BindingWhenOnSyntax(this._binding)},ee.prototype.inSingletonScope=function(){return this._binding.scope=Y.BindingScopeEnum.Singleton,new $.BindingWhenOnSyntax(this._binding)},ee.prototype.inTransientScope=function(){return this._binding.scope=Y.BindingScopeEnum.Transient,new $.BindingWhenOnSyntax(this._binding)},ee}();W.BindingInSyntax=v},74889:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingInWhenOnSyntax=void 0;var Y=R(83366),$=R(51811),v=R(98370),ee=function(){function F(Q){this._binding=Q,this._bindingWhenSyntax=new v.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new $.BindingOnSyntax(this._binding),this._bindingInSyntax=new Y.BindingInSyntax(Q)}return F.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},F.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},F.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},F.prototype.when=function(Q){return this._bindingWhenSyntax.when(Q)},F.prototype.whenTargetNamed=function(Q){return this._bindingWhenSyntax.whenTargetNamed(Q)},F.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},F.prototype.whenTargetTagged=function(Q,re){return this._bindingWhenSyntax.whenTargetTagged(Q,re)},F.prototype.whenInjectedInto=function(Q){return this._bindingWhenSyntax.whenInjectedInto(Q)},F.prototype.whenParentNamed=function(Q){return this._bindingWhenSyntax.whenParentNamed(Q)},F.prototype.whenParentTagged=function(Q,re){return this._bindingWhenSyntax.whenParentTagged(Q,re)},F.prototype.whenAnyAncestorIs=function(Q){return this._bindingWhenSyntax.whenAnyAncestorIs(Q)},F.prototype.whenNoAncestorIs=function(Q){return this._bindingWhenSyntax.whenNoAncestorIs(Q)},F.prototype.whenAnyAncestorNamed=function(Q){return this._bindingWhenSyntax.whenAnyAncestorNamed(Q)},F.prototype.whenAnyAncestorTagged=function(Q,re){return this._bindingWhenSyntax.whenAnyAncestorTagged(Q,re)},F.prototype.whenNoAncestorNamed=function(Q){return this._bindingWhenSyntax.whenNoAncestorNamed(Q)},F.prototype.whenNoAncestorTagged=function(Q,re){return this._bindingWhenSyntax.whenNoAncestorTagged(Q,re)},F.prototype.whenAnyAncestorMatches=function(Q){return this._bindingWhenSyntax.whenAnyAncestorMatches(Q)},F.prototype.whenNoAncestorMatches=function(Q){return this._bindingWhenSyntax.whenNoAncestorMatches(Q)},F.prototype.onActivation=function(Q){return this._bindingOnSyntax.onActivation(Q)},F}();W.BindingInWhenOnSyntax=ee},51811:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingOnSyntax=void 0;var Y=R(98370),$=function(){function v(ee){this._binding=ee}return v.prototype.onActivation=function(ee){return this._binding.onActivation=ee,new Y.BindingWhenSyntax(this._binding)},v}();W.BindingOnSyntax=$},15451:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingToSyntax=void 0;var Y=R(16674),$=R(28421),v=R(74889),ee=R(71325),F=function(){function Q(re){this._binding=re}return Q.prototype.to=function(re){return this._binding.type=$.BindingTypeEnum.Instance,this._binding.implementationType=re,new v.BindingInWhenOnSyntax(this._binding)},Q.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Y.INVALID_TO_SELF_VALUE);var re=this._binding.serviceIdentifier;return this.to(re)},Q.prototype.toConstantValue=function(re){return this._binding.type=$.BindingTypeEnum.ConstantValue,this._binding.cache=re,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=$.BindingScopeEnum.Singleton,new ee.BindingWhenOnSyntax(this._binding)},Q.prototype.toDynamicValue=function(re){return this._binding.type=$.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=re,this._binding.implementationType=null,new v.BindingInWhenOnSyntax(this._binding)},Q.prototype.toConstructor=function(re){return this._binding.type=$.BindingTypeEnum.Constructor,this._binding.implementationType=re,this._binding.scope=$.BindingScopeEnum.Singleton,new ee.BindingWhenOnSyntax(this._binding)},Q.prototype.toFactory=function(re){return this._binding.type=$.BindingTypeEnum.Factory,this._binding.factory=re,this._binding.scope=$.BindingScopeEnum.Singleton,new ee.BindingWhenOnSyntax(this._binding)},Q.prototype.toFunction=function(re){if(typeof re!="function")throw new Error(Y.INVALID_FUNCTION_BINDING);var Ee=this.toConstantValue(re);return this._binding.type=$.BindingTypeEnum.Function,this._binding.scope=$.BindingScopeEnum.Singleton,Ee},Q.prototype.toAutoFactory=function(re){return this._binding.type=$.BindingTypeEnum.Factory,this._binding.factory=function(Ee){var ne=function(){return Ee.container.get(re)};return ne},this._binding.scope=$.BindingScopeEnum.Singleton,new ee.BindingWhenOnSyntax(this._binding)},Q.prototype.toProvider=function(re){return this._binding.type=$.BindingTypeEnum.Provider,this._binding.provider=re,this._binding.scope=$.BindingScopeEnum.Singleton,new ee.BindingWhenOnSyntax(this._binding)},Q.prototype.toService=function(re){this.toDynamicValue(function(Ee){return Ee.container.get(re)})},Q}();W.BindingToSyntax=F},71325:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingWhenOnSyntax=void 0;var Y=R(51811),$=R(98370),v=function(){function ee(F){this._binding=F,this._bindingWhenSyntax=new $.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Y.BindingOnSyntax(this._binding)}return ee.prototype.when=function(F){return this._bindingWhenSyntax.when(F)},ee.prototype.whenTargetNamed=function(F){return this._bindingWhenSyntax.whenTargetNamed(F)},ee.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},ee.prototype.whenTargetTagged=function(F,Q){return this._bindingWhenSyntax.whenTargetTagged(F,Q)},ee.prototype.whenInjectedInto=function(F){return this._bindingWhenSyntax.whenInjectedInto(F)},ee.prototype.whenParentNamed=function(F){return this._bindingWhenSyntax.whenParentNamed(F)},ee.prototype.whenParentTagged=function(F,Q){return this._bindingWhenSyntax.whenParentTagged(F,Q)},ee.prototype.whenAnyAncestorIs=function(F){return this._bindingWhenSyntax.whenAnyAncestorIs(F)},ee.prototype.whenNoAncestorIs=function(F){return this._bindingWhenSyntax.whenNoAncestorIs(F)},ee.prototype.whenAnyAncestorNamed=function(F){return this._bindingWhenSyntax.whenAnyAncestorNamed(F)},ee.prototype.whenAnyAncestorTagged=function(F,Q){return this._bindingWhenSyntax.whenAnyAncestorTagged(F,Q)},ee.prototype.whenNoAncestorNamed=function(F){return this._bindingWhenSyntax.whenNoAncestorNamed(F)},ee.prototype.whenNoAncestorTagged=function(F,Q){return this._bindingWhenSyntax.whenNoAncestorTagged(F,Q)},ee.prototype.whenAnyAncestorMatches=function(F){return this._bindingWhenSyntax.whenAnyAncestorMatches(F)},ee.prototype.whenNoAncestorMatches=function(F){return this._bindingWhenSyntax.whenNoAncestorMatches(F)},ee.prototype.onActivation=function(F){return this._bindingOnSyntax.onActivation(F)},ee}();W.BindingWhenOnSyntax=v},98370:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.BindingWhenSyntax=void 0;var Y=R(51811),$=R(80758),v=function(){function ee(F){this._binding=F}return ee.prototype.when=function(F){return this._binding.constraint=F,new Y.BindingOnSyntax(this._binding)},ee.prototype.whenTargetNamed=function(F){return this._binding.constraint=$.namedConstraint(F),new Y.BindingOnSyntax(this._binding)},ee.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(F){var Q=F.target!==null&&!F.target.isNamed()&&!F.target.isTagged();return Q},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenTargetTagged=function(F,Q){return this._binding.constraint=$.taggedConstraint(F)(Q),new Y.BindingOnSyntax(this._binding)},ee.prototype.whenInjectedInto=function(F){return this._binding.constraint=function(Q){return $.typeConstraint(F)(Q.parentRequest)},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenParentNamed=function(F){return this._binding.constraint=function(Q){return $.namedConstraint(F)(Q.parentRequest)},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenParentTagged=function(F,Q){return this._binding.constraint=function(re){return $.taggedConstraint(F)(Q)(re.parentRequest)},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenAnyAncestorIs=function(F){return this._binding.constraint=function(Q){return $.traverseAncerstors(Q,$.typeConstraint(F))},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenNoAncestorIs=function(F){return this._binding.constraint=function(Q){return!$.traverseAncerstors(Q,$.typeConstraint(F))},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenAnyAncestorNamed=function(F){return this._binding.constraint=function(Q){return $.traverseAncerstors(Q,$.namedConstraint(F))},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenNoAncestorNamed=function(F){return this._binding.constraint=function(Q){return!$.traverseAncerstors(Q,$.namedConstraint(F))},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenAnyAncestorTagged=function(F,Q){return this._binding.constraint=function(re){return $.traverseAncerstors(re,$.taggedConstraint(F)(Q))},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenNoAncestorTagged=function(F,Q){return this._binding.constraint=function(re){return!$.traverseAncerstors(re,$.taggedConstraint(F)(Q))},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenAnyAncestorMatches=function(F){return this._binding.constraint=function(Q){return $.traverseAncerstors(Q,F)},new Y.BindingOnSyntax(this._binding)},ee.prototype.whenNoAncestorMatches=function(F){return this._binding.constraint=function(Q){return!$.traverseAncerstors(Q,F)},new Y.BindingOnSyntax(this._binding)},ee}();W.BindingWhenSyntax=v},80758:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.typeConstraint=W.namedConstraint=W.taggedConstraint=W.traverseAncerstors=void 0;var Y=R(6867),$=R(47738),v=function(re,Ee){var ne=re.parentRequest;return ne!==null?Ee(ne)?!0:v(ne,Ee):!1};W.traverseAncerstors=v;var ee=function(re){return function(Ee){var ne=function(je){return je!==null&&je.target!==null&&je.target.matchesTag(re)(Ee)};return ne.metaData=new $.Metadata(re,Ee),ne}};W.taggedConstraint=ee;var F=ee(Y.NAMED_TAG);W.namedConstraint=F;var Q=function(re){return function(Ee){var ne=null;if(Ee!==null)if(ne=Ee.bindings[0],typeof re=="string"){var je=ne.serviceIdentifier;return je===re}else{var Ce=Ee.bindings[0].implementationType;return re===Ce}return!1}};W.typeConstraint=Q},70600:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.multiBindToService=void 0;var R=function(Y){return function($){return function(){for(var v=[],ee=0;ee<arguments.length;ee++)v[ee]=arguments[ee];return v.forEach(function(F){return Y.bind(F).toService($)})}}};W.multiBindToService=R},85265:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.isStackOverflowExeption=void 0;var Y=R(16674);function $(v){return v instanceof RangeError||v.message===Y.STACK_OVERFLOW}W.isStackOverflowExeption=$},37791:function(Ue,W){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.id=void 0;var R=0;function Y(){return R++}W.id=Y},55800:function(Ue,W,R){"use strict";Object.defineProperty(W,"__esModule",{value:!0}),W.circularDependencyToException=W.listMetadataForTarget=W.listRegisteredBindingsForServiceIdentifier=W.getServiceIdentifierAsString=W.getFunctionName=void 0;var Y=R(16674);function $(ne){if(typeof ne=="function"){var je=ne;return je.name}else{if(typeof ne=="symbol")return ne.toString();var je=ne;return je}}W.getServiceIdentifierAsString=$;function v(ne,je,Ce){var et="",Pt=Ce(ne,je);return Pt.length!==0&&(et=`
Registered bindings:`,Pt.forEach(function(nr){var xt="Object";nr.implementationType!==null&&(xt=Ee(nr.implementationType)),et=et+`
 `+xt,nr.constraint.metaData&&(et=et+" - "+nr.constraint.metaData)})),et}W.listRegisteredBindingsForServiceIdentifier=v;function ee(ne,je){return ne.parentRequest===null?!1:ne.parentRequest.serviceIdentifier===je?!0:ee(ne.parentRequest,je)}function F(ne){function je(et,Pt){Pt===void 0&&(Pt=[]);var nr=$(et.serviceIdentifier);return Pt.push(nr),et.parentRequest!==null?je(et.parentRequest,Pt):Pt}var Ce=je(ne);return Ce.reverse().join(" --> ")}function Q(ne){ne.childRequests.forEach(function(je){if(ee(je,je.serviceIdentifier)){var Ce=F(je);throw new Error(Y.CIRCULAR_DEPENDENCY+" "+Ce)}else Q(je)})}W.circularDependencyToException=Q;function re(ne,je){if(je.isTagged()||je.isNamed()){var Ce="",et=je.getNamedTag(),Pt=je.getCustomTags();return et!==null&&(Ce+=et.toString()+`
`),Pt!==null&&Pt.forEach(function(nr){Ce+=nr.toString()+`
`})," "+ne+`
 `+ne+" - "+Ce}else return" "+ne}W.listMetadataForTarget=re;function Ee(ne){if(ne.name)return ne.name;var je=ne.toString(),Ce=je.match(/^function\s*([^\s(]+)/);return Ce?Ce[1]:"Anonymous function: "+je}W.getFunctionName=Ee},31745:function(Ue){"use strict";Ue.exports=R,Ue.exports.default=R;var W=1e20;function R(F,Q,re,Ee,ne,je){this.fontSize=F||24,this.buffer=Q===void 0?3:Q,this.cutoff=Ee||.25,this.fontFamily=ne||"sans-serif",this.fontWeight=je||"normal",this.radius=re||8;var Ce=this.size=this.fontSize+this.buffer*2,et=Ce+this.buffer*2,Pt=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";Pt?this.canvas=my.createOffscreenCanvas(Ce,Ce,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=Ce),this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(et*et),this.gridInner=new Float64Array(et*et),this.f=new Float64Array(et),this.z=new Float64Array(et+1),this.v=new Uint16Array(et),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,Pt?this.middle=Math.round(Ce/2*1):this.middle=Math.round(Ce/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Y(F,Q,re,Ee,ne,je,Ce){je.fill(W,0,Q*re),Ce.fill(0,0,Q*re);for(var et=(Q-Ee)/2,Pt=0;Pt<ne;Pt++)for(var nr=0;nr<Ee;nr++){var xt=(Pt+et)*Q+nr+et,Wt=F.data[4*(Pt*Ee+nr)+3]/255;if(Wt===1)je[xt]=0,Ce[xt]=W;else if(Wt===0)je[xt]=W,Ce[xt]=0;else{var wt=Math.max(0,.5-Wt),st=Math.max(0,Wt-.5);je[xt]=wt*wt,Ce[xt]=st*st}}}function $(F,Q,re,Ee,ne,je,Ce){for(var et=0;et<Q*re;et++){var Pt=Math.sqrt(Ee[et])-Math.sqrt(ne[et]);F[et]=Math.round(255-255*(Pt/je+Ce))}}R.prototype._draw=function(F,Q){var re=this.ctx.measureText(F),Ee=re.width,ne=2*this.buffer,je,Ce,et,Pt,nr,xt,Wt,wt;Q&&this.useMetrics?(nr=Math.floor(re.actualBoundingBoxAscent),wt=this.buffer+Math.ceil(re.actualBoundingBoxAscent),xt=this.buffer,Wt=this.buffer,Ce=Math.min(this.size,Math.ceil(re.actualBoundingBoxRight-re.actualBoundingBoxLeft)),Pt=Math.min(this.size-xt,Math.ceil(re.actualBoundingBoxAscent+re.actualBoundingBoxDescent)),je=Ce+ne,et=Pt+ne,this.ctx.textBaseline="alphabetic"):(je=Ce=this.size,et=Pt=this.size,nr=19*this.fontSize/24,xt=Wt=0,wt=this.middle,this.ctx.textBaseline="middle");var st;Ce&&Pt&&(this.ctx.clearRect(Wt,xt,Ce,Pt),this.ctx.fillText(F,this.buffer,wt),st=this.ctx.getImageData(Wt,xt,Ce,Pt));var ut=new Uint8ClampedArray(je*et);return Y(st,je,et,Ce,Pt,this.gridOuter,this.gridInner),v(this.gridOuter,je,et,this.f,this.v,this.z),v(this.gridInner,je,et,this.f,this.v,this.z),$(ut,je,et,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:ut,metrics:{width:Ce,height:Pt,sdfWidth:je,sdfHeight:et,top:nr,left:0,advance:Ee}}},R.prototype.draw=function(F){return this._draw(F,!1).data},R.prototype.drawWithMetrics=function(F){return this._draw(F,!0)};function v(F,Q,re,Ee,ne,je){for(var Ce=0;Ce<Q;Ce++)ee(F,Ce,Q,re,Ee,ne,je);for(var et=0;et<re;et++)ee(F,et*Q,1,Q,Ee,ne,je)}function ee(F,Q,re,Ee,ne,je,Ce){var et,Pt,nr,xt;for(je[0]=0,Ce[0]=-W,Ce[1]=W,et=0;et<Ee;et++)ne[et]=F[Q+et*re];for(et=1,Pt=0,nr=0;et<Ee;et++){do xt=je[Pt],nr=(ne[et]-ne[xt]+et*et-xt*xt)/(et-xt)/2;while(nr<=Ce[Pt]&&--Pt>-1);Pt++,je[Pt]=et,Ce[Pt]=nr,Ce[Pt+1]=W}for(et=0,Pt=0;et<Ee;et++){for(;Ce[Pt+1]<et;)Pt++;xt=je[Pt],F[Q+et*re]=ne[xt]+(et-xt)*(et-xt)}}},18857:function(Ue,W,R){"use strict";R.r(W),R.d(W,{Function:function(){return iu},Interpreter:function(){return yo},default:function(){return Zu},evaluate:function(){return Uu},vm:function(){return Y}});var Y={};R.r(Y),R.d(Y,{Script:function(){return El},compileFunction:function(){return xc},createContext:function(){return Wl},runInContext:function(){return zu},runInNewContext:function(){return bc}});var $={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},v="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",ee={5:v,"5module":v+" export import",6:v+" const class extends export import super"},F=/^in(stanceof)?$/,Q="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",re="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Ee=new RegExp("["+Q+"]"),ne=new RegExp("["+Q+re+"]");Q=re=null;var je=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],Ce=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function et(g,w){for(var B=65536,O=0;O<w.length;O+=2){if(B+=w[O],B>g)return!1;if(B+=w[O+1],B>=g)return!0}}function Pt(g,w){return g<65?g===36:g<91?!0:g<97?g===95:g<123?!0:g<=65535?g>=170&&Ee.test(String.fromCharCode(g)):w===!1?!1:et(g,je)}function nr(g,w){return g<48?g===36:g<58?!0:g<65?!1:g<91?!0:g<97?g===95:g<123?!0:g<=65535?g>=170&&ne.test(String.fromCharCode(g)):w===!1?!1:et(g,je)||et(g,Ce)}var xt=function(w,B){B===void 0&&(B={}),this.label=w,this.keyword=B.keyword,this.beforeExpr=!!B.beforeExpr,this.startsExpr=!!B.startsExpr,this.isLoop=!!B.isLoop,this.isAssign=!!B.isAssign,this.prefix=!!B.prefix,this.postfix=!!B.postfix,this.binop=B.binop||null,this.updateContext=null};function Wt(g,w){return new xt(g,{beforeExpr:!0,binop:w})}var wt={beforeExpr:!0},st={startsExpr:!0},ut={};function Jt(g,w){return w===void 0&&(w={}),w.keyword=g,ut[g]=new xt(g,w)}var X={num:new xt("num",st),regexp:new xt("regexp",st),string:new xt("string",st),name:new xt("name",st),eof:new xt("eof"),bracketL:new xt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new xt("]"),braceL:new xt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new xt("}"),parenL:new xt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new xt(")"),comma:new xt(",",wt),semi:new xt(";",wt),colon:new xt(":",wt),dot:new xt("."),question:new xt("?",wt),questionDot:new xt("?."),arrow:new xt("=>",wt),template:new xt("template"),invalidTemplate:new xt("invalidTemplate"),ellipsis:new xt("...",wt),backQuote:new xt("`",st),dollarBraceL:new xt("${",{beforeExpr:!0,startsExpr:!0}),eq:new xt("=",{beforeExpr:!0,isAssign:!0}),assign:new xt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new xt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new xt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:Wt("||",1),logicalAND:Wt("&&",2),bitwiseOR:Wt("|",3),bitwiseXOR:Wt("^",4),bitwiseAND:Wt("&",5),equality:Wt("==/!=/===/!==",6),relational:Wt("</>/<=/>=",7),bitShift:Wt("<</>>/>>>",8),plusMin:new xt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:Wt("%",10),star:Wt("*",10),slash:Wt("/",10),starstar:new xt("**",{beforeExpr:!0}),coalesce:Wt("??",1),_break:Jt("break"),_case:Jt("case",wt),_catch:Jt("catch"),_continue:Jt("continue"),_debugger:Jt("debugger"),_default:Jt("default",wt),_do:Jt("do",{isLoop:!0,beforeExpr:!0}),_else:Jt("else",wt),_finally:Jt("finally"),_for:Jt("for",{isLoop:!0}),_function:Jt("function",st),_if:Jt("if"),_return:Jt("return",wt),_switch:Jt("switch"),_throw:Jt("throw",wt),_try:Jt("try"),_var:Jt("var"),_const:Jt("const"),_while:Jt("while",{isLoop:!0}),_with:Jt("with"),_new:Jt("new",{beforeExpr:!0,startsExpr:!0}),_this:Jt("this",st),_super:Jt("super",st),_class:Jt("class",st),_extends:Jt("extends",wt),_export:Jt("export"),_import:Jt("import",st),_null:Jt("null",st),_true:Jt("true",st),_false:Jt("false",st),_in:Jt("in",{beforeExpr:!0,binop:7}),_instanceof:Jt("instanceof",{beforeExpr:!0,binop:7}),_typeof:Jt("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:Jt("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:Jt("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},Xt=/\r\n?|\n|\u2028|\u2029/,vt=new RegExp(Xt.source,"g");function qe(g,w){return g===10||g===13||!w&&(g===8232||g===8233)}var pt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,$e=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,kt=Object.prototype,xr=kt.hasOwnProperty,Ir=kt.toString;function Wr(g,w){return xr.call(g,w)}var Me=Array.isArray||function(g){return Ir.call(g)==="[object Array]"};function Ye(g){return new RegExp("^(?:"+g.replace(/ /g,"|")+")$")}var Fe=function(w,B){this.line=w,this.column=B};Fe.prototype.offset=function(w){return new Fe(this.line,this.column+w)};var At=function(w,B,O){this.start=B,this.end=O,w.sourceFile!==null&&(this.source=w.sourceFile)};function gt(g,w){for(var B=1,O=0;;){vt.lastIndex=O;var q=vt.exec(g);if(q&&q.index<w)++B,O=q.index+q[0].length;else return new Fe(B,w-O)}}var Nt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function qt(g){var w={};for(var B in Nt)w[B]=g&&Wr(g,B)?g[B]:Nt[B];if(w.ecmaVersion>=2015&&(w.ecmaVersion-=2009),w.allowReserved==null&&(w.allowReserved=w.ecmaVersion<5),Me(w.onToken)){var O=w.onToken;w.onToken=function(q){return O.push(q)}}return Me(w.onComment)&&(w.onComment=Cr(w,w.onComment)),w}function Cr(g,w){return function(B,O,q,_e,Xe,ct){var mt={type:B?"Block":"Line",value:O,start:q,end:_e};g.locations&&(mt.loc=new At(this,Xe,ct)),g.ranges&&(mt.range=[q,_e]),w.push(mt)}}var Wn=1,hn=2,Yi=Wn|hn,Un=4,Gn=8,di=16,Xn=32,ai=64,aa=128;function Ri(g,w){return hn|(g?Un:0)|(w?Gn:0)}var Ei=0,ji=1,ua=2,Si=3,ba=4,Mn=5,_i=function(w,B,O){this.options=w=qt(w),this.sourceFile=w.sourceFile,this.keywords=Ye(ee[w.ecmaVersion>=6?6:w.sourceType==="module"?"5module":5]);var q="";if(w.allowReserved!==!0){for(var _e=w.ecmaVersion;!(q=$[_e]);_e--);w.sourceType==="module"&&(q+=" await")}this.reservedWords=Ye(q);var Xe=(q?q+" ":"")+$.strict;this.reservedWordsStrict=Ye(Xe),this.reservedWordsStrictBind=Ye(Xe+" "+$.strictBind),this.input=String(B),this.containsEsc=!1,O?(this.pos=O,this.lineStart=this.input.lastIndexOf(`
`,O-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(Xt).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=X.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=w.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&w.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Wn),this.regexpState=null},Ui={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};_i.prototype.parse=function(){var w=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(w)},Ui.inFunction.get=function(){return(this.currentVarScope().flags&hn)>0},Ui.inGenerator.get=function(){return(this.currentVarScope().flags&Gn)>0},Ui.inAsync.get=function(){return(this.currentVarScope().flags&Un)>0},Ui.allowSuper.get=function(){return(this.currentThisScope().flags&ai)>0},Ui.allowDirectSuper.get=function(){return(this.currentThisScope().flags&aa)>0},Ui.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},_i.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&hn)>0},_i.extend=function(){for(var w=[],B=arguments.length;B--;)w[B]=arguments[B];for(var O=this,q=0;q<w.length;q++)O=w[q](O);return O},_i.parse=function(w,B){return new this(B,w).parse()},_i.parseExpressionAt=function(w,B,O){var q=new this(O,w,B);return q.nextToken(),q.parseExpression()},_i.tokenizer=function(w,B){return new this(B,w)},Object.defineProperties(_i.prototype,Ui);var qi=_i.prototype,Ga=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;qi.strictDirective=function(g){for(;;){$e.lastIndex=g,g+=$e.exec(this.input)[0].length;var w=Ga.exec(this.input.slice(g));if(!w)return!1;if((w[1]||w[2])==="use strict"){$e.lastIndex=g+w[0].length;var B=$e.exec(this.input),O=B.index+B[0].length,q=this.input.charAt(O);return q===";"||q==="}"||Xt.test(B[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(q)||q==="!"&&this.input.charAt(O+1)==="=")}g+=w[0].length,$e.lastIndex=g,g+=$e.exec(this.input)[0].length,this.input[g]===";"&&g++}},qi.eat=function(g){return this.type===g?(this.next(),!0):!1},qi.isContextual=function(g){return this.type===X.name&&this.value===g&&!this.containsEsc},qi.eatContextual=function(g){return this.isContextual(g)?(this.next(),!0):!1},qi.expectContextual=function(g){this.eatContextual(g)||this.unexpected()},qi.canInsertSemicolon=function(){return this.type===X.eof||this.type===X.braceR||Xt.test(this.input.slice(this.lastTokEnd,this.start))},qi.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},qi.semicolon=function(){!this.eat(X.semi)&&!this.insertSemicolon()&&this.unexpected()},qi.afterTrailingComma=function(g,w){if(this.type===g)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),w||this.next(),!0},qi.expect=function(g){this.eat(g)||this.unexpected()},qi.unexpected=function(g){this.raise(g!=null?g:this.start,"Unexpected token")};function ve(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}qi.checkPatternErrors=function(g,w){if(!!g){g.trailingComma>-1&&this.raiseRecoverable(g.trailingComma,"Comma is not permitted after the rest element");var B=w?g.parenthesizedAssign:g.parenthesizedBind;B>-1&&this.raiseRecoverable(B,"Parenthesized pattern")}},qi.checkExpressionErrors=function(g,w){if(!g)return!1;var B=g.shorthandAssign,O=g.doubleProto;if(!w)return B>=0||O>=0;B>=0&&this.raise(B,"Shorthand property assignments are valid only in destructuring patterns"),O>=0&&this.raiseRecoverable(O,"Redefinition of __proto__ property")},qi.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},qi.isSimpleAssignTarget=function(g){return g.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(g.expression):g.type==="Identifier"||g.type==="MemberExpression"};var Ln=_i.prototype;Ln.parseTopLevel=function(g){var w={};for(g.body||(g.body=[]);this.type!==X.eof;){var B=this.parseStatement(null,!0,w);g.body.push(B)}if(this.inModule)for(var O=0,q=Object.keys(this.undefinedExports);O<q.length;O+=1){var _e=q[O];this.raiseRecoverable(this.undefinedExports[_e].start,"Export '"+_e+"' is not defined")}return this.adaptDirectivePrologue(g.body),this.next(),g.sourceType=this.options.sourceType,this.finishNode(g,"Program")};var Ha={kind:"loop"},os={kind:"switch"};Ln.isLet=function(g){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;$e.lastIndex=this.pos;var w=$e.exec(this.input),B=this.pos+w[0].length,O=this.input.charCodeAt(B);if(O===91)return!0;if(g)return!1;if(O===123)return!0;if(Pt(O,!0)){for(var q=B+1;nr(this.input.charCodeAt(q),!0);)++q;var _e=this.input.slice(B,q);if(!F.test(_e))return!0}return!1},Ln.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;$e.lastIndex=this.pos;var g=$e.exec(this.input),w=this.pos+g[0].length;return!Xt.test(this.input.slice(this.pos,w))&&this.input.slice(w,w+8)==="function"&&(w+8===this.input.length||!nr(this.input.charAt(w+8)))},Ln.parseStatement=function(g,w,B){var O=this.type,q=this.startNode(),_e;switch(this.isLet(g)&&(O=X._var,_e="let"),O){case X._break:case X._continue:return this.parseBreakContinueStatement(q,O.keyword);case X._debugger:return this.parseDebuggerStatement(q);case X._do:return this.parseDoStatement(q);case X._for:return this.parseForStatement(q);case X._function:return g&&(this.strict||g!=="if"&&g!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(q,!1,!g);case X._class:return g&&this.unexpected(),this.parseClass(q,!0);case X._if:return this.parseIfStatement(q);case X._return:return this.parseReturnStatement(q);case X._switch:return this.parseSwitchStatement(q);case X._throw:return this.parseThrowStatement(q);case X._try:return this.parseTryStatement(q);case X._const:case X._var:return _e=_e||this.value,g&&_e!=="var"&&this.unexpected(),this.parseVarStatement(q,_e);case X._while:return this.parseWhileStatement(q);case X._with:return this.parseWithStatement(q);case X.braceL:return this.parseBlock(!0,q);case X.semi:return this.parseEmptyStatement(q);case X._export:case X._import:if(this.options.ecmaVersion>10&&O===X._import){$e.lastIndex=this.pos;var Xe=$e.exec(this.input),ct=this.pos+Xe[0].length,mt=this.input.charCodeAt(ct);if(mt===40||mt===46)return this.parseExpressionStatement(q,this.parseExpression())}return this.options.allowImportExportEverywhere||(w||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),O===X._import?this.parseImport(q):this.parseExport(q,B);default:if(this.isAsyncFunction())return g&&this.unexpected(),this.next(),this.parseFunctionStatement(q,!0,!g);var lr=this.value,Er=this.parseExpression();return O===X.name&&Er.type==="Identifier"&&this.eat(X.colon)?this.parseLabeledStatement(q,lr,Er,g):this.parseExpressionStatement(q,Er)}},Ln.parseBreakContinueStatement=function(g,w){var B=w==="break";this.next(),this.eat(X.semi)||this.insertSemicolon()?g.label=null:this.type!==X.name?this.unexpected():(g.label=this.parseIdent(),this.semicolon());for(var O=0;O<this.labels.length;++O){var q=this.labels[O];if((g.label==null||q.name===g.label.name)&&(q.kind!=null&&(B||q.kind==="loop")||g.label&&B))break}return O===this.labels.length&&this.raise(g.start,"Unsyntactic "+w),this.finishNode(g,B?"BreakStatement":"ContinueStatement")},Ln.parseDebuggerStatement=function(g){return this.next(),this.semicolon(),this.finishNode(g,"DebuggerStatement")},Ln.parseDoStatement=function(g){return this.next(),this.labels.push(Ha),g.body=this.parseStatement("do"),this.labels.pop(),this.expect(X._while),g.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(X.semi):this.semicolon(),this.finishNode(g,"DoWhileStatement")},Ln.parseForStatement=function(g){this.next();var w=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Ha),this.enterScope(0),this.expect(X.parenL),this.type===X.semi)return w>-1&&this.unexpected(w),this.parseFor(g,null);var B=this.isLet();if(this.type===X._var||this.type===X._const||B){var O=this.startNode(),q=B?"let":this.value;return this.next(),this.parseVar(O,!0,q),this.finishNode(O,"VariableDeclaration"),(this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&O.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===X._in?w>-1&&this.unexpected(w):g.await=w>-1),this.parseForIn(g,O)):(w>-1&&this.unexpected(w),this.parseFor(g,O))}var _e=new ve,Xe=this.parseExpression(!0,_e);return this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===X._in?w>-1&&this.unexpected(w):g.await=w>-1),this.toAssignable(Xe,!1,_e),this.checkLVal(Xe),this.parseForIn(g,Xe)):(this.checkExpressionErrors(_e,!0),w>-1&&this.unexpected(w),this.parseFor(g,Xe))},Ln.parseFunctionStatement=function(g,w,B){return this.next(),this.parseFunction(g,ir|(B?0:Pr),!1,w)},Ln.parseIfStatement=function(g){return this.next(),g.test=this.parseParenExpression(),g.consequent=this.parseStatement("if"),g.alternate=this.eat(X._else)?this.parseStatement("if"):null,this.finishNode(g,"IfStatement")},Ln.parseReturnStatement=function(g){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(X.semi)||this.insertSemicolon()?g.argument=null:(g.argument=this.parseExpression(),this.semicolon()),this.finishNode(g,"ReturnStatement")},Ln.parseSwitchStatement=function(g){this.next(),g.discriminant=this.parseParenExpression(),g.cases=[],this.expect(X.braceL),this.labels.push(os),this.enterScope(0);for(var w,B=!1;this.type!==X.braceR;)if(this.type===X._case||this.type===X._default){var O=this.type===X._case;w&&this.finishNode(w,"SwitchCase"),g.cases.push(w=this.startNode()),w.consequent=[],this.next(),O?w.test=this.parseExpression():(B&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),B=!0,w.test=null),this.expect(X.colon)}else w||this.unexpected(),w.consequent.push(this.parseStatement(null));return this.exitScope(),w&&this.finishNode(w,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(g,"SwitchStatement")},Ln.parseThrowStatement=function(g){return this.next(),Xt.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),g.argument=this.parseExpression(),this.semicolon(),this.finishNode(g,"ThrowStatement")};var Ut=[];Ln.parseTryStatement=function(g){if(this.next(),g.block=this.parseBlock(),g.handler=null,this.type===X._catch){var w=this.startNode();if(this.next(),this.eat(X.parenL)){w.param=this.parseBindingAtom();var B=w.param.type==="Identifier";this.enterScope(B?Xn:0),this.checkLVal(w.param,B?ba:ua),this.expect(X.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),w.param=null,this.enterScope(0);w.body=this.parseBlock(!1),this.exitScope(),g.handler=this.finishNode(w,"CatchClause")}return g.finalizer=this.eat(X._finally)?this.parseBlock():null,!g.handler&&!g.finalizer&&this.raise(g.start,"Missing catch or finally clause"),this.finishNode(g,"TryStatement")},Ln.parseVarStatement=function(g,w){return this.next(),this.parseVar(g,!1,w),this.semicolon(),this.finishNode(g,"VariableDeclaration")},Ln.parseWhileStatement=function(g){return this.next(),g.test=this.parseParenExpression(),this.labels.push(Ha),g.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(g,"WhileStatement")},Ln.parseWithStatement=function(g){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),g.object=this.parseParenExpression(),g.body=this.parseStatement("with"),this.finishNode(g,"WithStatement")},Ln.parseEmptyStatement=function(g){return this.next(),this.finishNode(g,"EmptyStatement")},Ln.parseLabeledStatement=function(g,w,B,O){for(var q=0,_e=this.labels;q<_e.length;q+=1){var Xe=_e[q];Xe.name===w&&this.raise(B.start,"Label '"+w+"' is already declared")}for(var ct=this.type.isLoop?"loop":this.type===X._switch?"switch":null,mt=this.labels.length-1;mt>=0;mt--){var lr=this.labels[mt];if(lr.statementStart===g.start)lr.statementStart=this.start,lr.kind=ct;else break}return this.labels.push({name:w,kind:ct,statementStart:this.start}),g.body=this.parseStatement(O?O.indexOf("label")===-1?O+"label":O:"label"),this.labels.pop(),g.label=B,this.finishNode(g,"LabeledStatement")},Ln.parseExpressionStatement=function(g,w){return g.expression=w,this.semicolon(),this.finishNode(g,"ExpressionStatement")},Ln.parseBlock=function(g,w,B){for(g===void 0&&(g=!0),w===void 0&&(w=this.startNode()),w.body=[],this.expect(X.braceL),g&&this.enterScope(0);this.type!==X.braceR;){var O=this.parseStatement(null);w.body.push(O)}return B&&(this.strict=!1),this.next(),g&&this.exitScope(),this.finishNode(w,"BlockStatement")},Ln.parseFor=function(g,w){return g.init=w,this.expect(X.semi),g.test=this.type===X.semi?null:this.parseExpression(),this.expect(X.semi),g.update=this.type===X.parenR?null:this.parseExpression(),this.expect(X.parenR),g.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(g,"ForStatement")},Ln.parseForIn=function(g,w){var B=this.type===X._in;return this.next(),w.type==="VariableDeclaration"&&w.declarations[0].init!=null&&(!B||this.options.ecmaVersion<8||this.strict||w.kind!=="var"||w.declarations[0].id.type!=="Identifier")?this.raise(w.start,(B?"for-in":"for-of")+" loop variable declaration may not have an initializer"):w.type==="AssignmentPattern"&&this.raise(w.start,"Invalid left-hand side in for-loop"),g.left=w,g.right=B?this.parseExpression():this.parseMaybeAssign(),this.expect(X.parenR),g.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(g,B?"ForInStatement":"ForOfStatement")},Ln.parseVar=function(g,w,B){for(g.declarations=[],g.kind=B;;){var O=this.startNode();if(this.parseVarId(O,B),this.eat(X.eq)?O.init=this.parseMaybeAssign(w):B==="const"&&!(this.type===X._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():O.id.type!=="Identifier"&&!(w&&(this.type===X._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):O.init=null,g.declarations.push(this.finishNode(O,"VariableDeclarator")),!this.eat(X.comma))break}return g},Ln.parseVarId=function(g,w){g.id=this.parseBindingAtom(),this.checkLVal(g.id,w==="var"?ji:ua,!1)};var ir=1,Pr=2,I=4;Ln.parseFunction=function(g,w,B,O){this.initFunction(g),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!O)&&(this.type===X.star&&w&Pr&&this.unexpected(),g.generator=this.eat(X.star)),this.options.ecmaVersion>=8&&(g.async=!!O),w&ir&&(g.id=w&I&&this.type!==X.name?null:this.parseIdent(),g.id&&!(w&Pr)&&this.checkLVal(g.id,this.strict||g.generator||g.async?this.treatFunctionsAsVar?ji:ua:Si));var q=this.yieldPos,_e=this.awaitPos,Xe=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ri(g.async,g.generator)),w&ir||(g.id=this.type===X.name?this.parseIdent():null),this.parseFunctionParams(g),this.parseFunctionBody(g,B,!1),this.yieldPos=q,this.awaitPos=_e,this.awaitIdentPos=Xe,this.finishNode(g,w&ir?"FunctionDeclaration":"FunctionExpression")},Ln.parseFunctionParams=function(g){this.expect(X.parenL),g.params=this.parseBindingList(X.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Ln.parseClass=function(g,w){this.next();var B=this.strict;this.strict=!0,this.parseClassId(g,w),this.parseClassSuper(g);var O=this.startNode(),q=!1;for(O.body=[],this.expect(X.braceL);this.type!==X.braceR;){var _e=this.parseClassElement(g.superClass!==null);_e&&(O.body.push(_e),_e.type==="MethodDefinition"&&_e.kind==="constructor"&&(q&&this.raise(_e.start,"Duplicate constructor in the same class"),q=!0))}return this.strict=B,this.next(),g.body=this.finishNode(O,"ClassBody"),this.finishNode(g,w?"ClassDeclaration":"ClassExpression")},Ln.parseClassElement=function(g){var w=this;if(this.eat(X.semi))return null;var B=this.startNode(),O=function(mt,lr){lr===void 0&&(lr=!1);var Er=w.start,In=w.startLoc;return w.eatContextual(mt)?w.type!==X.parenL&&(!lr||!w.canInsertSemicolon())?!0:(B.key&&w.unexpected(),B.computed=!1,B.key=w.startNodeAt(Er,In),B.key.name=mt,w.finishNode(B.key,"Identifier"),!1):!1};B.kind="method",B.static=O("static");var q=this.eat(X.star),_e=!1;q||(this.options.ecmaVersion>=8&&O("async",!0)?(_e=!0,q=this.options.ecmaVersion>=9&&this.eat(X.star)):O("get")?B.kind="get":O("set")&&(B.kind="set")),B.key||this.parsePropertyName(B);var Xe=B.key,ct=!1;return!B.computed&&!B.static&&(Xe.type==="Identifier"&&Xe.name==="constructor"||Xe.type==="Literal"&&Xe.value==="constructor")?(B.kind!=="method"&&this.raise(Xe.start,"Constructor can't have get/set modifier"),q&&this.raise(Xe.start,"Constructor can't be a generator"),_e&&this.raise(Xe.start,"Constructor can't be an async method"),B.kind="constructor",ct=g):B.static&&Xe.type==="Identifier"&&Xe.name==="prototype"&&this.raise(Xe.start,"Classes may not have a static property named prototype"),this.parseClassMethod(B,q,_e,ct),B.kind==="get"&&B.value.params.length!==0&&this.raiseRecoverable(B.value.start,"getter should have no params"),B.kind==="set"&&B.value.params.length!==1&&this.raiseRecoverable(B.value.start,"setter should have exactly one param"),B.kind==="set"&&B.value.params[0].type==="RestElement"&&this.raiseRecoverable(B.value.params[0].start,"Setter cannot use rest params"),B},Ln.parseClassMethod=function(g,w,B,O){return g.value=this.parseMethod(w,B,O),this.finishNode(g,"MethodDefinition")},Ln.parseClassId=function(g,w){this.type===X.name?(g.id=this.parseIdent(),w&&this.checkLVal(g.id,ua,!1)):(w===!0&&this.unexpected(),g.id=null)},Ln.parseClassSuper=function(g){g.superClass=this.eat(X._extends)?this.parseExprSubscripts():null},Ln.parseExport=function(g,w){if(this.next(),this.eat(X.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(g.exported=this.parseIdent(!0),this.checkExport(w,g.exported.name,this.lastTokStart)):g.exported=null),this.expectContextual("from"),this.type!==X.string&&this.unexpected(),g.source=this.parseExprAtom(),this.semicolon(),this.finishNode(g,"ExportAllDeclaration");if(this.eat(X._default)){this.checkExport(w,"default",this.lastTokStart);var B;if(this.type===X._function||(B=this.isAsyncFunction())){var O=this.startNode();this.next(),B&&this.next(),g.declaration=this.parseFunction(O,ir|I,!1,B)}else if(this.type===X._class){var q=this.startNode();g.declaration=this.parseClass(q,"nullableID")}else g.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(g,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())g.declaration=this.parseStatement(null),g.declaration.type==="VariableDeclaration"?this.checkVariableExport(w,g.declaration.declarations):this.checkExport(w,g.declaration.id.name,g.declaration.id.start),g.specifiers=[],g.source=null;else{if(g.declaration=null,g.specifiers=this.parseExportSpecifiers(w),this.eatContextual("from"))this.type!==X.string&&this.unexpected(),g.source=this.parseExprAtom();else{for(var _e=0,Xe=g.specifiers;_e<Xe.length;_e+=1){var ct=Xe[_e];this.checkUnreserved(ct.local),this.checkLocalExport(ct.local)}g.source=null}this.semicolon()}return this.finishNode(g,"ExportNamedDeclaration")},Ln.checkExport=function(g,w,B){!g||(Wr(g,w)&&this.raiseRecoverable(B,"Duplicate export '"+w+"'"),g[w]=!0)},Ln.checkPatternExport=function(g,w){var B=w.type;if(B==="Identifier")this.checkExport(g,w.name,w.start);else if(B==="ObjectPattern")for(var O=0,q=w.properties;O<q.length;O+=1){var _e=q[O];this.checkPatternExport(g,_e)}else if(B==="ArrayPattern")for(var Xe=0,ct=w.elements;Xe<ct.length;Xe+=1){var mt=ct[Xe];mt&&this.checkPatternExport(g,mt)}else B==="Property"?this.checkPatternExport(g,w.value):B==="AssignmentPattern"?this.checkPatternExport(g,w.left):B==="RestElement"?this.checkPatternExport(g,w.argument):B==="ParenthesizedExpression"&&this.checkPatternExport(g,w.expression)},Ln.checkVariableExport=function(g,w){if(!!g)for(var B=0,O=w;B<O.length;B+=1){var q=O[B];this.checkPatternExport(g,q.id)}},Ln.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Ln.parseExportSpecifiers=function(g){var w=[],B=!0;for(this.expect(X.braceL);!this.eat(X.braceR);){if(B)B=!1;else if(this.expect(X.comma),this.afterTrailingComma(X.braceR))break;var O=this.startNode();O.local=this.parseIdent(!0),O.exported=this.eatContextual("as")?this.parseIdent(!0):O.local,this.checkExport(g,O.exported.name,O.exported.start),w.push(this.finishNode(O,"ExportSpecifier"))}return w},Ln.parseImport=function(g){return this.next(),this.type===X.string?(g.specifiers=Ut,g.source=this.parseExprAtom()):(g.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),g.source=this.type===X.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(g,"ImportDeclaration")},Ln.parseImportSpecifiers=function(){var g=[],w=!0;if(this.type===X.name){var B=this.startNode();if(B.local=this.parseIdent(),this.checkLVal(B.local,ua),g.push(this.finishNode(B,"ImportDefaultSpecifier")),!this.eat(X.comma))return g}if(this.type===X.star){var O=this.startNode();return this.next(),this.expectContextual("as"),O.local=this.parseIdent(),this.checkLVal(O.local,ua),g.push(this.finishNode(O,"ImportNamespaceSpecifier")),g}for(this.expect(X.braceL);!this.eat(X.braceR);){if(w)w=!1;else if(this.expect(X.comma),this.afterTrailingComma(X.braceR))break;var q=this.startNode();q.imported=this.parseIdent(!0),this.eatContextual("as")?q.local=this.parseIdent():(this.checkUnreserved(q.imported),q.local=q.imported),this.checkLVal(q.local,ua),g.push(this.finishNode(q,"ImportSpecifier"))}return g},Ln.adaptDirectivePrologue=function(g){for(var w=0;w<g.length&&this.isDirectiveCandidate(g[w]);++w)g[w].directive=g[w].expression.raw.slice(1,-1)},Ln.isDirectiveCandidate=function(g){return g.type==="ExpressionStatement"&&g.expression.type==="Literal"&&typeof g.expression.value=="string"&&(this.input[g.start]==='"'||this.input[g.start]==="'")};var or=_i.prototype;or.toAssignable=function(g,w,B){if(this.options.ecmaVersion>=6&&g)switch(g.type){case"Identifier":this.inAsync&&g.name==="await"&&this.raise(g.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":g.type="ObjectPattern",B&&this.checkPatternErrors(B,!0);for(var O=0,q=g.properties;O<q.length;O+=1){var _e=q[O];this.toAssignable(_e,w),_e.type==="RestElement"&&(_e.argument.type==="ArrayPattern"||_e.argument.type==="ObjectPattern")&&this.raise(_e.argument.start,"Unexpected token")}break;case"Property":g.kind!=="init"&&this.raise(g.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(g.value,w);break;case"ArrayExpression":g.type="ArrayPattern",B&&this.checkPatternErrors(B,!0),this.toAssignableList(g.elements,w);break;case"SpreadElement":g.type="RestElement",this.toAssignable(g.argument,w),g.argument.type==="AssignmentPattern"&&this.raise(g.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":g.operator!=="="&&this.raise(g.left.end,"Only '=' operator can be used for specifying default value."),g.type="AssignmentPattern",delete g.operator,this.toAssignable(g.left,w);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(g.expression,w,B);break;case"ChainExpression":this.raiseRecoverable(g.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!w)break;default:this.raise(g.start,"Assigning to rvalue")}else B&&this.checkPatternErrors(B,!0);return g},or.toAssignableList=function(g,w){for(var B=g.length,O=0;O<B;O++){var q=g[O];q&&this.toAssignable(q,w)}if(B){var _e=g[B-1];this.options.ecmaVersion===6&&w&&_e&&_e.type==="RestElement"&&_e.argument.type!=="Identifier"&&this.unexpected(_e.argument.start)}return g},or.parseSpread=function(g){var w=this.startNode();return this.next(),w.argument=this.parseMaybeAssign(!1,g),this.finishNode(w,"SpreadElement")},or.parseRestBinding=function(){var g=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==X.name&&this.unexpected(),g.argument=this.parseBindingAtom(),this.finishNode(g,"RestElement")},or.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case X.bracketL:var g=this.startNode();return this.next(),g.elements=this.parseBindingList(X.bracketR,!0,!0),this.finishNode(g,"ArrayPattern");case X.braceL:return this.parseObj(!0)}return this.parseIdent()},or.parseBindingList=function(g,w,B){for(var O=[],q=!0;!this.eat(g);)if(q?q=!1:this.expect(X.comma),w&&this.type===X.comma)O.push(null);else{if(B&&this.afterTrailingComma(g))break;if(this.type===X.ellipsis){var _e=this.parseRestBinding();this.parseBindingListItem(_e),O.push(_e),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(g);break}else{var Xe=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(Xe),O.push(Xe)}}return O},or.parseBindingListItem=function(g){return g},or.parseMaybeDefault=function(g,w,B){if(B=B||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(X.eq))return B;var O=this.startNodeAt(g,w);return O.left=B,O.right=this.parseMaybeAssign(),this.finishNode(O,"AssignmentPattern")},or.checkLVal=function(g,w,B){switch(w===void 0&&(w=Ei),g.type){case"Identifier":w===ua&&g.name==="let"&&this.raiseRecoverable(g.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(g.name)&&this.raiseRecoverable(g.start,(w?"Binding ":"Assigning to ")+g.name+" in strict mode"),B&&(Wr(B,g.name)&&this.raiseRecoverable(g.start,"Argument name clash"),B[g.name]=!0),w!==Ei&&w!==Mn&&this.declareName(g.name,w,g.start);break;case"ChainExpression":this.raiseRecoverable(g.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":w&&this.raiseRecoverable(g.start,"Binding member expression");break;case"ObjectPattern":for(var O=0,q=g.properties;O<q.length;O+=1){var _e=q[O];this.checkLVal(_e,w,B)}break;case"Property":this.checkLVal(g.value,w,B);break;case"ArrayPattern":for(var Xe=0,ct=g.elements;Xe<ct.length;Xe+=1){var mt=ct[Xe];mt&&this.checkLVal(mt,w,B)}break;case"AssignmentPattern":this.checkLVal(g.left,w,B);break;case"RestElement":this.checkLVal(g.argument,w,B);break;case"ParenthesizedExpression":this.checkLVal(g.expression,w,B);break;default:this.raise(g.start,(w?"Binding":"Assigning to")+" rvalue")}};var Rn=_i.prototype;Rn.checkPropClash=function(g,w,B){if(!(this.options.ecmaVersion>=9&&g.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(g.computed||g.method||g.shorthand))){var O=g.key,q;switch(O.type){case"Identifier":q=O.name;break;case"Literal":q=String(O.value);break;default:return}var _e=g.kind;if(this.options.ecmaVersion>=6){q==="__proto__"&&_e==="init"&&(w.proto&&(B?B.doubleProto<0&&(B.doubleProto=O.start):this.raiseRecoverable(O.start,"Redefinition of __proto__ property")),w.proto=!0);return}q="$"+q;var Xe=w[q];if(Xe){var ct;_e==="init"?ct=this.strict&&Xe.init||Xe.get||Xe.set:ct=Xe.init||Xe[_e],ct&&this.raiseRecoverable(O.start,"Redefinition of property")}else Xe=w[q]={init:!1,get:!1,set:!1};Xe[_e]=!0}},Rn.parseExpression=function(g,w){var B=this.start,O=this.startLoc,q=this.parseMaybeAssign(g,w);if(this.type===X.comma){var _e=this.startNodeAt(B,O);for(_e.expressions=[q];this.eat(X.comma);)_e.expressions.push(this.parseMaybeAssign(g,w));return this.finishNode(_e,"SequenceExpression")}return q},Rn.parseMaybeAssign=function(g,w,B){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(g);this.exprAllowed=!1}var O=!1,q=-1,_e=-1;w?(q=w.parenthesizedAssign,_e=w.trailingComma,w.parenthesizedAssign=w.trailingComma=-1):(w=new ve,O=!0);var Xe=this.start,ct=this.startLoc;(this.type===X.parenL||this.type===X.name)&&(this.potentialArrowAt=this.start);var mt=this.parseMaybeConditional(g,w);if(B&&(mt=B.call(this,mt,Xe,ct)),this.type.isAssign){var lr=this.startNodeAt(Xe,ct);return lr.operator=this.value,lr.left=this.type===X.eq?this.toAssignable(mt,!1,w):mt,O||(w.parenthesizedAssign=w.trailingComma=w.doubleProto=-1),w.shorthandAssign>=lr.left.start&&(w.shorthandAssign=-1),this.checkLVal(mt),this.next(),lr.right=this.parseMaybeAssign(g),this.finishNode(lr,"AssignmentExpression")}else O&&this.checkExpressionErrors(w,!0);return q>-1&&(w.parenthesizedAssign=q),_e>-1&&(w.trailingComma=_e),mt},Rn.parseMaybeConditional=function(g,w){var B=this.start,O=this.startLoc,q=this.parseExprOps(g,w);if(this.checkExpressionErrors(w))return q;if(this.eat(X.question)){var _e=this.startNodeAt(B,O);return _e.test=q,_e.consequent=this.parseMaybeAssign(),this.expect(X.colon),_e.alternate=this.parseMaybeAssign(g),this.finishNode(_e,"ConditionalExpression")}return q},Rn.parseExprOps=function(g,w){var B=this.start,O=this.startLoc,q=this.parseMaybeUnary(w,!1);return this.checkExpressionErrors(w)||q.start===B&&q.type==="ArrowFunctionExpression"?q:this.parseExprOp(q,B,O,-1,g)},Rn.parseExprOp=function(g,w,B,O,q){var _e=this.type.binop;if(_e!=null&&(!q||this.type!==X._in)&&_e>O){var Xe=this.type===X.logicalOR||this.type===X.logicalAND,ct=this.type===X.coalesce;ct&&(_e=X.logicalAND.binop);var mt=this.value;this.next();var lr=this.start,Er=this.startLoc,In=this.parseExprOp(this.parseMaybeUnary(null,!1),lr,Er,_e,q),si=this.buildBinary(w,B,g,In,mt,Xe||ct);return(Xe&&this.type===X.coalesce||ct&&(this.type===X.logicalOR||this.type===X.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(si,w,B,O,q)}return g},Rn.buildBinary=function(g,w,B,O,q,_e){var Xe=this.startNodeAt(g,w);return Xe.left=B,Xe.operator=q,Xe.right=O,this.finishNode(Xe,_e?"LogicalExpression":"BinaryExpression")},Rn.parseMaybeUnary=function(g,w){var B=this.start,O=this.startLoc,q;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))q=this.parseAwait(),w=!0;else if(this.type.prefix){var _e=this.startNode(),Xe=this.type===X.incDec;_e.operator=this.value,_e.prefix=!0,this.next(),_e.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(g,!0),Xe?this.checkLVal(_e.argument):this.strict&&_e.operator==="delete"&&_e.argument.type==="Identifier"?this.raiseRecoverable(_e.start,"Deleting local variable in strict mode"):w=!0,q=this.finishNode(_e,Xe?"UpdateExpression":"UnaryExpression")}else{if(q=this.parseExprSubscripts(g),this.checkExpressionErrors(g))return q;for(;this.type.postfix&&!this.canInsertSemicolon();){var ct=this.startNodeAt(B,O);ct.operator=this.value,ct.prefix=!1,ct.argument=q,this.checkLVal(q),this.next(),q=this.finishNode(ct,"UpdateExpression")}}return!w&&this.eat(X.starstar)?this.buildBinary(B,O,q,this.parseMaybeUnary(null,!1),"**",!1):q},Rn.parseExprSubscripts=function(g){var w=this.start,B=this.startLoc,O=this.parseExprAtom(g);if(O.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return O;var q=this.parseSubscripts(O,w,B);return g&&q.type==="MemberExpression"&&(g.parenthesizedAssign>=q.start&&(g.parenthesizedAssign=-1),g.parenthesizedBind>=q.start&&(g.parenthesizedBind=-1)),q},Rn.parseSubscripts=function(g,w,B,O){for(var q=this.options.ecmaVersion>=8&&g.type==="Identifier"&&g.name==="async"&&this.lastTokEnd===g.end&&!this.canInsertSemicolon()&&g.end-g.start==5&&this.potentialArrowAt===g.start,_e=!1;;){var Xe=this.parseSubscript(g,w,B,O,q,_e);if(Xe.optional&&(_e=!0),Xe===g||Xe.type==="ArrowFunctionExpression"){if(_e){var ct=this.startNodeAt(w,B);ct.expression=Xe,Xe=this.finishNode(ct,"ChainExpression")}return Xe}g=Xe}},Rn.parseSubscript=function(g,w,B,O,q,_e){var Xe=this.options.ecmaVersion>=11,ct=Xe&&this.eat(X.questionDot);O&&ct&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var mt=this.eat(X.bracketL);if(mt||ct&&this.type!==X.parenL&&this.type!==X.backQuote||this.eat(X.dot)){var lr=this.startNodeAt(w,B);lr.object=g,lr.property=mt?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),lr.computed=!!mt,mt&&this.expect(X.bracketR),Xe&&(lr.optional=ct),g=this.finishNode(lr,"MemberExpression")}else if(!O&&this.eat(X.parenL)){var Er=new ve,In=this.yieldPos,si=this.awaitPos,Jn=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var Xi=this.parseExprList(X.parenR,this.options.ecmaVersion>=8,!1,Er);if(q&&!ct&&!this.canInsertSemicolon()&&this.eat(X.arrow))return this.checkPatternErrors(Er,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=In,this.awaitPos=si,this.awaitIdentPos=Jn,this.parseArrowExpression(this.startNodeAt(w,B),Xi,!0);this.checkExpressionErrors(Er,!0),this.yieldPos=In||this.yieldPos,this.awaitPos=si||this.awaitPos,this.awaitIdentPos=Jn||this.awaitIdentPos;var fa=this.startNodeAt(w,B);fa.callee=g,fa.arguments=Xi,Xe&&(fa.optional=ct),g=this.finishNode(fa,"CallExpression")}else if(this.type===X.backQuote){(ct||_e)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var Ia=this.startNodeAt(w,B);Ia.tag=g,Ia.quasi=this.parseTemplate({isTagged:!0}),g=this.finishNode(Ia,"TaggedTemplateExpression")}return g},Rn.parseExprAtom=function(g){this.type===X.slash&&this.readRegexp();var w,B=this.potentialArrowAt===this.start;switch(this.type){case X._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),w=this.startNode(),this.next(),this.type===X.parenL&&!this.allowDirectSuper&&this.raise(w.start,"super() call outside constructor of a subclass"),this.type!==X.dot&&this.type!==X.bracketL&&this.type!==X.parenL&&this.unexpected(),this.finishNode(w,"Super");case X._this:return w=this.startNode(),this.next(),this.finishNode(w,"ThisExpression");case X.name:var O=this.start,q=this.startLoc,_e=this.containsEsc,Xe=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!_e&&Xe.name==="async"&&!this.canInsertSemicolon()&&this.eat(X._function))return this.parseFunction(this.startNodeAt(O,q),0,!1,!0);if(B&&!this.canInsertSemicolon()){if(this.eat(X.arrow))return this.parseArrowExpression(this.startNodeAt(O,q),[Xe],!1);if(this.options.ecmaVersion>=8&&Xe.name==="async"&&this.type===X.name&&!_e)return Xe=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(X.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(O,q),[Xe],!0)}return Xe;case X.regexp:var ct=this.value;return w=this.parseLiteral(ct.value),w.regex={pattern:ct.pattern,flags:ct.flags},w;case X.num:case X.string:return this.parseLiteral(this.value);case X._null:case X._true:case X._false:return w=this.startNode(),w.value=this.type===X._null?null:this.type===X._true,w.raw=this.type.keyword,this.next(),this.finishNode(w,"Literal");case X.parenL:var mt=this.start,lr=this.parseParenAndDistinguishExpression(B);return g&&(g.parenthesizedAssign<0&&!this.isSimpleAssignTarget(lr)&&(g.parenthesizedAssign=mt),g.parenthesizedBind<0&&(g.parenthesizedBind=mt)),lr;case X.bracketL:return w=this.startNode(),this.next(),w.elements=this.parseExprList(X.bracketR,!0,!0,g),this.finishNode(w,"ArrayExpression");case X.braceL:return this.parseObj(!1,g);case X._function:return w=this.startNode(),this.next(),this.parseFunction(w,0);case X._class:return this.parseClass(this.startNode(),!1);case X._new:return this.parseNew();case X.backQuote:return this.parseTemplate();case X._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Rn.parseExprImport=function(){var g=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var w=this.parseIdent(!0);switch(this.type){case X.parenL:return this.parseDynamicImport(g);case X.dot:return g.meta=w,this.parseImportMeta(g);default:this.unexpected()}},Rn.parseDynamicImport=function(g){if(this.next(),g.source=this.parseMaybeAssign(),!this.eat(X.parenR)){var w=this.start;this.eat(X.comma)&&this.eat(X.parenR)?this.raiseRecoverable(w,"Trailing comma is not allowed in import()"):this.unexpected(w)}return this.finishNode(g,"ImportExpression")},Rn.parseImportMeta=function(g){this.next();var w=this.containsEsc;return g.property=this.parseIdent(!0),g.property.name!=="meta"&&this.raiseRecoverable(g.property.start,"The only valid meta property for import is 'import.meta'"),w&&this.raiseRecoverable(g.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(g.start,"Cannot use 'import.meta' outside a module"),this.finishNode(g,"MetaProperty")},Rn.parseLiteral=function(g){var w=this.startNode();return w.value=g,w.raw=this.input.slice(this.start,this.end),w.raw.charCodeAt(w.raw.length-1)===110&&(w.bigint=w.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(w,"Literal")},Rn.parseParenExpression=function(){this.expect(X.parenL);var g=this.parseExpression();return this.expect(X.parenR),g},Rn.parseParenAndDistinguishExpression=function(g){var w=this.start,B=this.startLoc,O,q=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var _e=this.start,Xe=this.startLoc,ct=[],mt=!0,lr=!1,Er=new ve,In=this.yieldPos,si=this.awaitPos,Jn;for(this.yieldPos=0,this.awaitPos=0;this.type!==X.parenR;)if(mt?mt=!1:this.expect(X.comma),q&&this.afterTrailingComma(X.parenR,!0)){lr=!0;break}else if(this.type===X.ellipsis){Jn=this.start,ct.push(this.parseParenItem(this.parseRestBinding())),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else ct.push(this.parseMaybeAssign(!1,Er,this.parseParenItem));var Xi=this.start,fa=this.startLoc;if(this.expect(X.parenR),g&&!this.canInsertSemicolon()&&this.eat(X.arrow))return this.checkPatternErrors(Er,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=In,this.awaitPos=si,this.parseParenArrowList(w,B,ct);(!ct.length||lr)&&this.unexpected(this.lastTokStart),Jn&&this.unexpected(Jn),this.checkExpressionErrors(Er,!0),this.yieldPos=In||this.yieldPos,this.awaitPos=si||this.awaitPos,ct.length>1?(O=this.startNodeAt(_e,Xe),O.expressions=ct,this.finishNodeAt(O,"SequenceExpression",Xi,fa)):O=ct[0]}else O=this.parseParenExpression();if(this.options.preserveParens){var Ia=this.startNodeAt(w,B);return Ia.expression=O,this.finishNode(Ia,"ParenthesizedExpression")}else return O},Rn.parseParenItem=function(g){return g},Rn.parseParenArrowList=function(g,w,B){return this.parseArrowExpression(this.startNodeAt(g,w),B)};var oi=[];Rn.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var g=this.startNode(),w=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(X.dot)){g.meta=w;var B=this.containsEsc;return g.property=this.parseIdent(!0),g.property.name!=="target"&&this.raiseRecoverable(g.property.start,"The only valid meta property for new is 'new.target'"),B&&this.raiseRecoverable(g.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(g.start,"'new.target' can only be used in functions"),this.finishNode(g,"MetaProperty")}var O=this.start,q=this.startLoc,_e=this.type===X._import;return g.callee=this.parseSubscripts(this.parseExprAtom(),O,q,!0),_e&&g.callee.type==="ImportExpression"&&this.raise(O,"Cannot use new with import()"),this.eat(X.parenL)?g.arguments=this.parseExprList(X.parenR,this.options.ecmaVersion>=8,!1):g.arguments=oi,this.finishNode(g,"NewExpression")},Rn.parseTemplateElement=function(g){var w=g.isTagged,B=this.startNode();return this.type===X.invalidTemplate?(w||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),B.value={raw:this.value,cooked:null}):B.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),B.tail=this.type===X.backQuote,this.finishNode(B,"TemplateElement")},Rn.parseTemplate=function(g){g===void 0&&(g={});var w=g.isTagged;w===void 0&&(w=!1);var B=this.startNode();this.next(),B.expressions=[];var O=this.parseTemplateElement({isTagged:w});for(B.quasis=[O];!O.tail;)this.type===X.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(X.dollarBraceL),B.expressions.push(this.parseExpression()),this.expect(X.braceR),B.quasis.push(O=this.parseTemplateElement({isTagged:w}));return this.next(),this.finishNode(B,"TemplateLiteral")},Rn.isAsyncProp=function(g){return!g.computed&&g.key.type==="Identifier"&&g.key.name==="async"&&(this.type===X.name||this.type===X.num||this.type===X.string||this.type===X.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===X.star)&&!Xt.test(this.input.slice(this.lastTokEnd,this.start))},Rn.parseObj=function(g,w){var B=this.startNode(),O=!0,q={};for(B.properties=[],this.next();!this.eat(X.braceR);){if(O)O=!1;else if(this.expect(X.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(X.braceR))break;var _e=this.parseProperty(g,w);g||this.checkPropClash(_e,q,w),B.properties.push(_e)}return this.finishNode(B,g?"ObjectPattern":"ObjectExpression")},Rn.parseProperty=function(g,w){var B=this.startNode(),O,q,_e,Xe;if(this.options.ecmaVersion>=9&&this.eat(X.ellipsis))return g?(B.argument=this.parseIdent(!1),this.type===X.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(B,"RestElement")):(this.type===X.parenL&&w&&(w.parenthesizedAssign<0&&(w.parenthesizedAssign=this.start),w.parenthesizedBind<0&&(w.parenthesizedBind=this.start)),B.argument=this.parseMaybeAssign(!1,w),this.type===X.comma&&w&&w.trailingComma<0&&(w.trailingComma=this.start),this.finishNode(B,"SpreadElement"));this.options.ecmaVersion>=6&&(B.method=!1,B.shorthand=!1,(g||w)&&(_e=this.start,Xe=this.startLoc),g||(O=this.eat(X.star)));var ct=this.containsEsc;return this.parsePropertyName(B),!g&&!ct&&this.options.ecmaVersion>=8&&!O&&this.isAsyncProp(B)?(q=!0,O=this.options.ecmaVersion>=9&&this.eat(X.star),this.parsePropertyName(B,w)):q=!1,this.parsePropertyValue(B,g,O,q,_e,Xe,w,ct),this.finishNode(B,"Property")},Rn.parsePropertyValue=function(g,w,B,O,q,_e,Xe,ct){if((B||O)&&this.type===X.colon&&this.unexpected(),this.eat(X.colon))g.value=w?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,Xe),g.kind="init";else if(this.options.ecmaVersion>=6&&this.type===X.parenL)w&&this.unexpected(),g.kind="init",g.method=!0,g.value=this.parseMethod(B,O);else if(!w&&!ct&&this.options.ecmaVersion>=5&&!g.computed&&g.key.type==="Identifier"&&(g.key.name==="get"||g.key.name==="set")&&this.type!==X.comma&&this.type!==X.braceR&&this.type!==X.eq){(B||O)&&this.unexpected(),g.kind=g.key.name,this.parsePropertyName(g),g.value=this.parseMethod(!1);var mt=g.kind==="get"?0:1;if(g.value.params.length!==mt){var lr=g.value.start;g.kind==="get"?this.raiseRecoverable(lr,"getter should have no params"):this.raiseRecoverable(lr,"setter should have exactly one param")}else g.kind==="set"&&g.value.params[0].type==="RestElement"&&this.raiseRecoverable(g.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!g.computed&&g.key.type==="Identifier"?((B||O)&&this.unexpected(),this.checkUnreserved(g.key),g.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=q),g.kind="init",w?g.value=this.parseMaybeDefault(q,_e,g.key):this.type===X.eq&&Xe?(Xe.shorthandAssign<0&&(Xe.shorthandAssign=this.start),g.value=this.parseMaybeDefault(q,_e,g.key)):g.value=g.key,g.shorthand=!0):this.unexpected()},Rn.parsePropertyName=function(g){if(this.options.ecmaVersion>=6){if(this.eat(X.bracketL))return g.computed=!0,g.key=this.parseMaybeAssign(),this.expect(X.bracketR),g.key;g.computed=!1}return g.key=this.type===X.num||this.type===X.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Rn.initFunction=function(g){g.id=null,this.options.ecmaVersion>=6&&(g.generator=g.expression=!1),this.options.ecmaVersion>=8&&(g.async=!1)},Rn.parseMethod=function(g,w,B){var O=this.startNode(),q=this.yieldPos,_e=this.awaitPos,Xe=this.awaitIdentPos;return this.initFunction(O),this.options.ecmaVersion>=6&&(O.generator=g),this.options.ecmaVersion>=8&&(O.async=!!w),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Ri(w,O.generator)|ai|(B?aa:0)),this.expect(X.parenL),O.params=this.parseBindingList(X.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(O,!1,!0),this.yieldPos=q,this.awaitPos=_e,this.awaitIdentPos=Xe,this.finishNode(O,"FunctionExpression")},Rn.parseArrowExpression=function(g,w,B){var O=this.yieldPos,q=this.awaitPos,_e=this.awaitIdentPos;return this.enterScope(Ri(B,!1)|di),this.initFunction(g),this.options.ecmaVersion>=8&&(g.async=!!B),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,g.params=this.toAssignableList(w,!0),this.parseFunctionBody(g,!0,!1),this.yieldPos=O,this.awaitPos=q,this.awaitIdentPos=_e,this.finishNode(g,"ArrowFunctionExpression")},Rn.parseFunctionBody=function(g,w,B){var O=w&&this.type!==X.braceL,q=this.strict,_e=!1;if(O)g.body=this.parseMaybeAssign(),g.expression=!0,this.checkParams(g,!1);else{var Xe=this.options.ecmaVersion>=7&&!this.isSimpleParamList(g.params);(!q||Xe)&&(_e=this.strictDirective(this.end),_e&&Xe&&this.raiseRecoverable(g.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var ct=this.labels;this.labels=[],_e&&(this.strict=!0),this.checkParams(g,!q&&!_e&&!w&&!B&&this.isSimpleParamList(g.params)),this.strict&&g.id&&this.checkLVal(g.id,Mn),g.body=this.parseBlock(!1,void 0,_e&&!q),g.expression=!1,this.adaptDirectivePrologue(g.body.body),this.labels=ct}this.exitScope()},Rn.isSimpleParamList=function(g){for(var w=0,B=g;w<B.length;w+=1){var O=B[w];if(O.type!=="Identifier")return!1}return!0},Rn.checkParams=function(g,w){for(var B={},O=0,q=g.params;O<q.length;O+=1){var _e=q[O];this.checkLVal(_e,ji,w?null:B)}},Rn.parseExprList=function(g,w,B,O){for(var q=[],_e=!0;!this.eat(g);){if(_e)_e=!1;else if(this.expect(X.comma),w&&this.afterTrailingComma(g))break;var Xe=void 0;B&&this.type===X.comma?Xe=null:this.type===X.ellipsis?(Xe=this.parseSpread(O),O&&this.type===X.comma&&O.trailingComma<0&&(O.trailingComma=this.start)):Xe=this.parseMaybeAssign(!1,O),q.push(Xe)}return q},Rn.checkUnreserved=function(g){var w=g.start,B=g.end,O=g.name;if(this.inGenerator&&O==="yield"&&this.raiseRecoverable(w,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&O==="await"&&this.raiseRecoverable(w,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(O)&&this.raise(w,"Unexpected keyword '"+O+"'"),!(this.options.ecmaVersion<6&&this.input.slice(w,B).indexOf("\\")!==-1)){var q=this.strict?this.reservedWordsStrict:this.reservedWords;q.test(O)&&(!this.inAsync&&O==="await"&&this.raiseRecoverable(w,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(w,"The keyword '"+O+"' is reserved"))}},Rn.parseIdent=function(g,w){var B=this.startNode();return this.type===X.name?B.name=this.value:this.type.keyword?(B.name=this.type.keyword,(B.name==="class"||B.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!g),this.finishNode(B,"Identifier"),g||(this.checkUnreserved(B),B.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=B.start)),B},Rn.parseYield=function(g){this.yieldPos||(this.yieldPos=this.start);var w=this.startNode();return this.next(),this.type===X.semi||this.canInsertSemicolon()||this.type!==X.star&&!this.type.startsExpr?(w.delegate=!1,w.argument=null):(w.delegate=this.eat(X.star),w.argument=this.parseMaybeAssign(g)),this.finishNode(w,"YieldExpression")},Rn.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var g=this.startNode();return this.next(),g.argument=this.parseMaybeUnary(null,!1),this.finishNode(g,"AwaitExpression")};var jn=_i.prototype;jn.raise=function(g,w){var B=gt(this.input,g);w+=" ("+B.line+":"+B.column+")";var O=new SyntaxError(w);throw O.pos=g,O.loc=B,O.raisedAt=this.pos,O},jn.raiseRecoverable=jn.raise,jn.curPosition=function(){if(this.options.locations)return new Fe(this.curLine,this.pos-this.lineStart)};var nn=_i.prototype,Ti=function(w){this.flags=w,this.var=[],this.lexical=[],this.functions=[]};nn.enterScope=function(g){this.scopeStack.push(new Ti(g))},nn.exitScope=function(){this.scopeStack.pop()},nn.treatFunctionsAsVarInScope=function(g){return g.flags&hn||!this.inModule&&g.flags&Wn},nn.declareName=function(g,w,B){var O=!1;if(w===ua){var q=this.currentScope();O=q.lexical.indexOf(g)>-1||q.functions.indexOf(g)>-1||q.var.indexOf(g)>-1,q.lexical.push(g),this.inModule&&q.flags&Wn&&delete this.undefinedExports[g]}else if(w===ba){var _e=this.currentScope();_e.lexical.push(g)}else if(w===Si){var Xe=this.currentScope();this.treatFunctionsAsVar?O=Xe.lexical.indexOf(g)>-1:O=Xe.lexical.indexOf(g)>-1||Xe.var.indexOf(g)>-1,Xe.functions.push(g)}else for(var ct=this.scopeStack.length-1;ct>=0;--ct){var mt=this.scopeStack[ct];if(mt.lexical.indexOf(g)>-1&&!(mt.flags&Xn&&mt.lexical[0]===g)||!this.treatFunctionsAsVarInScope(mt)&&mt.functions.indexOf(g)>-1){O=!0;break}if(mt.var.push(g),this.inModule&&mt.flags&Wn&&delete this.undefinedExports[g],mt.flags&Yi)break}O&&this.raiseRecoverable(B,"Identifier '"+g+"' has already been declared")},nn.checkLocalExport=function(g){this.scopeStack[0].lexical.indexOf(g.name)===-1&&this.scopeStack[0].var.indexOf(g.name)===-1&&(this.undefinedExports[g.name]=g)},nn.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},nn.currentVarScope=function(){for(var g=this.scopeStack.length-1;;g--){var w=this.scopeStack[g];if(w.flags&Yi)return w}},nn.currentThisScope=function(){for(var g=this.scopeStack.length-1;;g--){var w=this.scopeStack[g];if(w.flags&Yi&&!(w.flags&di))return w}};var Mi=function(w,B,O){this.type="",this.start=B,this.end=0,w.options.locations&&(this.loc=new At(w,O)),w.options.directSourceFile&&(this.sourceFile=w.options.directSourceFile),w.options.ranges&&(this.range=[B,0])},$a=_i.prototype;$a.startNode=function(){return new Mi(this,this.start,this.startLoc)},$a.startNodeAt=function(g,w){return new Mi(this,g,w)};function ss(g,w,B,O){return g.type=w,g.end=B,this.options.locations&&(g.loc.end=O),this.options.ranges&&(g.range[1]=B),g}$a.finishNode=function(g,w){return ss.call(this,g,w,this.lastTokEnd,this.lastTokEndLoc)},$a.finishNodeAt=function(g,w,B,O){return ss.call(this,g,w,B,O)};var ma=function(w,B,O,q,_e){this.token=w,this.isExpr=!!B,this.preserveSpace=!!O,this.override=q,this.generator=!!_e},Ra={b_stat:new ma("{",!1),b_expr:new ma("{",!0),b_tmpl:new ma("${",!1),p_stat:new ma("(",!1),p_expr:new ma("(",!0),q_tmpl:new ma("`",!0,!0,function(g){return g.tryReadTemplateToken()}),f_stat:new ma("function",!1),f_expr:new ma("function",!0),f_expr_gen:new ma("function",!0,!1,null,!0),f_gen:new ma("function",!1,!1,null,!0)},Ca=_i.prototype;Ca.initialContext=function(){return[Ra.b_stat]},Ca.braceIsBlock=function(g){var w=this.curContext();return w===Ra.f_expr||w===Ra.f_stat?!0:g===X.colon&&(w===Ra.b_stat||w===Ra.b_expr)?!w.isExpr:g===X._return||g===X.name&&this.exprAllowed?Xt.test(this.input.slice(this.lastTokEnd,this.start)):g===X._else||g===X.semi||g===X.eof||g===X.parenR||g===X.arrow?!0:g===X.braceL?w===Ra.b_stat:g===X._var||g===X._const||g===X.name?!1:!this.exprAllowed},Ca.inGeneratorContext=function(){for(var g=this.context.length-1;g>=1;g--){var w=this.context[g];if(w.token==="function")return w.generator}return!1},Ca.updateContext=function(g){var w,B=this.type;B.keyword&&g===X.dot?this.exprAllowed=!1:(w=B.updateContext)?w.call(this,g):this.exprAllowed=B.beforeExpr},X.parenR.updateContext=X.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var g=this.context.pop();g===Ra.b_stat&&this.curContext().token==="function"&&(g=this.context.pop()),this.exprAllowed=!g.isExpr},X.braceL.updateContext=function(g){this.context.push(this.braceIsBlock(g)?Ra.b_stat:Ra.b_expr),this.exprAllowed=!0},X.dollarBraceL.updateContext=function(){this.context.push(Ra.b_tmpl),this.exprAllowed=!0},X.parenL.updateContext=function(g){var w=g===X._if||g===X._for||g===X._with||g===X._while;this.context.push(w?Ra.p_stat:Ra.p_expr),this.exprAllowed=!0},X.incDec.updateContext=function(){},X._function.updateContext=X._class.updateContext=function(g){g.beforeExpr&&g!==X.semi&&g!==X._else&&!(g===X._return&&Xt.test(this.input.slice(this.lastTokEnd,this.start)))&&!((g===X.colon||g===X.braceL)&&this.curContext()===Ra.b_stat)?this.context.push(Ra.f_expr):this.context.push(Ra.f_stat),this.exprAllowed=!1},X.backQuote.updateContext=function(){this.curContext()===Ra.q_tmpl?this.context.pop():this.context.push(Ra.q_tmpl),this.exprAllowed=!1},X.star.updateContext=function(g){if(g===X._function){var w=this.context.length-1;this.context[w]===Ra.f_expr?this.context[w]=Ra.f_expr_gen:this.context[w]=Ra.f_gen}this.exprAllowed=!0},X.name.updateContext=function(g){var w=!1;this.options.ecmaVersion>=6&&g!==X.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(w=!0),this.exprAllowed=w};var G="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",K=G+" Extended_Pictographic",se=K,ge={9:G,10:K,11:se},Le="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Ge="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",rt=Ge+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",pe=rt+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Be={9:Ge,10:rt,11:pe},yt={};function dr(g){var w=yt[g]={binary:Ye(ge[g]+" "+Le),nonBinary:{General_Category:Ye(Le),Script:Ye(Be[g])}};w.nonBinary.Script_Extensions=w.nonBinary.Script,w.nonBinary.gc=w.nonBinary.General_Category,w.nonBinary.sc=w.nonBinary.Script,w.nonBinary.scx=w.nonBinary.Script_Extensions}dr(9),dr(10),dr(11);var Dt=_i.prototype,Ft=function(w){this.parser=w,this.validFlags="gim"+(w.options.ecmaVersion>=6?"uy":"")+(w.options.ecmaVersion>=9?"s":""),this.unicodeProperties=yt[w.options.ecmaVersion>=11?11:w.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Ft.prototype.reset=function(w,B,O){var q=O.indexOf("u")!==-1;this.start=w|0,this.source=B+"",this.flags=O,this.switchU=q&&this.parser.options.ecmaVersion>=6,this.switchN=q&&this.parser.options.ecmaVersion>=9},Ft.prototype.raise=function(w){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+w)},Ft.prototype.at=function(w,B){B===void 0&&(B=!1);var O=this.source,q=O.length;if(w>=q)return-1;var _e=O.charCodeAt(w);if(!(B||this.switchU)||_e<=55295||_e>=57344||w+1>=q)return _e;var Xe=O.charCodeAt(w+1);return Xe>=56320&&Xe<=57343?(_e<<10)+Xe-56613888:_e},Ft.prototype.nextIndex=function(w,B){B===void 0&&(B=!1);var O=this.source,q=O.length;if(w>=q)return q;var _e=O.charCodeAt(w),Xe;return!(B||this.switchU)||_e<=55295||_e>=57344||w+1>=q||(Xe=O.charCodeAt(w+1))<56320||Xe>57343?w+1:w+2},Ft.prototype.current=function(w){return w===void 0&&(w=!1),this.at(this.pos,w)},Ft.prototype.lookahead=function(w){return w===void 0&&(w=!1),this.at(this.nextIndex(this.pos,w),w)},Ft.prototype.advance=function(w){w===void 0&&(w=!1),this.pos=this.nextIndex(this.pos,w)},Ft.prototype.eat=function(w,B){return B===void 0&&(B=!1),this.current(B)===w?(this.advance(B),!0):!1};function _r(g){return g<=65535?String.fromCharCode(g):(g-=65536,String.fromCharCode((g>>10)+55296,(g&1023)+56320))}Dt.validateRegExpFlags=function(g){for(var w=g.validFlags,B=g.flags,O=0;O<B.length;O++){var q=B.charAt(O);w.indexOf(q)===-1&&this.raise(g.start,"Invalid regular expression flag"),B.indexOf(q,O+1)>-1&&this.raise(g.start,"Duplicate regular expression flag")}},Dt.validateRegExpPattern=function(g){this.regexp_pattern(g),!g.switchN&&this.options.ecmaVersion>=9&&g.groupNames.length>0&&(g.switchN=!0,this.regexp_pattern(g))},Dt.regexp_pattern=function(g){g.pos=0,g.lastIntValue=0,g.lastStringValue="",g.lastAssertionIsQuantifiable=!1,g.numCapturingParens=0,g.maxBackReference=0,g.groupNames.length=0,g.backReferenceNames.length=0,this.regexp_disjunction(g),g.pos!==g.source.length&&(g.eat(41)&&g.raise("Unmatched ')'"),(g.eat(93)||g.eat(125))&&g.raise("Lone quantifier brackets")),g.maxBackReference>g.numCapturingParens&&g.raise("Invalid escape");for(var w=0,B=g.backReferenceNames;w<B.length;w+=1){var O=B[w];g.groupNames.indexOf(O)===-1&&g.raise("Invalid named capture referenced")}},Dt.regexp_disjunction=function(g){for(this.regexp_alternative(g);g.eat(124);)this.regexp_alternative(g);this.regexp_eatQuantifier(g,!0)&&g.raise("Nothing to repeat"),g.eat(123)&&g.raise("Lone quantifier brackets")},Dt.regexp_alternative=function(g){for(;g.pos<g.source.length&&this.regexp_eatTerm(g););},Dt.regexp_eatTerm=function(g){return this.regexp_eatAssertion(g)?(g.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(g)&&g.switchU&&g.raise("Invalid quantifier"),!0):(g.switchU?this.regexp_eatAtom(g):this.regexp_eatExtendedAtom(g))?(this.regexp_eatQuantifier(g),!0):!1},Dt.regexp_eatAssertion=function(g){var w=g.pos;if(g.lastAssertionIsQuantifiable=!1,g.eat(94)||g.eat(36))return!0;if(g.eat(92)){if(g.eat(66)||g.eat(98))return!0;g.pos=w}if(g.eat(40)&&g.eat(63)){var B=!1;if(this.options.ecmaVersion>=9&&(B=g.eat(60)),g.eat(61)||g.eat(33))return this.regexp_disjunction(g),g.eat(41)||g.raise("Unterminated group"),g.lastAssertionIsQuantifiable=!B,!0}return g.pos=w,!1},Dt.regexp_eatQuantifier=function(g,w){return w===void 0&&(w=!1),this.regexp_eatQuantifierPrefix(g,w)?(g.eat(63),!0):!1},Dt.regexp_eatQuantifierPrefix=function(g,w){return g.eat(42)||g.eat(43)||g.eat(63)||this.regexp_eatBracedQuantifier(g,w)},Dt.regexp_eatBracedQuantifier=function(g,w){var B=g.pos;if(g.eat(123)){var O=0,q=-1;if(this.regexp_eatDecimalDigits(g)&&(O=g.lastIntValue,g.eat(44)&&this.regexp_eatDecimalDigits(g)&&(q=g.lastIntValue),g.eat(125)))return q!==-1&&q<O&&!w&&g.raise("numbers out of order in {} quantifier"),!0;g.switchU&&!w&&g.raise("Incomplete quantifier"),g.pos=B}return!1},Dt.regexp_eatAtom=function(g){return this.regexp_eatPatternCharacters(g)||g.eat(46)||this.regexp_eatReverseSolidusAtomEscape(g)||this.regexp_eatCharacterClass(g)||this.regexp_eatUncapturingGroup(g)||this.regexp_eatCapturingGroup(g)},Dt.regexp_eatReverseSolidusAtomEscape=function(g){var w=g.pos;if(g.eat(92)){if(this.regexp_eatAtomEscape(g))return!0;g.pos=w}return!1},Dt.regexp_eatUncapturingGroup=function(g){var w=g.pos;if(g.eat(40)){if(g.eat(63)&&g.eat(58)){if(this.regexp_disjunction(g),g.eat(41))return!0;g.raise("Unterminated group")}g.pos=w}return!1},Dt.regexp_eatCapturingGroup=function(g){if(g.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(g):g.current()===63&&g.raise("Invalid group"),this.regexp_disjunction(g),g.eat(41))return g.numCapturingParens+=1,!0;g.raise("Unterminated group")}return!1},Dt.regexp_eatExtendedAtom=function(g){return g.eat(46)||this.regexp_eatReverseSolidusAtomEscape(g)||this.regexp_eatCharacterClass(g)||this.regexp_eatUncapturingGroup(g)||this.regexp_eatCapturingGroup(g)||this.regexp_eatInvalidBracedQuantifier(g)||this.regexp_eatExtendedPatternCharacter(g)},Dt.regexp_eatInvalidBracedQuantifier=function(g){return this.regexp_eatBracedQuantifier(g,!0)&&g.raise("Nothing to repeat"),!1},Dt.regexp_eatSyntaxCharacter=function(g){var w=g.current();return En(w)?(g.lastIntValue=w,g.advance(),!0):!1};function En(g){return g===36||g>=40&&g<=43||g===46||g===63||g>=91&&g<=94||g>=123&&g<=125}Dt.regexp_eatPatternCharacters=function(g){for(var w=g.pos,B=0;(B=g.current())!==-1&&!En(B);)g.advance();return g.pos!==w},Dt.regexp_eatExtendedPatternCharacter=function(g){var w=g.current();return w!==-1&&w!==36&&!(w>=40&&w<=43)&&w!==46&&w!==63&&w!==91&&w!==94&&w!==124?(g.advance(),!0):!1},Dt.regexp_groupSpecifier=function(g){if(g.eat(63)){if(this.regexp_eatGroupName(g)){g.groupNames.indexOf(g.lastStringValue)!==-1&&g.raise("Duplicate capture group name"),g.groupNames.push(g.lastStringValue);return}g.raise("Invalid group")}},Dt.regexp_eatGroupName=function(g){if(g.lastStringValue="",g.eat(60)){if(this.regexp_eatRegExpIdentifierName(g)&&g.eat(62))return!0;g.raise("Invalid capture group name")}return!1},Dt.regexp_eatRegExpIdentifierName=function(g){if(g.lastStringValue="",this.regexp_eatRegExpIdentifierStart(g)){for(g.lastStringValue+=_r(g.lastIntValue);this.regexp_eatRegExpIdentifierPart(g);)g.lastStringValue+=_r(g.lastIntValue);return!0}return!1},Dt.regexp_eatRegExpIdentifierStart=function(g){var w=g.pos,B=this.options.ecmaVersion>=11,O=g.current(B);return g.advance(B),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(g,B)&&(O=g.lastIntValue),un(O)?(g.lastIntValue=O,!0):(g.pos=w,!1)};function un(g){return Pt(g,!0)||g===36||g===95}Dt.regexp_eatRegExpIdentifierPart=function(g){var w=g.pos,B=this.options.ecmaVersion>=11,O=g.current(B);return g.advance(B),O===92&&this.regexp_eatRegExpUnicodeEscapeSequence(g,B)&&(O=g.lastIntValue),Tt(O)?(g.lastIntValue=O,!0):(g.pos=w,!1)};function Tt(g){return nr(g,!0)||g===36||g===95||g===8204||g===8205}Dt.regexp_eatAtomEscape=function(g){return this.regexp_eatBackReference(g)||this.regexp_eatCharacterClassEscape(g)||this.regexp_eatCharacterEscape(g)||g.switchN&&this.regexp_eatKGroupName(g)?!0:(g.switchU&&(g.current()===99&&g.raise("Invalid unicode escape"),g.raise("Invalid escape")),!1)},Dt.regexp_eatBackReference=function(g){var w=g.pos;if(this.regexp_eatDecimalEscape(g)){var B=g.lastIntValue;if(g.switchU)return B>g.maxBackReference&&(g.maxBackReference=B),!0;if(B<=g.numCapturingParens)return!0;g.pos=w}return!1},Dt.regexp_eatKGroupName=function(g){if(g.eat(107)){if(this.regexp_eatGroupName(g))return g.backReferenceNames.push(g.lastStringValue),!0;g.raise("Invalid named reference")}return!1},Dt.regexp_eatCharacterEscape=function(g){return this.regexp_eatControlEscape(g)||this.regexp_eatCControlLetter(g)||this.regexp_eatZero(g)||this.regexp_eatHexEscapeSequence(g)||this.regexp_eatRegExpUnicodeEscapeSequence(g,!1)||!g.switchU&&this.regexp_eatLegacyOctalEscapeSequence(g)||this.regexp_eatIdentityEscape(g)},Dt.regexp_eatCControlLetter=function(g){var w=g.pos;if(g.eat(99)){if(this.regexp_eatControlLetter(g))return!0;g.pos=w}return!1},Dt.regexp_eatZero=function(g){return g.current()===48&&!Ci(g.lookahead())?(g.lastIntValue=0,g.advance(),!0):!1},Dt.regexp_eatControlEscape=function(g){var w=g.current();return w===116?(g.lastIntValue=9,g.advance(),!0):w===110?(g.lastIntValue=10,g.advance(),!0):w===118?(g.lastIntValue=11,g.advance(),!0):w===102?(g.lastIntValue=12,g.advance(),!0):w===114?(g.lastIntValue=13,g.advance(),!0):!1},Dt.regexp_eatControlLetter=function(g){var w=g.current();return on(w)?(g.lastIntValue=w%32,g.advance(),!0):!1};function on(g){return g>=65&&g<=90||g>=97&&g<=122}Dt.regexp_eatRegExpUnicodeEscapeSequence=function(g,w){w===void 0&&(w=!1);var B=g.pos,O=w||g.switchU;if(g.eat(117)){if(this.regexp_eatFixedHexDigits(g,4)){var q=g.lastIntValue;if(O&&q>=55296&&q<=56319){var _e=g.pos;if(g.eat(92)&&g.eat(117)&&this.regexp_eatFixedHexDigits(g,4)){var Xe=g.lastIntValue;if(Xe>=56320&&Xe<=57343)return g.lastIntValue=(q-55296)*1024+(Xe-56320)+65536,!0}g.pos=_e,g.lastIntValue=q}return!0}if(O&&g.eat(123)&&this.regexp_eatHexDigits(g)&&g.eat(125)&&Gr(g.lastIntValue))return!0;O&&g.raise("Invalid unicode escape"),g.pos=B}return!1};function Gr(g){return g>=0&&g<=1114111}Dt.regexp_eatIdentityEscape=function(g){if(g.switchU)return this.regexp_eatSyntaxCharacter(g)?!0:g.eat(47)?(g.lastIntValue=47,!0):!1;var w=g.current();return w!==99&&(!g.switchN||w!==107)?(g.lastIntValue=w,g.advance(),!0):!1},Dt.regexp_eatDecimalEscape=function(g){g.lastIntValue=0;var w=g.current();if(w>=49&&w<=57){do g.lastIntValue=10*g.lastIntValue+(w-48),g.advance();while((w=g.current())>=48&&w<=57);return!0}return!1},Dt.regexp_eatCharacterClassEscape=function(g){var w=g.current();if(qr(w))return g.lastIntValue=-1,g.advance(),!0;if(g.switchU&&this.options.ecmaVersion>=9&&(w===80||w===112)){if(g.lastIntValue=-1,g.advance(),g.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(g)&&g.eat(125))return!0;g.raise("Invalid property name")}return!1};function qr(g){return g===100||g===68||g===115||g===83||g===119||g===87}Dt.regexp_eatUnicodePropertyValueExpression=function(g){var w=g.pos;if(this.regexp_eatUnicodePropertyName(g)&&g.eat(61)){var B=g.lastStringValue;if(this.regexp_eatUnicodePropertyValue(g)){var O=g.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(g,B,O),!0}}if(g.pos=w,this.regexp_eatLoneUnicodePropertyNameOrValue(g)){var q=g.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(g,q),!0}return!1},Dt.regexp_validateUnicodePropertyNameAndValue=function(g,w,B){Wr(g.unicodeProperties.nonBinary,w)||g.raise("Invalid property name"),g.unicodeProperties.nonBinary[w].test(B)||g.raise("Invalid property value")},Dt.regexp_validateUnicodePropertyNameOrValue=function(g,w){g.unicodeProperties.binary.test(w)||g.raise("Invalid property name")},Dt.regexp_eatUnicodePropertyName=function(g){var w=0;for(g.lastStringValue="";ni(w=g.current());)g.lastStringValue+=_r(w),g.advance();return g.lastStringValue!==""};function ni(g){return on(g)||g===95}Dt.regexp_eatUnicodePropertyValue=function(g){var w=0;for(g.lastStringValue="";tn(w=g.current());)g.lastStringValue+=_r(w),g.advance();return g.lastStringValue!==""};function tn(g){return ni(g)||Ci(g)}Dt.regexp_eatLoneUnicodePropertyNameOrValue=function(g){return this.regexp_eatUnicodePropertyValue(g)},Dt.regexp_eatCharacterClass=function(g){if(g.eat(91)){if(g.eat(94),this.regexp_classRanges(g),g.eat(93))return!0;g.raise("Unterminated character class")}return!1},Dt.regexp_classRanges=function(g){for(;this.regexp_eatClassAtom(g);){var w=g.lastIntValue;if(g.eat(45)&&this.regexp_eatClassAtom(g)){var B=g.lastIntValue;g.switchU&&(w===-1||B===-1)&&g.raise("Invalid character class"),w!==-1&&B!==-1&&w>B&&g.raise("Range out of order in character class")}}},Dt.regexp_eatClassAtom=function(g){var w=g.pos;if(g.eat(92)){if(this.regexp_eatClassEscape(g))return!0;if(g.switchU){var B=g.current();(B===99||Pi(B))&&g.raise("Invalid class escape"),g.raise("Invalid escape")}g.pos=w}var O=g.current();return O!==93?(g.lastIntValue=O,g.advance(),!0):!1},Dt.regexp_eatClassEscape=function(g){var w=g.pos;if(g.eat(98))return g.lastIntValue=8,!0;if(g.switchU&&g.eat(45))return g.lastIntValue=45,!0;if(!g.switchU&&g.eat(99)){if(this.regexp_eatClassControlLetter(g))return!0;g.pos=w}return this.regexp_eatCharacterClassEscape(g)||this.regexp_eatCharacterEscape(g)},Dt.regexp_eatClassControlLetter=function(g){var w=g.current();return Ci(w)||w===95?(g.lastIntValue=w%32,g.advance(),!0):!1},Dt.regexp_eatHexEscapeSequence=function(g){var w=g.pos;if(g.eat(120)){if(this.regexp_eatFixedHexDigits(g,2))return!0;g.switchU&&g.raise("Invalid escape"),g.pos=w}return!1},Dt.regexp_eatDecimalDigits=function(g){var w=g.pos,B=0;for(g.lastIntValue=0;Ci(B=g.current());)g.lastIntValue=10*g.lastIntValue+(B-48),g.advance();return g.pos!==w};function Ci(g){return g>=48&&g<=57}Dt.regexp_eatHexDigits=function(g){var w=g.pos,B=0;for(g.lastIntValue=0;Ji(B=g.current());)g.lastIntValue=16*g.lastIntValue+yi(B),g.advance();return g.pos!==w};function Ji(g){return g>=48&&g<=57||g>=65&&g<=70||g>=97&&g<=102}function yi(g){return g>=65&&g<=70?10+(g-65):g>=97&&g<=102?10+(g-97):g-48}Dt.regexp_eatLegacyOctalEscapeSequence=function(g){if(this.regexp_eatOctalDigit(g)){var w=g.lastIntValue;if(this.regexp_eatOctalDigit(g)){var B=g.lastIntValue;w<=3&&this.regexp_eatOctalDigit(g)?g.lastIntValue=w*64+B*8+g.lastIntValue:g.lastIntValue=w*8+B}else g.lastIntValue=w;return!0}return!1},Dt.regexp_eatOctalDigit=function(g){var w=g.current();return Pi(w)?(g.lastIntValue=w-48,g.advance(),!0):(g.lastIntValue=0,!1)};function Pi(g){return g>=48&&g<=55}Dt.regexp_eatFixedHexDigits=function(g,w){var B=g.pos;g.lastIntValue=0;for(var O=0;O<w;++O){var q=g.current();if(!Ji(q))return g.pos=B,!1;g.lastIntValue=16*g.lastIntValue+yi(q),g.advance()}return!0};var xi=function(w){this.type=w.type,this.value=w.value,this.start=w.start,this.end=w.end,w.options.locations&&(this.loc=new At(w,w.startLoc,w.endLoc)),w.options.ranges&&(this.range=[w.start,w.end])},ei=_i.prototype;ei.next=function(g){!g&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new xi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ei.getToken=function(){return this.next(),new xi(this)},typeof Symbol!="undefined"&&(ei[Symbol.iterator]=function(){var g=this;return{next:function(){var w=g.getToken();return{done:w.type===X.eof,value:w}}}}),ei.curContext=function(){return this.context[this.context.length-1]},ei.nextToken=function(){var g=this.curContext();if((!g||!g.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(X.eof);if(g.override)return g.override(this);this.readToken(this.fullCharCodeAtPos())},ei.readToken=function(g){return Pt(g,this.options.ecmaVersion>=6)||g===92?this.readWord():this.getTokenFromCode(g)},ei.fullCharCodeAtPos=function(){var g=this.input.charCodeAt(this.pos);if(g<=55295||g>=57344)return g;var w=this.input.charCodeAt(this.pos+1);return(g<<10)+w-56613888},ei.skipBlockComment=function(){var g=this.options.onComment&&this.curPosition(),w=this.pos,B=this.input.indexOf("*/",this.pos+=2);if(B===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=B+2,this.options.locations){vt.lastIndex=w;for(var O;(O=vt.exec(this.input))&&O.index<this.pos;)++this.curLine,this.lineStart=O.index+O[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(w+2,B),w,this.pos,g,this.curPosition())},ei.skipLineComment=function(g){for(var w=this.pos,B=this.options.onComment&&this.curPosition(),O=this.input.charCodeAt(this.pos+=g);this.pos<this.input.length&&!qe(O);)O=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(w+g,this.pos),w,this.pos,B,this.curPosition())},ei.skipSpace=function(){e:for(;this.pos<this.input.length;){var g=this.input.charCodeAt(this.pos);switch(g){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(g>8&&g<14||g>=5760&&pt.test(String.fromCharCode(g)))++this.pos;else break e}}},ei.finishToken=function(g,w){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var B=this.type;this.type=g,this.value=w,this.updateContext(B)},ei.readToken_dot=function(){var g=this.input.charCodeAt(this.pos+1);if(g>=48&&g<=57)return this.readNumber(!0);var w=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&g===46&&w===46?(this.pos+=3,this.finishToken(X.ellipsis)):(++this.pos,this.finishToken(X.dot))},ei.readToken_slash=function(){var g=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):g===61?this.finishOp(X.assign,2):this.finishOp(X.slash,1)},ei.readToken_mult_modulo_exp=function(g){var w=this.input.charCodeAt(this.pos+1),B=1,O=g===42?X.star:X.modulo;return this.options.ecmaVersion>=7&&g===42&&w===42&&(++B,O=X.starstar,w=this.input.charCodeAt(this.pos+2)),w===61?this.finishOp(X.assign,B+1):this.finishOp(O,B)},ei.readToken_pipe_amp=function(g){var w=this.input.charCodeAt(this.pos+1);if(w===g){if(this.options.ecmaVersion>=12){var B=this.input.charCodeAt(this.pos+2);if(B===61)return this.finishOp(X.assign,3)}return this.finishOp(g===124?X.logicalOR:X.logicalAND,2)}return w===61?this.finishOp(X.assign,2):this.finishOp(g===124?X.bitwiseOR:X.bitwiseAND,1)},ei.readToken_caret=function(){var g=this.input.charCodeAt(this.pos+1);return g===61?this.finishOp(X.assign,2):this.finishOp(X.bitwiseXOR,1)},ei.readToken_plus_min=function(g){var w=this.input.charCodeAt(this.pos+1);return w===g?w===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||Xt.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(X.incDec,2):w===61?this.finishOp(X.assign,2):this.finishOp(X.plusMin,1)},ei.readToken_lt_gt=function(g){var w=this.input.charCodeAt(this.pos+1),B=1;return w===g?(B=g===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+B)===61?this.finishOp(X.assign,B+1):this.finishOp(X.bitShift,B)):w===33&&g===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(w===61&&(B=2),this.finishOp(X.relational,B))},ei.readToken_eq_excl=function(g){var w=this.input.charCodeAt(this.pos+1);return w===61?this.finishOp(X.equality,this.input.charCodeAt(this.pos+2)===61?3:2):g===61&&w===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(X.arrow)):this.finishOp(g===61?X.eq:X.prefix,1)},ei.readToken_question=function(){var g=this.options.ecmaVersion;if(g>=11){var w=this.input.charCodeAt(this.pos+1);if(w===46){var B=this.input.charCodeAt(this.pos+2);if(B<48||B>57)return this.finishOp(X.questionDot,2)}if(w===63){if(g>=12){var O=this.input.charCodeAt(this.pos+2);if(O===61)return this.finishOp(X.assign,3)}return this.finishOp(X.coalesce,2)}}return this.finishOp(X.question,1)},ei.getTokenFromCode=function(g){switch(g){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(X.parenL);case 41:return++this.pos,this.finishToken(X.parenR);case 59:return++this.pos,this.finishToken(X.semi);case 44:return++this.pos,this.finishToken(X.comma);case 91:return++this.pos,this.finishToken(X.bracketL);case 93:return++this.pos,this.finishToken(X.bracketR);case 123:return++this.pos,this.finishToken(X.braceL);case 125:return++this.pos,this.finishToken(X.braceR);case 58:return++this.pos,this.finishToken(X.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(X.backQuote);case 48:var w=this.input.charCodeAt(this.pos+1);if(w===120||w===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(w===111||w===79)return this.readRadixNumber(8);if(w===98||w===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(g);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(g);case 124:case 38:return this.readToken_pipe_amp(g);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(g);case 60:case 62:return this.readToken_lt_gt(g);case 61:case 33:return this.readToken_eq_excl(g);case 63:return this.readToken_question();case 126:return this.finishOp(X.prefix,1)}this.raise(this.pos,"Unexpected character '"+oa(g)+"'")},ei.finishOp=function(g,w){var B=this.input.slice(this.pos,this.pos+w);return this.pos+=w,this.finishToken(g,B)},ei.readRegexp=function(){for(var g,w,B=this.pos;;){this.pos>=this.input.length&&this.raise(B,"Unterminated regular expression");var O=this.input.charAt(this.pos);if(Xt.test(O)&&this.raise(B,"Unterminated regular expression"),g)g=!1;else{if(O==="[")w=!0;else if(O==="]"&&w)w=!1;else if(O==="/"&&!w)break;g=O==="\\"}++this.pos}var q=this.input.slice(B,this.pos);++this.pos;var _e=this.pos,Xe=this.readWord1();this.containsEsc&&this.unexpected(_e);var ct=this.regexpState||(this.regexpState=new Ft(this));ct.reset(B,q,Xe),this.validateRegExpFlags(ct),this.validateRegExpPattern(ct);var mt=null;try{mt=new RegExp(q,Xe)}catch(lr){}return this.finishToken(X.regexp,{pattern:q,flags:Xe,value:mt})},ei.readInt=function(g,w,B){for(var O=this.options.ecmaVersion>=12&&w===void 0,q=B&&this.input.charCodeAt(this.pos)===48,_e=this.pos,Xe=0,ct=0,mt=0,lr=w==null?Infinity:w;mt<lr;++mt,++this.pos){var Er=this.input.charCodeAt(this.pos),In=void 0;if(O&&Er===95){q&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),ct===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),mt===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),ct=Er;continue}if(Er>=97?In=Er-97+10:Er>=65?In=Er-65+10:Er>=48&&Er<=57?In=Er-48:In=Infinity,In>=g)break;ct=Er,Xe=Xe*g+In}return O&&ct===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===_e||w!=null&&this.pos-_e!==w?null:Xe};function Wi(g,w){return w?parseInt(g,8):parseFloat(g.replace(/_/g,""))}function La(g){return typeof BigInt!="function"?null:BigInt(g.replace(/_/g,""))}ei.readRadixNumber=function(g){var w=this.pos;this.pos+=2;var B=this.readInt(g);return B==null&&this.raise(this.start+2,"Expected number in radix "+g),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(B=La(this.input.slice(w,this.pos)),++this.pos):Pt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(X.num,B)},ei.readNumber=function(g){var w=this.pos;!g&&this.readInt(10,void 0,!0)===null&&this.raise(w,"Invalid number");var B=this.pos-w>=2&&this.input.charCodeAt(w)===48;B&&this.strict&&this.raise(w,"Invalid number");var O=this.input.charCodeAt(this.pos);if(!B&&!g&&this.options.ecmaVersion>=11&&O===110){var q=La(this.input.slice(w,this.pos));return++this.pos,Pt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(X.num,q)}B&&/[89]/.test(this.input.slice(w,this.pos))&&(B=!1),O===46&&!B&&(++this.pos,this.readInt(10),O=this.input.charCodeAt(this.pos)),(O===69||O===101)&&!B&&(O=this.input.charCodeAt(++this.pos),(O===43||O===45)&&++this.pos,this.readInt(10)===null&&this.raise(w,"Invalid number")),Pt(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var _e=Wi(this.input.slice(w,this.pos),B);return this.finishToken(X.num,_e)},ei.readCodePoint=function(){var g=this.input.charCodeAt(this.pos),w;if(g===123){this.options.ecmaVersion<6&&this.unexpected();var B=++this.pos;w=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,w>1114111&&this.invalidStringToken(B,"Code point out of bounds")}else w=this.readHexChar(4);return w};function oa(g){return g<=65535?String.fromCharCode(g):(g-=65536,String.fromCharCode((g>>10)+55296,(g&1023)+56320))}ei.readString=function(g){for(var w="",B=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var O=this.input.charCodeAt(this.pos);if(O===g)break;O===92?(w+=this.input.slice(B,this.pos),w+=this.readEscapedChar(!1),B=this.pos):(qe(O,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return w+=this.input.slice(B,this.pos++),this.finishToken(X.string,w)};var Ii={};ei.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(g){if(g===Ii)this.readInvalidTemplateToken();else throw g}this.inTemplateElement=!1},ei.invalidStringToken=function(g,w){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Ii;this.raise(g,w)},ei.readTmplToken=function(){for(var g="",w=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var B=this.input.charCodeAt(this.pos);if(B===96||B===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===X.template||this.type===X.invalidTemplate)?B===36?(this.pos+=2,this.finishToken(X.dollarBraceL)):(++this.pos,this.finishToken(X.backQuote)):(g+=this.input.slice(w,this.pos),this.finishToken(X.template,g));if(B===92)g+=this.input.slice(w,this.pos),g+=this.readEscapedChar(!0),w=this.pos;else if(qe(B)){switch(g+=this.input.slice(w,this.pos),++this.pos,B){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:g+=`
`;break;default:g+=String.fromCharCode(B);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),w=this.pos}else++this.pos}},ei.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(X.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ei.readEscapedChar=function(g){var w=this.input.charCodeAt(++this.pos);switch(++this.pos,w){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return oa(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(g){var B=this.pos-1;return this.invalidStringToken(B,"Invalid escape sequence in template string"),null}default:if(w>=48&&w<=55){var O=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],q=parseInt(O,8);return q>255&&(O=O.slice(0,-1),q=parseInt(O,8)),this.pos+=O.length-1,w=this.input.charCodeAt(this.pos),(O!=="0"||w===56||w===57)&&(this.strict||g)&&this.invalidStringToken(this.pos-1-O.length,g?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(q)}return qe(w)?"":String.fromCharCode(w)}},ei.readHexChar=function(g){var w=this.pos,B=this.readInt(16,g);return B===null&&this.invalidStringToken(w,"Bad character escape sequence"),B},ei.readWord1=function(){this.containsEsc=!1;for(var g="",w=!0,B=this.pos,O=this.options.ecmaVersion>=6;this.pos<this.input.length;){var q=this.fullCharCodeAtPos();if(nr(q,O))this.pos+=q<=65535?1:2;else if(q===92){this.containsEsc=!0,g+=this.input.slice(B,this.pos);var _e=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var Xe=this.readCodePoint();(w?Pt:nr)(Xe,O)||this.invalidStringToken(_e,"Invalid Unicode escape"),g+=oa(Xe),B=this.pos}else break;w=!1}return g+this.input.slice(B,this.pos)},ei.readWord=function(){var g=this.readWord1(),w=X.name;return this.keywords.test(g)&&(w=ut[g]),this.finishToken(w,g)};var Vi="7.4.1";_i.acorn={Parser:_i,version:Vi,defaultOptions:Nt,Position:Fe,SourceLocation:At,getLineInfo:gt,Node:Mi,TokenType:xt,tokTypes:X,keywordTypes:ut,TokContext:ma,tokContexts:Ra,isIdentifierChar:nr,isIdentifierStart:Pt,Token:xi,isNewLine:qe,lineBreak:Xt,lineBreakG:vt,nonASCIIwhitespace:pt};function Na(g,w){return _i.parse(g,w)}function tu(g,w,B){return _i.parseExpressionAt(g,w,B)}function wa(g,w){return _i.tokenizer(g,w)}function Aa(g,w){g.prototype=Object.create(w.prototype),g.prototype.constructor=g,g.__proto__=w}function ms(g){var w=typeof Map=="function"?new Map:void 0;return ms=function(O){if(O===null||!Bu(O))return O;if(typeof O!="function")throw new TypeError("Super expression must either be null or a function");if(typeof w!="undefined"){if(w.has(O))return w.get(O);w.set(O,q)}function q(){return ta(O,arguments,za(this).constructor)}return q.prototype=Object.create(O.prototype,{constructor:{value:q,enumerable:!1,writable:!0,configurable:!0}}),mo(q,O)},ms(g)}function us(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(g){return!1}}function ta(g,w,B){return us()?ta=Reflect.construct:ta=function(q,_e,Xe){var ct=[null];ct.push.apply(ct,_e);var mt=Function.bind.apply(q,ct),lr=new mt;return Xe&&mo(lr,Xe.prototype),lr},ta.apply(null,arguments)}function Bu(g){return Function.toString.call(g).indexOf("[native code]")!==-1}function mo(g,w){return mo=Object.setPrototypeOf||function(O,q){return O.__proto__=q,O},mo(g,w)}function za(g){return za=Object.setPrototypeOf?Object.getPrototypeOf:function(B){return B.__proto__||Object.getPrototypeOf(B)},za(g)}var ro=function(g){Aa(w,g);function w(){return g.apply(this,arguments)||this}return w}(ms(Error)),Ki=function(g){Aa(w,g);function w(){return g.apply(this,arguments)||this}return w}(ms(SyntaxError)),Ho=function(g){Aa(w,g);function w(){return g.apply(this,arguments)||this}return w}(ms(ReferenceError)),Wo=function(g){Aa(w,g);function w(){return g.apply(this,arguments)||this}return w}(ms(TypeError)),Nu=function(g){Aa(w,g);function w(){return g.apply(this,arguments)||this}return w}(ro),Co=function(g){Aa(w,g);function w(){return g.apply(this,arguments)||this}return w}(Ki),Xo=function(g){Aa(w,g);function w(){return g.apply(this,arguments)||this}return w}(Ho),ga={UnknownError:[3001,"%0",Nu],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Nu],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Xo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Xo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Xo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Xo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Xo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Xo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Xo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Xo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Xo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Xo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Ho],VariableUndefinedReferenceError:[2002,"%0 is not defined",Ho],IsNotConstructor:[2003,"%0 is not a constructor",Wo]};function go(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(g){return!1}}function Yo(g,w,B){return go()?Yo=Reflect.construct:Yo=function(q,_e,Xe){var ct=[null];ct.push.apply(ct,_e);var mt=Function.bind.apply(q,ct),lr=new mt;return Xe&&no(lr,Xe.prototype),lr},Yo.apply(null,arguments)}function no(g,w){return no=Object.setPrototypeOf||function(O,q){return O.__proto__=q,O},no(g,w)}var ru="0.0.3";function _c(g,w){Object.defineProperty(g,"name",{value:w,writable:!1,enumerable:!1,configurable:!0})}var Os=Object.prototype.hasOwnProperty,ie=Symbol("Break"),be=Symbol("Continue"),Qe=Symbol("DefaultCase"),Ot=Symbol("EmptyStatementReturn"),Dr=Symbol("WithScopeName"),lt=Symbol("SuperScopeName"),Lt=Symbol("RootScopeName"),io=Symbol("GlobalScopeName");function $i(g){return typeof g=="function"}var Wa=function(){function g(B){this.interpreter=B}var w=g.prototype;return w.generator=function(){var O=this.interpreter;function q(){return this.getCurrentScope()}function _e(){return this.getGlobalScope()}function Xe(){return this.getCurrentContext()}return{getOptions:O.getOptions.bind(O),getCurrentScope:q.bind(O),getGlobalScope:_e.bind(O),getCurrentContext:Xe.bind(O),getExecStartTime:O.getExecStartTime.bind(O)}},g}();function qo(g,w,B){if(B===void 0&&(B=!0),!(g instanceof Wa))throw new Error("Illegal call");if(typeof w!="string")return w;if(!!w){var O=g.generator(),q=O.getOptions(),_e={timeout:q.timeout,_initEnv:function(){B||this.setCurrentContext(O.getCurrentContext()),this.execStartTime=O.getExecStartTime(),this.execEndTime=this.execStartTime}},Xe=B?O.getGlobalScope():O.getCurrentScope(),ct=new yo(Xe,_e);return ct.evaluate(w)}}Object.defineProperty(qo,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function xn(g){if(!(g instanceof Wa))throw new Error("Illegal call");for(var w=g.generator(),B=arguments.length,O=new Array(B>1?B-1:0),q=1;q<B;q++)O[q-1]=arguments[q];var _e=O.pop(),Xe=new yo(w.getGlobalScope(),w.getOptions()),ct=`
		    (function anonymous(`+O.join(",")+`){
		        `+_e+`
		    });
		    `;return Xe.evaluate(ct)}Object.defineProperty(xn,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var dn=function(w){this.value=w},Kt=function(w){this.value=w},Bo=function(w){this.value=w},xe=function(w,B,O){B===void 0&&(B=null),this.name=O,this.parent=B,this.data=w,this.labelStack=[]};function Vs(){}function nu(g,w){return g===void 0&&(g=null),new xe(Object.create(null),g,w)}function ls(g){return Object.create(g)}var sa={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Float64Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:qo,Function:xn};typeof JSON!="undefined"&&(sa.JSON=JSON),typeof Promise!="undefined"&&(sa.Promise=Promise),typeof Set!="undefined"&&(sa.Set=Set),typeof Map!="undefined"&&(sa.Map=Map),typeof Symbol!="undefined"&&(sa.Symbol=Symbol),typeof Proxy!="undefined"&&(sa.Proxy=Proxy),typeof WeakMap!="undefined"&&(sa.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(sa.WeakSet=WeakSet),typeof Reflect!="undefined"&&(sa.Reflect=Reflect);var yo=function(){function g(B,O){B===void 0&&(B=g.global),O===void 0&&(O={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:O.ecmaVersion||g.ecmaVersion,timeout:O.timeout||0,rootContext:O.rootContext,globalContextInFunction:O.globalContextInFunction===void 0?g.globalContextInFunction:O.globalContextInFunction,_initEnv:O._initEnv},this.context=B||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var w=g.prototype;return w.initEnvironment=function(O){var q;if(O instanceof xe)q=O;else{var _e=null,Xe=this.createSuperScope(O);this.options.rootContext&&(_e=new xe(ls(this.options.rootContext),Xe,Lt)),q=new xe(O,_e||Xe,io)}this.globalScope=q,this.currentScope=this.globalScope,this.globalContext=q.data,this.currentContext=q.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var ct=this.options._initEnv;ct&&ct.call(this)},w.getExecStartTime=function(){return this.execStartTime},w.getExecutionTime=function(){return this.execEndTime-this.execStartTime},w.setExecTimeout=function(O){O===void 0&&(O=0),this.options.timeout=O},w.getOptions=function(){return this.options},w.getGlobalScope=function(){return this.globalScope},w.getCurrentScope=function(){return this.currentScope},w.getCurrentContext=function(){return this.currentContext},w.isInterruptThrow=function(O){return O instanceof Nu||O instanceof Xo||O instanceof Co},w.createSuperScope=function(O){var q=Object.assign({},sa),_e=Object.keys(q);return _e.forEach(function(Xe){Xe in O&&delete q[Xe]}),new xe(q,null,lt)},w.setCurrentContext=function(O){this.currentContext=O},w.setCurrentScope=function(O){this.currentScope=O},w.evaluate=function(O){O===void 0&&(O="");var q;if(!!O)return q=Na(O,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||g.ecmaVersion}),this.evaluateNode(q,O)},w.appendCode=function(O){return this.evaluate(O)},w.evaluateNode=function(O,q){var _e=this;q===void 0&&(q=""),this.value=void 0,this.source=q,this.sourceList.push(q),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Xe=this.getCurrentScope(),ct=this.getCurrentContext(),mt=Xe.labelStack.concat([]),lr=this.callStack.concat([]),Er=function(){_e.setCurrentScope(Xe),_e.setCurrentContext(ct),Xe.labelStack=mt,_e.callStack=lr};try{var In=this.createClosure(O);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),In()}catch(si){throw si}finally{Er(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},w.createErrorMessage=function(O,q,_e){var Xe=O[1].replace("%0",String(q));return _e!==null&&(Xe+=this.getNodePosition(_e||this.lastExecNode)),Xe},w.createError=function(O,q){return new q(O)},w.createThrowError=function(O,q){return this.createError(O,q)},w.createInternalThrowError=function(O,q,_e){return this.createError(this.createErrorMessage(O,q,_e),O[2])},w.checkTimeout=function(){if(!this.isRunning)return!1;var O=this.options.timeout||0,q=Date.now();return q-this.execStartTime>O},w.getNodePosition=function(O){if(O){var q="";return O.loc?" ["+O.loc.start.line+":"+O.loc.start.column+"]"+q:""}return""},w.createClosure=function(O){var q=this,_e;switch(O.type){case"BinaryExpression":_e=this.binaryExpressionHandler(O);break;case"LogicalExpression":_e=this.logicalExpressionHandler(O);break;case"UnaryExpression":_e=this.unaryExpressionHandler(O);break;case"UpdateExpression":_e=this.updateExpressionHandler(O);break;case"ObjectExpression":_e=this.objectExpressionHandler(O);break;case"ArrayExpression":_e=this.arrayExpressionHandler(O);break;case"CallExpression":_e=this.callExpressionHandler(O);break;case"NewExpression":_e=this.newExpressionHandler(O);break;case"MemberExpression":_e=this.memberExpressionHandler(O);break;case"ThisExpression":_e=this.thisExpressionHandler(O);break;case"SequenceExpression":_e=this.sequenceExpressionHandler(O);break;case"Literal":_e=this.literalHandler(O);break;case"Identifier":_e=this.identifierHandler(O);break;case"AssignmentExpression":_e=this.assignmentExpressionHandler(O);break;case"FunctionDeclaration":_e=this.functionDeclarationHandler(O);break;case"VariableDeclaration":_e=this.variableDeclarationHandler(O);break;case"BlockStatement":case"Program":_e=this.programHandler(O);break;case"ExpressionStatement":_e=this.expressionStatementHandler(O);break;case"EmptyStatement":_e=this.emptyStatementHandler(O);break;case"ReturnStatement":_e=this.returnStatementHandler(O);break;case"FunctionExpression":_e=this.functionExpressionHandler(O);break;case"IfStatement":_e=this.ifStatementHandler(O);break;case"ConditionalExpression":_e=this.conditionalExpressionHandler(O);break;case"ForStatement":_e=this.forStatementHandler(O);break;case"WhileStatement":_e=this.whileStatementHandler(O);break;case"DoWhileStatement":_e=this.doWhileStatementHandler(O);break;case"ForInStatement":_e=this.forInStatementHandler(O);break;case"WithStatement":_e=this.withStatementHandler(O);break;case"ThrowStatement":_e=this.throwStatementHandler(O);break;case"TryStatement":_e=this.tryStatementHandler(O);break;case"ContinueStatement":_e=this.continueStatementHandler(O);break;case"BreakStatement":_e=this.breakStatementHandler(O);break;case"SwitchStatement":_e=this.switchStatementHandler(O);break;case"LabeledStatement":_e=this.labeledStatementHandler(O);break;case"DebuggerStatement":_e=this.debuggerStatementHandler(O);break;default:throw this.createInternalThrowError(ga.NodeTypeSyntaxError,O.type,O)}return function(){var Xe=q.options.timeout;if(Xe&&Xe>0&&q.checkTimeout())throw q.createInternalThrowError(ga.ExecutionTimeOutError,Xe,null);return q.lastExecNode=O,_e.apply(void 0,arguments)}},w.binaryExpressionHandler=function(O){var q=this,_e=this.createClosure(O.left),Xe=this.createClosure(O.right);return function(){var ct=_e(),mt=Xe();switch(O.operator){case"==":return ct==mt;case"!=":return ct!=mt;case"===":return ct===mt;case"!==":return ct!==mt;case"<":return ct<mt;case"<=":return ct<=mt;case">":return ct>mt;case">=":return ct>=mt;case"<<":return ct<<mt;case">>":return ct>>mt;case">>>":return ct>>>mt;case"+":return ct+mt;case"-":return ct-mt;case"*":return ct*mt;case"**":return Math.pow(ct,mt);case"/":return ct/mt;case"%":return ct%mt;case"|":return ct|mt;case"^":return ct^mt;case"&":return ct&mt;case"in":return ct in mt;case"instanceof":return ct instanceof mt;default:throw q.createInternalThrowError(ga.BinaryOperatorSyntaxError,O.operator,O)}}},w.logicalExpressionHandler=function(O){var q=this,_e=this.createClosure(O.left),Xe=this.createClosure(O.right);return function(){switch(O.operator){case"||":return _e()||Xe();case"&&":return _e()&&Xe();default:throw q.createInternalThrowError(ga.LogicalOperatorSyntaxError,O.operator,O)}}},w.unaryExpressionHandler=function(O){var q=this;switch(O.operator){case"delete":var _e=this.createObjectGetter(O.argument),Xe=this.createNameGetter(O.argument);return function(){var Er=_e(),In=Xe();return delete Er[In]};default:var ct;if(O.operator==="typeof"&&O.argument.type==="Identifier"){var mt=this.createObjectGetter(O.argument),lr=this.createNameGetter(O.argument);ct=function(){return mt()[lr()]}}else ct=this.createClosure(O.argument);return function(){var Er=ct();switch(O.operator){case"-":return-Er;case"+":return+Er;case"!":return!Er;case"~":return~Er;case"void":return;case"typeof":return typeof Er;default:throw q.createInternalThrowError(ga.UnaryOperatorSyntaxError,O.operator,O)}}}},w.updateExpressionHandler=function(O){var q=this,_e=this.createObjectGetter(O.argument),Xe=this.createNameGetter(O.argument);return function(){var ct=_e(),mt=Xe();switch(q.assertVariable(ct,mt,O),O.operator){case"++":return O.prefix?++ct[mt]:ct[mt]++;case"--":return O.prefix?--ct[mt]:ct[mt]--;default:throw q.createInternalThrowError(ga.UpdateOperatorSyntaxError,O.operator,O)}}},w.objectExpressionHandler=function(O){var q=this,_e=[];function Xe(mt){return mt.type==="Identifier"?mt.name:mt.type==="Literal"?mt.value:this.throwError(ga.ObjectStructureSyntaxError,mt.type,mt)}var ct=Object.create(null);return O.properties.forEach(function(mt){var lr=mt.kind,Er=Xe(mt.key);(!ct[Er]||lr==="init")&&(ct[Er]={}),ct[Er][lr]=q.createClosure(mt.value),_e.push({key:Er,property:mt})}),function(){for(var mt={},lr=_e.length,Er=0;Er<lr;Er++){var In=_e[Er],si=In.key,Jn=ct[si],Xi=Jn.init?Jn.init():void 0,fa=Jn.get?Jn.get():function(){},Ia=Jn.set?Jn.set():function(il){};if("set"in Jn||"get"in Jn){var Gi={configurable:!0,enumerable:!0,get:fa,set:Ia};Object.defineProperty(mt,si,Gi)}else{var Lo=In.property,gs=Lo.kind;Lo.key.type==="Identifier"&&Lo.value.type==="FunctionExpression"&&gs==="init"&&!Lo.value.id&&_c(Xi,Lo.key.name),mt[si]=Xi}}return mt}},w.arrayExpressionHandler=function(O){var q=this,_e=O.elements.map(function(Xe){return Xe&&q.createClosure(Xe)});return function(){for(var Xe=_e.length,ct=Array(Xe),mt=0;mt<Xe;mt++){var lr=_e[mt];lr&&(ct[mt]=lr())}return ct}},w.safeObjectGet=function(O,q,_e){return O[q]},w.createCallFunctionGetter=function(O){var q=this;switch(O.type){case"MemberExpression":var _e=this.createClosure(O.object),Xe=this.createMemberKeyGetter(O),ct=this.source;return function(){var lr=_e(),Er=Xe(),In=q.safeObjectGet(lr,Er,O);if(!In||!$i(In)){var si=ct.slice(O.start,O.end);throw q.createInternalThrowError(ga.FunctionUndefinedReferenceError,si,O)}return In.__IS_EVAL_FUNC?function(Jn){return In(new Wa(q),Jn,!0)}:In.__IS_FUNCTION_FUNC?function(){for(var Jn=arguments.length,Xi=new Array(Jn),fa=0;fa<Jn;fa++)Xi[fa]=arguments[fa];return In.apply(void 0,[new Wa(q)].concat(Xi))}:In.bind(lr)};default:var mt=this.createClosure(O);return function(){var lr="";O.type==="Identifier"&&(lr=O.name);var Er=mt();if(!Er||!$i(Er))throw q.createInternalThrowError(ga.FunctionUndefinedReferenceError,lr,O);if(O.type==="Identifier"&&Er.__IS_EVAL_FUNC&&lr==="eval")return function(Jn){var Xi=q.getScopeFromName(lr,q.getCurrentScope()),fa=Xi.name===lt||Xi.name===io||Xi.name===Lt;return Er(new Wa(q),Jn,!fa)};if(Er.__IS_EVAL_FUNC)return function(Jn){return Er(new Wa(q),Jn,!0)};if(Er.__IS_FUNCTION_FUNC)return function(){for(var Jn=arguments.length,Xi=new Array(Jn),fa=0;fa<Jn;fa++)Xi[fa]=arguments[fa];return Er.apply(void 0,[new Wa(q)].concat(Xi))};var In=q.options.globalContextInFunction;if(O.type==="Identifier"){var si=q.getIdentifierScope(O);si.name===Dr&&(In=si.data)}return Er.bind(In)}}},w.callExpressionHandler=function(O){var q=this,_e=this.createCallFunctionGetter(O.callee),Xe=O.arguments.map(function(ct){return q.createClosure(ct)});return function(){return _e().apply(void 0,Xe.map(function(ct){return ct()}))}},w.functionExpressionHandler=function(O){var q=this,_e=this,Xe=this.source,ct=this.collectDeclVars,mt=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var lr=O.id?O.id.name:"",Er=O.params.length,In=O.params.map(function(fa){return q.createParamNameGetter(fa)}),si=this.createClosure(O.body),Jn=this.collectDeclVars,Xi=this.collectDeclFuncs;return this.collectDeclVars=ct,this.collectDeclFuncs=mt,function(){var fa=_e.getCurrentScope(),Ia=function Gi(){for(var Lo=arguments.length,gs=new Array(Lo),il=0;il<Lo;il++)gs[il]=arguments[il];_e.callStack.push(""+lr);var Xc=_e.getCurrentScope(),ju=nu(fa,"FunctionScope("+lr+")");_e.setCurrentScope(ju),_e.addDeclarationsToScope(Jn,Xi,ju),lr&&(ju.data[lr]=Gi),ju.data.arguments=arguments,In.forEach(function(hu,wo){ju.data[hu()]=gs[wo]});var Ec=_e.getCurrentContext();_e.setCurrentContext(this);var Eu=si();if(_e.setCurrentContext(Ec),_e.setCurrentScope(Xc),_e.callStack.pop(),Eu instanceof dn)return Eu.value};return _c(Ia,lr),Object.defineProperty(Ia,"length",{value:Er,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(Ia,"toString",{value:function(){return Xe.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(Ia,"valueOf",{value:function(){return Xe.slice(O.start,O.end)},writable:!0,configurable:!0,enumerable:!1}),Ia}},w.newExpressionHandler=function(O){var q=this,_e=this.source,Xe=this.createClosure(O.callee),ct=O.arguments.map(function(mt){return q.createClosure(mt)});return function(){var mt=Xe();if(!$i(mt)||mt.__IS_EVAL_FUNC){var lr=O.callee,Er=_e.slice(lr.start,lr.end);throw q.createInternalThrowError(ga.IsNotConstructor,Er,O)}return mt.__IS_FUNCTION_FUNC?mt.apply(void 0,[new Wa(q)].concat(ct.map(function(In){return In()}))):Yo(mt,ct.map(function(In){return In()}))}},w.memberExpressionHandler=function(O){var q=this.createClosure(O.object),_e=this.createMemberKeyGetter(O);return function(){var Xe=q(),ct=_e();return Xe[ct]}},w.thisExpressionHandler=function(O){var q=this;return function(){return q.getCurrentContext()}},w.sequenceExpressionHandler=function(O){var q=this,_e=O.expressions.map(function(Xe){return q.createClosure(Xe)});return function(){for(var Xe,ct=_e.length,mt=0;mt<ct;mt++){var lr=_e[mt];Xe=lr()}return Xe}},w.literalHandler=function(O){return function(){return O.regex?new RegExp(O.regex.pattern,O.regex.flags):O.value}},w.identifierHandler=function(O){var q=this;return function(){var _e=q.getCurrentScope(),Xe=q.getScopeDataFromName(O.name,_e);return q.assertVariable(Xe,O.name,O),Xe[O.name]}},w.getIdentifierScope=function(O){var q=this.getCurrentScope(),_e=this.getScopeFromName(O.name,q);return _e},w.assignmentExpressionHandler=function(O){var q=this;O.left.type==="Identifier"&&O.right.type==="FunctionExpression"&&!O.right.id&&(O.right.id={type:"Identifier",name:O.left.name});var _e=this.createObjectGetter(O.left),Xe=this.createNameGetter(O.left),ct=this.createClosure(O.right);return function(){var mt=_e(),lr=Xe(),Er=ct();switch(O.operator!=="="&&q.assertVariable(mt,lr,O),O.operator){case"=":return mt[lr]=Er;case"+=":return mt[lr]+=Er;case"-=":return mt[lr]-=Er;case"*=":return mt[lr]*=Er;case"**=":return mt[lr]=Math.pow(mt[lr],Er);case"/=":return mt[lr]/=Er;case"%=":return mt[lr]%=Er;case"<<=":return mt[lr]<<=Er;case">>=":return mt[lr]>>=Er;case">>>=":return mt[lr]>>>=Er;case"&=":return mt[lr]&=Er;case"^=":return mt[lr]^=Er;case"|=":return mt[lr]|=Er;default:throw q.createInternalThrowError(ga.AssignmentExpressionSyntaxError,O.type,O)}}},w.functionDeclarationHandler=function(O){if(O.id){var q=this.functionExpressionHandler(O);Object.defineProperty(q,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(O.id.name,q)}return function(){return Ot}},w.getVariableName=function(O){if(O.type==="Identifier")return O.name;throw this.createInternalThrowError(ga.VariableTypeSyntaxError,O.type,O)},w.variableDeclarationHandler=function(O){for(var q=this,_e,Xe=[],ct=0;ct<O.declarations.length;ct++){var mt=O.declarations[ct];this.varDeclaration(this.getVariableName(mt.id)),mt.init&&Xe.push({type:"AssignmentExpression",operator:"=",left:mt.id,right:mt.init})}return Xe.length&&(_e=this.createClosure({type:"BlockStatement",body:Xe})),function(){if(_e){var lr=q.isVarDeclMode;q.isVarDeclMode=!0,_e(),q.isVarDeclMode=lr}return Ot}},w.assertVariable=function(O,q,_e){if(O===this.globalScope.data&&!(q in O))throw this.createInternalThrowError(ga.VariableUndefinedReferenceError,q,_e)},w.programHandler=function(O){var q=this,_e=O.body.map(function(Xe){return q.createClosure(Xe)});return function(){for(var Xe=Ot,ct=0;ct<_e.length;ct++){var mt=_e[ct],lr=q.setValue(mt());if(lr!==Ot&&(Xe=lr,Xe instanceof dn||Xe instanceof Kt||Xe instanceof Bo||Xe===ie||Xe===be))break}return Xe}},w.expressionStatementHandler=function(O){return this.createClosure(O.expression)},w.emptyStatementHandler=function(O){return function(){return Ot}},w.returnStatementHandler=function(O){var q=O.argument?this.createClosure(O.argument):Vs;return function(){return new dn(q())}},w.ifStatementHandler=function(O){var q=this.createClosure(O.test),_e=this.createClosure(O.consequent),Xe=O.alternate?this.createClosure(O.alternate):function(){return Ot};return function(){return q()?_e():Xe()}},w.conditionalExpressionHandler=function(O){return this.ifStatementHandler(O)},w.forStatementHandler=function(O){var q=this,_e=Vs,Xe=O.test?this.createClosure(O.test):function(){return!0},ct=Vs,mt=this.createClosure(O.body);return O.type==="ForStatement"&&(_e=O.init?this.createClosure(O.init):_e,ct=O.update?this.createClosure(O.update):Vs),function(lr){var Er,In=Ot,si=O.type==="DoWhileStatement";for(lr&&lr.type==="LabeledStatement"&&(Er=lr.label.name),_e();si||Xe();ct()){si=!1;var Jn=q.setValue(mt());if(!(Jn===Ot||Jn===be)){if(Jn===ie)break;if(In=Jn,In instanceof Bo&&In.value===Er){In=Ot;continue}if(In instanceof dn||In instanceof Kt||In instanceof Bo)break}}return In}},w.whileStatementHandler=function(O){return this.forStatementHandler(O)},w.doWhileStatementHandler=function(O){return this.forStatementHandler(O)},w.forInStatementHandler=function(O){var q=this,_e=O.left,Xe=this.createClosure(O.right),ct=this.createClosure(O.body);return O.left.type==="VariableDeclaration"&&(this.createClosure(O.left)(),_e=O.left.declarations[0].id),function(mt){var lr,Er=Ot,In;mt&&mt.type==="LabeledStatement"&&(lr=mt.label.name);var si=Xe();for(In in si){q.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:_e,right:{type:"Literal",value:In}})();var Jn=q.setValue(ct());if(!(Jn===Ot||Jn===be)){if(Jn===ie)break;if(Er=Jn,Er instanceof Bo&&Er.value===lr){Er=Ot;continue}if(Er instanceof dn||Er instanceof Kt||Er instanceof Bo)break}}return Er}},w.withStatementHandler=function(O){var q=this,_e=this.createClosure(O.object),Xe=this.createClosure(O.body);return function(){var ct=_e(),mt=q.getCurrentScope(),lr=new xe(ct,mt,Dr);q.setCurrentScope(lr);var Er=q.setValue(Xe());return q.setCurrentScope(mt),Er}},w.throwStatementHandler=function(O){var q=this,_e=this.createClosure(O.argument);return function(){throw q.setValue(void 0),_e()}},w.tryStatementHandler=function(O){var q=this,_e=this.createClosure(O.block),Xe=O.handler?this.catchClauseHandler(O.handler):null,ct=O.finalizer?this.createClosure(O.finalizer):null;return function(){var mt=q.getCurrentScope(),lr=q.getCurrentContext(),Er=mt.labelStack.concat([]),In=q.callStack.concat([]),si=Ot,Jn,Xi,fa=function(){q.setCurrentScope(mt),q.setCurrentContext(lr),mt.labelStack=Er,q.callStack=In};try{si=q.setValue(_e()),si instanceof dn&&(Jn=si)}catch(Ia){if(fa(),q.isInterruptThrow(Ia))throw Ia;if(Xe)try{si=q.setValue(Xe(Ia)),si instanceof dn&&(Jn=si)}catch(Gi){if(fa(),q.isInterruptThrow(Gi))throw Gi;Xi=Gi}}if(ct)try{si=ct(),si instanceof dn&&(Jn=si)}catch(Ia){if(fa(),q.isInterruptThrow(Ia))throw Ia;Xi=Ia}if(Xi)throw Xi;return Jn||si}},w.catchClauseHandler=function(O){var q=this,_e=this.createParamNameGetter(O.param),Xe=this.createClosure(O.body);return function(ct){var mt,lr=q.getCurrentScope(),Er=lr.data,In=_e(),si=Os.call(Er,In),Jn=Er[In];return Er[In]=ct,mt=Xe(),si?Er[In]=Jn:delete Er[In],mt}},w.continueStatementHandler=function(O){return function(){return O.label?new Bo(O.label.name):be}},w.breakStatementHandler=function(O){return function(){return O.label?new Kt(O.label.name):ie}},w.switchStatementHandler=function(O){var q=this,_e=this.createClosure(O.discriminant),Xe=O.cases.map(function(ct){return q.switchCaseHandler(ct)});return function(){for(var ct=_e(),mt=!1,lr,Er,In,si=0;si<Xe.length;si++){var Jn=Xe[si](),Xi=Jn.testClosure();if(Xi===Qe){In=Jn;continue}if(mt||Xi===ct){if(mt=!0,Er=q.setValue(Jn.bodyClosure()),Er===Ot)continue;if(Er===ie||(lr=Er,lr instanceof dn||lr instanceof Kt||lr instanceof Bo||lr===be))break}}if(!mt&&In){Er=q.setValue(In.bodyClosure());var fa=Er===Ot||Er===ie||Er===be;fa||(lr=Er)}return lr}},w.switchCaseHandler=function(O){var q=O.test?this.createClosure(O.test):function(){return Qe},_e=this.createClosure({type:"BlockStatement",body:O.consequent});return function(){return{testClosure:q,bodyClosure:_e}}},w.labeledStatementHandler=function(O){var q=this,_e=O.label.name,Xe=this.createClosure(O.body);return function(){var ct,mt=q.getCurrentScope();return mt.labelStack.push(_e),ct=Xe(O),ct instanceof Kt&&ct.value===_e&&(ct=Ot),mt.labelStack.pop(),ct}},w.debuggerStatementHandler=function(O){return function(){debugger;return Ot}},w.createParamNameGetter=function(O){if(O.type==="Identifier")return function(){return O.name};throw this.createInternalThrowError(ga.ParamTypeSyntaxError,O.type,O)},w.createObjectKeyGetter=function(O){var q;return O.type==="Identifier"?q=function(){return O.name}:q=this.createClosure(O),function(){return q()}},w.createMemberKeyGetter=function(O){return O.computed?this.createClosure(O.property):this.createObjectKeyGetter(O.property)},w.createObjectGetter=function(O){var q=this;switch(O.type){case"Identifier":return function(){return q.getScopeDataFromName(O.name,q.getCurrentScope())};case"MemberExpression":return this.createClosure(O.object);default:throw this.createInternalThrowError(ga.AssignmentTypeSyntaxError,O.type,O)}},w.createNameGetter=function(O){switch(O.type){case"Identifier":return function(){return O.name};case"MemberExpression":return this.createMemberKeyGetter(O);default:throw this.createInternalThrowError(ga.AssignmentTypeSyntaxError,O.type,O)}},w.varDeclaration=function(O){var q=this.collectDeclVars;q[O]=void 0},w.funcDeclaration=function(O,q){var _e=this.collectDeclFuncs;_e[O]=q},w.addDeclarationsToScope=function(O,q,_e){var Xe=_e.data;for(var ct in q){var mt=q[ct];Xe[ct]=mt&&mt()}for(var lr in O)lr in Xe||(Xe[lr]=void 0)},w.getScopeValue=function(O,q){var _e=this.getScopeFromName(O,q);return _e.data[O]},w.getScopeDataFromName=function(O,q){return this.getScopeFromName(O,q).data},w.getScopeFromName=function(O,q){var _e=q;do if(O in _e.data)return _e;while(_e=_e.parent);return this.globalScope},w.setValue=function(O){var q=this.callStack.length;return this.isVarDeclMode||q||O===Ot||O===ie||O===be||O instanceof Kt||O instanceof Bo||(this.value=O instanceof dn?O.value:O),O},w.getValue=function(){return this.value},g}();yo.version=ru,yo.eval=qo,yo.Function=xn,yo.ecmaVersion=5,yo.globalContextInFunction=void 0,yo.global=Object.create(null);function Wl(g){return g===void 0&&(g=Object.create(null)),g}function xc(g,w,B){w===void 0&&(w=[]),B===void 0&&(B={});var O=B.parsingContext,q=B.timeout===void 0?0:B.timeout,_e=`
    (function anonymous(`+w.join(",")+`){
         `+g+`
    });
    `,Xe=new yo(O,{ecmaVersion:B.ecmaVersion,timeout:q,rootContext:B.rootContext,globalContextInFunction:B.globalContextInFunction});return Xe.evaluate(_e)}function zu(g,w,B){var O=new yo(w,B);return O.evaluate(g)}var bc=zu,El=function(){function g(B){this._code=B}var w=g.prototype;return w.runInContext=function(O){return zu(this._code,O)},w.runInNewContext=function(O){return zu(this._code,O)},g}(),Uu=function(g,w,B){return zu(g,w,B)};function iu(){for(var g=arguments.length,w=new Array(g),B=0;B<g;B++)w[B]=arguments[B];var O=w.pop();return xc(O||"",w)}var Zu=Uu},20396:function(Ue,W,R){var Y;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function($,v,ee,F){"use strict";var Q=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",re=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined"),Ee=Q||re,ne=["","webkit","Moz","MS","ms","o"],je=Ee?"":v.createElement("div"),Ce="function",et=Math.round,Pt=Math.abs,nr=Date.now;function xt(ie,be,Qe){return setTimeout(vt(ie,Qe),be)}function Wt(ie,be,Qe){return Array.isArray(ie)?(wt(ie,Qe[be],Qe),!0):!1}function wt(ie,be,Qe){var Ot;if(!!ie)if(ie.forEach)ie.forEach(be,Qe);else if(ie.length!==F)for(Ot=0;Ot<ie.length;)be.call(Qe,ie[Ot],Ot,ie),Ot++;else for(Ot in ie)ie.hasOwnProperty(Ot)&&be.call(Qe,ie[Ot],Ot,ie)}function st(ie,be,Qe){var Ot="DEPRECATED METHOD: "+be+`
`+Qe+` AT 
`;return function(){var Dr=new Error("get-stack-trace"),lt=Dr&&Dr.stack?Dr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Lt=$.console&&($.console.warn||$.console.log);return Lt&&Lt.call($.console,Ot,lt),ie.apply(this,arguments)}}var ut;typeof Object.assign!="function"?ut=function(be){if(be===F||be===null)throw new TypeError("Cannot convert undefined or null to object");for(var Qe=Object(be),Ot=1;Ot<arguments.length;Ot++){var Dr=arguments[Ot];if(Dr!==F&&Dr!==null)for(var lt in Dr)Dr.hasOwnProperty(lt)&&(Qe[lt]=Dr[lt])}return Qe}:ut=Object.assign;var Jt=st(function(be,Qe,Ot){for(var Dr=Object.keys(Qe),lt=0;lt<Dr.length;)(!Ot||Ot&&be[Dr[lt]]===F)&&(be[Dr[lt]]=Qe[Dr[lt]]),lt++;return be},"extend","Use `assign`."),X=st(function(be,Qe){return Jt(be,Qe,!0)},"merge","Use `assign`.");function Xt(ie,be,Qe){var Ot=be.prototype,Dr;Dr=ie.prototype=Object.create(Ot),Dr.constructor=ie,Dr._super=Ot,Qe&&ut(Dr,Qe)}function vt(ie,be){return function(){return ie.apply(be,arguments)}}function qe(ie,be){return typeof ie==Ce?ie.apply(be&&be[0]||F,be):ie}function pt(ie,be){return ie===F?be:ie}function $e(ie,be,Qe){wt(Wr(be),function(Ot){ie.addEventListener(Ot,Qe,!1)})}function kt(ie,be,Qe){wt(Wr(be),function(Ot){ie.removeEventListener(Ot,Qe,!1)})}function xr(ie,be){for(;ie;){if(ie==be)return!0;ie=ie.parentNode}return!1}function Ir(ie,be){return ie.indexOf(be)>-1}function Wr(ie){return ie.trim().split(/\s+/g)}function Me(ie,be,Qe){if(ie.indexOf&&!Qe)return ie.indexOf(be);for(var Ot=0;Ot<ie.length;){if(Qe&&ie[Ot][Qe]==be||!Qe&&ie[Ot]===be)return Ot;Ot++}return-1}function Ye(ie){return Array.prototype.slice.call(ie,0)}function Fe(ie,be,Qe){for(var Ot=[],Dr=[],lt=0;lt<ie.length;){var Lt=be?ie[lt][be]:ie[lt];Me(Dr,Lt)<0&&Ot.push(ie[lt]),Dr[lt]=Lt,lt++}return Qe&&(be?Ot=Ot.sort(function($i,Wa){return $i[be]>Wa[be]}):Ot=Ot.sort()),Ot}function At(ie,be){for(var Qe,Ot,Dr=be[0].toUpperCase()+be.slice(1),lt=0;lt<ne.length;){if(Qe=ne[lt],Ot=Qe?Qe+Dr:be,Ot in ie)return Ot;lt++}return F}var gt=1;function Nt(){return gt++}function qt(ie){var be=ie.ownerDocument||ie;return be.defaultView||be.parentWindow||$}var Cr=/mobile|tablet|ip(ad|hone|od)|android/i,Wn="ontouchstart"in $,hn=At($,"PointerEvent")!==F,Yi=Wn&&Cr.test(navigator.userAgent),Un="touch",Gn="pen",di="mouse",Xn="kinect",ai=25,aa=1,Ri=2,Ei=4,ji=8,ua=1,Si=2,ba=4,Mn=8,_i=16,Ui=Si|ba,qi=Mn|_i,Ga=Ui|qi,ve=["x","y"],Ln=["clientX","clientY"];function Ha(ie,be){var Qe=this;this.manager=ie,this.callback=be,this.element=ie.element,this.target=ie.options.inputTarget,this.domHandler=function(Ot){qe(ie.options.enable,[ie])&&Qe.handler(Ot)},this.init()}Ha.prototype={handler:function(){},init:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(qt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&kt(this.element,this.evEl,this.domHandler),this.evTarget&&kt(this.target,this.evTarget,this.domHandler),this.evWin&&kt(qt(this.element),this.evWin,this.domHandler)}};function os(ie){var be,Qe=ie.options.inputClass;return Qe?be=Qe:hn?be=Le:Yi?be=Ft:Wn?be=Tt:be=Ca,new be(ie,Ut)}function Ut(ie,be,Qe){var Ot=Qe.pointers.length,Dr=Qe.changedPointers.length,lt=be&aa&&Ot-Dr==0,Lt=be&(Ei|ji)&&Ot-Dr==0;Qe.isFirst=!!lt,Qe.isFinal=!!Lt,lt&&(ie.session={}),Qe.eventType=be,ir(ie,Qe),ie.emit("hammer.input",Qe),ie.recognize(Qe),ie.session.prevInput=Qe}function ir(ie,be){var Qe=ie.session,Ot=be.pointers,Dr=Ot.length;Qe.firstInput||(Qe.firstInput=or(be)),Dr>1&&!Qe.firstMultiple?Qe.firstMultiple=or(be):Dr===1&&(Qe.firstMultiple=!1);var lt=Qe.firstInput,Lt=Qe.firstMultiple,io=Lt?Lt.center:lt.center,$i=be.center=Rn(Ot);be.timeStamp=nr(),be.deltaTime=be.timeStamp-lt.timeStamp,be.angle=Ti(io,$i),be.distance=nn(io,$i),Pr(Qe,be),be.offsetDirection=jn(be.deltaX,be.deltaY);var Wa=oi(be.deltaTime,be.deltaX,be.deltaY);be.overallVelocityX=Wa.x,be.overallVelocityY=Wa.y,be.overallVelocity=Pt(Wa.x)>Pt(Wa.y)?Wa.x:Wa.y,be.scale=Lt?$a(Lt.pointers,Ot):1,be.rotation=Lt?Mi(Lt.pointers,Ot):0,be.maxPointers=Qe.prevInput?be.pointers.length>Qe.prevInput.maxPointers?be.pointers.length:Qe.prevInput.maxPointers:be.pointers.length,I(Qe,be);var qo=ie.element;xr(be.srcEvent.target,qo)&&(qo=be.srcEvent.target),be.target=qo}function Pr(ie,be){var Qe=be.center,Ot=ie.offsetDelta||{},Dr=ie.prevDelta||{},lt=ie.prevInput||{};(be.eventType===aa||lt.eventType===Ei)&&(Dr=ie.prevDelta={x:lt.deltaX||0,y:lt.deltaY||0},Ot=ie.offsetDelta={x:Qe.x,y:Qe.y}),be.deltaX=Dr.x+(Qe.x-Ot.x),be.deltaY=Dr.y+(Qe.y-Ot.y)}function I(ie,be){var Qe=ie.lastInterval||be,Ot=be.timeStamp-Qe.timeStamp,Dr,lt,Lt,io;if(be.eventType!=ji&&(Ot>ai||Qe.velocity===F)){var $i=be.deltaX-Qe.deltaX,Wa=be.deltaY-Qe.deltaY,qo=oi(Ot,$i,Wa);lt=qo.x,Lt=qo.y,Dr=Pt(qo.x)>Pt(qo.y)?qo.x:qo.y,io=jn($i,Wa),ie.lastInterval=be}else Dr=Qe.velocity,lt=Qe.velocityX,Lt=Qe.velocityY,io=Qe.direction;be.velocity=Dr,be.velocityX=lt,be.velocityY=Lt,be.direction=io}function or(ie){for(var be=[],Qe=0;Qe<ie.pointers.length;)be[Qe]={clientX:et(ie.pointers[Qe].clientX),clientY:et(ie.pointers[Qe].clientY)},Qe++;return{timeStamp:nr(),pointers:be,center:Rn(be),deltaX:ie.deltaX,deltaY:ie.deltaY}}function Rn(ie){var be=ie.length;if(be===1)return{x:et(ie[0].clientX),y:et(ie[0].clientY)};for(var Qe=0,Ot=0,Dr=0;Dr<be;)Qe+=ie[Dr].clientX,Ot+=ie[Dr].clientY,Dr++;return{x:et(Qe/be),y:et(Ot/be)}}function oi(ie,be,Qe){return{x:be/ie||0,y:Qe/ie||0}}function jn(ie,be){return ie===be?ua:Pt(ie)>=Pt(be)?ie<0?Si:ba:be<0?Mn:_i}function nn(ie,be,Qe){Qe||(Qe=ve);var Ot=be[Qe[0]]-ie[Qe[0]],Dr=be[Qe[1]]-ie[Qe[1]];return Math.sqrt(Ot*Ot+Dr*Dr)}function Ti(ie,be,Qe){Qe||(Qe=ve);var Ot=be[Qe[0]]-ie[Qe[0]],Dr=be[Qe[1]]-ie[Qe[1]];return Math.atan2(Dr,Ot)*180/Math.PI}function Mi(ie,be){return Ti(be[1],be[0],Ln)+Ti(ie[1],ie[0],Ln)}function $a(ie,be){return nn(be[0],be[1],Ln)/nn(ie[0],ie[1],Ln)}var ss={mousedown:aa,mousemove:Ri,mouseup:Ei},ma="mousedown",Ra="mousemove mouseup";function Ca(){this.evEl=ma,this.evWin=Ra,this.pressed=!1,Ha.apply(this,arguments)}Xt(Ca,Ha,{handler:function(be){var Qe=ss[be.type];Qe&aa&&be.button===0&&(this.pressed=!0),Qe&Ri&&be.which!==1&&(Qe=Ei),!!this.pressed&&(Qe&Ei&&(this.pressed=!1),this.callback(this.manager,Qe,{pointers:[be],changedPointers:[be],pointerType:di,srcEvent:be}))}});var G={pointerdown:aa,pointermove:Ri,pointerup:Ei,pointercancel:ji,pointerout:ji},K={2:Un,3:Gn,4:di,5:Xn},se="pointerdown",ge="pointermove pointerup pointercancel";!Ee&&$.MSPointerEvent&&!$.PointerEvent&&(se="MSPointerDown",ge="MSPointerMove MSPointerUp MSPointerCancel");function Le(){this.evEl=se,this.evWin=ge,Ha.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Xt(Le,Ha,{handler:function(be){var Qe=this.store,Ot=!1,Dr=be.type.toLowerCase().replace("ms",""),lt=G[Dr],Lt=K[be.pointerType]||be.pointerType,io=Lt==Un,$i=Me(Qe,be.pointerId,"pointerId");lt&aa&&(be.button===0||io)?$i<0&&(Qe.push(be),$i=Qe.length-1):lt&(Ei|ji)&&(Ot=!0),!($i<0)&&(Qe[$i]=be,this.callback(this.manager,lt,{pointers:Qe,changedPointers:[be],pointerType:Lt,srcEvent:be}),Ot&&Qe.splice($i,1))}});var Ge={touchstart:aa,touchmove:Ri,touchend:Ei,touchcancel:ji},rt="touchstart",pe="touchstart touchmove touchend touchcancel";function Be(){this.evTarget=rt,this.evWin=pe,this.started=!1,Ha.apply(this,arguments)}Xt(Be,Ha,{handler:function(be){var Qe=Ge[be.type];if(Qe===aa&&(this.started=!0),!!this.started){var Ot=yt.call(this,be,Qe);Qe&(Ei|ji)&&Ot[0].length-Ot[1].length==0&&(this.started=!1),this.callback(this.manager,Qe,{pointers:Ot[0],changedPointers:Ot[1],pointerType:Un,srcEvent:be})}}});function yt(ie,be){var Qe=Ye(ie.touches),Ot=Ye(ie.changedTouches);return be&(Ei|ji)&&(Qe=Fe(Qe.concat(Ot),"identifier",!0)),[Qe,Ot]}var dr={touchstart:aa,touchmove:Ri,touchend:Ei,touchcancel:ji},Dt="touchstart touchmove touchend touchcancel";function Ft(){this.evTarget=Dt,this.targetIds={},Ha.apply(this,arguments)}Xt(Ft,Ha,{handler:function(be){var Qe=dr[be.type],Ot=_r.call(this,be,Qe);!Ot||this.callback(this.manager,Qe,{pointers:Ot[0],changedPointers:Ot[1],pointerType:Un,srcEvent:be})}});function _r(ie,be){var Qe=Ye(ie.touches),Ot=this.targetIds;if(be&(aa|Ri)&&Qe.length===1)return Ot[Qe[0].identifier]=!0,[Qe,Qe];var Dr,lt,Lt=Ye(ie.changedTouches),io=[],$i=this.target;if(lt=Qe.filter(function(Wa){return xr(Wa.target,$i)}),be===aa)for(Dr=0;Dr<lt.length;)Ot[lt[Dr].identifier]=!0,Dr++;for(Dr=0;Dr<Lt.length;)Ot[Lt[Dr].identifier]&&io.push(Lt[Dr]),be&(Ei|ji)&&delete Ot[Lt[Dr].identifier],Dr++;if(!!io.length)return[Fe(lt.concat(io),"identifier",!0),io]}var En=2500,un=25;function Tt(){Ha.apply(this,arguments);var ie=vt(this.handler,this);this.touch=new Ft(this.manager,ie),this.mouse=new Ca(this.manager,ie),this.primaryTouch=null,this.lastTouches=[]}Xt(Tt,Ha,{handler:function(be,Qe,Ot){var Dr=Ot.pointerType==Un,lt=Ot.pointerType==di;if(!(lt&&Ot.sourceCapabilities&&Ot.sourceCapabilities.firesTouchEvents)){if(Dr)on.call(this,Qe,Ot);else if(lt&&qr.call(this,Ot))return;this.callback(be,Qe,Ot)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function on(ie,be){ie&aa?(this.primaryTouch=be.changedPointers[0].identifier,Gr.call(this,be)):ie&(Ei|ji)&&Gr.call(this,be)}function Gr(ie){var be=ie.changedPointers[0];if(be.identifier===this.primaryTouch){var Qe={x:be.clientX,y:be.clientY};this.lastTouches.push(Qe);var Ot=this.lastTouches,Dr=function(){var lt=Ot.indexOf(Qe);lt>-1&&Ot.splice(lt,1)};setTimeout(Dr,En)}}function qr(ie){for(var be=ie.srcEvent.clientX,Qe=ie.srcEvent.clientY,Ot=0;Ot<this.lastTouches.length;Ot++){var Dr=this.lastTouches[Ot],lt=Math.abs(be-Dr.x),Lt=Math.abs(Qe-Dr.y);if(lt<=un&&Lt<=un)return!0}return!1}var ni=Ee?F:At(je.style,"touchAction"),tn=ni!==F,Ci="compute",Ji="auto",yi="manipulation",Pi="none",xi="pan-x",ei="pan-y",Wi=Ii();function La(ie,be){this.manager=ie,this.set(be)}La.prototype={set:function(ie){ie==Ci&&(ie=this.compute()),tn&&this.manager.element.style&&Wi[ie]&&(this.manager.element.style[ni]=ie),this.actions=ie.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ie=[];return wt(this.manager.recognizers,function(be){qe(be.options.enable,[be])&&(ie=ie.concat(be.getTouchAction()))}),oa(ie.join(" "))},preventDefaults:function(ie){var be=ie.srcEvent,Qe=ie.offsetDirection;if(this.manager.session.prevented){be.preventDefault();return}var Ot=this.actions,Dr=Ir(Ot,Pi)&&!Wi[Pi],lt=Ir(Ot,ei)&&!Wi[ei],Lt=Ir(Ot,xi)&&!Wi[xi];if(Dr){var io=ie.pointers.length===1,$i=ie.distance<2,Wa=ie.deltaTime<250;if(io&&$i&&Wa)return}if(!(Lt&&lt)&&(Dr||lt&&Qe&Ui||Lt&&Qe&qi))return this.preventSrc(be)},preventSrc:function(ie){this.manager.session.prevented=!0,ie.preventDefault()}};function oa(ie){if(Ir(ie,Pi))return Pi;var be=Ir(ie,xi),Qe=Ir(ie,ei);return be&&Qe?Pi:be||Qe?be?xi:ei:Ir(ie,yi)?yi:Ji}function Ii(){if(!tn)return!1;var ie={};if(Ee)return ie;var be=$.CSS&&$.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(Qe){ie[Qe]=be?$.CSS.supports("touch-action",Qe):!0}),ie}var Vi=1,Na=2,tu=4,wa=8,Aa=wa,ms=16,us=32;function ta(ie){this.options=ut({},this.defaults,ie||{}),this.id=Nt(),this.manager=null,this.options.enable=pt(this.options.enable,!0),this.state=Vi,this.simultaneous={},this.requireFail=[]}ta.prototype={defaults:{},set:function(ie){return ut(this.options,ie),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ie){if(Wt(ie,"recognizeWith",this))return this;var be=this.simultaneous;return ie=za(ie,this),be[ie.id]||(be[ie.id]=ie,ie.recognizeWith(this)),this},dropRecognizeWith:function(ie){return Wt(ie,"dropRecognizeWith",this)?this:(ie=za(ie,this),delete this.simultaneous[ie.id],this)},requireFailure:function(ie){if(Wt(ie,"requireFailure",this))return this;var be=this.requireFail;return ie=za(ie,this),Me(be,ie)===-1&&(be.push(ie),ie.requireFailure(this)),this},dropRequireFailure:function(ie){if(Wt(ie,"dropRequireFailure",this))return this;ie=za(ie,this);var be=Me(this.requireFail,ie);return be>-1&&this.requireFail.splice(be,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ie){return!!this.simultaneous[ie.id]},emit:function(ie){var be=this,Qe=this.state;function Ot(Dr){be.manager.emit(Dr,ie)}Qe<wa&&Ot(be.options.event+Bu(Qe)),Ot(be.options.event),ie.additionalEvent&&Ot(ie.additionalEvent),Qe>=wa&&Ot(be.options.event+Bu(Qe))},tryEmit:function(ie){if(this.canEmit())return this.emit(ie);this.state=us},canEmit:function(){for(var ie=0;ie<this.requireFail.length;){if(!(this.requireFail[ie].state&(us|Vi)))return!1;ie++}return!0},recognize:function(ie){var be=ut({},ie);if(!qe(this.options.enable,[this,be])){this.reset(),this.state=us;return}this.state&(Aa|ms|us)&&(this.state=Vi),this.state=this.process(be),this.state&(Na|tu|wa|ms)&&this.tryEmit(be)},process:function(ie){},getTouchAction:function(){},reset:function(){}};function Bu(ie){return ie&ms?"cancel":ie&wa?"end":ie&tu?"move":ie&Na?"start":""}function mo(ie){return ie==_i?"down":ie==Mn?"up":ie==Si?"left":ie==ba?"right":""}function za(ie,be){var Qe=be.manager;return Qe?Qe.get(ie):ie}function ro(){ta.apply(this,arguments)}Xt(ro,ta,{defaults:{pointers:1},attrTest:function(ie){var be=this.options.pointers;return be===0||ie.pointers.length===be},process:function(ie){var be=this.state,Qe=ie.eventType,Ot=be&(Na|tu),Dr=this.attrTest(ie);return Ot&&(Qe&ji||!Dr)?be|ms:Ot||Dr?Qe&Ei?be|wa:be&Na?be|tu:Na:us}});function Ki(){ro.apply(this,arguments),this.pX=null,this.pY=null}Xt(Ki,ro,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ga},getTouchAction:function(){var ie=this.options.direction,be=[];return ie&Ui&&be.push(ei),ie&qi&&be.push(xi),be},directionTest:function(ie){var be=this.options,Qe=!0,Ot=ie.distance,Dr=ie.direction,lt=ie.deltaX,Lt=ie.deltaY;return Dr&be.direction||(be.direction&Ui?(Dr=lt===0?ua:lt<0?Si:ba,Qe=lt!=this.pX,Ot=Math.abs(ie.deltaX)):(Dr=Lt===0?ua:Lt<0?Mn:_i,Qe=Lt!=this.pY,Ot=Math.abs(ie.deltaY))),ie.direction=Dr,Qe&&Ot>be.threshold&&Dr&be.direction},attrTest:function(ie){return ro.prototype.attrTest.call(this,ie)&&(this.state&Na||!(this.state&Na)&&this.directionTest(ie))},emit:function(ie){this.pX=ie.deltaX,this.pY=ie.deltaY;var be=mo(ie.direction);be&&(ie.additionalEvent=this.options.event+be),this._super.emit.call(this,ie)}});function Ho(){ro.apply(this,arguments)}Xt(Ho,ro,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Pi]},attrTest:function(ie){return this._super.attrTest.call(this,ie)&&(Math.abs(ie.scale-1)>this.options.threshold||this.state&Na)},emit:function(ie){if(ie.scale!==1){var be=ie.scale<1?"in":"out";ie.additionalEvent=this.options.event+be}this._super.emit.call(this,ie)}});function Wo(){ta.apply(this,arguments),this._timer=null,this._input=null}Xt(Wo,ta,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Ji]},process:function(ie){var be=this.options,Qe=ie.pointers.length===be.pointers,Ot=ie.distance<be.threshold,Dr=ie.deltaTime>be.time;if(this._input=ie,!Ot||!Qe||ie.eventType&(Ei|ji)&&!Dr)this.reset();else if(ie.eventType&aa)this.reset(),this._timer=xt(function(){this.state=Aa,this.tryEmit()},be.time,this);else if(ie.eventType&Ei)return Aa;return us},reset:function(){clearTimeout(this._timer)},emit:function(ie){this.state===Aa&&(ie&&ie.eventType&Ei?this.manager.emit(this.options.event+"up",ie):(this._input.timeStamp=nr(),this.manager.emit(this.options.event,this._input)))}});function Nu(){ro.apply(this,arguments)}Xt(Nu,ro,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Pi]},attrTest:function(ie){return this._super.attrTest.call(this,ie)&&(Math.abs(ie.rotation)>this.options.threshold||this.state&Na)}});function Co(){ro.apply(this,arguments)}Xt(Co,ro,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Ui|qi,pointers:1},getTouchAction:function(){return Ki.prototype.getTouchAction.call(this)},attrTest:function(ie){var be=this.options.direction,Qe;return be&(Ui|qi)?Qe=ie.overallVelocity:be&Ui?Qe=ie.overallVelocityX:be&qi&&(Qe=ie.overallVelocityY),this._super.attrTest.call(this,ie)&&be&ie.offsetDirection&&ie.distance>this.options.threshold&&ie.maxPointers==this.options.pointers&&Pt(Qe)>this.options.velocity&&ie.eventType&Ei},emit:function(ie){var be=mo(ie.offsetDirection);be&&this.manager.emit(this.options.event+be,ie),this.manager.emit(this.options.event,ie)}});function Xo(){ta.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Xt(Xo,ta,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[yi]},process:function(ie){var be=this.options,Qe=ie.pointers.length===be.pointers,Ot=ie.distance<be.threshold,Dr=ie.deltaTime<be.time;if(this.reset(),ie.eventType&aa&&this.count===0)return this.failTimeout();if(Ot&&Dr&&Qe){if(ie.eventType!=Ei)return this.failTimeout();var lt=this.pTime?ie.timeStamp-this.pTime<be.interval:!0,Lt=!this.pCenter||nn(this.pCenter,ie.center)<be.posThreshold;this.pTime=ie.timeStamp,this.pCenter=ie.center,!Lt||!lt?this.count=1:this.count+=1,this._input=ie;var io=this.count%be.taps;if(io===0)return this.hasRequireFailures()?(this._timer=xt(function(){this.state=Aa,this.tryEmit()},be.interval,this),Na):Aa}return us},failTimeout:function(){return this._timer=xt(function(){this.state=us},this.options.interval,this),us},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Aa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function ga(ie,be){return be=be||{},be.recognizers=pt(be.recognizers,ga.defaults.preset),new no(ie,be)}ga.VERSION="2.0.7",ga.defaults={domEvents:!1,touchAction:Ci,enable:!0,inputTarget:null,inputClass:null,preset:[[Nu,{enable:!1}],[Ho,{enable:!1},["rotate"]],[Co,{direction:Ui}],[Ki,{direction:Ui},["swipe"]],[Xo],[Xo,{event:"doubletap",taps:2},["tap"]],[Wo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var go=1,Yo=2;function no(ie,be){this.options=ut({},ga.defaults,be||{}),this.options.inputTarget=this.options.inputTarget||ie,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ie,this.input=os(this),this.touchAction=new La(this,this.options.touchAction),ru(this,!0),wt(this.options.recognizers,function(Qe){var Ot=this.add(new Qe[0](Qe[1]));Qe[2]&&Ot.recognizeWith(Qe[2]),Qe[3]&&Ot.requireFailure(Qe[3])},this)}no.prototype={set:function(ie){return ut(this.options,ie),ie.touchAction&&this.touchAction.update(),ie.inputTarget&&(this.input.destroy(),this.input.target=ie.inputTarget,this.input.init()),this},stop:function(ie){this.session.stopped=ie?Yo:go},recognize:function(ie){var be=this.session;if(!be.stopped){this.touchAction.preventDefaults(ie);var Qe,Ot=this.recognizers,Dr=be.curRecognizer;(!Dr||Dr&&Dr.state&Aa)&&(Dr=be.curRecognizer=null);for(var lt=0;lt<Ot.length;)Qe=Ot[lt],be.stopped!==Yo&&(!Dr||Qe==Dr||Qe.canRecognizeWith(Dr))?Qe.recognize(ie):Qe.reset(),!Dr&&Qe.state&(Na|tu|wa)&&(Dr=be.curRecognizer=Qe),lt++}},get:function(ie){if(ie instanceof ta)return ie;for(var be=this.recognizers,Qe=0;Qe<be.length;Qe++)if(be[Qe].options.event==ie)return be[Qe];return null},add:function(ie){if(Wt(ie,"add",this))return this;var be=this.get(ie.options.event);return be&&this.remove(be),this.recognizers.push(ie),ie.manager=this,this.touchAction.update(),ie},remove:function(ie){if(Wt(ie,"remove",this))return this;if(ie=this.get(ie),ie){var be=this.recognizers,Qe=Me(be,ie);Qe!==-1&&(be.splice(Qe,1),this.touchAction.update())}return this},on:function(ie,be){if(ie!==F&&be!==F){var Qe=this.handlers;return wt(Wr(ie),function(Ot){Qe[Ot]=Qe[Ot]||[],Qe[Ot].push(be)}),this}},off:function(ie,be){if(ie!==F){var Qe=this.handlers;return wt(Wr(ie),function(Ot){be?Qe[Ot]&&Qe[Ot].splice(Me(Qe[Ot],be),1):delete Qe[Ot]}),this}},emit:function(ie,be){this.options.domEvents&&_c(ie,be);var Qe=this.handlers[ie]&&this.handlers[ie].slice();if(!(!Qe||!Qe.length)){be.type=ie,be.preventDefault=function(){be.srcEvent.preventDefault()};for(var Ot=0;Ot<Qe.length;)Qe[Ot](be),Ot++}},destroy:function(){this.element&&ru(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ru(ie,be){var Qe=ie.element;if(!!Qe.style){var Ot;wt(ie.options.cssProps,function(Dr,lt){Ot=At(Qe.style,lt),be?(ie.oldCssProps[Ot]=Qe.style[Ot],Qe.style[Ot]=Dr):Qe.style[Ot]=ie.oldCssProps[Ot]||""}),be||(ie.oldCssProps={})}}function _c(ie,be){if(!Ee){var Qe=v.createEvent("Event");Qe.initEvent(ie,!0,!0),Qe.gesture=be,be.target.dispatchEvent(Qe)}}if(!Ee){ut(ga,{INPUT_START:aa,INPUT_MOVE:Ri,INPUT_END:Ei,INPUT_CANCEL:ji,STATE_POSSIBLE:Vi,STATE_BEGAN:Na,STATE_CHANGED:tu,STATE_ENDED:wa,STATE_RECOGNIZED:Aa,STATE_CANCELLED:ms,STATE_FAILED:us,DIRECTION_NONE:ua,DIRECTION_LEFT:Si,DIRECTION_RIGHT:ba,DIRECTION_UP:Mn,DIRECTION_DOWN:_i,DIRECTION_HORIZONTAL:Ui,DIRECTION_VERTICAL:qi,DIRECTION_ALL:Ga,Manager:no,Input:Ha,TouchAction:La,TouchInput:Ft,MouseInput:Ca,PointerEventInput:Le,TouchMouseInput:Tt,SingleTouchInput:Be,Recognizer:ta,AttrRecognizer:ro,Tap:Xo,Pan:Ki,Swipe:Co,Pinch:Ho,Rotate:Nu,Press:Wo,on:$e,off:kt,each:wt,merge:X,extend:Jt,assign:ut,inherit:Xt,bindFn:vt,prefixed:At});var Os=typeof window!="undefined"?window:typeof self!="undefined"?self:{};Os.Hammer=ga,Y=function(){return ga}.call(W,R,W,Ue),Y!==F&&(Ue.exports=Y)}})(typeof window!="undefined"?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document,"Hammer")},88307:function(Ue,W,R){(function(Y,$){Ue.exports=$(R(18857))})(this,function(Y){"use strict";var $=function(N){return N instanceof Uint8Array||N instanceof Uint16Array||N instanceof Uint32Array||N instanceof Int8Array||N instanceof Int16Array||N instanceof Int32Array||N instanceof Float32Array||N instanceof Float64Array||N instanceof Uint8ClampedArray},v=function(N,me){for(var Pe=Object.keys(me),Mt=0;Mt<Pe.length;++Mt)N[Pe[Mt]]=me[Pe[Mt]];return N},ee=`
`;function F(N){return typeof atob!="undefined"?atob(N):"base64:"+N}function Q(N){var me=new Error("(regl) "+N);throw console.error(me),me}function re(N,me){N||Q(me)}function Ee(N){return N?": "+N:""}function ne(N,me,Pe){N in me||Q("unknown parameter ("+N+")"+Ee(Pe)+". possible values: "+Object.keys(me).join())}function je(N,me){$(N)||Q("invalid parameter type"+Ee(me)+". must be a typed array")}function Ce(N,me){switch(me){case"number":return typeof N=="number";case"object":return typeof N=="object";case"string":return typeof N=="string";case"boolean":return typeof N=="boolean";case"function":return typeof N=="function";case"undefined":return typeof N=="undefined";case"symbol":return typeof N=="symbol"}}function et(N,me,Pe){Ce(N,me)||Q("invalid parameter type"+Ee(Pe)+". expected "+me+", got "+typeof N)}function Pt(N,me){N>=0&&(N|0)===N||Q("invalid parameter type, ("+N+")"+Ee(me)+". must be a nonnegative integer")}function nr(N,me,Pe){me.indexOf(N)<0&&Q("invalid value"+Ee(Pe)+". must be one of: "+me)}var xt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function Wt(N){Object.keys(N).forEach(function(me){xt.indexOf(me)<0&&Q('invalid regl constructor argument "'+me+'". must be one of '+xt)})}function wt(N,me){for(N=N+"";N.length<me;)N=" "+N;return N}function st(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function ut(N,me){this.number=N,this.line=me,this.errors=[]}function Jt(N,me,Pe){this.file=N,this.line=me,this.message=Pe}function X(){var N=new Error,me=(N.stack||N).toString(),Pe=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(me);if(Pe)return Pe[1];var Mt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(me);return Mt?Mt[1]:"unknown"}function Xt(){var N=new Error,me=(N.stack||N).toString(),Pe=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(me);if(Pe)return Pe[1];var Mt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(me);return Mt?Mt[1]:"unknown"}function vt(N,me){var Pe=N.split(`
`),Mt=1,sr=0,Rt={unknown:new st,0:new st};Rt.unknown.name=Rt[0].name=me||X(),Rt.unknown.lines.push(new ut(0,""));for(var er=0;er<Pe.length;++er){var pr=Pe[er],br=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(pr);if(br)switch(br[1]){case"line":var wr=/(\d+)(\s+\d+)?/.exec(br[2]);wr&&(Mt=wr[1]|0,wr[2]&&(sr=wr[2]|0,sr in Rt||(Rt[sr]=new st)));break;case"define":var Mr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(br[2]);Mr&&(Rt[sr].name=Mr[1]?F(Mr[2]):Mr[2]);break}Rt[sr].lines.push(new ut(Mt++,pr))}return Object.keys(Rt).forEach(function(Rr){var Hr=Rt[Rr];Hr.lines.forEach(function(vr){Hr.index[vr.number]=vr})}),Rt}function qe(N){var me=[];return N.split(`
`).forEach(function(Pe){if(!(Pe.length<5)){var Mt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Pe);Mt?me.push(new Jt(Mt[1]|0,Mt[2]|0,Mt[3].trim())):Pe.length>0&&me.push(new Jt("unknown",0,Pe))}}),me}function pt(N,me){me.forEach(function(Pe){var Mt=N[Pe.file];if(Mt){var sr=Mt.index[Pe.line];if(sr){sr.errors.push(Pe),Mt.hasErrors=!0;return}}N.unknown.hasErrors=!0,N.unknown.lines[0].errors.push(Pe)})}function $e(N,me,Pe,Mt,sr){if(!N.getShaderParameter(me,N.COMPILE_STATUS)){var Rt=N.getShaderInfoLog(me),er=Mt===N.FRAGMENT_SHADER?"fragment":"vertex";Fe(Pe,"string",er+" shader source must be a string",sr);var pr=vt(Pe,sr),br=qe(Rt);pt(pr,br),Object.keys(pr).forEach(function(wr){var Mr=pr[wr];if(!Mr.hasErrors)return;var Rr=[""],Hr=[""];function vr(Ar,at){Rr.push(Ar),Hr.push(at||"")}vr("file number "+wr+": "+Mr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Mr.lines.forEach(function(Ar){if(Ar.errors.length>0){vr(wt(Ar.number,4)+"|  ","background-color:yellow; font-weight:bold"),vr(Ar.line+ee,"color:red; background-color:yellow; font-weight:bold");var at=0;Ar.errors.forEach(function(Gt){var Sr=Gt.message,Ur=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Sr);if(Ur){var fr=Ur[1];switch(Sr=Ur[2],fr){case"assign":fr="=";break}at=Math.max(Ar.line.indexOf(fr,at),0)}else at=0;vr(wt("| ",6)),vr(wt("^^^",at+3)+ee,"font-weight:bold"),vr(wt("| ",6)),vr(Sr+ee,"font-weight:bold")}),vr(wt("| ",6)+ee)}else vr(wt(Ar.number,4)+"|  "),vr(Ar.line+ee,"color:red")}),typeof document!="undefined"&&!window.chrome?(Hr[0]=Rr.join("%c"),console.log.apply(console,Hr)):console.log(Rr.join(""))}),re.raise("Error compiling "+er+" shader, "+pr[0].name)}}function kt(N,me,Pe,Mt,sr){if(!N.getProgramParameter(me,N.LINK_STATUS)){var Rt=N.getProgramInfoLog(me),er=vt(Pe,sr),pr=vt(Mt,sr),br='Error linking program with vertex shader, "'+pr[0].name+'", and fragment shader "'+er[0].name+'"';typeof document!="undefined"?console.log("%c"+br+ee+"%c"+Rt,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(br+ee+Rt),re.raise(br)}}function xr(N){N._commandRef=X()}function Ir(N,me,Pe,Mt){xr(N);function sr(br){return br?Mt.id(br):0}N._fragId=sr(N.static.frag),N._vertId=sr(N.static.vert);function Rt(br,wr){Object.keys(wr).forEach(function(Mr){br[Mt.id(Mr)]=!0})}var er=N._uniformSet={};Rt(er,me.static),Rt(er,me.dynamic);var pr=N._attributeSet={};Rt(pr,Pe.static),Rt(pr,Pe.dynamic),N._hasCount="count"in N.static||"count"in N.dynamic||"elements"in N.static||"elements"in N.dynamic}function Wr(N,me){var Pe=Xt();Q(N+" in command "+(me||X())+(Pe==="unknown"?"":" called from "+Pe))}function Me(N,me,Pe){N||Wr(me,Pe||X())}function Ye(N,me,Pe,Mt){N in me||Wr("unknown parameter ("+N+")"+Ee(Pe)+". possible values: "+Object.keys(me).join(),Mt||X())}function Fe(N,me,Pe,Mt){Ce(N,me)||Wr("invalid parameter type"+Ee(Pe)+". expected "+me+", got "+typeof N,Mt||X())}function At(N){N()}function gt(N,me,Pe){N.texture?nr(N.texture._texture.internalformat,me,"unsupported texture format for attachment"):nr(N.renderbuffer._renderbuffer.format,Pe,"unsupported renderbuffer format for attachment")}var Nt=33071,qt=9728,Cr=9984,Wn=9985,hn=9986,Yi=9987,Un=5120,Gn=5121,di=5122,Xn=5123,ai=5124,aa=5125,Ri=5126,Ei=32819,ji=32820,ua=33635,Si=34042,ba=36193,Mn={};Mn[Un]=Mn[Gn]=1,Mn[di]=Mn[Xn]=Mn[ba]=Mn[ua]=Mn[Ei]=Mn[ji]=2,Mn[ai]=Mn[aa]=Mn[Ri]=Mn[Si]=4;function _i(N,me){return N===ji||N===Ei||N===ua?2:N===Si?4:Mn[N]*me}function Ui(N){return!(N&N-1)&&!!N}function qi(N,me,Pe){var Mt,sr=me.width,Rt=me.height,er=me.channels;re(sr>0&&sr<=Pe.maxTextureSize&&Rt>0&&Rt<=Pe.maxTextureSize,"invalid texture shape"),(N.wrapS!==Nt||N.wrapT!==Nt)&&re(Ui(sr)&&Ui(Rt),"incompatible wrap mode for texture, both width and height must be power of 2"),me.mipmask===1?sr!==1&&Rt!==1&&re(N.minFilter!==Cr&&N.minFilter!==hn&&N.minFilter!==Wn&&N.minFilter!==Yi,"min filter requires mipmap"):(re(Ui(sr)&&Ui(Rt),"texture must be a square power of 2 to support mipmapping"),re(me.mipmask===(sr<<1)-1,"missing or incomplete mipmap data")),me.type===Ri&&(Pe.extensions.indexOf("oes_texture_float_linear")<0&&re(N.minFilter===qt&&N.magFilter===qt,"filter not supported, must enable oes_texture_float_linear"),re(!N.genMipmaps,"mipmap generation not supported with float textures"));var pr=me.images;for(Mt=0;Mt<16;++Mt)if(pr[Mt]){var br=sr>>Mt,wr=Rt>>Mt;re(me.mipmask&1<<Mt,"missing mipmap data");var Mr=pr[Mt];if(re(Mr.width===br&&Mr.height===wr,"invalid shape for mip images"),re(Mr.format===me.format&&Mr.internalformat===me.internalformat&&Mr.type===me.type,"incompatible type for mip image"),!Mr.compressed)if(Mr.data){var Rr=Math.ceil(_i(Mr.type,er)*br/Mr.unpackAlignment)*Mr.unpackAlignment;re(Mr.data.byteLength===Rr*wr,"invalid data for image, buffer size is inconsistent with image format")}else Mr.element||Mr.copy}else N.genMipmaps||re((me.mipmask&1<<Mt)==0,"extra mipmap data");me.compressed&&re(!N.genMipmaps,"mipmap generation for compressed images not supported")}function Ga(N,me,Pe,Mt){var sr=N.width,Rt=N.height,er=N.channels;re(sr>0&&sr<=Mt.maxTextureSize&&Rt>0&&Rt<=Mt.maxTextureSize,"invalid texture shape"),re(sr===Rt,"cube map must be square"),re(me.wrapS===Nt&&me.wrapT===Nt,"wrap mode not supported by cube map");for(var pr=0;pr<Pe.length;++pr){var br=Pe[pr];re(br.width===sr&&br.height===Rt,"inconsistent cube map face shape"),me.genMipmaps&&(re(!br.compressed,"can not generate mipmap for compressed textures"),re(br.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var wr=br.images,Mr=0;Mr<16;++Mr){var Rr=wr[Mr];if(Rr){var Hr=sr>>Mr,vr=Rt>>Mr;re(br.mipmask&1<<Mr,"missing mipmap data"),re(Rr.width===Hr&&Rr.height===vr,"invalid shape for mip images"),re(Rr.format===N.format&&Rr.internalformat===N.internalformat&&Rr.type===N.type,"incompatible type for mip image"),Rr.compressed||(Rr.data?re(Rr.data.byteLength===Hr*vr*Math.max(_i(Rr.type,er),Rr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Rr.element||Rr.copy)}}}}var ve=v(re,{optional:At,raise:Q,commandRaise:Wr,command:Me,parameter:ne,commandParameter:Ye,constructor:Wt,type:et,commandType:Fe,isTypedArray:je,nni:Pt,oneOf:nr,shaderError:$e,linkError:kt,callSite:Xt,saveCommandRef:xr,saveDrawInfo:Ir,framebufferFormat:gt,guessCommand:X,texture2D:qi,textureCube:Ga}),Ln=0,Ha=0,os=5,Ut=6;function ir(N,me){this.id=Ln++,this.type=N,this.data=me}function Pr(N){return N.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function I(N){if(N.length===0)return[];var me=N.charAt(0),Pe=N.charAt(N.length-1);if(N.length>1&&me===Pe&&(me==='"'||me==="'"))return['"'+Pr(N.substr(1,N.length-2))+'"'];var Mt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(N);if(Mt)return I(N.substr(0,Mt.index)).concat(I(Mt[1])).concat(I(N.substr(Mt.index+Mt[0].length)));var sr=N.split(".");if(sr.length===1)return['"'+Pr(N)+'"'];for(var Rt=[],er=0;er<sr.length;++er)Rt=Rt.concat(I(sr[er]));return Rt}function or(N){return"["+I(N).join("][")+"]"}function Rn(N,me){return new ir(N,or(me+""))}function oi(N){return typeof N=="function"&&!N._reglType||N instanceof ir}function jn(N,me){if(typeof N=="function")return new ir(Ha,N);if(typeof N=="number"||typeof N=="boolean")return new ir(os,N);if(Array.isArray(N))return new ir(Ut,N.map(function(Pe,Mt){return jn(Pe,me+"["+Mt+"]")}));if(N instanceof ir)return N;ve(!1,"invalid option type in uniform "+me)}var nn={DynamicVariable:ir,define:Rn,isDynamic:oi,unbox:jn,accessor:or},Ti={next:typeof requestAnimationFrame=="function"?function(N){return requestAnimationFrame(N)}:function(N){return setTimeout(N,16)},cancel:typeof cancelAnimationFrame=="function"?function(N){return cancelAnimationFrame(N)}:clearTimeout},Mi=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",$a=Mi?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ss(){var N={"":0},me=[""];return{id:function(Pe){var Mt=N[Pe];return Mt||(Mt=N[Pe]=me.length,me.push(Pe),Mt)},str:function(Pe){return me[Pe]}}}function ma(N,me,Pe){var Mt=document.createElement("canvas");v(Mt.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),N.appendChild(Mt),N===document.body&&(Mt.style.position="absolute",v(N.style,{margin:0,padding:0}));function sr(){var pr=window.innerWidth,br=window.innerHeight;if(N!==document.body){var wr=Mt.getBoundingClientRect();pr=wr.right-wr.left,br=wr.bottom-wr.top}Mt.width=Pe*pr,Mt.height=Pe*br}var Rt;N!==document.body&&typeof ResizeObserver=="function"?(Rt=new ResizeObserver(function(){setTimeout(sr)}),Rt.observe(N)):window.addEventListener("resize",sr,!1);function er(){Rt?Rt.disconnect():window.removeEventListener("resize",sr),N.removeChild(Mt)}return sr(),{canvas:Mt,onDestroy:er}}function Ra(N,me){function Pe(Mt){try{return N.getContext(Mt,me)}catch(sr){return null}}return Pe("webgl")||Pe("experimental-webgl")||Pe("webgl-experimental")}function Ca(N){return typeof N.nodeName=="string"&&typeof N.appendChild=="function"&&typeof N.getBoundingClientRect=="function"}function G(N){return typeof N.drawArrays=="function"||typeof N.drawElements=="function"}function K(N){return typeof N=="string"?N.split():(ve(Array.isArray(N),"invalid extension array"),N)}function se(N){return typeof N=="string"?(ve(typeof document!="undefined","not supported outside of DOM"),document.querySelector(N)):N}function ge(N){var me=N||{},Pe,Mt,sr,Rt,er={},pr=[],br=[],wr=typeof window=="undefined"?1:window.devicePixelRatio,Mr=!1,Rr=function(Ar){Ar&&ve.raise(Ar)},Hr=function(){};if(typeof me=="string"?(ve(typeof document!="undefined","selector queries only supported in DOM environments"),Pe=document.querySelector(me),ve(Pe,"invalid query string for element")):typeof me=="object"?Ca(me)?Pe=me:G(me)?(Rt=me,sr=Rt.canvas):(ve.constructor(me),"gl"in me?Rt=me.gl:"canvas"in me?sr=se(me.canvas):"container"in me&&(Mt=se(me.container)),"attributes"in me&&(er=me.attributes,ve.type(er,"object","invalid context attributes")),"extensions"in me&&(pr=K(me.extensions)),"optionalExtensions"in me&&(br=K(me.optionalExtensions)),"onDone"in me&&(ve.type(me.onDone,"function","invalid or missing onDone callback"),Rr=me.onDone),"profile"in me&&(Mr=!!me.profile),"pixelRatio"in me&&(wr=+me.pixelRatio,ve(wr>0,"invalid pixel ratio"))):ve.raise("invalid arguments to regl"),Pe&&(Pe.nodeName.toLowerCase()==="canvas"?sr=Pe:Mt=Pe),!Rt){if(!sr){ve(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var vr=ma(Mt||document.body,Rr,wr);if(!vr)return null;sr=vr.canvas,Hr=vr.onDestroy}er.premultipliedAlpha===void 0&&(er.premultipliedAlpha=!0),Rt=Ra(sr,er)}return Rt?{gl:Rt,canvas:sr,container:Mt,extensions:pr,optionalExtensions:br,pixelRatio:wr,profile:Mr,onDone:Rr,onDestroy:Hr}:(Hr(),Rr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Le(N,me){var Pe={};function Mt(pr){ve.type(pr,"string","extension name must be string");var br=pr.toLowerCase(),wr;try{wr=Pe[br]=sr(pr)}catch(Mr){}return!!wr}function sr(pr){return N.getExtension(pr)?N.getExtension(pr):N.getExtension(pr.toLowerCase())?N.getExtension(pr.toLowerCase()):null}for(var Rt=0;Rt<me.extensions.length;++Rt){var er=me.extensions[Rt];if(!Mt(er))return me.onDestroy(),me.onDone('"'+er+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return me.optionalExtensions.forEach(Mt),{extensions:Pe,restore:function(){Object.keys(Pe).forEach(function(pr){if(Pe[pr]&&!Mt(pr))throw new Error("(regl): error restoring extension "+pr)})}}}function Ge(N,me){for(var Pe=Array(N),Mt=0;Mt<N;++Mt)Pe[Mt]=me(Mt);return Pe}var rt=5120,pe=5121,Be=5122,yt=5123,dr=5124,Dt=5125,Ft=5126;function _r(N){for(var me=16;me<=1<<28;me*=16)if(N<=me)return me;return 0}function En(N){var me,Pe;return me=(N>65535)<<4,N>>>=me,Pe=(N>255)<<3,N>>>=Pe,me|=Pe,Pe=(N>15)<<2,N>>>=Pe,me|=Pe,Pe=(N>3)<<1,N>>>=Pe,me|=Pe,me|N>>1}function un(){var N=Ge(8,function(){return[]});function me(Rt){var er=_r(Rt),pr=N[En(er)>>2];return pr.length>0?pr.pop():new ArrayBuffer(er)}function Pe(Rt){N[En(Rt.byteLength)>>2].push(Rt)}function Mt(Rt,er){var pr=null;switch(Rt){case rt:pr=new Int8Array(me(er),0,er);break;case pe:pr=new Uint8Array(me(er),0,er);break;case Be:pr=new Int16Array(me(2*er),0,er);break;case yt:pr=new Uint16Array(me(2*er),0,er);break;case dr:pr=new Int32Array(me(4*er),0,er);break;case Dt:pr=new Uint32Array(me(4*er),0,er);break;case Ft:pr=new Float32Array(me(4*er),0,er);break;default:return null}return pr.length!==er?pr.subarray(0,er):pr}function sr(Rt){Pe(Rt.buffer)}return{alloc:me,free:Pe,allocType:Mt,freeType:sr}}var Tt=un();Tt.zero=un();var on=3408,Gr=3410,qr=3411,ni=3412,tn=3413,Ci=3414,Ji=3415,yi=33901,Pi=33902,xi=3379,ei=3386,Wi=34921,La=36347,oa=36348,Ii=35661,Vi=35660,Na=34930,tu=36349,wa=34076,Aa=34024,ms=7936,us=7937,ta=7938,Bu=35724,mo=34047,za=36063,ro=34852,Ki=3553,Ho=34067,Wo=34069,Nu=33984,Co=6408,Xo=5126,ga=5121,go=36160,Yo=36053,no=36064,ru=16384,_c=function(N,me){var Pe=1;me.ext_texture_filter_anisotropic&&(Pe=N.getParameter(mo));var Mt=1,sr=1;me.webgl_draw_buffers&&(Mt=N.getParameter(ro),sr=N.getParameter(za));var Rt=!!me.oes_texture_float;if(Rt){var er=N.createTexture();N.bindTexture(Ki,er),N.texImage2D(Ki,0,Co,1,1,0,Co,Xo,null);var pr=N.createFramebuffer();if(N.bindFramebuffer(go,pr),N.framebufferTexture2D(go,no,Ki,er,0),N.bindTexture(Ki,null),N.checkFramebufferStatus(go)!==Yo)Rt=!1;else{N.viewport(0,0,1,1),N.clearColor(1,0,0,1),N.clear(ru);var br=Tt.allocType(Xo,4);N.readPixels(0,0,1,1,Co,Xo,br),N.getError()?Rt=!1:(N.deleteFramebuffer(pr),N.deleteTexture(er),Rt=br[0]===1),Tt.freeType(br)}}var wr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Mr=!0;if(!wr){var Rr=N.createTexture(),Hr=Tt.allocType(ga,36);N.activeTexture(Nu),N.bindTexture(Ho,Rr),N.texImage2D(Wo,0,Co,3,3,0,Co,ga,Hr),Tt.freeType(Hr),N.bindTexture(Ho,null),N.deleteTexture(Rr),Mr=!N.getError()}return{colorBits:[N.getParameter(Gr),N.getParameter(qr),N.getParameter(ni),N.getParameter(tn)],depthBits:N.getParameter(Ci),stencilBits:N.getParameter(Ji),subpixelBits:N.getParameter(on),extensions:Object.keys(me).filter(function(vr){return!!me[vr]}),maxAnisotropic:Pe,maxDrawbuffers:Mt,maxColorAttachments:sr,pointSizeDims:N.getParameter(yi),lineWidthDims:N.getParameter(Pi),maxViewportDims:N.getParameter(ei),maxCombinedTextureUnits:N.getParameter(Ii),maxCubeMapSize:N.getParameter(wa),maxRenderbufferSize:N.getParameter(Aa),maxTextureUnits:N.getParameter(Na),maxTextureSize:N.getParameter(xi),maxAttributes:N.getParameter(Wi),maxVertexUniforms:N.getParameter(La),maxVertexTextureUnits:N.getParameter(Vi),maxVaryingVectors:N.getParameter(oa),maxFragmentUniforms:N.getParameter(tu),glsl:N.getParameter(Bu),renderer:N.getParameter(us),vendor:N.getParameter(ms),version:N.getParameter(ta),readFloat:Rt,npotTextureCube:Mr}};function Os(N){return!!N&&typeof N=="object"&&Array.isArray(N.shape)&&Array.isArray(N.stride)&&typeof N.offset=="number"&&N.shape.length===N.stride.length&&(Array.isArray(N.data)||$(N.data))}var ie=function(N){return Object.keys(N).map(function(me){return N[me]})},be={shape:io,flatten:Lt};function Qe(N,me,Pe){for(var Mt=0;Mt<me;++Mt)Pe[Mt]=N[Mt]}function Ot(N,me,Pe,Mt){for(var sr=0,Rt=0;Rt<me;++Rt)for(var er=N[Rt],pr=0;pr<Pe;++pr)Mt[sr++]=er[pr]}function Dr(N,me,Pe,Mt,sr,Rt){for(var er=Rt,pr=0;pr<me;++pr)for(var br=N[pr],wr=0;wr<Pe;++wr)for(var Mr=br[wr],Rr=0;Rr<Mt;++Rr)sr[er++]=Mr[Rr]}function lt(N,me,Pe,Mt,sr){for(var Rt=1,er=Pe+1;er<me.length;++er)Rt*=me[er];var pr=me[Pe];if(me.length-Pe==4){var br=me[Pe+1],wr=me[Pe+2],Mr=me[Pe+3];for(er=0;er<pr;++er)Dr(N[er],br,wr,Mr,Mt,sr),sr+=Rt}else for(er=0;er<pr;++er)lt(N[er],me,Pe+1,Mt,sr),sr+=Rt}function Lt(N,me,Pe,Mt){var sr=1;if(me.length)for(var Rt=0;Rt<me.length;++Rt)sr*=me[Rt];else sr=0;var er=Mt||Tt.allocType(Pe,sr);switch(me.length){case 0:break;case 1:Qe(N,me[0],er);break;case 2:Ot(N,me[0],me[1],er);break;case 3:Dr(N,me[0],me[1],me[2],er,0);break;default:lt(N,me,0,er,0)}return er}function io(N){for(var me=[],Pe=N;Pe.length;Pe=Pe[0])me.push(Pe.length);return me}var $i={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Wa=5120,qo=5122,xn=5124,dn=5121,Kt=5123,Bo=5125,xe=5126,Vs=5126,nu={int8:Wa,int16:qo,int32:xn,uint8:dn,uint16:Kt,uint32:Bo,float:xe,float32:Vs},ls=35048,sa=35040,yo={dynamic:ls,stream:sa,static:35044},Wl=be.flatten,xc=be.shape,zu=35044,bc=35040,El=5121,Uu=5126,iu=[];iu[5120]=1,iu[5122]=2,iu[5124]=4,iu[5121]=1,iu[5123]=2,iu[5125]=4,iu[5126]=4;function Zu(N){return $i[Object.prototype.toString.call(N)]|0}function g(N,me){for(var Pe=0;Pe<me.length;++Pe)N[Pe]=me[Pe]}function w(N,me,Pe,Mt,sr,Rt,er){for(var pr=0,br=0;br<Pe;++br)for(var wr=0;wr<Mt;++wr)N[pr++]=me[sr*br+Rt*wr+er]}function B(N,me,Pe,Mt){var sr=0,Rt={};function er(at){this.id=sr++,this.buffer=N.createBuffer(),this.type=at,this.usage=zu,this.byteLength=0,this.dimension=1,this.dtype=El,this.persistentData=null,Pe.profile&&(this.stats={size:0})}er.prototype.bind=function(){N.bindBuffer(this.type,this.buffer)},er.prototype.destroy=function(){Hr(this)};var pr=[];function br(at,Gt){var Sr=pr.pop();return Sr||(Sr=new er(at)),Sr.bind(),Rr(Sr,Gt,bc,0,1,!1),Sr}function wr(at){pr.push(at)}function Mr(at,Gt,Sr){at.byteLength=Gt.byteLength,N.bufferData(at.type,Gt,Sr)}function Rr(at,Gt,Sr,Ur,fr,kr){var en;if(at.usage=Sr,Array.isArray(Gt)){if(at.dtype=Ur||Uu,Gt.length>0){var Fn;if(Array.isArray(Gt[0])){en=xc(Gt);for(var tr=1,ar=1;ar<en.length;++ar)tr*=en[ar];at.dimension=tr,Fn=Wl(Gt,en,at.dtype),Mr(at,Fn,Sr),kr?at.persistentData=Fn:Tt.freeType(Fn)}else if(typeof Gt[0]=="number"){at.dimension=fr;var Sn=Tt.allocType(at.dtype,Gt.length);g(Sn,Gt),Mr(at,Sn,Sr),kr?at.persistentData=Sn:Tt.freeType(Sn)}else $(Gt[0])?(at.dimension=Gt[0].length,at.dtype=Ur||Zu(Gt[0])||Uu,Fn=Wl(Gt,[Gt.length,Gt[0].length],at.dtype),Mr(at,Fn,Sr),kr?at.persistentData=Fn:Tt.freeType(Fn)):ve.raise("invalid buffer data")}}else if($(Gt))at.dtype=Ur||Zu(Gt),at.dimension=fr,Mr(at,Gt,Sr),kr&&(at.persistentData=new Uint8Array(new Uint8Array(Gt.buffer)));else if(Os(Gt)){en=Gt.shape;var Xr=Gt.stride,Tr=Gt.offset,Jr=0,Qr=0,mi=0,ri=0;en.length===1?(Jr=en[0],Qr=1,mi=Xr[0],ri=0):en.length===2?(Jr=en[0],Qr=en[1],mi=Xr[0],ri=Xr[1]):ve.raise("invalid shape"),at.dtype=Ur||Zu(Gt.data)||Uu,at.dimension=Qr;var Kr=Tt.allocType(at.dtype,Jr*Qr);w(Kr,Gt.data,Jr,Qr,mi,ri,Tr),Mr(at,Kr,Sr),kr?at.persistentData=Kr:Tt.freeType(Kr)}else Gt instanceof ArrayBuffer?(at.dtype=El,at.dimension=fr,Mr(at,Gt,Sr),kr&&(at.persistentData=new Uint8Array(new Uint8Array(Gt)))):ve.raise("invalid buffer data")}function Hr(at){me.bufferCount--,Mt(at);var Gt=at.buffer;ve(Gt,"buffer must not be deleted already"),N.deleteBuffer(Gt),at.buffer=null,delete Rt[at.id]}function vr(at,Gt,Sr,Ur){me.bufferCount++;var fr=new er(Gt);Rt[fr.id]=fr;function kr(tr){var ar=zu,Sn=null,Xr=0,Tr=0,Jr=1;return Array.isArray(tr)||$(tr)||Os(tr)||tr instanceof ArrayBuffer?Sn=tr:typeof tr=="number"?Xr=tr|0:tr&&(ve.type(tr,"object","buffer arguments must be an object, a number or an array"),"data"in tr&&(ve(Sn===null||Array.isArray(Sn)||$(Sn)||Os(Sn),"invalid data for buffer"),Sn=tr.data),"usage"in tr&&(ve.parameter(tr.usage,yo,"invalid buffer usage"),ar=yo[tr.usage]),"type"in tr&&(ve.parameter(tr.type,nu,"invalid buffer type"),Tr=nu[tr.type]),"dimension"in tr&&(ve.type(tr.dimension,"number","invalid dimension"),Jr=tr.dimension|0),"length"in tr&&(ve.nni(Xr,"buffer length must be a nonnegative integer"),Xr=tr.length|0)),fr.bind(),Sn?Rr(fr,Sn,ar,Tr,Jr,Ur):(Xr&&N.bufferData(fr.type,Xr,ar),fr.dtype=Tr||El,fr.usage=ar,fr.dimension=Jr,fr.byteLength=Xr),Pe.profile&&(fr.stats.size=fr.byteLength*iu[fr.dtype]),kr}function en(tr,ar){ve(ar+tr.byteLength<=fr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+tr.byteLength+" starting from offset "+ar+" to a buffer of size "+fr.byteLength),N.bufferSubData(fr.type,ar,tr)}function Fn(tr,ar){var Sn=(ar||0)|0,Xr;if(fr.bind(),$(tr)||tr instanceof ArrayBuffer)en(tr,Sn);else if(Array.isArray(tr)){if(tr.length>0)if(typeof tr[0]=="number"){var Tr=Tt.allocType(fr.dtype,tr.length);g(Tr,tr),en(Tr,Sn),Tt.freeType(Tr)}else if(Array.isArray(tr[0])||$(tr[0])){Xr=xc(tr);var Jr=Wl(tr,Xr,fr.dtype);en(Jr,Sn),Tt.freeType(Jr)}else ve.raise("invalid buffer data")}else if(Os(tr)){Xr=tr.shape;var Qr=tr.stride,mi=0,ri=0,Kr=0,an=0;Xr.length===1?(mi=Xr[0],ri=1,Kr=Qr[0],an=0):Xr.length===2?(mi=Xr[0],ri=Xr[1],Kr=Qr[0],an=Qr[1]):ve.raise("invalid shape");var Kn=Array.isArray(tr.data)?fr.dtype:Zu(tr.data),ui=Tt.allocType(Kn,mi*ri);w(ui,tr.data,mi,ri,Kr,an,tr.offset),en(ui,Sn),Tt.freeType(ui)}else ve.raise("invalid data for buffer subdata");return kr}return Sr||kr(at),kr._reglType="buffer",kr._buffer=fr,kr.subdata=Fn,Pe.profile&&(kr.stats=fr.stats),kr.destroy=function(){Hr(fr)},kr}function Ar(){ie(Rt).forEach(function(at){at.buffer=N.createBuffer(),N.bindBuffer(at.type,at.buffer),N.bufferData(at.type,at.persistentData||at.byteLength,at.usage)})}return Pe.profile&&(me.getTotalBufferSize=function(){var at=0;return Object.keys(Rt).forEach(function(Gt){at+=Rt[Gt].stats.size}),at}),{create:vr,createStream:br,destroyStream:wr,clear:function(){ie(Rt).forEach(Hr),pr.forEach(Hr)},getBuffer:function(at){return at&&at._buffer instanceof er?at._buffer:null},restore:Ar,_initBuffer:Rr}}var O=0,q=0,_e=1,Xe=1,ct=4,mt=4,lr={points:O,point:q,lines:_e,line:Xe,triangles:ct,triangle:mt,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Er=0,In=1,si=4,Jn=5120,Xi=5121,fa=5122,Ia=5123,Gi=5124,Lo=5125,gs=34963,il=35040,Xc=35044;function ju(N,me,Pe,Mt){var sr={},Rt=0,er={uint8:Xi,uint16:Ia};me.oes_element_index_uint&&(er.uint32=Lo);function pr(Ar){this.id=Rt++,sr[this.id]=this,this.buffer=Ar,this.primType=si,this.vertCount=0,this.type=0}pr.prototype.bind=function(){this.buffer.bind()};var br=[];function wr(Ar){var at=br.pop();return at||(at=new pr(Pe.create(null,gs,!0,!1)._buffer)),Rr(at,Ar,il,-1,-1,0,0),at}function Mr(Ar){br.push(Ar)}function Rr(Ar,at,Gt,Sr,Ur,fr,kr){Ar.buffer.bind();var en;if(at){var Fn=kr;!kr&&(!$(at)||Os(at)&&!$(at.data))&&(Fn=me.oes_element_index_uint?Lo:Ia),Pe._initBuffer(Ar.buffer,at,Gt,Fn,3)}else N.bufferData(gs,fr,Gt),Ar.buffer.dtype=en||Xi,Ar.buffer.usage=Gt,Ar.buffer.dimension=3,Ar.buffer.byteLength=fr;if(en=kr,!kr){switch(Ar.buffer.dtype){case Xi:case Jn:en=Xi;break;case Ia:case fa:en=Ia;break;case Lo:case Gi:en=Lo;break;default:ve.raise("unsupported type for element array")}Ar.buffer.dtype=en}Ar.type=en,ve(en!==Lo||!!me.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var tr=Ur;tr<0&&(tr=Ar.buffer.byteLength,en===Ia?tr>>=1:en===Lo&&(tr>>=2)),Ar.vertCount=tr;var ar=Sr;if(Sr<0){ar=si;var Sn=Ar.buffer.dimension;Sn===1&&(ar=Er),Sn===2&&(ar=In),Sn===3&&(ar=si)}Ar.primType=ar}function Hr(Ar){Mt.elementsCount--,ve(Ar.buffer!==null,"must not double destroy elements"),delete sr[Ar.id],Ar.buffer.destroy(),Ar.buffer=null}function vr(Ar,at){var Gt=Pe.create(null,gs,!0),Sr=new pr(Gt._buffer);Mt.elementsCount++;function Ur(fr){if(!fr)Gt(),Sr.primType=si,Sr.vertCount=0,Sr.type=Xi;else if(typeof fr=="number")Gt(fr),Sr.primType=si,Sr.vertCount=fr|0,Sr.type=Xi;else{var kr=null,en=Xc,Fn=-1,tr=-1,ar=0,Sn=0;Array.isArray(fr)||$(fr)||Os(fr)?kr=fr:(ve.type(fr,"object","invalid arguments for elements"),"data"in fr&&(kr=fr.data,ve(Array.isArray(kr)||$(kr)||Os(kr),"invalid data for element buffer")),"usage"in fr&&(ve.parameter(fr.usage,yo,"invalid element buffer usage"),en=yo[fr.usage]),"primitive"in fr&&(ve.parameter(fr.primitive,lr,"invalid element buffer primitive"),Fn=lr[fr.primitive]),"count"in fr&&(ve(typeof fr.count=="number"&&fr.count>=0,"invalid vertex count for elements"),tr=fr.count|0),"type"in fr&&(ve.parameter(fr.type,er,"invalid buffer type"),Sn=er[fr.type]),"length"in fr?ar=fr.length|0:(ar=tr,Sn===Ia||Sn===fa?ar*=2:(Sn===Lo||Sn===Gi)&&(ar*=4))),Rr(Sr,kr,en,Fn,tr,ar,Sn)}return Ur}return Ur(Ar),Ur._reglType="elements",Ur._elements=Sr,Ur.subdata=function(fr,kr){return Gt.subdata(fr,kr),Ur},Ur.destroy=function(){Hr(Sr)},Ur}return{create:vr,createStream:wr,destroyStream:Mr,getElements:function(Ar){return typeof Ar=="function"&&Ar._elements instanceof pr?Ar._elements:null},clear:function(){ie(sr).forEach(Hr)}}}var Ec=new Float32Array(1),Eu=new Uint32Array(Ec.buffer),hu=5123;function wo(N){for(var me=Tt.allocType(hu,N.length),Pe=0;Pe<N.length;++Pe)if(isNaN(N[Pe]))me[Pe]=65535;else if(N[Pe]===Infinity)me[Pe]=31744;else if(N[Pe]===-Infinity)me[Pe]=64512;else{Ec[0]=N[Pe];var Mt=Eu[0],sr=Mt>>>31<<15,Rt=(Mt<<1>>>24)-127,er=Mt>>13&(1<<10)-1;if(Rt<-24)me[Pe]=sr;else if(Rt<-14){var pr=-14-Rt;me[Pe]=sr+(er+(1<<10)>>pr)}else Rt>15?me[Pe]=sr+31744:me[Pe]=sr+(Rt+15<<10)+er}return me}function ha(N){return Array.isArray(N)||$(N)}var oh=function(N){return!(N&N-1)&&!!N},sh=34467,fo=3553,wf=34067,pu=34069,Rs=6408,Sc=6406,al=6407,Ea=6409,Sl=6410,Xl=32854,ts=32855,Af=36194,uh=32819,lh=32820,Yc=33635,ol=34042,No=6402,Su=34041,Vu=35904,zo=35906,Cl=36193,Gu=33776,Gs=33777,qc=33778,Kc=33779,$c=35986,Hu=35987,Yl=34798,Cc=35840,Jc=35841,wc=35842,ch=35843,Ac=36196,sl=5121,Qc=5123,ef=5125,Cu=5126,tf=10242,Tf=10243,fh=10497,wl=33071,$h=33648,rs=10240,Xa=10241,ql=9728,Al=9729,au=9984,Di=9985,ka=9986,Ls=9987,rf=33170,ul=4352,nf=4353,Jh=4354,Qh=34046,Tc=3317,Kl=37440,Wu=37441,ko=37443,$l=37444,Jl=33984,Ja=[au,ka,Di,Ls],yn=[0,Ea,Sl,al,Rs],ao={};ao[Ea]=ao[Sc]=ao[No]=1,ao[Su]=ao[Sl]=2,ao[al]=ao[Vu]=3,ao[Rs]=ao[zo]=4;function Xu(N){return"[object "+N+"]"}var Yu=Xu("HTMLCanvasElement"),du=Xu("OffscreenCanvas"),ks=Xu("CanvasRenderingContext2D"),Mf=Xu("ImageBitmap"),$r=Xu("HTMLImageElement"),af=Xu("HTMLVideoElement"),Pf=Object.keys($i).concat([Yu,du,ks,Mf,$r,af]),wu=[];wu[sl]=1,wu[Cu]=4,wu[Cl]=2,wu[Qc]=2,wu[ef]=4;var ja=[];ja[Xl]=2,ja[ts]=2,ja[Af]=2,ja[Su]=4,ja[Gu]=.5,ja[Gs]=.5,ja[qc]=1,ja[Kc]=1,ja[$c]=.5,ja[Hu]=1,ja[Yl]=1,ja[Cc]=.5,ja[Jc]=.25,ja[wc]=.5,ja[ch]=.25,ja[Ac]=.5;function Ds(N){return Array.isArray(N)&&(N.length===0||typeof N[0]=="number")}function of(N){if(!Array.isArray(N))return!1;var me=N.length;return!(me===0||!ha(N[0]))}function Au(N){return Object.prototype.toString.call(N)}function ws(N){return Au(N)===Yu}function Ao(N){return Au(N)===du}function hh(N){return Au(N)===ks}function ya(N){return Au(N)===Mf}function If(N){return Au(N)===$r}function ph(N){return Au(N)===af}function Hs(N){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(me&&N&&N.getContext)}function As(N){var me=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(me&&N&&"src"in N&&"crossOrigin"in N)}function Oi(N){if(!N)return!1;if(Hs(N)||As(N))return!0;var me=Au(N);return Pf.indexOf(me)>=0?!0:Ds(N)||of(N)||Os(N)}function vu(N){return $i[Object.prototype.toString.call(N)]|0}function pa(N,me){var Pe=me.length;switch(N.type){case sl:case Qc:case ef:case Cu:var Mt=Tt.allocType(N.type,Pe);Mt.set(me),N.data=Mt;break;case Cl:N.data=wo(me);break;default:ve.raise("unsupported texture type, must specify a typed array")}}function ho(N,me){return Tt.allocType(N.type===Cl?Cu:N.type,me)}function Fs(N,me){N.type===Cl?(N.data=wo(me),Tt.freeType(me)):N.data=me}function ou(N,me,Pe,Mt,sr,Rt){for(var er=N.width,pr=N.height,br=N.channels,wr=er*pr*br,Mr=ho(N,wr),Rr=0,Hr=0;Hr<pr;++Hr)for(var vr=0;vr<er;++vr)for(var Ar=0;Ar<br;++Ar)Mr[Rr++]=me[Pe*vr+Mt*Hr+sr*Ar+Rt];Fs(N,Mr)}function Bs(N,me,Pe,Mt,sr,Rt){var er;if(typeof ja[N]!="undefined"?er=ja[N]:er=ao[N]*wu[me],Rt&&(er*=6),sr){for(var pr=0,br=Pe;br>=1;)pr+=er*br*br,br/=2;return pr}else return er*Pe*Mt}function cs(N,me,Pe,Mt,sr,Rt,er){var pr={"don't care":ul,"dont care":ul,nice:Jh,fast:nf},br={repeat:fh,clamp:wl,mirror:$h},wr={nearest:ql,linear:Al},Mr=v({mipmap:Ls,"nearest mipmap nearest":au,"linear mipmap nearest":Di,"nearest mipmap linear":ka,"linear mipmap linear":Ls},wr),Rr={none:0,browser:$l},Hr={uint8:sl,rgba4:uh,rgb565:Yc,"rgb5 a1":lh},vr={alpha:Sc,luminance:Ea,"luminance alpha":Sl,rgb:al,rgba:Rs,rgba4:Xl,"rgb5 a1":ts,rgb565:Af},Ar={};me.ext_srgb&&(vr.srgb=Vu,vr.srgba=zo),me.oes_texture_float&&(Hr.float32=Hr.float=Cu),me.oes_texture_half_float&&(Hr.float16=Hr["half float"]=Cl),me.webgl_depth_texture&&(v(vr,{depth:No,"depth stencil":Su}),v(Hr,{uint16:Qc,uint32:ef,"depth stencil":ol})),me.webgl_compressed_texture_s3tc&&v(Ar,{"rgb s3tc dxt1":Gu,"rgba s3tc dxt1":Gs,"rgba s3tc dxt3":qc,"rgba s3tc dxt5":Kc}),me.webgl_compressed_texture_atc&&v(Ar,{"rgb atc":$c,"rgba atc explicit alpha":Hu,"rgba atc interpolated alpha":Yl}),me.webgl_compressed_texture_pvrtc&&v(Ar,{"rgb pvrtc 4bppv1":Cc,"rgb pvrtc 2bppv1":Jc,"rgba pvrtc 4bppv1":wc,"rgba pvrtc 2bppv1":ch}),me.webgl_compressed_texture_etc1&&(Ar["rgb etc1"]=Ac);var at=Array.prototype.slice.call(N.getParameter(sh)||new Uint32Array(0));Object.keys(Ar).forEach(function(Ie){var Bt=Ar[Ie];at.indexOf(Bt)>=0&&(vr[Ie]=Bt)});var Gt=Object.keys(vr);Pe.textureFormats=Gt;var Sr=[];Object.keys(vr).forEach(function(Ie){var Bt=vr[Ie];Sr[Bt]=Ie});var Ur=[];Object.keys(Hr).forEach(function(Ie){var Bt=Hr[Ie];Ur[Bt]=Ie});var fr=[];Object.keys(wr).forEach(function(Ie){var Bt=wr[Ie];fr[Bt]=Ie});var kr=[];Object.keys(Mr).forEach(function(Ie){var Bt=Mr[Ie];kr[Bt]=Ie});var en=[];Object.keys(br).forEach(function(Ie){var Bt=br[Ie];en[Bt]=Ie});var Fn=Gt.reduce(function(Ie,Bt){var Ct=vr[Bt];return Ct===Ea||Ct===Sc||Ct===Ea||Ct===Sl||Ct===No||Ct===Su||me.ext_srgb&&(Ct===Vu||Ct===zo)?Ie[Ct]=Ct:Ct===ts||Bt.indexOf("rgba")>=0?Ie[Ct]=Rs:Ie[Ct]=al,Ie},{});function tr(){this.internalformat=Rs,this.format=Rs,this.type=sl,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=$l,this.width=0,this.height=0,this.channels=0}function ar(Ie,Bt){Ie.internalformat=Bt.internalformat,Ie.format=Bt.format,Ie.type=Bt.type,Ie.compressed=Bt.compressed,Ie.premultiplyAlpha=Bt.premultiplyAlpha,Ie.flipY=Bt.flipY,Ie.unpackAlignment=Bt.unpackAlignment,Ie.colorSpace=Bt.colorSpace,Ie.width=Bt.width,Ie.height=Bt.height,Ie.channels=Bt.channels}function Sn(Ie,Bt){if(!(typeof Bt!="object"||!Bt)){if("premultiplyAlpha"in Bt&&(ve.type(Bt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ie.premultiplyAlpha=Bt.premultiplyAlpha),"flipY"in Bt&&(ve.type(Bt.flipY,"boolean","invalid texture flip"),Ie.flipY=Bt.flipY),"alignment"in Bt&&(ve.oneOf(Bt.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ie.unpackAlignment=Bt.alignment),"colorSpace"in Bt&&(ve.parameter(Bt.colorSpace,Rr,"invalid colorSpace"),Ie.colorSpace=Rr[Bt.colorSpace]),"type"in Bt){var Ct=Bt.type;ve(me.oes_texture_float||!(Ct==="float"||Ct==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),ve(me.oes_texture_half_float||!(Ct==="half float"||Ct==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ve(me.webgl_depth_texture||!(Ct==="uint16"||Ct==="uint32"||Ct==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ve.parameter(Ct,Hr,"invalid texture type"),Ie.type=Hr[Ct]}var vn=Ie.width,Ni=Ie.height,Se=Ie.channels,ce=!1;"shape"in Bt?(ve(Array.isArray(Bt.shape)&&Bt.shape.length>=2,"shape must be an array"),vn=Bt.shape[0],Ni=Bt.shape[1],Bt.shape.length===3&&(Se=Bt.shape[2],ve(Se>0&&Se<=4,"invalid number of channels"),ce=!0),ve(vn>=0&&vn<=Pe.maxTextureSize,"invalid width"),ve(Ni>=0&&Ni<=Pe.maxTextureSize,"invalid height")):("radius"in Bt&&(vn=Ni=Bt.radius,ve(vn>=0&&vn<=Pe.maxTextureSize,"invalid radius")),"width"in Bt&&(vn=Bt.width,ve(vn>=0&&vn<=Pe.maxTextureSize,"invalid width")),"height"in Bt&&(Ni=Bt.height,ve(Ni>=0&&Ni<=Pe.maxTextureSize,"invalid height")),"channels"in Bt&&(Se=Bt.channels,ve(Se>0&&Se<=4,"invalid number of channels"),ce=!0)),Ie.width=vn|0,Ie.height=Ni|0,Ie.channels=Se|0;var Ve=!1;if("format"in Bt){var dt=Bt.format;ve(me.webgl_depth_texture||!(dt==="depth"||dt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ve.parameter(dt,vr,"invalid texture format");var It=Ie.internalformat=vr[dt];Ie.format=Fn[It],dt in Hr&&("type"in Bt||(Ie.type=Hr[dt])),dt in Ar&&(Ie.compressed=!0),Ve=!0}!ce&&Ve?Ie.channels=ao[Ie.format]:ce&&!Ve?Ie.channels!==yn[Ie.format]&&(Ie.format=Ie.internalformat=yn[Ie.channels]):Ve&&ce&&ve(Ie.channels===ao[Ie.format],"number of channels inconsistent with specified format")}}function Xr(Ie){N.pixelStorei(Kl,Ie.flipY),N.pixelStorei(Wu,Ie.premultiplyAlpha),N.pixelStorei(ko,Ie.colorSpace),N.pixelStorei(Tc,Ie.unpackAlignment)}function Tr(){tr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Jr(Ie,Bt){var Ct=null;if(Oi(Bt)?Ct=Bt:Bt&&(ve.type(Bt,"object","invalid pixel data type"),Sn(Ie,Bt),"x"in Bt&&(Ie.xOffset=Bt.x|0),"y"in Bt&&(Ie.yOffset=Bt.y|0),Oi(Bt.data)&&(Ct=Bt.data)),ve(!Ie.compressed||Ct instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),Bt.copy){ve(!Ct,"can not specify copy and data field for the same texture");var vn=sr.viewportWidth,Ni=sr.viewportHeight;Ie.width=Ie.width||vn-Ie.xOffset,Ie.height=Ie.height||Ni-Ie.yOffset,Ie.needsCopy=!0,ve(Ie.xOffset>=0&&Ie.xOffset<vn&&Ie.yOffset>=0&&Ie.yOffset<Ni&&Ie.width>0&&Ie.width<=vn&&Ie.height>0&&Ie.height<=Ni,"copy texture read out of bounds")}else if(!Ct)Ie.width=Ie.width||1,Ie.height=Ie.height||1,Ie.channels=Ie.channels||4;else if($(Ct))Ie.channels=Ie.channels||4,Ie.data=Ct,!("type"in Bt)&&Ie.type===sl&&(Ie.type=vu(Ct));else if(Ds(Ct))Ie.channels=Ie.channels||4,pa(Ie,Ct),Ie.alignment=1,Ie.needsFree=!0;else if(Os(Ct)){var Se=Ct.data;!Array.isArray(Se)&&Ie.type===sl&&(Ie.type=vu(Se));var ce=Ct.shape,Ve=Ct.stride,dt,It,Je,Ne,nt,ye;ce.length===3?(Je=ce[2],ye=Ve[2]):(ve(ce.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Je=1,ye=1),dt=ce[0],It=ce[1],Ne=Ve[0],nt=Ve[1],Ie.alignment=1,Ie.width=dt,Ie.height=It,Ie.channels=Je,Ie.format=Ie.internalformat=yn[Je],Ie.needsFree=!0,ou(Ie,Se,Ne,nt,ye,Ct.offset)}else if(Hs(Ct)||ws(Ct)||Ao(Ct)||hh(Ct))Hs(Ct)||ws(Ct)||Ao(Ct)?Ie.element=Ct:Ie.element=Ct.canvas,Ie.width=Ie.element.width,Ie.height=Ie.element.height,Ie.channels=4;else if(ya(Ct))Ie.element=Ct,Ie.width=Ct.width,Ie.height=Ct.height,Ie.channels=4;else if(If(Ct))Ie.element=Ct,Ie.width=Ct.naturalWidth,Ie.height=Ct.naturalHeight,Ie.channels=4;else if(As(Ct))Ie.element=Ct,Ie.width=Ct.width,Ie.height=Ct.height,Ie.channels=4;else if(ph(Ct))Ie.element=Ct,Ie.width=Ct.videoWidth,Ie.height=Ct.videoHeight,Ie.channels=4;else if(of(Ct)){var Ze=Ie.width||Ct[0].length,we=Ie.height||Ct.length,ft=Ie.channels;ha(Ct[0][0])?ft=ft||Ct[0][0].length:ft=ft||1;for(var St=be.shape(Ct),hr=1,Zr=0;Zr<St.length;++Zr)hr*=St[Zr];var jr=ho(Ie,hr);be.flatten(Ct,St,"",jr),Fs(Ie,jr),Ie.alignment=1,Ie.width=Ze,Ie.height=we,Ie.channels=ft,Ie.format=Ie.internalformat=yn[ft],Ie.needsFree=!0}Ie.type===Cu?ve(Pe.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ie.type===Cl&&ve(Pe.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Qr(Ie,Bt,Ct){var vn=Ie.element,Ni=Ie.data,Se=Ie.internalformat,ce=Ie.format,Ve=Ie.type,dt=Ie.width,It=Ie.height;Xr(Ie),vn?N.texImage2D(Bt,Ct,ce,ce,Ve,vn):Ie.compressed?N.compressedTexImage2D(Bt,Ct,Se,dt,It,0,Ni):Ie.needsCopy?(Mt(),N.copyTexImage2D(Bt,Ct,ce,Ie.xOffset,Ie.yOffset,dt,It,0)):N.texImage2D(Bt,Ct,ce,dt,It,0,ce,Ve,Ni||null)}function mi(Ie,Bt,Ct,vn,Ni){var Se=Ie.element,ce=Ie.data,Ve=Ie.internalformat,dt=Ie.format,It=Ie.type,Je=Ie.width,Ne=Ie.height;Xr(Ie),Se?N.texSubImage2D(Bt,Ni,Ct,vn,dt,It,Se):Ie.compressed?N.compressedTexSubImage2D(Bt,Ni,Ct,vn,Ve,Je,Ne,ce):Ie.needsCopy?(Mt(),N.copyTexSubImage2D(Bt,Ni,Ct,vn,Ie.xOffset,Ie.yOffset,Je,Ne)):N.texSubImage2D(Bt,Ni,Ct,vn,Je,Ne,dt,It,ce)}var ri=[];function Kr(){return ri.pop()||new Tr}function an(Ie){Ie.needsFree&&Tt.freeType(Ie.data),Tr.call(Ie),ri.push(Ie)}function Kn(){tr.call(this),this.genMipmaps=!1,this.mipmapHint=ul,this.mipmask=0,this.images=Array(16)}function ui(Ie,Bt,Ct){var vn=Ie.images[0]=Kr();Ie.mipmask=1,vn.width=Ie.width=Bt,vn.height=Ie.height=Ct,vn.channels=Ie.channels=4}function Fi(Ie,Bt){var Ct=null;if(Oi(Bt))Ct=Ie.images[0]=Kr(),ar(Ct,Ie),Jr(Ct,Bt),Ie.mipmask=1;else if(Sn(Ie,Bt),Array.isArray(Bt.mipmap))for(var vn=Bt.mipmap,Ni=0;Ni<vn.length;++Ni)Ct=Ie.images[Ni]=Kr(),ar(Ct,Ie),Ct.width>>=Ni,Ct.height>>=Ni,Jr(Ct,vn[Ni]),Ie.mipmask|=1<<Ni;else Ct=Ie.images[0]=Kr(),ar(Ct,Ie),Jr(Ct,Bt),Ie.mipmask=1;ar(Ie,Ie.images[0]),Ie.compressed&&(Ie.internalformat===Gu||Ie.internalformat===Gs||Ie.internalformat===qc||Ie.internalformat===Kc)&&ve(Ie.width%4==0&&Ie.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function so(Ie,Bt){for(var Ct=Ie.images,vn=0;vn<Ct.length;++vn){if(!Ct[vn])return;Qr(Ct[vn],Bt,vn)}}var po=[];function ki(){var Ie=po.pop()||new Kn;tr.call(Ie),Ie.mipmask=0;for(var Bt=0;Bt<16;++Bt)Ie.images[Bt]=null;return Ie}function ns(Ie){for(var Bt=Ie.images,Ct=0;Ct<Bt.length;++Ct)Bt[Ct]&&an(Bt[Ct]),Bt[Ct]=null;po.push(Ie)}function qa(){this.minFilter=ql,this.magFilter=ql,this.wrapS=wl,this.wrapT=wl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ul}function $o(Ie,Bt){if("min"in Bt){var Ct=Bt.min;ve.parameter(Ct,Mr),Ie.minFilter=Mr[Ct],Ja.indexOf(Ie.minFilter)>=0&&!("faces"in Bt)&&(Ie.genMipmaps=!0)}if("mag"in Bt){var vn=Bt.mag;ve.parameter(vn,wr),Ie.magFilter=wr[vn]}var Ni=Ie.wrapS,Se=Ie.wrapT;if("wrap"in Bt){var ce=Bt.wrap;typeof ce=="string"?(ve.parameter(ce,br),Ni=Se=br[ce]):Array.isArray(ce)&&(ve.parameter(ce[0],br),ve.parameter(ce[1],br),Ni=br[ce[0]],Se=br[ce[1]])}else{if("wrapS"in Bt){var Ve=Bt.wrapS;ve.parameter(Ve,br),Ni=br[Ve]}if("wrapT"in Bt){var dt=Bt.wrapT;ve.parameter(dt,br),Se=br[dt]}}if(Ie.wrapS=Ni,Ie.wrapT=Se,"anisotropic"in Bt){var It=Bt.anisotropic;ve(typeof It=="number"&&It>=1&&It<=Pe.maxAnisotropic,"aniso samples must be between 1 and "),Ie.anisotropic=Bt.anisotropic}if("mipmap"in Bt){var Je=!1;switch(typeof Bt.mipmap){case"string":ve.parameter(Bt.mipmap,pr,"invalid mipmap hint"),Ie.mipmapHint=pr[Bt.mipmap],Ie.genMipmaps=!0,Je=!0;break;case"boolean":Je=Ie.genMipmaps=Bt.mipmap;break;case"object":ve(Array.isArray(Bt.mipmap),"invalid mipmap type"),Ie.genMipmaps=!1,Je=!0;break;default:ve.raise("invalid mipmap type")}Je&&!("min"in Bt)&&(Ie.minFilter=au)}}function Mo(Ie,Bt){N.texParameteri(Bt,Xa,Ie.minFilter),N.texParameteri(Bt,rs,Ie.magFilter),N.texParameteri(Bt,tf,Ie.wrapS),N.texParameteri(Bt,Tf,Ie.wrapT),me.ext_texture_filter_anisotropic&&N.texParameteri(Bt,Qh,Ie.anisotropic),Ie.genMipmaps&&(N.hint(rf,Ie.mipmapHint),N.generateMipmap(Bt))}var Jo=0,Uo={},ps=Pe.maxTextureUnits,uo=Array(ps).map(function(){return null});function gi(Ie){tr.call(this),this.mipmask=0,this.internalformat=Rs,this.id=Jo++,this.refCount=1,this.target=Ie,this.texture=N.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new qa,er.profile&&(this.stats={size:0})}function Zo(Ie){N.activeTexture(Jl),N.bindTexture(Ie.target,Ie.texture)}function ra(){var Ie=uo[0];Ie?N.bindTexture(Ie.target,Ie.texture):N.bindTexture(fo,null)}function jo(Ie){var Bt=Ie.texture;ve(Bt,"must not double destroy texture");var Ct=Ie.unit,vn=Ie.target;Ct>=0&&(N.activeTexture(Jl+Ct),N.bindTexture(vn,null),uo[Ct]=null),N.deleteTexture(Bt),Ie.texture=null,Ie.params=null,Ie.pixels=null,Ie.refCount=0,delete Uo[Ie.id],Rt.textureCount--}v(gi.prototype,{bind:function(){var Ie=this;Ie.bindCount+=1;var Bt=Ie.unit;if(Bt<0){for(var Ct=0;Ct<ps;++Ct){var vn=uo[Ct];if(vn){if(vn.bindCount>0)continue;vn.unit=-1}uo[Ct]=Ie,Bt=Ct;break}Bt>=ps&&ve.raise("insufficient number of texture units"),er.profile&&Rt.maxTextureUnits<Bt+1&&(Rt.maxTextureUnits=Bt+1),Ie.unit=Bt,N.activeTexture(Jl+Bt),N.bindTexture(Ie.target,Ie.texture)}return Bt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&jo(this)}});function ti(Ie,Bt){var Ct=new gi(fo);Uo[Ct.id]=Ct,Rt.textureCount++;function vn(ce,Ve){var dt=Ct.texInfo;qa.call(dt);var It=ki();return typeof ce=="number"?typeof Ve=="number"?ui(It,ce|0,Ve|0):ui(It,ce|0,ce|0):ce?(ve.type(ce,"object","invalid arguments to regl.texture"),$o(dt,ce),Fi(It,ce)):ui(It,1,1),dt.genMipmaps&&(It.mipmask=(It.width<<1)-1),Ct.mipmask=It.mipmask,ar(Ct,It),ve.texture2D(dt,It,Pe),Ct.internalformat=It.internalformat,vn.width=It.width,vn.height=It.height,Zo(Ct),so(It,fo),Mo(dt,fo),ra(),ns(It),er.profile&&(Ct.stats.size=Bs(Ct.internalformat,Ct.type,It.width,It.height,dt.genMipmaps,!1)),vn.format=Sr[Ct.internalformat],vn.type=Ur[Ct.type],vn.mag=fr[dt.magFilter],vn.min=kr[dt.minFilter],vn.wrapS=en[dt.wrapS],vn.wrapT=en[dt.wrapT],vn}function Ni(ce,Ve,dt,It){ve(!!ce,"must specify image data");var Je=Ve|0,Ne=dt|0,nt=It|0,ye=Kr();return ar(ye,Ct),ye.width=0,ye.height=0,Jr(ye,ce),ye.width=ye.width||(Ct.width>>nt)-Je,ye.height=ye.height||(Ct.height>>nt)-Ne,ve(Ct.type===ye.type&&Ct.format===ye.format&&Ct.internalformat===ye.internalformat,"incompatible format for texture.subimage"),ve(Je>=0&&Ne>=0&&Je+ye.width<=Ct.width&&Ne+ye.height<=Ct.height,"texture.subimage write out of bounds"),ve(Ct.mipmask&1<<nt,"missing mipmap data"),ve(ye.data||ye.element||ye.needsCopy,"missing image data"),Zo(Ct),mi(ye,fo,Je,Ne,nt),ra(),an(ye),vn}function Se(ce,Ve){var dt=ce|0,It=Ve|0||dt;if(dt===Ct.width&&It===Ct.height)return vn;vn.width=Ct.width=dt,vn.height=Ct.height=It,Zo(Ct);for(var Je=0;Ct.mipmask>>Je;++Je){var Ne=dt>>Je,nt=It>>Je;if(!Ne||!nt)break;N.texImage2D(fo,Je,Ct.format,Ne,nt,0,Ct.format,Ct.type,null)}return ra(),er.profile&&(Ct.stats.size=Bs(Ct.internalformat,Ct.type,dt,It,!1,!1)),vn}return vn(Ie,Bt),vn.subimage=Ni,vn.resize=Se,vn._reglType="texture2d",vn._texture=Ct,er.profile&&(vn.stats=Ct.stats),vn.destroy=function(){Ct.decRef()},vn}function Bi(Ie,Bt,Ct,vn,Ni,Se){var ce=new gi(wf);Uo[ce.id]=ce,Rt.cubeCount++;var Ve=new Array(6);function dt(Ne,nt,ye,Ze,we,ft){var St,hr=ce.texInfo;for(qa.call(hr),St=0;St<6;++St)Ve[St]=ki();if(typeof Ne=="number"||!Ne){var Zr=Ne|0||1;for(St=0;St<6;++St)ui(Ve[St],Zr,Zr)}else if(typeof Ne=="object")if(nt)Fi(Ve[0],Ne),Fi(Ve[1],nt),Fi(Ve[2],ye),Fi(Ve[3],Ze),Fi(Ve[4],we),Fi(Ve[5],ft);else if($o(hr,Ne),Sn(ce,Ne),"faces"in Ne){var jr=Ne.faces;for(ve(Array.isArray(jr)&&jr.length===6,"cube faces must be a length 6 array"),St=0;St<6;++St)ve(typeof jr[St]=="object"&&!!jr[St],"invalid input for cube map face"),ar(Ve[St],ce),Fi(Ve[St],jr[St])}else for(St=0;St<6;++St)Fi(Ve[St],Ne);else ve.raise("invalid arguments to cube map");for(ar(ce,Ve[0]),ve.optional(function(){Pe.npotTextureCube||ve(oh(ce.width)&&oh(ce.height),"your browser does not support non power or two texture dimensions")}),hr.genMipmaps?ce.mipmask=(Ve[0].width<<1)-1:ce.mipmask=Ve[0].mipmask,ve.textureCube(ce,hr,Ve,Pe),ce.internalformat=Ve[0].internalformat,dt.width=Ve[0].width,dt.height=Ve[0].height,Zo(ce),St=0;St<6;++St)so(Ve[St],pu+St);for(Mo(hr,wf),ra(),er.profile&&(ce.stats.size=Bs(ce.internalformat,ce.type,dt.width,dt.height,hr.genMipmaps,!0)),dt.format=Sr[ce.internalformat],dt.type=Ur[ce.type],dt.mag=fr[hr.magFilter],dt.min=kr[hr.minFilter],dt.wrapS=en[hr.wrapS],dt.wrapT=en[hr.wrapT],St=0;St<6;++St)ns(Ve[St]);return dt}function It(Ne,nt,ye,Ze,we){ve(!!nt,"must specify image data"),ve(typeof Ne=="number"&&Ne===(Ne|0)&&Ne>=0&&Ne<6,"invalid face");var ft=ye|0,St=Ze|0,hr=we|0,Zr=Kr();return ar(Zr,ce),Zr.width=0,Zr.height=0,Jr(Zr,nt),Zr.width=Zr.width||(ce.width>>hr)-ft,Zr.height=Zr.height||(ce.height>>hr)-St,ve(ce.type===Zr.type&&ce.format===Zr.format&&ce.internalformat===Zr.internalformat,"incompatible format for texture.subimage"),ve(ft>=0&&St>=0&&ft+Zr.width<=ce.width&&St+Zr.height<=ce.height,"texture.subimage write out of bounds"),ve(ce.mipmask&1<<hr,"missing mipmap data"),ve(Zr.data||Zr.element||Zr.needsCopy,"missing image data"),Zo(ce),mi(Zr,pu+Ne,ft,St,hr),ra(),an(Zr),dt}function Je(Ne){var nt=Ne|0;if(nt!==ce.width){dt.width=ce.width=nt,dt.height=ce.height=nt,Zo(ce);for(var ye=0;ye<6;++ye)for(var Ze=0;ce.mipmask>>Ze;++Ze)N.texImage2D(pu+ye,Ze,ce.format,nt>>Ze,nt>>Ze,0,ce.format,ce.type,null);return ra(),er.profile&&(ce.stats.size=Bs(ce.internalformat,ce.type,dt.width,dt.height,!1,!0)),dt}}return dt(Ie,Bt,Ct,vn,Ni,Se),dt.subimage=It,dt.resize=Je,dt._reglType="textureCube",dt._texture=ce,er.profile&&(dt.stats=ce.stats),dt.destroy=function(){ce.decRef()},dt}function la(){for(var Ie=0;Ie<ps;++Ie)N.activeTexture(Jl+Ie),N.bindTexture(fo,null),uo[Ie]=null;ie(Uo).forEach(jo),Rt.cubeCount=0,Rt.textureCount=0}er.profile&&(Rt.getTotalTextureSize=function(){var Ie=0;return Object.keys(Uo).forEach(function(Bt){Ie+=Uo[Bt].stats.size}),Ie});function Eo(){for(var Ie=0;Ie<ps;++Ie){var Bt=uo[Ie];Bt&&(Bt.bindCount=0,Bt.unit=-1,uo[Ie]=null)}ie(Uo).forEach(function(Ct){Ct.texture=N.createTexture(),N.bindTexture(Ct.target,Ct.texture);for(var vn=0;vn<32;++vn)if((Ct.mipmask&1<<vn)!=0)if(Ct.target===fo)N.texImage2D(fo,vn,Ct.internalformat,Ct.width>>vn,Ct.height>>vn,0,Ct.internalformat,Ct.type,null);else for(var Ni=0;Ni<6;++Ni)N.texImage2D(pu+Ni,vn,Ct.internalformat,Ct.width>>vn,Ct.height>>vn,0,Ct.internalformat,Ct.type,null);Mo(Ct.texInfo,Ct.target)})}function gl(){for(var Ie=0;Ie<ps;++Ie){var Bt=uo[Ie];Bt&&(Bt.bindCount=0,Bt.unit=-1,uo[Ie]=null),N.activeTexture(Jl+Ie),N.bindTexture(fo,null),N.bindTexture(wf,null)}}return{create2D:ti,createCube:Bi,clear:la,getTexture:function(Ie){return null},restore:Eo,refresh:gl}}var Ns=36161,On=32854,wn=32855,Ql=36194,fs=33189,mu=36168,Ko=34041,Sa=35907,Mc=34836,Pc=34842,da=34843,Ta=[];Ta[On]=2,Ta[wn]=2,Ta[Ql]=2,Ta[fs]=2,Ta[mu]=1,Ta[Ko]=4,Ta[Sa]=4,Ta[Mc]=16,Ta[Pc]=8,Ta[da]=6;function Ic(N,me,Pe){return Ta[N]*me*Pe}var Tl=function(N,me,Pe,Mt,sr){var Rt={rgba4:On,rgb565:Ql,"rgb5 a1":wn,depth:fs,stencil:mu,"depth stencil":Ko};me.ext_srgb&&(Rt.srgba=Sa),me.ext_color_buffer_half_float&&(Rt.rgba16f=Pc,Rt.rgb16f=da),me.webgl_color_buffer_float&&(Rt.rgba32f=Mc);var er=[];Object.keys(Rt).forEach(function(vr){var Ar=Rt[vr];er[Ar]=vr});var pr=0,br={};function wr(vr){this.id=pr++,this.refCount=1,this.renderbuffer=vr,this.format=On,this.width=0,this.height=0,sr.profile&&(this.stats={size:0})}wr.prototype.decRef=function(){--this.refCount<=0&&Mr(this)};function Mr(vr){var Ar=vr.renderbuffer;ve(Ar,"must not double destroy renderbuffer"),N.bindRenderbuffer(Ns,null),N.deleteRenderbuffer(Ar),vr.renderbuffer=null,vr.refCount=0,delete br[vr.id],Mt.renderbufferCount--}function Rr(vr,Ar){var at=new wr(N.createRenderbuffer());br[at.id]=at,Mt.renderbufferCount++;function Gt(Ur,fr){var kr=0,en=0,Fn=On;if(typeof Ur=="object"&&Ur){var tr=Ur;if("shape"in tr){var ar=tr.shape;ve(Array.isArray(ar)&&ar.length>=2,"invalid renderbuffer shape"),kr=ar[0]|0,en=ar[1]|0}else"radius"in tr&&(kr=en=tr.radius|0),"width"in tr&&(kr=tr.width|0),"height"in tr&&(en=tr.height|0);"format"in tr&&(ve.parameter(tr.format,Rt,"invalid renderbuffer format"),Fn=Rt[tr.format])}else typeof Ur=="number"?(kr=Ur|0,typeof fr=="number"?en=fr|0:en=kr):Ur?ve.raise("invalid arguments to renderbuffer constructor"):kr=en=1;if(ve(kr>0&&en>0&&kr<=Pe.maxRenderbufferSize&&en<=Pe.maxRenderbufferSize,"invalid renderbuffer size"),!(kr===at.width&&en===at.height&&Fn===at.format))return Gt.width=at.width=kr,Gt.height=at.height=en,at.format=Fn,N.bindRenderbuffer(Ns,at.renderbuffer),N.renderbufferStorage(Ns,Fn,kr,en),ve(N.getError()===0,"invalid render buffer format"),sr.profile&&(at.stats.size=Ic(at.format,at.width,at.height)),Gt.format=er[at.format],Gt}function Sr(Ur,fr){var kr=Ur|0,en=fr|0||kr;return kr===at.width&&en===at.height||(ve(kr>0&&en>0&&kr<=Pe.maxRenderbufferSize&&en<=Pe.maxRenderbufferSize,"invalid renderbuffer size"),Gt.width=at.width=kr,Gt.height=at.height=en,N.bindRenderbuffer(Ns,at.renderbuffer),N.renderbufferStorage(Ns,at.format,kr,en),ve(N.getError()===0,"invalid render buffer format"),sr.profile&&(at.stats.size=Ic(at.format,at.width,at.height))),Gt}return Gt(vr,Ar),Gt.resize=Sr,Gt._reglType="renderbuffer",Gt._renderbuffer=at,sr.profile&&(Gt.stats=at.stats),Gt.destroy=function(){at.decRef()},Gt}sr.profile&&(Mt.getTotalRenderbufferSize=function(){var vr=0;return Object.keys(br).forEach(function(Ar){vr+=br[Ar].stats.size}),vr});function Hr(){ie(br).forEach(function(vr){vr.renderbuffer=N.createRenderbuffer(),N.bindRenderbuffer(Ns,vr.renderbuffer),N.renderbufferStorage(Ns,vr.format,vr.width,vr.height)}),N.bindRenderbuffer(Ns,null)}return{create:Rr,clear:function(){ie(br).forEach(Mr)},restore:Hr}},gu=36160,Ws=36161,Do=3553,ll=34069,yu=36064,sf=36096,Ml=36128,Pl=33306,Il=36053,ec=36054,cl=36055,dh=36057,qu=36061,Tu=36193,Of=5121,fl=5126,Xs=6407,uf=6408,_u=6402,vh=[Xs,uf],tc=[];tc[uf]=4,tc[Xs]=3;var l=[];l[Of]=1,l[fl]=4,l[Tu]=2;var f=32854,c=32855,d=36194,b=33189,C=36168,A=34041,L=35907,Z=34836,V=34842,le=34843,fe=[f,c,d,L,V,le,Z],de={};de[Il]="complete",de[ec]="incomplete attachment",de[dh]="incomplete dimensions",de[cl]="incomplete, missing attachment",de[qu]="unsupported";function ke(N,me,Pe,Mt,sr,Rt){var er={cur:null,next:null,dirty:!1,setFBO:null},pr=["rgba"],br=["rgba4","rgb565","rgb5 a1"];me.ext_srgb&&br.push("srgba"),me.ext_color_buffer_half_float&&br.push("rgba16f","rgb16f"),me.webgl_color_buffer_float&&br.push("rgba32f");var wr=["uint8"];me.oes_texture_half_float&&wr.push("half float","float16"),me.oes_texture_float&&wr.push("float","float32");function Mr(Tr,Jr,Qr){this.target=Tr,this.texture=Jr,this.renderbuffer=Qr;var mi=0,ri=0;Jr?(mi=Jr.width,ri=Jr.height):Qr&&(mi=Qr.width,ri=Qr.height),this.width=mi,this.height=ri}function Rr(Tr){Tr&&(Tr.texture&&Tr.texture._texture.decRef(),Tr.renderbuffer&&Tr.renderbuffer._renderbuffer.decRef())}function Hr(Tr,Jr,Qr){if(!!Tr)if(Tr.texture){var mi=Tr.texture._texture,ri=Math.max(1,mi.width),Kr=Math.max(1,mi.height);ve(ri===Jr&&Kr===Qr,"inconsistent width/height for supplied texture"),mi.refCount+=1}else{var an=Tr.renderbuffer._renderbuffer;ve(an.width===Jr&&an.height===Qr,"inconsistent width/height for renderbuffer"),an.refCount+=1}}function vr(Tr,Jr){Jr&&(Jr.texture?N.framebufferTexture2D(gu,Tr,Jr.target,Jr.texture._texture.texture,0):N.framebufferRenderbuffer(gu,Tr,Ws,Jr.renderbuffer._renderbuffer.renderbuffer))}function Ar(Tr){var Jr=Do,Qr=null,mi=null,ri=Tr;typeof Tr=="object"&&(ri=Tr.data,"target"in Tr&&(Jr=Tr.target|0)),ve.type(ri,"function","invalid attachment data");var Kr=ri._reglType;return Kr==="texture2d"?(Qr=ri,ve(Jr===Do)):Kr==="textureCube"?(Qr=ri,ve(Jr>=ll&&Jr<ll+6,"invalid cube map target")):Kr==="renderbuffer"?(mi=ri,Jr=Ws):ve.raise("invalid regl object for attachment"),new Mr(Jr,Qr,mi)}function at(Tr,Jr,Qr,mi,ri){if(Qr){var Kr=Mt.create2D({width:Tr,height:Jr,format:mi,type:ri});return Kr._texture.refCount=0,new Mr(Do,Kr,null)}else{var an=sr.create({width:Tr,height:Jr,format:mi});return an._renderbuffer.refCount=0,new Mr(Ws,null,an)}}function Gt(Tr){return Tr&&(Tr.texture||Tr.renderbuffer)}function Sr(Tr,Jr,Qr){Tr&&(Tr.texture?Tr.texture.resize(Jr,Qr):Tr.renderbuffer&&Tr.renderbuffer.resize(Jr,Qr),Tr.width=Jr,Tr.height=Qr)}var Ur=0,fr={};function kr(){this.id=Ur++,fr[this.id]=this,this.framebuffer=N.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function en(Tr){Tr.colorAttachments.forEach(Rr),Rr(Tr.depthAttachment),Rr(Tr.stencilAttachment),Rr(Tr.depthStencilAttachment)}function Fn(Tr){var Jr=Tr.framebuffer;ve(Jr,"must not double destroy framebuffer"),N.deleteFramebuffer(Jr),Tr.framebuffer=null,Rt.framebufferCount--,delete fr[Tr.id]}function tr(Tr){var Jr;N.bindFramebuffer(gu,Tr.framebuffer);var Qr=Tr.colorAttachments;for(Jr=0;Jr<Qr.length;++Jr)vr(yu+Jr,Qr[Jr]);for(Jr=Qr.length;Jr<Pe.maxColorAttachments;++Jr)N.framebufferTexture2D(gu,yu+Jr,Do,null,0);N.framebufferTexture2D(gu,Pl,Do,null,0),N.framebufferTexture2D(gu,sf,Do,null,0),N.framebufferTexture2D(gu,Ml,Do,null,0),vr(sf,Tr.depthAttachment),vr(Ml,Tr.stencilAttachment),vr(Pl,Tr.depthStencilAttachment);var mi=N.checkFramebufferStatus(gu);!N.isContextLost()&&mi!==Il&&ve.raise("framebuffer configuration not supported, status = "+de[mi]),N.bindFramebuffer(gu,er.next?er.next.framebuffer:null),er.cur=er.next,N.getError()}function ar(Tr,Jr){var Qr=new kr;Rt.framebufferCount++;function mi(Kr,an){var Kn;ve(er.next!==Qr,"can not update framebuffer which is currently in use");var ui=0,Fi=0,so=!0,po=!0,ki=null,ns=!0,qa="rgba",$o="uint8",Mo=1,Jo=null,Uo=null,ps=null,uo=!1;if(typeof Kr=="number")ui=Kr|0,Fi=an|0||ui;else if(!Kr)ui=Fi=1;else{ve.type(Kr,"object","invalid arguments for framebuffer");var gi=Kr;if("shape"in gi){var Zo=gi.shape;ve(Array.isArray(Zo)&&Zo.length>=2,"invalid shape for framebuffer"),ui=Zo[0],Fi=Zo[1]}else"radius"in gi&&(ui=Fi=gi.radius),"width"in gi&&(ui=gi.width),"height"in gi&&(Fi=gi.height);("color"in gi||"colors"in gi)&&(ki=gi.color||gi.colors,Array.isArray(ki)&&ve(ki.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),ki||("colorCount"in gi&&(Mo=gi.colorCount|0,ve(Mo>0,"invalid color buffer count")),"colorTexture"in gi&&(ns=!!gi.colorTexture,qa="rgba4"),"colorType"in gi&&($o=gi.colorType,ns?(ve(me.oes_texture_float||!($o==="float"||$o==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ve(me.oes_texture_half_float||!($o==="half float"||$o==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):$o==="half float"||$o==="float16"?(ve(me.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),qa="rgba16f"):($o==="float"||$o==="float32")&&(ve(me.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),qa="rgba32f"),ve.oneOf($o,wr,"invalid color type")),"colorFormat"in gi&&(qa=gi.colorFormat,pr.indexOf(qa)>=0?ns=!0:br.indexOf(qa)>=0?ns=!1:ve.optional(function(){ns?ve.oneOf(gi.colorFormat,pr,"invalid color format for texture"):ve.oneOf(gi.colorFormat,br,"invalid color format for renderbuffer")}))),("depthTexture"in gi||"depthStencilTexture"in gi)&&(uo=!!(gi.depthTexture||gi.depthStencilTexture),ve(!uo||me.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in gi&&(typeof gi.depth=="boolean"?so=gi.depth:(Jo=gi.depth,po=!1)),"stencil"in gi&&(typeof gi.stencil=="boolean"?po=gi.stencil:(Uo=gi.stencil,so=!1)),"depthStencil"in gi&&(typeof gi.depthStencil=="boolean"?so=po=gi.depthStencil:(ps=gi.depthStencil,so=!1,po=!1))}var ra=null,jo=null,ti=null,Bi=null;if(Array.isArray(ki))ra=ki.map(Ar);else if(ki)ra=[Ar(ki)];else for(ra=new Array(Mo),Kn=0;Kn<Mo;++Kn)ra[Kn]=at(ui,Fi,ns,qa,$o);ve(me.webgl_draw_buffers||ra.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ve(ra.length<=Pe.maxColorAttachments,"too many color attachments, not supported"),ui=ui||ra[0].width,Fi=Fi||ra[0].height,Jo?jo=Ar(Jo):so&&!po&&(jo=at(ui,Fi,uo,"depth","uint32")),Uo?ti=Ar(Uo):po&&!so&&(ti=at(ui,Fi,!1,"stencil","uint8")),ps?Bi=Ar(ps):!Jo&&!Uo&&po&&so&&(Bi=at(ui,Fi,uo,"depth stencil","depth stencil")),ve(!!Jo+!!Uo+!!ps<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var la=null;for(Kn=0;Kn<ra.length;++Kn)if(Hr(ra[Kn],ui,Fi),ve(!ra[Kn]||ra[Kn].texture&&vh.indexOf(ra[Kn].texture._texture.format)>=0||ra[Kn].renderbuffer&&fe.indexOf(ra[Kn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Kn+" is invalid"),ra[Kn]&&ra[Kn].texture){var Eo=tc[ra[Kn].texture._texture.format]*l[ra[Kn].texture._texture.type];la===null?la=Eo:ve(la===Eo,"all color attachments much have the same number of bits per pixel.")}return Hr(jo,ui,Fi),ve(!jo||jo.texture&&jo.texture._texture.format===_u||jo.renderbuffer&&jo.renderbuffer._renderbuffer.format===b,"invalid depth attachment for framebuffer object"),Hr(ti,ui,Fi),ve(!ti||ti.renderbuffer&&ti.renderbuffer._renderbuffer.format===C,"invalid stencil attachment for framebuffer object"),Hr(Bi,ui,Fi),ve(!Bi||Bi.texture&&Bi.texture._texture.format===A||Bi.renderbuffer&&Bi.renderbuffer._renderbuffer.format===A,"invalid depth-stencil attachment for framebuffer object"),en(Qr),Qr.width=ui,Qr.height=Fi,Qr.colorAttachments=ra,Qr.depthAttachment=jo,Qr.stencilAttachment=ti,Qr.depthStencilAttachment=Bi,mi.color=ra.map(Gt),mi.depth=Gt(jo),mi.stencil=Gt(ti),mi.depthStencil=Gt(Bi),mi.width=Qr.width,mi.height=Qr.height,tr(Qr),mi}function ri(Kr,an){ve(er.next!==Qr,"can not resize a framebuffer which is currently in use");var Kn=Math.max(Kr|0,1),ui=Math.max(an|0||Kn,1);if(Kn===Qr.width&&ui===Qr.height)return mi;for(var Fi=Qr.colorAttachments,so=0;so<Fi.length;++so)Sr(Fi[so],Kn,ui);return Sr(Qr.depthAttachment,Kn,ui),Sr(Qr.stencilAttachment,Kn,ui),Sr(Qr.depthStencilAttachment,Kn,ui),Qr.width=mi.width=Kn,Qr.height=mi.height=ui,tr(Qr),mi}return mi(Tr,Jr),v(mi,{resize:ri,_reglType:"framebuffer",_framebuffer:Qr,destroy:function(){Fn(Qr),en(Qr)},use:function(Kr){er.setFBO({framebuffer:mi},Kr)}})}function Sn(Tr){var Jr=Array(6);function Qr(ri){var Kr;ve(Jr.indexOf(er.next)<0,"can not update framebuffer which is currently in use");var an={color:null},Kn=0,ui=null,Fi="rgba",so="uint8",po=1;if(typeof ri=="number")Kn=ri|0;else if(!ri)Kn=1;else{ve.type(ri,"object","invalid arguments for framebuffer");var ki=ri;if("shape"in ki){var ns=ki.shape;ve(Array.isArray(ns)&&ns.length>=2,"invalid shape for framebuffer"),ve(ns[0]===ns[1],"cube framebuffer must be square"),Kn=ns[0]}else"radius"in ki&&(Kn=ki.radius|0),"width"in ki?(Kn=ki.width|0,"height"in ki&&ve(ki.height===Kn,"must be square")):"height"in ki&&(Kn=ki.height|0);("color"in ki||"colors"in ki)&&(ui=ki.color||ki.colors,Array.isArray(ui)&&ve(ui.length===1||me.webgl_draw_buffers,"multiple render targets not supported")),ui||("colorCount"in ki&&(po=ki.colorCount|0,ve(po>0,"invalid color buffer count")),"colorType"in ki&&(ve.oneOf(ki.colorType,wr,"invalid color type"),so=ki.colorType),"colorFormat"in ki&&(Fi=ki.colorFormat,ve.oneOf(ki.colorFormat,pr,"invalid color format for texture"))),"depth"in ki&&(an.depth=ki.depth),"stencil"in ki&&(an.stencil=ki.stencil),"depthStencil"in ki&&(an.depthStencil=ki.depthStencil)}var qa;if(ui)if(Array.isArray(ui))for(qa=[],Kr=0;Kr<ui.length;++Kr)qa[Kr]=ui[Kr];else qa=[ui];else{qa=Array(po);var $o={radius:Kn,format:Fi,type:so};for(Kr=0;Kr<po;++Kr)qa[Kr]=Mt.createCube($o)}for(an.color=Array(qa.length),Kr=0;Kr<qa.length;++Kr){var Mo=qa[Kr];ve(typeof Mo=="function"&&Mo._reglType==="textureCube","invalid cube map"),Kn=Kn||Mo.width,ve(Mo.width===Kn&&Mo.height===Kn,"invalid cube map shape"),an.color[Kr]={target:ll,data:qa[Kr]}}for(Kr=0;Kr<6;++Kr){for(var Jo=0;Jo<qa.length;++Jo)an.color[Jo].target=ll+Kr;Kr>0&&(an.depth=Jr[0].depth,an.stencil=Jr[0].stencil,an.depthStencil=Jr[0].depthStencil),Jr[Kr]?Jr[Kr](an):Jr[Kr]=ar(an)}return v(Qr,{width:Kn,height:Kn,color:qa})}function mi(ri){var Kr,an=ri|0;if(ve(an>0&&an<=Pe.maxCubeMapSize,"invalid radius for cube fbo"),an===Qr.width)return Qr;var Kn=Qr.color;for(Kr=0;Kr<Kn.length;++Kr)Kn[Kr].resize(an);for(Kr=0;Kr<6;++Kr)Jr[Kr].resize(an);return Qr.width=Qr.height=an,Qr}return Qr(Tr),v(Qr,{faces:Jr,resize:mi,_reglType:"framebufferCube",destroy:function(){Jr.forEach(function(ri){ri.destroy()})}})}function Xr(){er.cur=null,er.next=null,er.dirty=!0,ie(fr).forEach(function(Tr){Tr.framebuffer=N.createFramebuffer(),tr(Tr)})}return v(er,{getFramebuffer:function(Tr){if(typeof Tr=="function"&&Tr._reglType==="framebuffer"){var Jr=Tr._framebuffer;if(Jr instanceof kr)return Jr}return null},create:ar,createCube:Sn,clear:function(){ie(fr).forEach(Fn)},restore:Xr})}var Re=5126,He=34962,Ae=34963,We=["attributes","elements","offset","count","primitive","instances"];function tt(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Re,this.offset=0,this.stride=0,this.divisor=0}function bt(N,me,Pe,Mt,sr,Rt,er){for(var pr=Pe.maxAttributes,br=new Array(pr),wr=0;wr<pr;++wr)br[wr]=new tt;var Mr=0,Rr={},Hr={Record:tt,scope:{},state:br,currentVAO:null,targetVAO:null,restore:Ar()?en:function(){},createVAO:Fn,getVAO:Gt,destroyBuffer:vr,setVAO:Ar()?Sr:Ur,clear:Ar()?fr:function(){}};function vr(tr){for(var ar=0;ar<br.length;++ar){var Sn=br[ar];Sn.buffer===tr&&(N.disableVertexAttribArray(ar),Sn.buffer=null)}}function Ar(){return me.oes_vertex_array_object}function at(){return me.angle_instanced_arrays}function Gt(tr){return typeof tr=="function"&&tr._vao?tr._vao:null}function Sr(tr){if(tr!==Hr.currentVAO){var ar=Ar();tr?ar.bindVertexArrayOES(tr.vao):ar.bindVertexArrayOES(null),Hr.currentVAO=tr}}function Ur(tr){if(tr!==Hr.currentVAO){if(tr)tr.bindAttrs();else{for(var ar=at(),Sn=0;Sn<br.length;++Sn){var Xr=br[Sn];Xr.buffer?(N.enableVertexAttribArray(Sn),Xr.buffer.bind(),N.vertexAttribPointer(Sn,Xr.size,Xr.type,Xr.normalized,Xr.stride,Xr.offfset),ar&&Xr.divisor&&ar.vertexAttribDivisorANGLE(Sn,Xr.divisor)):(N.disableVertexAttribArray(Sn),N.vertexAttrib4f(Sn,Xr.x,Xr.y,Xr.z,Xr.w))}er.elements?N.bindBuffer(Ae,er.elements.buffer.buffer):N.bindBuffer(Ae,null)}Hr.currentVAO=tr}}function fr(){ie(Rr).forEach(function(tr){tr.destroy()})}function kr(){this.id=++Mr,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var tr=Ar();tr?this.vao=tr.createVertexArrayOES():this.vao=null,Rr[this.id]=this,this.buffers=[]}kr.prototype.bindAttrs=function(){for(var tr=at(),ar=this.attributes,Sn=0;Sn<ar.length;++Sn){var Xr=ar[Sn];Xr.buffer?(N.enableVertexAttribArray(Sn),N.bindBuffer(He,Xr.buffer.buffer),N.vertexAttribPointer(Sn,Xr.size,Xr.type,Xr.normalized,Xr.stride,Xr.offset),tr&&Xr.divisor&&tr.vertexAttribDivisorANGLE(Sn,Xr.divisor)):(N.disableVertexAttribArray(Sn),N.vertexAttrib4f(Sn,Xr.x,Xr.y,Xr.z,Xr.w))}for(var Tr=ar.length;Tr<pr;++Tr)N.disableVertexAttribArray(Tr);var Jr=Rt.getElements(this.elements);Jr?N.bindBuffer(Ae,Jr.buffer.buffer):N.bindBuffer(Ae,null)},kr.prototype.refresh=function(){var tr=Ar();tr&&(tr.bindVertexArrayOES(this.vao),this.bindAttrs(),Hr.currentVAO=null,tr.bindVertexArrayOES(null))},kr.prototype.destroy=function(){if(this.vao){var tr=Ar();this===Hr.currentVAO&&(Hr.currentVAO=null,tr.bindVertexArrayOES(null)),tr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),Rr[this.id]&&(delete Rr[this.id],Mt.vaoCount-=1)};function en(){var tr=Ar();tr&&ie(Rr).forEach(function(ar){ar.refresh()})}function Fn(tr){var ar=new kr;Mt.vaoCount+=1;function Sn(Xr){var Tr;if(Array.isArray(Xr))Tr=Xr,ar.elements&&ar.ownsElements&&ar.elements.destroy(),ar.elements=null,ar.ownsElements=!1,ar.offset=0,ar.count=0,ar.instances=-1,ar.primitive=4;else{if(ve(typeof Xr=="object","invalid arguments for create vao"),ve("attributes"in Xr,"must specify attributes for vao"),Xr.elements){var Jr=Xr.elements;ar.ownsElements?typeof Jr=="function"&&Jr._reglType==="elements"?(ar.elements.destroy(),ar.ownsElements=!1):(ar.elements(Jr),ar.ownsElements=!1):Rt.getElements(Xr.elements)?(ar.elements=Xr.elements,ar.ownsElements=!1):(ar.elements=Rt.create(Xr.elements),ar.ownsElements=!0)}else ar.elements=null,ar.ownsElements=!1;Tr=Xr.attributes,ar.offset=0,ar.count=-1,ar.instances=-1,ar.primitive=4,ar.elements&&(ar.count=ar.elements._elements.vertCount,ar.primitive=ar.elements._elements.primType),"offset"in Xr&&(ar.offset=Xr.offset|0),"count"in Xr&&(ar.count=Xr.count|0),"instances"in Xr&&(ar.instances=Xr.instances|0),"primitive"in Xr&&(ve(Xr.primitive in lr,"bad primitive type: "+Xr.primitive),ar.primitive=lr[Xr.primitive]),ve.optional(()=>{for(var so=Object.keys(Xr),po=0;po<so.length;++po)ve(We.indexOf(so[po])>=0,'invalid option for vao: "'+so[po]+'" valid options are '+We)}),ve(Array.isArray(Tr),"attributes must be an array")}ve(Tr.length<pr,"too many attributes"),ve(Tr.length>0,"must specify at least one attribute");var Qr={},mi=ar.attributes;mi.length=Tr.length;for(var ri=0;ri<Tr.length;++ri){var Kr=Tr[ri],an=mi[ri]=new tt,Kn=Kr.data||Kr;if(Array.isArray(Kn)||$(Kn)||Os(Kn)){var ui;ar.buffers[ri]&&(ui=ar.buffers[ri],$(Kn)&&ui._buffer.byteLength>=Kn.byteLength?ui.subdata(Kn):(ui.destroy(),ar.buffers[ri]=null)),ar.buffers[ri]||(ui=ar.buffers[ri]=sr.create(Kr,He,!1,!0)),an.buffer=sr.getBuffer(ui),an.size=an.buffer.dimension|0,an.normalized=!1,an.type=an.buffer.dtype,an.offset=0,an.stride=0,an.divisor=0,an.state=1,Qr[ri]=1}else sr.getBuffer(Kr)?(an.buffer=sr.getBuffer(Kr),an.size=an.buffer.dimension|0,an.normalized=!1,an.type=an.buffer.dtype,an.offset=0,an.stride=0,an.divisor=0,an.state=1):sr.getBuffer(Kr.buffer)?(an.buffer=sr.getBuffer(Kr.buffer),an.size=(+Kr.size||an.buffer.dimension)|0,an.normalized=!!Kr.normalized||!1,"type"in Kr?(ve.parameter(Kr.type,nu,"invalid buffer type"),an.type=nu[Kr.type]):an.type=an.buffer.dtype,an.offset=(Kr.offset||0)|0,an.stride=(Kr.stride||0)|0,an.divisor=(Kr.divisor||0)|0,an.state=1,ve(an.size>=1&&an.size<=4,"size must be between 1 and 4"),ve(an.offset>=0,"invalid offset"),ve(an.stride>=0&&an.stride<=255,"stride must be between 0 and 255"),ve(an.divisor>=0,"divisor must be positive"),ve(!an.divisor||!!me.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Kr?(ve(ri>0,"first attribute must not be a constant"),an.x=+Kr.x||0,an.y=+Kr.y||0,an.z=+Kr.z||0,an.w=+Kr.w||0,an.state=2):ve(!1,"invalid attribute spec for location "+ri)}for(var Fi=0;Fi<ar.buffers.length;++Fi)!Qr[Fi]&&ar.buffers[Fi]&&(ar.buffers[Fi].destroy(),ar.buffers[Fi]=null);return ar.refresh(),Sn}return Sn.destroy=function(){for(var Xr=0;Xr<ar.buffers.length;++Xr)ar.buffers[Xr]&&ar.buffers[Xr].destroy();ar.buffers.length=0,ar.ownsElements&&(ar.elements.destroy(),ar.elements=null,ar.ownsElements=!1),ar.destroy()},Sn._vao=ar,Sn._reglType="vao",Sn(tr)}return Hr}var Yt=35632,zt=35633,$t=35718,gr=35721;function Br(N,me,Pe,Mt){var sr={},Rt={};function er(at,Gt,Sr,Ur){this.name=at,this.id=Gt,this.location=Sr,this.info=Ur}function pr(at,Gt){for(var Sr=0;Sr<at.length;++Sr)if(at[Sr].id===Gt.id){at[Sr].location=Gt.location;return}at.push(Gt)}function br(at,Gt,Sr){var Ur=at===Yt?sr:Rt,fr=Ur[Gt];if(!fr){var kr=me.str(Gt);fr=N.createShader(at),N.shaderSource(fr,kr),N.compileShader(fr),ve.shaderError(N,fr,kr,at,Sr),Ur[Gt]=fr}return fr}var wr={},Mr=[],Rr=0;function Hr(at,Gt){this.id=Rr++,this.fragId=at,this.vertId=Gt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Mt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function vr(at,Gt,Sr){var Ur,fr,kr=br(Yt,at.fragId),en=br(zt,at.vertId),Fn=at.program=N.createProgram();if(N.attachShader(Fn,kr),N.attachShader(Fn,en),Sr)for(Ur=0;Ur<Sr.length;++Ur){var tr=Sr[Ur];N.bindAttribLocation(Fn,tr[0],tr[1])}N.linkProgram(Fn),ve.linkError(N,Fn,me.str(at.fragId),me.str(at.vertId),Gt);var ar=N.getProgramParameter(Fn,$t);Mt.profile&&(at.stats.uniformsCount=ar);var Sn=at.uniforms;for(Ur=0;Ur<ar;++Ur)if(fr=N.getActiveUniform(Fn,Ur),fr)if(fr.size>1)for(var Xr=0;Xr<fr.size;++Xr){var Tr=fr.name.replace("[0]","["+Xr+"]");pr(Sn,new er(Tr,me.id(Tr),N.getUniformLocation(Fn,Tr),fr))}else pr(Sn,new er(fr.name,me.id(fr.name),N.getUniformLocation(Fn,fr.name),fr));var Jr=N.getProgramParameter(Fn,gr);Mt.profile&&(at.stats.attributesCount=Jr);var Qr=at.attributes;for(Ur=0;Ur<Jr;++Ur)fr=N.getActiveAttrib(Fn,Ur),fr&&pr(Qr,new er(fr.name,me.id(fr.name),N.getAttribLocation(Fn,fr.name),fr))}Mt.profile&&(Pe.getMaxUniformsCount=function(){var at=0;return Mr.forEach(function(Gt){Gt.stats.uniformsCount>at&&(at=Gt.stats.uniformsCount)}),at},Pe.getMaxAttributesCount=function(){var at=0;return Mr.forEach(function(Gt){Gt.stats.attributesCount>at&&(at=Gt.stats.attributesCount)}),at});function Ar(){sr={},Rt={};for(var at=0;at<Mr.length;++at)vr(Mr[at],null,Mr[at].attributes.map(function(Gt){return[Gt.location,Gt.name]}))}return{clear:function(){var at=N.deleteShader.bind(N);ie(sr).forEach(at),sr={},ie(Rt).forEach(at),Rt={},Mr.forEach(function(Gt){N.deleteProgram(Gt.program)}),Mr.length=0,wr={},Pe.shaderCount=0},program:function(at,Gt,Sr,Ur){ve.command(at>=0,"missing vertex shader",Sr),ve.command(Gt>=0,"missing fragment shader",Sr);var fr=wr[Gt];fr||(fr=wr[Gt]={});var kr=fr[at];if(kr&&(kr.refCount++,!Ur))return kr;var en=new Hr(Gt,at);return Pe.shaderCount++,vr(en,Sr,Ur),kr||(fr[at]=en),Mr.push(en),v(en,{destroy:function(){if(en.refCount--,en.refCount<=0){N.deleteProgram(en.program);var Fn=Mr.indexOf(en);Mr.splice(Fn,1),Pe.shaderCount--}fr[en.vertId].refCount<=0&&(N.deleteShader(Rt[en.vertId]),delete Rt[en.vertId],delete wr[en.fragId][en.vertId]),Object.keys(wr[en.fragId]).length||(N.deleteShader(sr[en.fragId]),delete sr[en.fragId],delete wr[en.fragId])}})},restore:Ar,shader:br,frag:-1,vert:-1}}var Fr=6408,sn=5121,kn=3333,Dn=5126;function zn(N,me,Pe,Mt,sr,Rt,er){function pr(Mr){var Rr;me.next===null?(ve(sr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Rr=sn):(ve(me.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Rr=me.next.colorAttachments[0].texture._texture.type,ve.optional(function(){Rt.oes_texture_float?(ve(Rr===sn||Rr===Dn,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Rr===Dn&&ve(er.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ve(Rr===sn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Hr=0,vr=0,Ar=Mt.framebufferWidth,at=Mt.framebufferHeight,Gt=null;$(Mr)?Gt=Mr:Mr&&(ve.type(Mr,"object","invalid arguments to regl.read()"),Hr=Mr.x|0,vr=Mr.y|0,ve(Hr>=0&&Hr<Mt.framebufferWidth,"invalid x offset for regl.read"),ve(vr>=0&&vr<Mt.framebufferHeight,"invalid y offset for regl.read"),Ar=(Mr.width||Mt.framebufferWidth-Hr)|0,at=(Mr.height||Mt.framebufferHeight-vr)|0,Gt=Mr.data||null),Gt&&(Rr===sn?ve(Gt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Rr===Dn&&ve(Gt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ve(Ar>0&&Ar+Hr<=Mt.framebufferWidth,"invalid width for read pixels"),ve(at>0&&at+vr<=Mt.framebufferHeight,"invalid height for read pixels"),Pe();var Sr=Ar*at*4;return Gt||(Rr===sn?Gt=new Uint8Array(Sr):Rr===Dn&&(Gt=Gt||new Float32Array(Sr))),ve.isTypedArray(Gt,"data buffer for regl.read() must be a typedarray"),ve(Gt.byteLength>=Sr,"data buffer for regl.read() too small"),N.pixelStorei(kn,4),N.readPixels(Hr,vr,Ar,at,Fr,Rr,Gt),Gt}function br(Mr){var Rr;return me.setFBO({framebuffer:Mr.framebuffer},function(){Rr=pr(Mr)}),Rr}function wr(Mr){return!Mr||!("framebuffer"in Mr)?pr(Mr):br(Mr)}return wr}function ci(N){return Array.prototype.slice.call(N)}function ln(N){return ci(N).join("")}function Hn(){var N=0,me=[],Pe=[];function Mt(Rr){for(var Hr=0;Hr<Pe.length;++Hr)if(Pe[Hr]===Rr)return me[Hr];var vr="g"+N++;return me.push(vr),Pe.push(Rr),vr}function sr(){var Rr=[];function Hr(){Rr.push.apply(Rr,ci(arguments))}var vr=[];function Ar(){var at="v"+N++;return vr.push(at),arguments.length>0&&(Rr.push(at,"="),Rr.push.apply(Rr,ci(arguments)),Rr.push(";")),at}return v(Hr,{def:Ar,toString:function(){return ln([vr.length>0?"var "+vr.join(",")+";":"",ln(Rr)])}})}function Rt(){var Rr=sr(),Hr=sr(),vr=Rr.toString,Ar=Hr.toString;function at(Gt,Sr){Hr(Gt,Sr,"=",Rr.def(Gt,Sr),";")}return v(function(){Rr.apply(Rr,ci(arguments))},{def:Rr.def,entry:Rr,exit:Hr,save:at,set:function(Gt,Sr,Ur){at(Gt,Sr),Rr(Gt,Sr,"=",Ur,";")},toString:function(){return vr()+Ar()}})}function er(){var Rr=ln(arguments),Hr=Rt(),vr=Rt(),Ar=Hr.toString,at=vr.toString;return v(Hr,{then:function(){return Hr.apply(Hr,ci(arguments)),this},else:function(){return vr.apply(vr,ci(arguments)),this},toString:function(){var Gt=at();return Gt&&(Gt="else{"+Gt+"}"),ln(["if(",Rr,"){",Ar(),"}",Gt])}})}var pr=sr(),br={};function wr(Rr,Hr){var vr=[];function Ar(){var fr="a"+vr.length;return vr.push(fr),fr}Hr=Hr||0;for(var at=0;at<Hr;++at)Ar();var Gt=Rt(),Sr=Gt.toString,Ur=br[Rr]=v(Gt,{arg:Ar,toString:function(){return ln(["function(",vr.join(),"){",Sr(),"}"])}});return Ur}function Mr(){var Rr=['"use strict";',pr,"return {"];Object.keys(br).forEach(function(at){Rr.push('"',at,'":',br[at].toString(),",")}),Rr.push("}");var Hr=ln(Rr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),vr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",Ar=vr?Y.Function.apply(null,me.concat(Hr)):Function.apply(null,me.concat(Hr));return Ar.apply(null,Pe)}return{global:pr,link:Mt,block:sr,proc:wr,scope:Rt,cond:er,compile:Mr}}var fi="xyzw".split(""),Yn=5121,Zn=1,vi=2,qn=0,Vn=1,To=2,Li=3,Qi=4,_o=5,Ya=6,Ua="dither",zs="blend.enable",ys="blend.color",Ku="blend.equation",_s="blend.func",Ys="depth.enable",xo="depth.func",Oc="depth.range",rc="depth.mask",$u="colorMask",su="cull.enable",hl="cull.face",Ts="frontFace",pl="lineWidth",uu="polygonOffset.enable",oo="polygonOffset.offset",qs="sample.alpha",Mu="sample.enable",Pu="sample.coverage",ea="stencil.enable",Ms="stencil.mask",hs="stencil.func",Iu="stencil.opFront",Us="stencil.opBack",nc="scissor.enable",lf="scissor.box",Ks="viewport",ic="profile",lu="framebuffer",dl="vert",Rc="frag",$s="elements",Da="primitive",Lc="count",Rf="offset",Lf="instances",cf="vao",mh="Width",gh="Height",ac=lu+mh,ff=lu+gh,yh=Ks+mh,ep=Ks+gh,Ol="drawingBuffer",hf=Ol+mh,Lp=Ol+gh,kp=[_s,Ku,hs,Iu,Us,Pu,Ks,lf,oo],kc=34962,tp=34963,bd=35632,Ed=35633,Dp=3553,rp=34067,Fp=2884,pf=3042,Bp=3024,bo=2960,_h=2929,Np=3089,xh=32823,bh=32926,kf=32928,Eh=5126,vl=35664,oc=35665,df=35666,Df=5124,Sh=35667,Rl=35668,Ff=35669,Bf=35670,Ch=35671,Dc=35672,Fc=35673,Js=35674,Nf=35675,zf=35676,Uf=35678,Zf=35680,np=4,zr=1028,Bc=1029,Qt=2304,wh=2305,zp=32775,Up=32776,Zp=519,cu=7680,jp=0,jf=1,ml=32774,Ju=513,Vp=36160,Gp=36064,Qu={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Nc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],sc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ll={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Hp={frag:bd,vert:Ed},Ah={cw:Qt,ccw:wh};function Vf(N){return Array.isArray(N)||$(N)||Os(N)}function Gf(N){return N.sort(function(me,Pe){return me===Ks?-1:Pe===Ks?1:me<Pe?-1:1})}function _a(N,me,Pe,Mt){this.thisDep=N,this.contextDep=me,this.propDep=Pe,this.append=Mt}function uc(N){return N&&!(N.thisDep||N.contextDep||N.propDep)}function Fo(N){return new _a(!1,!1,!1,N)}function Qs(N,me){var Pe=N.type;if(Pe===qn){var Mt=N.data.length;return new _a(!0,Mt>=1,Mt>=2,me)}else if(Pe===Qi){var sr=N.data;return new _a(sr.thisDep,sr.contextDep,sr.propDep,me)}else{if(Pe===_o)return new _a(!1,!1,!1,me);if(Pe===Ya){for(var Rt=!1,er=!1,pr=!1,br=0;br<N.data.length;++br){var wr=N.data[br];if(wr.type===Vn)pr=!0;else if(wr.type===To)er=!0;else if(wr.type===Li)Rt=!0;else if(wr.type===qn){Rt=!0;var Mr=wr.data;Mr>=1&&(er=!0),Mr>=2&&(pr=!0)}else wr.type===Qi&&(Rt=Rt||wr.data.thisDep,er=er||wr.data.contextDep,pr=pr||wr.data.propDep)}return new _a(Rt,er,pr,me)}else return new _a(Pe===Li,Pe===To,Pe===Vn,me)}}var Wp=new _a(!1,!1,!1,function(){});function Xp(N,me,Pe,Mt,sr,Rt,er,pr,br,wr,Mr,Rr,Hr,vr,Ar){var at=wr.Record,Gt={add:32774,subtract:32778,"reverse subtract":32779};Pe.ext_blend_minmax&&(Gt.min=zp,Gt.max=Up);var Sr=Pe.angle_instanced_arrays,Ur=Pe.webgl_draw_buffers,fr=Pe.oes_vertex_array_object,kr={dirty:!0,profile:Ar.profile},en={},Fn=[],tr={},ar={};function Sn(Se){return Se.replace(".","_")}function Xr(Se,ce,Ve){var dt=Sn(Se);Fn.push(Se),en[dt]=kr[dt]=!!Ve,tr[dt]=ce}function Tr(Se,ce,Ve){var dt=Sn(Se);Fn.push(Se),Array.isArray(Ve)?(kr[dt]=Ve.slice(),en[dt]=Ve.slice()):kr[dt]=en[dt]=Ve,ar[dt]=ce}Xr(Ua,Bp),Xr(zs,pf),Tr(ys,"blendColor",[0,0,0,0]),Tr(Ku,"blendEquationSeparate",[ml,ml]),Tr(_s,"blendFuncSeparate",[jf,jp,jf,jp]),Xr(Ys,_h,!0),Tr(xo,"depthFunc",Ju),Tr(Oc,"depthRange",[0,1]),Tr(rc,"depthMask",!0),Tr($u,$u,[!0,!0,!0,!0]),Xr(su,Fp),Tr(hl,"cullFace",Bc),Tr(Ts,Ts,wh),Tr(pl,pl,1),Xr(uu,xh),Tr(oo,"polygonOffset",[0,0]),Xr(qs,bh),Xr(Mu,kf),Tr(Pu,"sampleCoverage",[1,!1]),Xr(ea,bo),Tr(Ms,"stencilMask",-1),Tr(hs,"stencilFunc",[Zp,0,-1]),Tr(Iu,"stencilOpSeparate",[zr,cu,cu,cu]),Tr(Us,"stencilOpSeparate",[Bc,cu,cu,cu]),Xr(nc,Np),Tr(lf,"scissor",[0,0,N.drawingBufferWidth,N.drawingBufferHeight]),Tr(Ks,Ks,[0,0,N.drawingBufferWidth,N.drawingBufferHeight]);var Jr={gl:N,context:Hr,strings:me,next:en,current:kr,draw:Rr,elements:Rt,buffer:sr,shader:Mr,attributes:wr.state,vao:wr,uniforms:br,framebuffer:pr,extensions:Pe,timer:vr,isBufferArgs:Vf},Qr={primTypes:lr,compareFuncs:sc,blendFuncs:Qu,blendEquations:Gt,stencilOps:Ll,glTypes:nu,orientationType:Ah};ve.optional(function(){Jr.isArrayLike=ha}),Ur&&(Qr.backBuffer=[Bc],Qr.drawBuffer=Ge(Mt.maxDrawbuffers,function(Se){return Se===0?[0]:Ge(Se,function(ce){return Gp+ce})}));var mi=0;function ri(){var Se=Hn(),ce=Se.link,Ve=Se.global;Se.id=mi++,Se.batchId="0";var dt=ce(Jr),It=Se.shared={props:"a0"};Object.keys(Jr).forEach(function(Ze){It[Ze]=Ve.def(dt,".",Ze)}),ve.optional(function(){Se.CHECK=ce(ve),Se.commandStr=ve.guessCommand(),Se.command=ce(Se.commandStr),Se.assert=function(Ze,we,ft){Ze("if(!(",we,"))",this.CHECK,".commandRaise(",ce(ft),",",this.command,");")},Qr.invalidBlendCombinations=Nc});var Je=Se.next={},Ne=Se.current={};Object.keys(ar).forEach(function(Ze){Array.isArray(kr[Ze])&&(Je[Ze]=Ve.def(It.next,".",Ze),Ne[Ze]=Ve.def(It.current,".",Ze))});var nt=Se.constants={};Object.keys(Qr).forEach(function(Ze){nt[Ze]=Ve.def(JSON.stringify(Qr[Ze]))}),Se.invoke=function(Ze,we){switch(we.type){case qn:var ft=["this",It.context,It.props,Se.batchId];return Ze.def(ce(we.data),".call(",ft.slice(0,Math.max(we.data.length+1,4)),")");case Vn:return Ze.def(It.props,we.data);case To:return Ze.def(It.context,we.data);case Li:return Ze.def("this",we.data);case Qi:return we.data.append(Se,Ze),we.data.ref;case _o:return we.data.toString();case Ya:return we.data.map(function(St){return Se.invoke(Ze,St)})}},Se.attribCache={};var ye={};return Se.scopeAttrib=function(Ze){var we=me.id(Ze);if(we in ye)return ye[we];var ft=wr.scope[we];ft||(ft=wr.scope[we]=new at);var St=ye[we]=ce(ft);return St},Se}function Kr(Se){var ce=Se.static,Ve=Se.dynamic,dt;if(ic in ce){var It=!!ce[ic];dt=Fo(function(Ne,nt){return It}),dt.enable=It}else if(ic in Ve){var Je=Ve[ic];dt=Qs(Je,function(Ne,nt){return Ne.invoke(nt,Je)})}return dt}function an(Se,ce){var Ve=Se.static,dt=Se.dynamic;if(lu in Ve){var It=Ve[lu];return It?(It=pr.getFramebuffer(It),ve.command(It,"invalid framebuffer object"),Fo(function(Ne,nt){var ye=Ne.link(It),Ze=Ne.shared;nt.set(Ze.framebuffer,".next",ye);var we=Ze.context;return nt.set(we,"."+ac,ye+".width"),nt.set(we,"."+ff,ye+".height"),ye})):Fo(function(Ne,nt){var ye=Ne.shared;nt.set(ye.framebuffer,".next","null");var Ze=ye.context;return nt.set(Ze,"."+ac,Ze+"."+hf),nt.set(Ze,"."+ff,Ze+"."+Lp),"null"})}else if(lu in dt){var Je=dt[lu];return Qs(Je,function(Ne,nt){var ye=Ne.invoke(nt,Je),Ze=Ne.shared,we=Ze.framebuffer,ft=nt.def(we,".getFramebuffer(",ye,")");ve.optional(function(){Ne.assert(nt,"!"+ye+"||"+ft,"invalid framebuffer object")}),nt.set(we,".next",ft);var St=Ze.context;return nt.set(St,"."+ac,ft+"?"+ft+".width:"+St+"."+hf),nt.set(St,"."+ff,ft+"?"+ft+".height:"+St+"."+Lp),ft})}else return null}function Kn(Se,ce,Ve){var dt=Se.static,It=Se.dynamic;function Je(ye){if(ye in dt){var Ze=dt[ye];ve.commandType(Ze,"object","invalid "+ye,Ve.commandStr);var we=!0,ft=Ze.x|0,St=Ze.y|0,hr,Zr;return"width"in Ze?(hr=Ze.width|0,ve.command(hr>=0,"invalid "+ye,Ve.commandStr)):we=!1,"height"in Ze?(Zr=Ze.height|0,ve.command(Zr>=0,"invalid "+ye,Ve.commandStr)):we=!1,new _a(!we&&ce&&ce.thisDep,!we&&ce&&ce.contextDep,!we&&ce&&ce.propDep,function(Nr,mr){var ur=Nr.shared.context,bn=hr;"width"in Ze||(bn=mr.def(ur,".",ac,"-",ft));var Cn=Zr;return"height"in Ze||(Cn=mr.def(ur,".",ff,"-",St)),[ft,St,bn,Cn]})}else if(ye in It){var jr=It[ye],rn=Qs(jr,function(Nr,mr){var ur=Nr.invoke(mr,jr);ve.optional(function(){Nr.assert(mr,ur+"&&typeof "+ur+'==="object"',"invalid "+ye)});var bn=Nr.shared.context,Cn=mr.def(ur,".x|0"),mn=mr.def(ur,".y|0"),$n=mr.def('"width" in ',ur,"?",ur,".width|0:","(",bn,".",ac,"-",Cn,")"),Ma=mr.def('"height" in ',ur,"?",ur,".height|0:","(",bn,".",ff,"-",mn,")");return ve.optional(function(){Nr.assert(mr,$n+">=0&&"+Ma+">=0","invalid "+ye)}),[Cn,mn,$n,Ma]});return ce&&(rn.thisDep=rn.thisDep||ce.thisDep,rn.contextDep=rn.contextDep||ce.contextDep,rn.propDep=rn.propDep||ce.propDep),rn}else return ce?new _a(ce.thisDep,ce.contextDep,ce.propDep,function(Nr,mr){var ur=Nr.shared.context;return[0,0,mr.def(ur,".",ac),mr.def(ur,".",ff)]}):null}var Ne=Je(Ks);if(Ne){var nt=Ne;Ne=new _a(Ne.thisDep,Ne.contextDep,Ne.propDep,function(ye,Ze){var we=nt.append(ye,Ze),ft=ye.shared.context;return Ze.set(ft,"."+yh,we[2]),Ze.set(ft,"."+ep,we[3]),we})}return{viewport:Ne,scissor_box:Je(lf)}}function ui(Se,ce){var Ve=Se.static,dt=typeof Ve[Rc]=="string"&&typeof Ve[dl]=="string";if(dt){if(Object.keys(ce.dynamic).length>0)return null;var It=ce.static,Je=Object.keys(It);if(Je.length>0&&typeof It[Je[0]]=="number"){for(var Ne=[],nt=0;nt<Je.length;++nt)ve(typeof It[Je[nt]]=="number","must specify all vertex attribute locations when using vaos"),Ne.push([It[Je[nt]]|0,Je[nt]]);return Ne}}return null}function Fi(Se,ce,Ve){var dt=Se.static,It=Se.dynamic;function Je(we){if(we in dt){var ft=me.id(dt[we]);ve.optional(function(){Mr.shader(Hp[we],ft,ve.guessCommand())});var St=Fo(function(){return ft});return St.id=ft,St}else if(we in It){var hr=It[we];return Qs(hr,function(Zr,jr){var rn=Zr.invoke(jr,hr),Nr=jr.def(Zr.shared.strings,".id(",rn,")");return ve.optional(function(){jr(Zr.shared.shader,".shader(",Hp[we],",",Nr,",",Zr.command,");")}),Nr})}return null}var Ne=Je(Rc),nt=Je(dl),ye=null,Ze;return uc(Ne)&&uc(nt)?(ye=Mr.program(nt.id,Ne.id,null,Ve),Ze=Fo(function(we,ft){return we.link(ye)})):Ze=new _a(Ne&&Ne.thisDep||nt&&nt.thisDep,Ne&&Ne.contextDep||nt&&nt.contextDep,Ne&&Ne.propDep||nt&&nt.propDep,function(we,ft){var St=we.shared.shader,hr;Ne?hr=Ne.append(we,ft):hr=ft.def(St,".",Rc);var Zr;nt?Zr=nt.append(we,ft):Zr=ft.def(St,".",dl);var jr=St+".program("+Zr+","+hr;return ve.optional(function(){jr+=","+we.command}),ft.def(jr+")")}),{frag:Ne,vert:nt,progVar:Ze,program:ye}}function so(Se,ce){var Ve=Se.static,dt=Se.dynamic,It={},Je=!1;function Ne(){if(cf in Ve){var mr=Ve[cf];return mr!==null&&wr.getVAO(mr)===null&&(mr=wr.createVAO(mr)),Je=!0,It.vao=mr,Fo(function(bn){var Cn=wr.getVAO(mr);return Cn?bn.link(Cn):"null"})}else if(cf in dt){Je=!0;var ur=dt[cf];return Qs(ur,function(bn,Cn){var mn=bn.invoke(Cn,ur);return Cn.def(bn.shared.vao+".getVAO("+mn+")")})}return null}var nt=Ne(),ye=!1;function Ze(){if($s in Ve){var mr=Ve[$s];if(It.elements=mr,Vf(mr)){var ur=It.elements=Rt.create(mr,!0);mr=Rt.getElements(ur),ye=!0}else mr&&(mr=Rt.getElements(mr),ye=!0,ve.command(mr,"invalid elements",ce.commandStr));var bn=Fo(function(mn,$n){if(mr){var Ma=mn.link(mr);return mn.ELEMENTS=Ma,Ma}return mn.ELEMENTS=null,null});return bn.value=mr,bn}else if($s in dt){ye=!0;var Cn=dt[$s];return Qs(Cn,function(mn,$n){var Ma=mn.shared,ds=Ma.isBufferArgs,Va=Ma.elements,xa=mn.invoke($n,Cn),Dl=$n.def("null"),Zs=$n.def(ds,"(",xa,")"),yl=mn.cond(Zs).then(Dl,"=",Va,".createStream(",xa,");").else(Dl,"=",Va,".getElements(",xa,");");return ve.optional(function(){mn.assert(yl.else,"!"+xa+"||"+Dl,"invalid elements")}),$n.entry(yl),$n.exit(mn.cond(Zs).then(Va,".destroyStream(",Dl,");")),mn.ELEMENTS=Dl,Dl})}else if(Je)return new _a(nt.thisDep,nt.contextDep,nt.propDep,function(mn,$n){return $n.def(mn.shared.vao+".currentVAO?"+mn.shared.elements+".getElements("+mn.shared.vao+".currentVAO.elements):null")});return null}var we=Ze();function ft(){if(Da in Ve){var mr=Ve[Da];return It.primitive=mr,ve.commandParameter(mr,lr,"invalid primitve",ce.commandStr),Fo(function(bn,Cn){return lr[mr]})}else if(Da in dt){var ur=dt[Da];return Qs(ur,function(bn,Cn){var mn=bn.constants.primTypes,$n=bn.invoke(Cn,ur);return ve.optional(function(){bn.assert(Cn,$n+" in "+mn,"invalid primitive, must be one of "+Object.keys(lr))}),Cn.def(mn,"[",$n,"]")})}else{if(ye)return uc(we)?we.value?Fo(function(bn,Cn){return Cn.def(bn.ELEMENTS,".primType")}):Fo(function(){return np}):new _a(we.thisDep,we.contextDep,we.propDep,function(bn,Cn){var mn=bn.ELEMENTS;return Cn.def(mn,"?",mn,".primType:",np)});if(Je)return new _a(nt.thisDep,nt.contextDep,nt.propDep,function(bn,Cn){return Cn.def(bn.shared.vao+".currentVAO?"+bn.shared.vao+".currentVAO.primitive:"+np)})}return null}function St(mr,ur){if(mr in Ve){var bn=Ve[mr]|0;return ur?It.offset=bn:It.instances=bn,ve.command(!ur||bn>=0,"invalid "+mr,ce.commandStr),Fo(function(mn,$n){return ur&&(mn.OFFSET=bn),bn})}else if(mr in dt){var Cn=dt[mr];return Qs(Cn,function(mn,$n){var Ma=mn.invoke($n,Cn);return ur&&(mn.OFFSET=Ma,ve.optional(function(){mn.assert($n,Ma+">=0","invalid "+mr)})),Ma})}else if(ur){if(ye)return Fo(function(mn,$n){return mn.OFFSET=0,0});if(Je)return new _a(nt.thisDep,nt.contextDep,nt.propDep,function(mn,$n){return $n.def(mn.shared.vao+".currentVAO?"+mn.shared.vao+".currentVAO.offset:0")})}else if(Je)return new _a(nt.thisDep,nt.contextDep,nt.propDep,function(mn,$n){return $n.def(mn.shared.vao+".currentVAO?"+mn.shared.vao+".currentVAO.instances:-1")});return null}var hr=St(Rf,!0);function Zr(){if(Lc in Ve){var mr=Ve[Lc]|0;return It.count=mr,ve.command(typeof mr=="number"&&mr>=0,"invalid vertex count",ce.commandStr),Fo(function(){return mr})}else if(Lc in dt){var ur=dt[Lc];return Qs(ur,function($n,Ma){var ds=$n.invoke(Ma,ur);return ve.optional(function(){$n.assert(Ma,"typeof "+ds+'==="number"&&'+ds+">=0&&"+ds+"===("+ds+"|0)","invalid vertex count")}),ds})}else if(ye)if(uc(we)){if(we)return hr?new _a(hr.thisDep,hr.contextDep,hr.propDep,function($n,Ma){var ds=Ma.def($n.ELEMENTS,".vertCount-",$n.OFFSET);return ve.optional(function(){$n.assert(Ma,ds+">=0","invalid vertex offset/element buffer too small")}),ds}):Fo(function($n,Ma){return Ma.def($n.ELEMENTS,".vertCount")});var bn=Fo(function(){return-1});return ve.optional(function(){bn.MISSING=!0}),bn}else{var Cn=new _a(we.thisDep||hr.thisDep,we.contextDep||hr.contextDep,we.propDep||hr.propDep,function($n,Ma){var ds=$n.ELEMENTS;return $n.OFFSET?Ma.def(ds,"?",ds,".vertCount-",$n.OFFSET,":-1"):Ma.def(ds,"?",ds,".vertCount:-1")});return ve.optional(function(){Cn.DYNAMIC=!0}),Cn}else if(Je){var mn=new _a(nt.thisDep,nt.contextDep,nt.propDep,function($n,Ma){return Ma.def($n.shared.vao,".currentVAO?",$n.shared.vao,".currentVAO.count:-1")});return mn}return null}var jr=ft(),rn=Zr(),Nr=St(Lf,!1);return{elements:we,primitive:jr,count:rn,instances:Nr,offset:hr,vao:nt,vaoActive:Je,elementsActive:ye,static:It}}function po(Se,ce){var Ve=Se.static,dt=Se.dynamic,It={};return Fn.forEach(function(Je){var Ne=Sn(Je);function nt(ye,Ze){if(Je in Ve){var we=ye(Ve[Je]);It[Ne]=Fo(function(){return we})}else if(Je in dt){var ft=dt[Je];It[Ne]=Qs(ft,function(St,hr){return Ze(St,hr,St.invoke(hr,ft))})}}switch(Je){case su:case zs:case Ua:case ea:case Ys:case nc:case uu:case qs:case Mu:case rc:return nt(function(ye){return ve.commandType(ye,"boolean",Je,ce.commandStr),ye},function(ye,Ze,we){return ve.optional(function(){ye.assert(Ze,"typeof "+we+'==="boolean"',"invalid flag "+Je,ye.commandStr)}),we});case xo:return nt(function(ye){return ve.commandParameter(ye,sc,"invalid "+Je,ce.commandStr),sc[ye]},function(ye,Ze,we){var ft=ye.constants.compareFuncs;return ve.optional(function(){ye.assert(Ze,we+" in "+ft,"invalid "+Je+", must be one of "+Object.keys(sc))}),Ze.def(ft,"[",we,"]")});case Oc:return nt(function(ye){return ve.command(ha(ye)&&ye.length===2&&typeof ye[0]=="number"&&typeof ye[1]=="number"&&ye[0]<=ye[1],"depth range is 2d array",ce.commandStr),ye},function(ye,Ze,we){ve.optional(function(){ye.assert(Ze,ye.shared.isArrayLike+"("+we+")&&"+we+".length===2&&typeof "+we+'[0]==="number"&&typeof '+we+'[1]==="number"&&'+we+"[0]<="+we+"[1]","depth range must be a 2d array")});var ft=Ze.def("+",we,"[0]"),St=Ze.def("+",we,"[1]");return[ft,St]});case _s:return nt(function(ye){ve.commandType(ye,"object","blend.func",ce.commandStr);var Ze="srcRGB"in ye?ye.srcRGB:ye.src,we="srcAlpha"in ye?ye.srcAlpha:ye.src,ft="dstRGB"in ye?ye.dstRGB:ye.dst,St="dstAlpha"in ye?ye.dstAlpha:ye.dst;return ve.commandParameter(Ze,Qu,Ne+".srcRGB",ce.commandStr),ve.commandParameter(we,Qu,Ne+".srcAlpha",ce.commandStr),ve.commandParameter(ft,Qu,Ne+".dstRGB",ce.commandStr),ve.commandParameter(St,Qu,Ne+".dstAlpha",ce.commandStr),ve.command(Nc.indexOf(Ze+", "+ft)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Ze+", "+ft+")",ce.commandStr),[Qu[Ze],Qu[ft],Qu[we],Qu[St]]},function(ye,Ze,we){var ft=ye.constants.blendFuncs;ve.optional(function(){ye.assert(Ze,we+"&&typeof "+we+'==="object"',"invalid blend func, must be an object")});function St(ur,bn){var Cn=Ze.def('"',ur,bn,'" in ',we,"?",we,".",ur,bn,":",we,".",ur);return ve.optional(function(){ye.assert(Ze,Cn+" in "+ft,"invalid "+Je+"."+ur+bn+", must be one of "+Object.keys(Qu))}),Cn}var hr=St("src","RGB"),Zr=St("dst","RGB");ve.optional(function(){var ur=ye.constants.invalidBlendCombinations;ye.assert(Ze,ur+".indexOf("+hr+'+", "+'+Zr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var jr=Ze.def(ft,"[",hr,"]"),rn=Ze.def(ft,"[",St("src","Alpha"),"]"),Nr=Ze.def(ft,"[",Zr,"]"),mr=Ze.def(ft,"[",St("dst","Alpha"),"]");return[jr,Nr,rn,mr]});case Ku:return nt(function(ye){if(typeof ye=="string")return ve.commandParameter(ye,Gt,"invalid "+Je,ce.commandStr),[Gt[ye],Gt[ye]];if(typeof ye=="object")return ve.commandParameter(ye.rgb,Gt,Je+".rgb",ce.commandStr),ve.commandParameter(ye.alpha,Gt,Je+".alpha",ce.commandStr),[Gt[ye.rgb],Gt[ye.alpha]];ve.commandRaise("invalid blend.equation",ce.commandStr)},function(ye,Ze,we){var ft=ye.constants.blendEquations,St=Ze.def(),hr=Ze.def(),Zr=ye.cond("typeof ",we,'==="string"');return ve.optional(function(){function jr(rn,Nr,mr){ye.assert(rn,mr+" in "+ft,"invalid "+Nr+", must be one of "+Object.keys(Gt))}jr(Zr.then,Je,we),ye.assert(Zr.else,we+"&&typeof "+we+'==="object"',"invalid "+Je),jr(Zr.else,Je+".rgb",we+".rgb"),jr(Zr.else,Je+".alpha",we+".alpha")}),Zr.then(St,"=",hr,"=",ft,"[",we,"];"),Zr.else(St,"=",ft,"[",we,".rgb];",hr,"=",ft,"[",we,".alpha];"),Ze(Zr),[St,hr]});case ys:return nt(function(ye){return ve.command(ha(ye)&&ye.length===4,"blend.color must be a 4d array",ce.commandStr),Ge(4,function(Ze){return+ye[Ze]})},function(ye,Ze,we){return ve.optional(function(){ye.assert(Ze,ye.shared.isArrayLike+"("+we+")&&"+we+".length===4","blend.color must be a 4d array")}),Ge(4,function(ft){return Ze.def("+",we,"[",ft,"]")})});case Ms:return nt(function(ye){return ve.commandType(ye,"number",Ne,ce.commandStr),ye|0},function(ye,Ze,we){return ve.optional(function(){ye.assert(Ze,"typeof "+we+'==="number"',"invalid stencil.mask")}),Ze.def(we,"|0")});case hs:return nt(function(ye){ve.commandType(ye,"object",Ne,ce.commandStr);var Ze=ye.cmp||"keep",we=ye.ref||0,ft="mask"in ye?ye.mask:-1;return ve.commandParameter(Ze,sc,Je+".cmp",ce.commandStr),ve.commandType(we,"number",Je+".ref",ce.commandStr),ve.commandType(ft,"number",Je+".mask",ce.commandStr),[sc[Ze],we,ft]},function(ye,Ze,we){var ft=ye.constants.compareFuncs;ve.optional(function(){function jr(){ye.assert(Ze,Array.prototype.join.call(arguments,""),"invalid stencil.func")}jr(we+"&&typeof ",we,'==="object"'),jr('!("cmp" in ',we,")||(",we,".cmp in ",ft,")")});var St=Ze.def('"cmp" in ',we,"?",ft,"[",we,".cmp]",":",cu),hr=Ze.def(we,".ref|0"),Zr=Ze.def('"mask" in ',we,"?",we,".mask|0:-1");return[St,hr,Zr]});case Iu:case Us:return nt(function(ye){ve.commandType(ye,"object",Ne,ce.commandStr);var Ze=ye.fail||"keep",we=ye.zfail||"keep",ft=ye.zpass||"keep";return ve.commandParameter(Ze,Ll,Je+".fail",ce.commandStr),ve.commandParameter(we,Ll,Je+".zfail",ce.commandStr),ve.commandParameter(ft,Ll,Je+".zpass",ce.commandStr),[Je===Us?Bc:zr,Ll[Ze],Ll[we],Ll[ft]]},function(ye,Ze,we){var ft=ye.constants.stencilOps;ve.optional(function(){ye.assert(Ze,we+"&&typeof "+we+'==="object"',"invalid "+Je)});function St(hr){return ve.optional(function(){ye.assert(Ze,'!("'+hr+'" in '+we+")||("+we+"."+hr+" in "+ft+")","invalid "+Je+"."+hr+", must be one of "+Object.keys(Ll))}),Ze.def('"',hr,'" in ',we,"?",ft,"[",we,".",hr,"]:",cu)}return[Je===Us?Bc:zr,St("fail"),St("zfail"),St("zpass")]});case oo:return nt(function(ye){ve.commandType(ye,"object",Ne,ce.commandStr);var Ze=ye.factor|0,we=ye.units|0;return ve.commandType(Ze,"number",Ne+".factor",ce.commandStr),ve.commandType(we,"number",Ne+".units",ce.commandStr),[Ze,we]},function(ye,Ze,we){ve.optional(function(){ye.assert(Ze,we+"&&typeof "+we+'==="object"',"invalid "+Je)});var ft=Ze.def(we,".factor|0"),St=Ze.def(we,".units|0");return[ft,St]});case hl:return nt(function(ye){var Ze=0;return ye==="front"?Ze=zr:ye==="back"&&(Ze=Bc),ve.command(!!Ze,Ne,ce.commandStr),Ze},function(ye,Ze,we){return ve.optional(function(){ye.assert(Ze,we+'==="front"||'+we+'==="back"',"invalid cull.face")}),Ze.def(we,'==="front"?',zr,":",Bc)});case pl:return nt(function(ye){return ve.command(typeof ye=="number"&&ye>=Mt.lineWidthDims[0]&&ye<=Mt.lineWidthDims[1],"invalid line width, must be a positive number between "+Mt.lineWidthDims[0]+" and "+Mt.lineWidthDims[1],ce.commandStr),ye},function(ye,Ze,we){return ve.optional(function(){ye.assert(Ze,"typeof "+we+'==="number"&&'+we+">="+Mt.lineWidthDims[0]+"&&"+we+"<="+Mt.lineWidthDims[1],"invalid line width")}),we});case Ts:return nt(function(ye){return ve.commandParameter(ye,Ah,Ne,ce.commandStr),Ah[ye]},function(ye,Ze,we){return ve.optional(function(){ye.assert(Ze,we+'==="cw"||'+we+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Ze.def(we+'==="cw"?'+Qt+":"+wh)});case $u:return nt(function(ye){return ve.command(ha(ye)&&ye.length===4,"color.mask must be length 4 array",ce.commandStr),ye.map(function(Ze){return!!Ze})},function(ye,Ze,we){return ve.optional(function(){ye.assert(Ze,ye.shared.isArrayLike+"("+we+")&&"+we+".length===4","invalid color.mask")}),Ge(4,function(ft){return"!!"+we+"["+ft+"]"})});case Pu:return nt(function(ye){ve.command(typeof ye=="object"&&ye,Ne,ce.commandStr);var Ze="value"in ye?ye.value:1,we=!!ye.invert;return ve.command(typeof Ze=="number"&&Ze>=0&&Ze<=1,"sample.coverage.value must be a number between 0 and 1",ce.commandStr),[Ze,we]},function(ye,Ze,we){ve.optional(function(){ye.assert(Ze,we+"&&typeof "+we+'==="object"',"invalid sample.coverage")});var ft=Ze.def('"value" in ',we,"?+",we,".value:1"),St=Ze.def("!!",we,".invert");return[ft,St]})}}),It}function ki(Se,ce){var Ve=Se.static,dt=Se.dynamic,It={};return Object.keys(Ve).forEach(function(Je){var Ne=Ve[Je],nt;if(typeof Ne=="number"||typeof Ne=="boolean")nt=Fo(function(){return Ne});else if(typeof Ne=="function"){var ye=Ne._reglType;ye==="texture2d"||ye==="textureCube"?nt=Fo(function(Ze){return Ze.link(Ne)}):ye==="framebuffer"||ye==="framebufferCube"?(ve.command(Ne.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Je+'"',ce.commandStr),nt=Fo(function(Ze){return Ze.link(Ne.color[0])})):ve.commandRaise('invalid data for uniform "'+Je+'"',ce.commandStr)}else ha(Ne)?nt=Fo(function(Ze){var we=Ze.global.def("[",Ge(Ne.length,function(ft){return ve.command(typeof Ne[ft]=="number"||typeof Ne[ft]=="boolean","invalid uniform "+Je,Ze.commandStr),Ne[ft]}),"]");return we}):ve.commandRaise('invalid or missing data for uniform "'+Je+'"',ce.commandStr);nt.value=Ne,It[Je]=nt}),Object.keys(dt).forEach(function(Je){var Ne=dt[Je];It[Je]=Qs(Ne,function(nt,ye){return nt.invoke(ye,Ne)})}),It}function ns(Se,ce){var Ve=Se.static,dt=Se.dynamic,It={};return Object.keys(Ve).forEach(function(Je){var Ne=Ve[Je],nt=me.id(Je),ye=new at;if(Vf(Ne))ye.state=Zn,ye.buffer=sr.getBuffer(sr.create(Ne,kc,!1,!0)),ye.type=0;else{var Ze=sr.getBuffer(Ne);if(Ze)ye.state=Zn,ye.buffer=Ze,ye.type=0;else if(ve.command(typeof Ne=="object"&&Ne,"invalid data for attribute "+Je,ce.commandStr),"constant"in Ne){var we=Ne.constant;ye.buffer="null",ye.state=vi,typeof we=="number"?ye.x=we:(ve.command(ha(we)&&we.length>0&&we.length<=4,"invalid constant for attribute "+Je,ce.commandStr),fi.forEach(function(Nr,mr){mr<we.length&&(ye[Nr]=we[mr])}))}else{Vf(Ne.buffer)?Ze=sr.getBuffer(sr.create(Ne.buffer,kc,!1,!0)):Ze=sr.getBuffer(Ne.buffer),ve.command(!!Ze,'missing buffer for attribute "'+Je+'"',ce.commandStr);var ft=Ne.offset|0;ve.command(ft>=0,'invalid offset for attribute "'+Je+'"',ce.commandStr);var St=Ne.stride|0;ve.command(St>=0&&St<256,'invalid stride for attribute "'+Je+'", must be integer betweeen [0, 255]',ce.commandStr);var hr=Ne.size|0;ve.command(!("size"in Ne)||hr>0&&hr<=4,'invalid size for attribute "'+Je+'", must be 1,2,3,4',ce.commandStr);var Zr=!!Ne.normalized,jr=0;"type"in Ne&&(ve.commandParameter(Ne.type,nu,"invalid type for attribute "+Je,ce.commandStr),jr=nu[Ne.type]);var rn=Ne.divisor|0;ve.optional(function(){"divisor"in Ne&&(ve.command(rn===0||Sr,'cannot specify divisor for attribute "'+Je+'", instancing not supported',ce.commandStr),ve.command(rn>=0,'invalid divisor for attribute "'+Je+'"',ce.commandStr));var Nr=ce.commandStr,mr=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Ne).forEach(function(ur){ve.command(mr.indexOf(ur)>=0,'unknown parameter "'+ur+'" for attribute pointer "'+Je+'" (valid parameters are '+mr+")",Nr)})}),ye.buffer=Ze,ye.state=Zn,ye.size=hr,ye.normalized=Zr,ye.type=jr||Ze.dtype,ye.offset=ft,ye.stride=St,ye.divisor=rn}}It[Je]=Fo(function(Nr,mr){var ur=Nr.attribCache;if(nt in ur)return ur[nt];var bn={isStream:!1};return Object.keys(ye).forEach(function(Cn){bn[Cn]=ye[Cn]}),ye.buffer&&(bn.buffer=Nr.link(ye.buffer),bn.type=bn.type||bn.buffer+".dtype"),ur[nt]=bn,bn})}),Object.keys(dt).forEach(function(Je){var Ne=dt[Je];function nt(ye,Ze){var we=ye.invoke(Ze,Ne),ft=ye.shared,St=ye.constants,hr=ft.isBufferArgs,Zr=ft.buffer;ve.optional(function(){ye.assert(Ze,we+"&&(typeof "+we+'==="object"||typeof '+we+'==="function")&&('+hr+"("+we+")||"+Zr+".getBuffer("+we+")||"+Zr+".getBuffer("+we+".buffer)||"+hr+"("+we+'.buffer)||("constant" in '+we+"&&(typeof "+we+'.constant==="number"||'+ft.isArrayLike+"("+we+".constant))))",'invalid dynamic attribute "'+Je+'"')});var jr={isStream:Ze.def(!1)},rn=new at;rn.state=Zn,Object.keys(rn).forEach(function(bn){jr[bn]=Ze.def(""+rn[bn])});var Nr=jr.buffer,mr=jr.type;Ze("if(",hr,"(",we,")){",jr.isStream,"=true;",Nr,"=",Zr,".createStream(",kc,",",we,");",mr,"=",Nr,".dtype;","}else{",Nr,"=",Zr,".getBuffer(",we,");","if(",Nr,"){",mr,"=",Nr,".dtype;",'}else if("constant" in ',we,"){",jr.state,"=",vi,";","if(typeof "+we+'.constant === "number"){',jr[fi[0]],"=",we,".constant;",fi.slice(1).map(function(bn){return jr[bn]}).join("="),"=0;","}else{",fi.map(function(bn,Cn){return jr[bn]+"="+we+".constant.length>"+Cn+"?"+we+".constant["+Cn+"]:0;"}).join(""),"}}else{","if(",hr,"(",we,".buffer)){",Nr,"=",Zr,".createStream(",kc,",",we,".buffer);","}else{",Nr,"=",Zr,".getBuffer(",we,".buffer);","}",mr,'="type" in ',we,"?",St.glTypes,"[",we,".type]:",Nr,".dtype;",jr.normalized,"=!!",we,".normalized;");function ur(bn){Ze(jr[bn],"=",we,".",bn,"|0;")}return ur("size"),ur("offset"),ur("stride"),ur("divisor"),Ze("}}"),Ze.exit("if(",jr.isStream,"){",Zr,".destroyStream(",Nr,");","}"),jr}It[Je]=Qs(Ne,nt)}),It}function qa(Se){var ce=Se.static,Ve=Se.dynamic,dt={};return Object.keys(ce).forEach(function(It){var Je=ce[It];dt[It]=Fo(function(Ne,nt){return typeof Je=="number"||typeof Je=="boolean"?""+Je:Ne.link(Je)})}),Object.keys(Ve).forEach(function(It){var Je=Ve[It];dt[It]=Qs(Je,function(Ne,nt){return Ne.invoke(nt,Je)})}),dt}function $o(Se,ce,Ve,dt,It){var Je=Se.static,Ne=Se.dynamic;ve.optional(function(){var ur=[lu,dl,Rc,$s,Da,Rf,Lc,Lf,ic,cf].concat(Fn);function bn(Cn){Object.keys(Cn).forEach(function(mn){ve.command(ur.indexOf(mn)>=0,'unknown parameter "'+mn+'"',It.commandStr)})}bn(Je),bn(Ne)});var nt=ui(Se,ce),ye=an(Se,It),Ze=Kn(Se,ye,It),we=so(Se,It),ft=po(Se,It),St=Fi(Se,It,nt);function hr(ur){var bn=Ze[ur];bn&&(ft[ur]=bn)}hr(Ks),hr(Sn(lf));var Zr=Object.keys(ft).length>0,jr={framebuffer:ye,draw:we,shader:St,state:ft,dirty:Zr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(jr.profile=Kr(Se,It),jr.uniforms=ki(Ve,It),jr.drawVAO=jr.scopeVAO=we.vao,!jr.drawVAO&&St.program&&!nt&&Pe.angle_instanced_arrays&&we.static.elements){var rn=!0,Nr=St.program.attributes.map(function(ur){var bn=ce.static[ur];return rn=rn&&!!bn,bn});if(rn&&Nr.length>0){var mr=wr.getVAO(wr.createVAO({attributes:Nr,elements:we.static.elements}));jr.drawVAO=new _a(null,null,null,function(ur,bn){return ur.link(mr)}),jr.useVAO=!0}}return nt?jr.useVAO=!0:jr.attributes=ns(ce,It),jr.context=qa(dt,It),jr}function Mo(Se,ce,Ve){var dt=Se.shared,It=dt.context,Je=Se.scope();Object.keys(Ve).forEach(function(Ne){ce.save(It,"."+Ne);var nt=Ve[Ne],ye=nt.append(Se,ce);Array.isArray(ye)?Je(It,".",Ne,"=[",ye.join(),"];"):Je(It,".",Ne,"=",ye,";")}),ce(Je)}function Jo(Se,ce,Ve,dt){var It=Se.shared,Je=It.gl,Ne=It.framebuffer,nt;Ur&&(nt=ce.def(It.extensions,".webgl_draw_buffers"));var ye=Se.constants,Ze=ye.drawBuffer,we=ye.backBuffer,ft;Ve?ft=Ve.append(Se,ce):ft=ce.def(Ne,".next"),dt||ce("if(",ft,"!==",Ne,".cur){"),ce("if(",ft,"){",Je,".bindFramebuffer(",Vp,",",ft,".framebuffer);"),Ur&&ce(nt,".drawBuffersWEBGL(",Ze,"[",ft,".colorAttachments.length]);"),ce("}else{",Je,".bindFramebuffer(",Vp,",null);"),Ur&&ce(nt,".drawBuffersWEBGL(",we,");"),ce("}",Ne,".cur=",ft,";"),dt||ce("}")}function Uo(Se,ce,Ve){var dt=Se.shared,It=dt.gl,Je=Se.current,Ne=Se.next,nt=dt.current,ye=dt.next,Ze=Se.cond(nt,".dirty");Fn.forEach(function(we){var ft=Sn(we);if(!(ft in Ve.state)){var St,hr;if(ft in Ne){St=Ne[ft],hr=Je[ft];var Zr=Ge(kr[ft].length,function(rn){return Ze.def(St,"[",rn,"]")});Ze(Se.cond(Zr.map(function(rn,Nr){return rn+"!=="+hr+"["+Nr+"]"}).join("||")).then(It,".",ar[ft],"(",Zr,");",Zr.map(function(rn,Nr){return hr+"["+Nr+"]="+rn}).join(";"),";"))}else{St=Ze.def(ye,".",ft);var jr=Se.cond(St,"!==",nt,".",ft);Ze(jr),ft in tr?jr(Se.cond(St).then(It,".enable(",tr[ft],");").else(It,".disable(",tr[ft],");"),nt,".",ft,"=",St,";"):jr(It,".",ar[ft],"(",St,");",nt,".",ft,"=",St,";")}}}),Object.keys(Ve.state).length===0&&Ze(nt,".dirty=false;"),ce(Ze)}function ps(Se,ce,Ve,dt){var It=Se.shared,Je=Se.current,Ne=It.current,nt=It.gl;Gf(Object.keys(Ve)).forEach(function(ye){var Ze=Ve[ye];if(!(dt&&!dt(Ze))){var we=Ze.append(Se,ce);if(tr[ye]){var ft=tr[ye];uc(Ze)?we?ce(nt,".enable(",ft,");"):ce(nt,".disable(",ft,");"):ce(Se.cond(we).then(nt,".enable(",ft,");").else(nt,".disable(",ft,");")),ce(Ne,".",ye,"=",we,";")}else if(ha(we)){var St=Je[ye];ce(nt,".",ar[ye],"(",we,");",we.map(function(hr,Zr){return St+"["+Zr+"]="+hr}).join(";"),";")}else ce(nt,".",ar[ye],"(",we,");",Ne,".",ye,"=",we,";")}})}function uo(Se,ce){Sr&&(Se.instancing=ce.def(Se.shared.extensions,".angle_instanced_arrays"))}function gi(Se,ce,Ve,dt,It){var Je=Se.shared,Ne=Se.stats,nt=Je.current,ye=Je.timer,Ze=Ve.profile;function we(){var ur=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return ur||typeof performance=="undefined"?"Date.now()":"performance.now()"}var ft,St;function hr(ur){ft=ce.def(),ur(ft,"=",we(),";"),typeof It=="string"?ur(Ne,".count+=",It,";"):ur(Ne,".count++;"),vr&&(dt?(St=ce.def(),ur(St,"=",ye,".getNumPendingQueries();")):ur(ye,".beginQuery(",Ne,");"))}function Zr(ur){ur(Ne,".cpuTime+=",we(),"-",ft,";"),vr&&(dt?ur(ye,".pushScopeStats(",St,",",ye,".getNumPendingQueries(),",Ne,");"):ur(ye,".endQuery();"))}function jr(ur){var bn=ce.def(nt,".profile");ce(nt,".profile=",ur,";"),ce.exit(nt,".profile=",bn,";")}var rn;if(Ze){if(uc(Ze)){Ze.enable?(hr(ce),Zr(ce.exit),jr("true")):jr("false");return}rn=Ze.append(Se,ce),jr(rn)}else rn=ce.def(nt,".profile");var Nr=Se.block();hr(Nr),ce("if(",rn,"){",Nr,"}");var mr=Se.block();Zr(mr),ce.exit("if(",rn,"){",mr,"}")}function Zo(Se,ce,Ve,dt,It){var Je=Se.shared;function Ne(ye){switch(ye){case vl:case Sh:case Ch:return 2;case oc:case Rl:case Dc:return 3;case df:case Ff:case Fc:return 4;default:return 1}}function nt(ye,Ze,we){var ft=Je.gl,St=ce.def(ye,".location"),hr=ce.def(Je.attributes,"[",St,"]"),Zr=we.state,jr=we.buffer,rn=[we.x,we.y,we.z,we.w],Nr=["buffer","normalized","offset","stride"];function mr(){ce("if(!",hr,".buffer){",ft,".enableVertexAttribArray(",St,");}");var bn=we.type,Cn;if(we.size?Cn=ce.def(we.size,"||",Ze):Cn=Ze,ce("if(",hr,".type!==",bn,"||",hr,".size!==",Cn,"||",Nr.map(function($n){return hr+"."+$n+"!=="+we[$n]}).join("||"),"){",ft,".bindBuffer(",kc,",",jr,".buffer);",ft,".vertexAttribPointer(",[St,Cn,bn,we.normalized,we.stride,we.offset],");",hr,".type=",bn,";",hr,".size=",Cn,";",Nr.map(function($n){return hr+"."+$n+"="+we[$n]+";"}).join(""),"}"),Sr){var mn=we.divisor;ce("if(",hr,".divisor!==",mn,"){",Se.instancing,".vertexAttribDivisorANGLE(",[St,mn],");",hr,".divisor=",mn,";}")}}function ur(){ce("if(",hr,".buffer){",ft,".disableVertexAttribArray(",St,");",hr,".buffer=null;","}if(",fi.map(function(bn,Cn){return hr+"."+bn+"!=="+rn[Cn]}).join("||"),"){",ft,".vertexAttrib4f(",St,",",rn,");",fi.map(function(bn,Cn){return hr+"."+bn+"="+rn[Cn]+";"}).join(""),"}")}Zr===Zn?mr():Zr===vi?ur():(ce("if(",Zr,"===",Zn,"){"),mr(),ce("}else{"),ur(),ce("}"))}dt.forEach(function(ye){var Ze=ye.name,we=Ve.attributes[Ze],ft;if(we){if(!It(we))return;ft=we.append(Se,ce)}else{if(!It(Wp))return;var St=Se.scopeAttrib(Ze);ve.optional(function(){Se.assert(ce,St+".state","missing attribute "+Ze)}),ft={},Object.keys(new at).forEach(function(hr){ft[hr]=ce.def(St,".",hr)})}nt(Se.link(ye),Ne(ye.info.type),ft)})}function ra(Se,ce,Ve,dt,It,Je){for(var Ne=Se.shared,nt=Ne.gl,ye,Ze=0;Ze<dt.length;++Ze){var we=dt[Ze],ft=we.name,St=we.info.type,hr=Ve.uniforms[ft],Zr=Se.link(we),jr=Zr+".location",rn;if(hr){if(!It(hr))continue;if(uc(hr)){var Nr=hr.value;if(ve.command(Nr!==null&&typeof Nr!="undefined",'missing uniform "'+ft+'"',Se.commandStr),St===Uf||St===Zf){ve.command(typeof Nr=="function"&&(St===Uf&&(Nr._reglType==="texture2d"||Nr._reglType==="framebuffer")||St===Zf&&(Nr._reglType==="textureCube"||Nr._reglType==="framebufferCube")),"invalid texture for uniform "+ft,Se.commandStr);var mr=Se.link(Nr._texture||Nr.color[0]._texture);ce(nt,".uniform1i(",jr,",",mr+".bind());"),ce.exit(mr,".unbind();")}else if(St===Js||St===Nf||St===zf){ve.optional(function(){ve.command(ha(Nr),"invalid matrix for uniform "+ft,Se.commandStr),ve.command(St===Js&&Nr.length===4||St===Nf&&Nr.length===9||St===zf&&Nr.length===16,"invalid length for matrix uniform "+ft,Se.commandStr)});var ur=Se.global.def("new Float32Array(["+Array.prototype.slice.call(Nr)+"])"),bn=2;St===Nf?bn=3:St===zf&&(bn=4),ce(nt,".uniformMatrix",bn,"fv(",jr,",false,",ur,");")}else{switch(St){case Eh:ve.commandType(Nr,"number","uniform "+ft,Se.commandStr),ye="1f";break;case vl:ve.command(ha(Nr)&&Nr.length===2,"uniform "+ft,Se.commandStr),ye="2f";break;case oc:ve.command(ha(Nr)&&Nr.length===3,"uniform "+ft,Se.commandStr),ye="3f";break;case df:ve.command(ha(Nr)&&Nr.length===4,"uniform "+ft,Se.commandStr),ye="4f";break;case Bf:ve.commandType(Nr,"boolean","uniform "+ft,Se.commandStr),ye="1i";break;case Df:ve.commandType(Nr,"number","uniform "+ft,Se.commandStr),ye="1i";break;case Ch:ve.command(ha(Nr)&&Nr.length===2,"uniform "+ft,Se.commandStr),ye="2i";break;case Sh:ve.command(ha(Nr)&&Nr.length===2,"uniform "+ft,Se.commandStr),ye="2i";break;case Dc:ve.command(ha(Nr)&&Nr.length===3,"uniform "+ft,Se.commandStr),ye="3i";break;case Rl:ve.command(ha(Nr)&&Nr.length===3,"uniform "+ft,Se.commandStr),ye="3i";break;case Fc:ve.command(ha(Nr)&&Nr.length===4,"uniform "+ft,Se.commandStr),ye="4i";break;case Ff:ve.command(ha(Nr)&&Nr.length===4,"uniform "+ft,Se.commandStr),ye="4i";break}ce(nt,".uniform",ye,"(",jr,",",ha(Nr)?Array.prototype.slice.call(Nr):Nr,");")}continue}else rn=hr.append(Se,ce)}else{if(!It(Wp))continue;rn=ce.def(Ne.uniforms,"[",me.id(ft),"]")}St===Uf?(ve(!Array.isArray(rn),"must specify a scalar prop for textures"),ce("if(",rn,"&&",rn,'._reglType==="framebuffer"){',rn,"=",rn,".color[0];","}")):St===Zf&&(ve(!Array.isArray(rn),"must specify a scalar prop for cube maps"),ce("if(",rn,"&&",rn,'._reglType==="framebufferCube"){',rn,"=",rn,".color[0];","}")),ve.optional(function(){function Zs(Ru,lc){Se.assert(ce,Ru,'bad data or missing for uniform "'+ft+'".  '+lc)}function yl(Ru){ve(!Array.isArray(rn),"must not specify an array type for uniform"),Zs("typeof "+rn+'==="'+Ru+'"',"invalid type, expected "+Ru)}function Ou(Ru,lc){Array.isArray(rn)?ve(rn.length===Ru,"must have length "+Ru):Zs(Ne.isArrayLike+"("+rn+")&&"+rn+".length==="+Ru,"invalid vector, should have length "+Ru,Se.commandStr)}function Kp(Ru){ve(!Array.isArray(rn),"must not specify a value type"),Zs("typeof "+rn+'==="function"&&'+rn+'._reglType==="texture'+(Ru===Dp?"2d":"Cube")+'"',"invalid texture type",Se.commandStr)}switch(St){case Df:yl("number");break;case Sh:Ou(2,"number");break;case Rl:Ou(3,"number");break;case Ff:Ou(4,"number");break;case Eh:yl("number");break;case vl:Ou(2,"number");break;case oc:Ou(3,"number");break;case df:Ou(4,"number");break;case Bf:yl("boolean");break;case Ch:Ou(2,"boolean");break;case Dc:Ou(3,"boolean");break;case Fc:Ou(4,"boolean");break;case Js:Ou(4,"number");break;case Nf:Ou(9,"number");break;case zf:Ou(16,"number");break;case Uf:Kp(Dp);break;case Zf:Kp(rp);break}});var Cn=1;switch(St){case Uf:case Zf:var mn=ce.def(rn,"._texture");ce(nt,".uniform1i(",jr,",",mn,".bind());"),ce.exit(mn,".unbind();");continue;case Df:case Bf:ye="1i";break;case Sh:case Ch:ye="2i",Cn=2;break;case Rl:case Dc:ye="3i",Cn=3;break;case Ff:case Fc:ye="4i",Cn=4;break;case Eh:ye="1f";break;case vl:ye="2f",Cn=2;break;case oc:ye="3f",Cn=3;break;case df:ye="4f",Cn=4;break;case Js:ye="Matrix2fv";break;case Nf:ye="Matrix3fv";break;case zf:ye="Matrix4fv";break}if(ye.charAt(0)==="M"){ce(nt,".uniform",ye,"(",jr,",");var $n=Math.pow(St-Js+2,2),Ma=Se.global.def("new Float32Array(",$n,")");Array.isArray(rn)?ce("false,(",Ge($n,function(Zs){return Ma+"["+Zs+"]="+rn[Zs]}),",",Ma,")"):ce("false,(Array.isArray(",rn,")||",rn," instanceof Float32Array)?",rn,":(",Ge($n,function(Zs){return Ma+"["+Zs+"]="+rn+"["+Zs+"]"}),",",Ma,")"),ce(");")}else if(Cn>1){for(var ds=[],Va=[],xa=0;xa<Cn;++xa)Array.isArray(rn)?Va.push(rn[xa]):Va.push(ce.def(rn+"["+xa+"]")),Je&&ds.push(ce.def());Je&&ce("if(!",Se.batchId,"||",ds.map(function(Zs,yl){return Zs+"!=="+Va[yl]}).join("||"),"){",ds.map(function(Zs,yl){return Zs+"="+Va[yl]+";"}).join("")),ce(nt,".uniform",ye,"(",jr,",",Va.join(","),");"),Je&&ce("}")}else{if(ve(!Array.isArray(rn),"uniform value must not be an array"),Je){var Dl=ce.def();ce("if(!",Se.batchId,"||",Dl,"!==",rn,"){",Dl,"=",rn,";")}ce(nt,".uniform",ye,"(",jr,",",rn,");"),Je&&ce("}")}}}function jo(Se,ce,Ve,dt){var It=Se.shared,Je=It.gl,Ne=It.draw,nt=dt.draw;function ye(){var Cn=nt.elements,mn,$n=ce;return Cn?((Cn.contextDep&&dt.contextDynamic||Cn.propDep)&&($n=Ve),mn=Cn.append(Se,$n),nt.elementsActive&&$n("if("+mn+")"+Je+".bindBuffer("+tp+","+mn+".buffer.buffer);")):(mn=$n.def(),$n(mn,"=",Ne,".",$s,";","if(",mn,"){",Je,".bindBuffer(",tp,",",mn,".buffer.buffer);}","else if(",It.vao,".currentVAO){",mn,"=",Se.shared.elements+".getElements("+It.vao,".currentVAO.elements);",fr?"":"if("+mn+")"+Je+".bindBuffer("+tp+","+mn+".buffer.buffer);","}")),mn}function Ze(){var Cn=nt.count,mn,$n=ce;return Cn?((Cn.contextDep&&dt.contextDynamic||Cn.propDep)&&($n=Ve),mn=Cn.append(Se,$n),ve.optional(function(){Cn.MISSING&&Se.assert(ce,"false","missing vertex count"),Cn.DYNAMIC&&Se.assert($n,mn+">=0","missing vertex count")})):(mn=$n.def(Ne,".",Lc),ve.optional(function(){Se.assert($n,mn+">=0","missing vertex count")})),mn}var we=ye();function ft(Cn){var mn=nt[Cn];return mn?mn.contextDep&&dt.contextDynamic||mn.propDep?mn.append(Se,Ve):mn.append(Se,ce):ce.def(Ne,".",Cn)}var St=ft(Da),hr=ft(Rf),Zr=Ze();if(typeof Zr=="number"){if(Zr===0)return}else Ve("if(",Zr,"){"),Ve.exit("}");var jr,rn;Sr&&(jr=ft(Lf),rn=Se.instancing);var Nr=we+".type",mr=nt.elements&&uc(nt.elements)&&!nt.vaoActive;function ur(){function Cn(){Ve(rn,".drawElementsInstancedANGLE(",[St,Zr,Nr,hr+"<<(("+Nr+"-"+Yn+")>>1)",jr],");")}function mn(){Ve(rn,".drawArraysInstancedANGLE(",[St,hr,Zr,jr],");")}we&&we!=="null"?mr?Cn():(Ve("if(",we,"){"),Cn(),Ve("}else{"),mn(),Ve("}")):mn()}function bn(){function Cn(){Ve(Je+".drawElements("+[St,Zr,Nr,hr+"<<(("+Nr+"-"+Yn+")>>1)"]+");")}function mn(){Ve(Je+".drawArrays("+[St,hr,Zr]+");")}we&&we!=="null"?mr?Cn():(Ve("if(",we,"){"),Cn(),Ve("}else{"),mn(),Ve("}")):mn()}Sr&&(typeof jr!="number"||jr>=0)?typeof jr=="string"?(Ve("if(",jr,">0){"),ur(),Ve("}else if(",jr,"<0){"),bn(),Ve("}")):ur():bn()}function ti(Se,ce,Ve,dt,It){var Je=ri(),Ne=Je.proc("body",It);return ve.optional(function(){Je.commandStr=ce.commandStr,Je.command=Je.link(ce.commandStr)}),Sr&&(Je.instancing=Ne.def(Je.shared.extensions,".angle_instanced_arrays")),Se(Je,Ne,Ve,dt),Je.compile().body}function Bi(Se,ce,Ve,dt){uo(Se,ce),Ve.useVAO?Ve.drawVAO?ce(Se.shared.vao,".setVAO(",Ve.drawVAO.append(Se,ce),");"):ce(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(ce(Se.shared.vao,".setVAO(null);"),Zo(Se,ce,Ve,dt.attributes,function(){return!0})),ra(Se,ce,Ve,dt.uniforms,function(){return!0},!1),jo(Se,ce,ce,Ve)}function la(Se,ce){var Ve=Se.proc("draw",1);uo(Se,Ve),Mo(Se,Ve,ce.context),Jo(Se,Ve,ce.framebuffer),Uo(Se,Ve,ce),ps(Se,Ve,ce.state),gi(Se,Ve,ce,!1,!0);var dt=ce.shader.progVar.append(Se,Ve);if(Ve(Se.shared.gl,".useProgram(",dt,".program);"),ce.shader.program)Bi(Se,Ve,ce,ce.shader.program);else{Ve(Se.shared.vao,".setVAO(null);");var It=Se.global.def("{}"),Je=Ve.def(dt,".id"),Ne=Ve.def(It,"[",Je,"]");Ve(Se.cond(Ne).then(Ne,".call(this,a0);").else(Ne,"=",It,"[",Je,"]=",Se.link(function(nt){return ti(Bi,Se,ce,nt,1)}),"(",dt,");",Ne,".call(this,a0);"))}Object.keys(ce.state).length>0&&Ve(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ve(Se.shared.vao,".setVAO(null);")}function Eo(Se,ce,Ve,dt){Se.batchId="a1",uo(Se,ce);function It(){return!0}Zo(Se,ce,Ve,dt.attributes,It),ra(Se,ce,Ve,dt.uniforms,It,!1),jo(Se,ce,ce,Ve)}function gl(Se,ce,Ve,dt){uo(Se,ce);var It=Ve.contextDep,Je=ce.def(),Ne="a0",nt="a1",ye=ce.def();Se.shared.props=ye,Se.batchId=Je;var Ze=Se.scope(),we=Se.scope();ce(Ze.entry,"for(",Je,"=0;",Je,"<",nt,";++",Je,"){",ye,"=",Ne,"[",Je,"];",we,"}",Ze.exit);function ft(Nr){return Nr.contextDep&&It||Nr.propDep}function St(Nr){return!ft(Nr)}if(Ve.needsContext&&Mo(Se,we,Ve.context),Ve.needsFramebuffer&&Jo(Se,we,Ve.framebuffer),ps(Se,we,Ve.state,ft),Ve.profile&&ft(Ve.profile)&&gi(Se,we,Ve,!1,!0),dt)Ve.useVAO?Ve.drawVAO?ft(Ve.drawVAO)?we(Se.shared.vao,".setVAO(",Ve.drawVAO.append(Se,we),");"):Ze(Se.shared.vao,".setVAO(",Ve.drawVAO.append(Se,Ze),");"):Ze(Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"):(Ze(Se.shared.vao,".setVAO(null);"),Zo(Se,Ze,Ve,dt.attributes,St),Zo(Se,we,Ve,dt.attributes,ft)),ra(Se,Ze,Ve,dt.uniforms,St,!1),ra(Se,we,Ve,dt.uniforms,ft,!0),jo(Se,Ze,we,Ve);else{var hr=Se.global.def("{}"),Zr=Ve.shader.progVar.append(Se,we),jr=we.def(Zr,".id"),rn=we.def(hr,"[",jr,"]");we(Se.shared.gl,".useProgram(",Zr,".program);","if(!",rn,"){",rn,"=",hr,"[",jr,"]=",Se.link(function(Nr){return ti(Eo,Se,Ve,Nr,2)}),"(",Zr,");}",rn,".call(this,a0[",Je,"],",Je,");")}}function Ie(Se,ce){var Ve=Se.proc("batch",2);Se.batchId="0",uo(Se,Ve);var dt=!1,It=!0;Object.keys(ce.context).forEach(function(hr){dt=dt||ce.context[hr].propDep}),dt||(Mo(Se,Ve,ce.context),It=!1);var Je=ce.framebuffer,Ne=!1;Je?(Je.propDep?dt=Ne=!0:Je.contextDep&&dt&&(Ne=!0),Ne||Jo(Se,Ve,Je)):Jo(Se,Ve,null),ce.state.viewport&&ce.state.viewport.propDep&&(dt=!0);function nt(hr){return hr.contextDep&&dt||hr.propDep}Uo(Se,Ve,ce),ps(Se,Ve,ce.state,function(hr){return!nt(hr)}),(!ce.profile||!nt(ce.profile))&&gi(Se,Ve,ce,!1,"a1"),ce.contextDep=dt,ce.needsContext=It,ce.needsFramebuffer=Ne;var ye=ce.shader.progVar;if(ye.contextDep&&dt||ye.propDep)gl(Se,Ve,ce,null);else{var Ze=ye.append(Se,Ve);if(Ve(Se.shared.gl,".useProgram(",Ze,".program);"),ce.shader.program)gl(Se,Ve,ce,ce.shader.program);else{Ve(Se.shared.vao,".setVAO(null);");var we=Se.global.def("{}"),ft=Ve.def(Ze,".id"),St=Ve.def(we,"[",ft,"]");Ve(Se.cond(St).then(St,".call(this,a0,a1);").else(St,"=",we,"[",ft,"]=",Se.link(function(hr){return ti(gl,Se,ce,hr,2)}),"(",Ze,");",St,".call(this,a0,a1);"))}}Object.keys(ce.state).length>0&&Ve(Se.shared.current,".dirty=true;"),Se.shared.vao&&Ve(Se.shared.vao,".setVAO(null);")}function Bt(Se,ce){var Ve=Se.proc("scope",3);Se.batchId="a2";var dt=Se.shared,It=dt.current;Mo(Se,Ve,ce.context),ce.framebuffer&&ce.framebuffer.append(Se,Ve),Gf(Object.keys(ce.state)).forEach(function(Ne){var nt=ce.state[Ne],ye=nt.append(Se,Ve);ha(ye)?ye.forEach(function(Ze,we){Ve.set(Se.next[Ne],"["+we+"]",Ze)}):Ve.set(dt.next,"."+Ne,ye)}),gi(Se,Ve,ce,!0,!0),[$s,Rf,Lc,Lf,Da].forEach(function(Ne){var nt=ce.draw[Ne];!nt||Ve.set(dt.draw,"."+Ne,""+nt.append(Se,Ve))}),Object.keys(ce.uniforms).forEach(function(Ne){var nt=ce.uniforms[Ne].append(Se,Ve);Array.isArray(nt)&&(nt="["+nt.join()+"]"),Ve.set(dt.uniforms,"["+me.id(Ne)+"]",nt)}),Object.keys(ce.attributes).forEach(function(Ne){var nt=ce.attributes[Ne].append(Se,Ve),ye=Se.scopeAttrib(Ne);Object.keys(new at).forEach(function(Ze){Ve.set(ye,"."+Ze,nt[Ze])})}),ce.scopeVAO&&Ve.set(dt.vao,".targetVAO",ce.scopeVAO.append(Se,Ve));function Je(Ne){var nt=ce.shader[Ne];nt&&Ve.set(dt.shader,"."+Ne,nt.append(Se,Ve))}Je(dl),Je(Rc),Object.keys(ce.state).length>0&&(Ve(It,".dirty=true;"),Ve.exit(It,".dirty=true;")),Ve("a1(",Se.shared.context,",a0,",Se.batchId,");")}function Ct(Se){if(!(typeof Se!="object"||ha(Se))){for(var ce=Object.keys(Se),Ve=0;Ve<ce.length;++Ve)if(nn.isDynamic(Se[ce[Ve]]))return!0;return!1}}function vn(Se,ce,Ve){var dt=ce.static[Ve];if(!dt||!Ct(dt))return;var It=Se.global,Je=Object.keys(dt),Ne=!1,nt=!1,ye=!1,Ze=Se.global.def("{}");Je.forEach(function(ft){var St=dt[ft];if(nn.isDynamic(St)){typeof St=="function"&&(St=dt[ft]=nn.unbox(St));var hr=Qs(St,null);Ne=Ne||hr.thisDep,ye=ye||hr.propDep,nt=nt||hr.contextDep}else{switch(It(Ze,".",ft,"="),typeof St){case"number":It(St);break;case"string":It('"',St,'"');break;case"object":Array.isArray(St)&&It("[",St.join(),"]");break;default:It(Se.link(St));break}It(";")}});function we(ft,St){Je.forEach(function(hr){var Zr=dt[hr];if(!!nn.isDynamic(Zr)){var jr=ft.invoke(St,Zr);St(Ze,".",hr,"=",jr,";")}})}ce.dynamic[Ve]=new nn.DynamicVariable(Qi,{thisDep:Ne,contextDep:nt,propDep:ye,ref:Ze,append:we}),delete ce.static[Ve]}function Ni(Se,ce,Ve,dt,It){var Je=ri();Je.stats=Je.link(It),Object.keys(ce.static).forEach(function(nt){vn(Je,ce,nt)}),kp.forEach(function(nt){vn(Je,Se,nt)});var Ne=$o(Se,ce,Ve,dt,Je);return la(Je,Ne),Bt(Je,Ne),Ie(Je,Ne),v(Je.compile(),{destroy:function(){Ne.shader.program.destroy()}})}return{next:en,current:kr,procs:function(){var Se=ri(),ce=Se.proc("poll"),Ve=Se.proc("refresh"),dt=Se.block();ce(dt),Ve(dt);var It=Se.shared,Je=It.gl,Ne=It.next,nt=It.current;dt(nt,".dirty=false;"),Jo(Se,ce),Jo(Se,Ve,null,!0);var ye;Sr&&(ye=Se.link(Sr)),Pe.oes_vertex_array_object&&Ve(Se.link(Pe.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Ze=0;Ze<Mt.maxAttributes;++Ze){var we=Ve.def(It.attributes,"[",Ze,"]"),ft=Se.cond(we,".buffer");ft.then(Je,".enableVertexAttribArray(",Ze,");",Je,".bindBuffer(",kc,",",we,".buffer.buffer);",Je,".vertexAttribPointer(",Ze,",",we,".size,",we,".type,",we,".normalized,",we,".stride,",we,".offset);").else(Je,".disableVertexAttribArray(",Ze,");",Je,".vertexAttrib4f(",Ze,",",we,".x,",we,".y,",we,".z,",we,".w);",we,".buffer=null;"),Ve(ft),Sr&&Ve(ye,".vertexAttribDivisorANGLE(",Ze,",",we,".divisor);")}return Ve(Se.shared.vao,".currentVAO=null;",Se.shared.vao,".setVAO(",Se.shared.vao,".targetVAO);"),Object.keys(tr).forEach(function(St){var hr=tr[St],Zr=dt.def(Ne,".",St),jr=Se.block();jr("if(",Zr,"){",Je,".enable(",hr,")}else{",Je,".disable(",hr,")}",nt,".",St,"=",Zr,";"),Ve(jr),ce("if(",Zr,"!==",nt,".",St,"){",jr,"}")}),Object.keys(ar).forEach(function(St){var hr=ar[St],Zr=kr[St],jr,rn,Nr=Se.block();if(Nr(Je,".",hr,"("),ha(Zr)){var mr=Zr.length;jr=Se.global.def(Ne,".",St),rn=Se.global.def(nt,".",St),Nr(Ge(mr,function(ur){return jr+"["+ur+"]"}),");",Ge(mr,function(ur){return rn+"["+ur+"]="+jr+"["+ur+"];"}).join("")),ce("if(",Ge(mr,function(ur){return jr+"["+ur+"]!=="+rn+"["+ur+"]"}).join("||"),"){",Nr,"}")}else jr=dt.def(Ne,".",St),rn=dt.def(nt,".",St),Nr(jr,");",nt,".",St,"=",jr,";"),ce("if(",jr,"!==",rn,"){",Nr,"}");Ve(Nr)}),Se.compile()}(),compile:Ni}}function Sd(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Yp=34918,Cd=34919,Th=35007,wd=function(N,me){if(!me.ext_disjoint_timer_query)return null;var Pe=[];function Mt(){return Pe.pop()||me.ext_disjoint_timer_query.createQueryEXT()}function sr(Sr){Pe.push(Sr)}var Rt=[];function er(Sr){var Ur=Mt();me.ext_disjoint_timer_query.beginQueryEXT(Th,Ur),Rt.push(Ur),vr(Rt.length-1,Rt.length,Sr)}function pr(){me.ext_disjoint_timer_query.endQueryEXT(Th)}function br(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var wr=[];function Mr(){return wr.pop()||new br}function Rr(Sr){wr.push(Sr)}var Hr=[];function vr(Sr,Ur,fr){var kr=Mr();kr.startQueryIndex=Sr,kr.endQueryIndex=Ur,kr.sum=0,kr.stats=fr,Hr.push(kr)}var Ar=[],at=[];function Gt(){var Sr,Ur,fr=Rt.length;if(fr!==0){at.length=Math.max(at.length,fr+1),Ar.length=Math.max(Ar.length,fr+1),Ar[0]=0,at[0]=0;var kr=0;for(Sr=0,Ur=0;Ur<Rt.length;++Ur){var en=Rt[Ur];me.ext_disjoint_timer_query.getQueryObjectEXT(en,Cd)?(kr+=me.ext_disjoint_timer_query.getQueryObjectEXT(en,Yp),sr(en)):Rt[Sr++]=en,Ar[Ur+1]=kr,at[Ur+1]=Sr}for(Rt.length=Sr,Sr=0,Ur=0;Ur<Hr.length;++Ur){var Fn=Hr[Ur],tr=Fn.startQueryIndex,ar=Fn.endQueryIndex;Fn.sum+=Ar[ar]-Ar[tr];var Sn=at[tr],Xr=at[ar];Xr===Sn?(Fn.stats.gpuTime+=Fn.sum/1e6,Rr(Fn)):(Fn.startQueryIndex=Sn,Fn.endQueryIndex=Xr,Hr[Sr++]=Fn)}Hr.length=Sr}}return{beginQuery:er,endQuery:pr,pushScopeStats:vr,update:Gt,getNumPendingQueries:function(){return Rt.length},clear:function(){Pe.push.apply(Pe,Rt);for(var Sr=0;Sr<Pe.length;Sr++)me.ext_disjoint_timer_query.deleteQueryEXT(Pe[Sr]);Rt.length=0,Pe.length=0},restore:function(){Rt.length=0,Pe.length=0}}},pv=16384,Hf=256,ip=1024,ap=34962,Wf="webglcontextlost",Oa="webglcontextrestored",Mh=1,kl=2,vf=3;function op(N,me){for(var Pe=0;Pe<N.length;++Pe)if(N[Pe]===me)return Pe;return-1}function qp(N){var me=ge(N);if(!me)return null;var Pe=me.gl,Mt=Pe.getContextAttributes(),sr=Pe.isContextLost(),Rt=Le(Pe,me);if(!Rt)return null;var er=ss(),pr=Sd(),br=Rt.extensions,wr=wd(Pe,br),Mr=$a(),Rr=Pe.drawingBufferWidth,Hr=Pe.drawingBufferHeight,vr={tick:0,time:0,viewportWidth:Rr,viewportHeight:Hr,framebufferWidth:Rr,framebufferHeight:Hr,drawingBufferWidth:Rr,drawingBufferHeight:Hr,pixelRatio:me.pixelRatio},Ar={},at={elements:null,primitive:4,count:-1,offset:0,instances:-1},Gt=_c(Pe,br),Sr=B(Pe,pr,me,kr),Ur=ju(Pe,br,Sr,pr),fr=bt(Pe,br,Gt,pr,Sr,Ur,at);function kr(ti){return fr.destroyBuffer(ti)}var en=Br(Pe,er,pr,me),Fn=cs(Pe,br,Gt,function(){Sn.procs.poll()},vr,pr,me),tr=Tl(Pe,br,Gt,pr,me),ar=ke(Pe,br,Gt,Fn,tr,pr),Sn=Xp(Pe,er,br,Gt,Sr,Ur,Fn,ar,Ar,fr,en,at,vr,wr,me),Xr=zn(Pe,ar,Sn.procs.poll,vr,Mt,br,Gt),Tr=Sn.next,Jr=Pe.canvas,Qr=[],mi=[],ri=[],Kr=[me.onDestroy],an=null;function Kn(){if(Qr.length===0){wr&&wr.update(),an=null;return}an=Ti.next(Kn),uo();for(var ti=Qr.length-1;ti>=0;--ti){var Bi=Qr[ti];Bi&&Bi(vr,null,0)}Pe.flush(),wr&&wr.update()}function ui(){!an&&Qr.length>0&&(an=Ti.next(Kn))}function Fi(){an&&(Ti.cancel(Kn),an=null)}function so(ti){ti.preventDefault(),sr=!0,Fi(),mi.forEach(function(Bi){Bi()})}function po(ti){Pe.getError(),sr=!1,Rt.restore(),en.restore(),Sr.restore(),Fn.restore(),tr.restore(),ar.restore(),fr.restore(),wr&&wr.restore(),Sn.procs.refresh(),ui(),ri.forEach(function(Bi){Bi()})}var ki=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!ki&&Jr&&(Jr.addEventListener(Wf,so,!1),Jr.addEventListener(Oa,po,!1));function ns(){Qr.length=0,Fi(),!ki&&Jr&&(Jr.removeEventListener(Wf,so),Jr.removeEventListener(Oa,po)),en.clear(),ar.clear(),tr.clear(),fr.clear(),Fn.clear(),Ur.clear(),Sr.clear(),wr&&wr.clear(),Kr.forEach(function(ti){ti()})}function qa(ti){ve(!!ti,"invalid args to regl({...})"),ve.type(ti,"object","invalid args to regl({...})");function Bi(Je){var Ne=v({},Je);delete Ne.uniforms,delete Ne.attributes,delete Ne.context,delete Ne.vao,"stencil"in Ne&&Ne.stencil.op&&(Ne.stencil.opBack=Ne.stencil.opFront=Ne.stencil.op,delete Ne.stencil.op);function nt(ye){if(ye in Ne){var Ze=Ne[ye];delete Ne[ye],Object.keys(Ze).forEach(function(we){Ne[ye+"."+we]=Ze[we]})}}return nt("blend"),nt("depth"),nt("cull"),nt("stencil"),nt("polygonOffset"),nt("scissor"),nt("sample"),"vao"in Je&&(Ne.vao=Je.vao),Ne}function la(Je,Ne){var nt={},ye={};return Object.keys(Je).forEach(function(Ze){var we=Je[Ze];if(nn.isDynamic(we)){ye[Ze]=nn.unbox(we,Ze);return}else if(Ne&&Array.isArray(we)){for(var ft=0;ft<we.length;++ft)if(nn.isDynamic(we[ft])){ye[Ze]=nn.unbox(we,Ze);return}}nt[Ze]=we}),{dynamic:ye,static:nt}}var Eo=la(ti.context||{},!0),gl=la(ti.uniforms||{},!0),Ie=la(ti.attributes||{},!1),Bt=la(Bi(ti),!1),Ct={gpuTime:0,cpuTime:0,count:0},vn=Sn.compile(Bt,Ie,gl,Eo,Ct),Ni=vn.draw,Se=vn.batch,ce=vn.scope,Ve=[];function dt(Je){for(;Ve.length<Je;)Ve.push(null);return Ve}function It(Je,Ne){var nt;if(sr&&ve.raise("context lost"),typeof Je=="function")return ce.call(this,null,Je,0);if(typeof Ne=="function")if(typeof Je=="number")for(nt=0;nt<Je;++nt)ce.call(this,null,Ne,nt);else if(Array.isArray(Je))for(nt=0;nt<Je.length;++nt)ce.call(this,Je[nt],Ne,nt);else return ce.call(this,Je,Ne,0);else if(typeof Je=="number"){if(Je>0)return Se.call(this,dt(Je|0),Je|0)}else if(Array.isArray(Je)){if(Je.length)return Se.call(this,Je,Je.length)}else return Ni.call(this,Je)}return v(It,{stats:Ct,destroy:function(){vn.destroy()}})}var $o=ar.setFBO=qa({framebuffer:nn.define.call(null,Mh,"framebuffer")});function Mo(ti,Bi){var la=0;Sn.procs.poll();var Eo=Bi.color;Eo&&(Pe.clearColor(+Eo[0]||0,+Eo[1]||0,+Eo[2]||0,+Eo[3]||0),la|=pv),"depth"in Bi&&(Pe.clearDepth(+Bi.depth),la|=Hf),"stencil"in Bi&&(Pe.clearStencil(Bi.stencil|0),la|=ip),ve(!!la,"called regl.clear with no buffer specified"),Pe.clear(la)}function Jo(ti){if(ve(typeof ti=="object"&&ti,"regl.clear() takes an object as input"),"framebuffer"in ti)if(ti.framebuffer&&ti.framebuffer_reglType==="framebufferCube")for(var Bi=0;Bi<6;++Bi)$o(v({framebuffer:ti.framebuffer.faces[Bi]},ti),Mo);else $o(ti,Mo);else Mo(null,ti)}function Uo(ti){ve.type(ti,"function","regl.frame() callback must be a function"),Qr.push(ti);function Bi(){var la=op(Qr,ti);ve(la>=0,"cannot cancel a frame twice");function Eo(){var gl=op(Qr,Eo);Qr[gl]=Qr[Qr.length-1],Qr.length-=1,Qr.length<=0&&Fi()}Qr[la]=Eo}return ui(),{cancel:Bi}}function ps(){var ti=Tr.viewport,Bi=Tr.scissor_box;ti[0]=ti[1]=Bi[0]=Bi[1]=0,vr.viewportWidth=vr.framebufferWidth=vr.drawingBufferWidth=ti[2]=Bi[2]=Pe.drawingBufferWidth,vr.viewportHeight=vr.framebufferHeight=vr.drawingBufferHeight=ti[3]=Bi[3]=Pe.drawingBufferHeight}function uo(){vr.tick+=1,vr.time=Zo(),ps(),Sn.procs.poll()}function gi(){Fn.refresh(),ps(),Sn.procs.refresh(),wr&&wr.update()}function Zo(){return($a()-Mr)/1e3}gi();function ra(ti,Bi){ve.type(Bi,"function","listener callback must be a function");var la;switch(ti){case"frame":return Uo(Bi);case"lost":la=mi;break;case"restore":la=ri;break;case"destroy":la=Kr;break;default:ve.raise("invalid event, must be one of frame,lost,restore,destroy")}return la.push(Bi),{cancel:function(){for(var Eo=0;Eo<la.length;++Eo)if(la[Eo]===Bi){la[Eo]=la[la.length-1],la.pop();return}}}}var jo=v(qa,{clear:Jo,prop:nn.define.bind(null,Mh),context:nn.define.bind(null,kl),this:nn.define.bind(null,vf),draw:qa({}),buffer:function(ti){return Sr.create(ti,ap,!1,!1)},elements:function(ti){return Ur.create(ti,!1)},texture:Fn.create2D,cube:Fn.createCube,renderbuffer:tr.create,framebuffer:ar.create,framebufferCube:ar.createCube,vao:fr.createVAO,attributes:Mt,frame:Uo,on:ra,limits:Gt,hasExtension:function(ti){return Gt.extensions.indexOf(ti.toLowerCase())>=0},read:Xr,destroy:ns,_gl:Pe,_refresh:gi,poll:function(){uo(),wr&&wr.update()},now:Zo,stats:pr});return me.onDone(null,jo),jo}return qp})},58380:function(Ue){function W(R,Y,$){switch($.length){case 0:return R.call(Y);case 1:return R.call(Y,$[0]);case 2:return R.call(Y,$[0],$[1]);case 3:return R.call(Y,$[0],$[1],$[2])}return R.apply(Y,$)}Ue.exports=W},77412:function(Ue){function W(R,Y){for(var $=-1,v=R==null?0:R.length;++$<v&&Y(R[$],$,R)!==!1;);return R}Ue.exports=W},47443:function(Ue,W,R){var Y=R(42118);function $(v,ee){var F=v==null?0:v.length;return!!F&&Y(v,ee,0)>-1}Ue.exports=$},1196:function(Ue){function W(R,Y,$){for(var v=-1,ee=R==null?0:R.length;++v<ee;)if($(Y,R[v]))return!0;return!1}Ue.exports=W},29932:function(Ue){function W(R,Y){for(var $=-1,v=R==null?0:R.length,ee=Array(v);++$<v;)ee[$]=Y(R[$],$,R);return ee}Ue.exports=W},62663:function(Ue){function W(R,Y,$,v){var ee=-1,F=R==null?0:R.length;for(v&&F&&($=R[++ee]);++ee<F;)$=Y($,R[ee],ee,R);return $}Ue.exports=W},49029:function(Ue){var W=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function R(Y){return Y.match(W)||[]}Ue.exports=R},86556:function(Ue,W,R){var Y=R(89465),$=R(77813);function v(ee,F,Q){(Q!==void 0&&!$(ee[F],Q)||Q===void 0&&!(F in ee))&&Y(ee,F,Q)}Ue.exports=v},34865:function(Ue,W,R){var Y=R(89465),$=R(77813),v=Object.prototype,ee=v.hasOwnProperty;function F(Q,re,Ee){var ne=Q[re];(!(ee.call(Q,re)&&$(ne,Ee))||Ee===void 0&&!(re in Q))&&Y(Q,re,Ee)}Ue.exports=F},44037:function(Ue,W,R){var Y=R(98363),$=R(3674);function v(ee,F){return ee&&Y(F,$(F),ee)}Ue.exports=v},63886:function(Ue,W,R){var Y=R(98363),$=R(81704);function v(ee,F){return ee&&Y(F,$(F),ee)}Ue.exports=v},89465:function(Ue,W,R){var Y=R(38777);function $(v,ee,F){ee=="__proto__"&&Y?Y(v,ee,{configurable:!0,enumerable:!0,value:F,writable:!0}):v[ee]=F}Ue.exports=$},29750:function(Ue){function W(R,Y,$){return R===R&&($!==void 0&&(R=R<=$?R:$),Y!==void 0&&(R=R>=Y?R:Y)),R}Ue.exports=W},85990:function(Ue,W,R){var Y=R(46384),$=R(77412),v=R(34865),ee=R(44037),F=R(63886),Q=R(64626),re=R(278),Ee=R(18805),ne=R(1911),je=R(58234),Ce=R(46904),et=R(64160),Pt=R(43824),nr=R(29148),xt=R(38517),Wt=R(1469),wt=R(44144),st=R(56688),ut=R(13218),Jt=R(72928),X=R(3674),Xt=R(81704),vt=1,qe=2,pt=4,$e="[object Arguments]",kt="[object Array]",xr="[object Boolean]",Ir="[object Date]",Wr="[object Error]",Me="[object Function]",Ye="[object GeneratorFunction]",Fe="[object Map]",At="[object Number]",gt="[object Object]",Nt="[object RegExp]",qt="[object Set]",Cr="[object String]",Wn="[object Symbol]",hn="[object WeakMap]",Yi="[object ArrayBuffer]",Un="[object DataView]",Gn="[object Float32Array]",di="[object Float64Array]",Xn="[object Int8Array]",ai="[object Int16Array]",aa="[object Int32Array]",Ri="[object Uint8Array]",Ei="[object Uint8ClampedArray]",ji="[object Uint16Array]",ua="[object Uint32Array]",Si={};Si[$e]=Si[kt]=Si[Yi]=Si[Un]=Si[xr]=Si[Ir]=Si[Gn]=Si[di]=Si[Xn]=Si[ai]=Si[aa]=Si[Fe]=Si[At]=Si[gt]=Si[Nt]=Si[qt]=Si[Cr]=Si[Wn]=Si[Ri]=Si[Ei]=Si[ji]=Si[ua]=!0,Si[Wr]=Si[Me]=Si[hn]=!1;function ba(Mn,_i,Ui,qi,Ga,ve){var Ln,Ha=_i&vt,os=_i&qe,Ut=_i&pt;if(Ui&&(Ln=Ga?Ui(Mn,qi,Ga,ve):Ui(Mn)),Ln!==void 0)return Ln;if(!ut(Mn))return Mn;var ir=Wt(Mn);if(ir){if(Ln=Pt(Mn),!Ha)return re(Mn,Ln)}else{var Pr=et(Mn),I=Pr==Me||Pr==Ye;if(wt(Mn))return Q(Mn,Ha);if(Pr==gt||Pr==$e||I&&!Ga){if(Ln=os||I?{}:xt(Mn),!Ha)return os?ne(Mn,F(Ln,Mn)):Ee(Mn,ee(Ln,Mn))}else{if(!Si[Pr])return Ga?Mn:{};Ln=nr(Mn,Pr,Ha)}}ve||(ve=new Y);var or=ve.get(Mn);if(or)return or;ve.set(Mn,Ln),Jt(Mn)?Mn.forEach(function(jn){Ln.add(ba(jn,_i,Ui,jn,Mn,ve))}):st(Mn)&&Mn.forEach(function(jn,nn){Ln.set(nn,ba(jn,_i,Ui,nn,Mn,ve))});var Rn=Ut?os?Ce:je:os?Xt:X,oi=ir?void 0:Rn(Mn);return $(oi||Mn,function(jn,nn){oi&&(nn=jn,jn=Mn[nn]),v(Ln,nn,ba(jn,_i,Ui,nn,Mn,ve))}),Ln}Ue.exports=ba},3118:function(Ue,W,R){var Y=R(13218),$=Object.create,v=function(){function ee(){}return function(F){if(!Y(F))return{};if($)return $(F);ee.prototype=F;var Q=new ee;return ee.prototype=void 0,Q}}();Ue.exports=v},41848:function(Ue){function W(R,Y,$,v){for(var ee=R.length,F=$+(v?1:-1);v?F--:++F<ee;)if(Y(R[F],F,R))return F;return-1}Ue.exports=W},28483:function(Ue,W,R){var Y=R(25063),$=Y();Ue.exports=$},42118:function(Ue,W,R){var Y=R(41848),$=R(62722),v=R(42351);function ee(F,Q,re){return Q===Q?v(F,Q,re):Y(F,$,re)}Ue.exports=ee},25588:function(Ue,W,R){var Y=R(64160),$=R(37005),v="[object Map]";function ee(F){return $(F)&&Y(F)==v}Ue.exports=ee},62722:function(Ue){function W(R){return R!==R}Ue.exports=W},29221:function(Ue,W,R){var Y=R(64160),$=R(37005),v="[object Set]";function ee(F){return $(F)&&Y(F)==v}Ue.exports=ee},10313:function(Ue,W,R){var Y=R(13218),$=R(25726),v=R(33498),ee=Object.prototype,F=ee.hasOwnProperty;function Q(re){if(!Y(re))return v(re);var Ee=$(re),ne=[];for(var je in re)je=="constructor"&&(Ee||!F.call(re,je))||ne.push(je);return ne}Ue.exports=Q},42980:function(Ue,W,R){var Y=R(46384),$=R(86556),v=R(28483),ee=R(59783),F=R(13218),Q=R(81704),re=R(36390);function Ee(ne,je,Ce,et,Pt){ne!==je&&v(je,function(nr,xt){if(Pt||(Pt=new Y),F(nr))ee(ne,je,xt,Ce,Ee,et,Pt);else{var Wt=et?et(re(ne,xt),nr,xt+"",ne,je,Pt):void 0;Wt===void 0&&(Wt=nr),$(ne,xt,Wt)}},Q)}Ue.exports=Ee},59783:function(Ue,W,R){var Y=R(86556),$=R(64626),v=R(77133),ee=R(278),F=R(38517),Q=R(35694),re=R(1469),Ee=R(29246),ne=R(44144),je=R(23560),Ce=R(13218),et=R(68630),Pt=R(36719),nr=R(36390),xt=R(59881);function Wt(wt,st,ut,Jt,X,Xt,vt){var qe=nr(wt,ut),pt=nr(st,ut),$e=vt.get(pt);if($e){Y(wt,ut,$e);return}var kt=Xt?Xt(qe,pt,ut+"",wt,st,vt):void 0,xr=kt===void 0;if(xr){var Ir=re(pt),Wr=!Ir&&ne(pt),Me=!Ir&&!Wr&&Pt(pt);kt=pt,Ir||Wr||Me?re(qe)?kt=qe:Ee(qe)?kt=ee(qe):Wr?(xr=!1,kt=$(pt,!0)):Me?(xr=!1,kt=v(pt,!0)):kt=[]:et(pt)||Q(pt)?(kt=qe,Q(qe)?kt=xt(qe):(!Ce(qe)||je(qe))&&(kt=F(pt))):xr=!1}xr&&(vt.set(pt,kt),X(kt,pt,Jt,Xt,vt),vt.delete(pt)),Y(wt,ut,kt)}Ue.exports=Wt},40371:function(Ue){function W(R){return function(Y){return Y==null?void 0:Y[R]}}Ue.exports=W},18674:function(Ue){function W(R){return function(Y){return R==null?void 0:R[Y]}}Ue.exports=W},5976:function(Ue,W,R){var Y=R(6557),$=R(45357),v=R(30061);function ee(F,Q){return v($(F,Q,Y),F+"")}Ue.exports=ee},56560:function(Ue,W,R){var Y=R(75703),$=R(38777),v=R(6557),ee=$?function(F,Q){return $(F,"toString",{configurable:!0,enumerable:!1,value:Y(Q),writable:!0})}:v;Ue.exports=ee},80531:function(Ue,W,R){var Y=R(62705),$=R(29932),v=R(1469),ee=R(33448),F=1/0,Q=Y?Y.prototype:void 0,re=Q?Q.toString:void 0;function Ee(ne){if(typeof ne=="string")return ne;if(v(ne))return $(ne,Ee)+"";if(ee(ne))return re?re.call(ne):"";var je=ne+"";return je=="0"&&1/ne==-F?"-0":je}Ue.exports=Ee},45652:function(Ue,W,R){var Y=R(88668),$=R(47443),v=R(1196),ee=R(74757),F=R(23593),Q=R(21814),re=200;function Ee(ne,je,Ce){var et=-1,Pt=$,nr=ne.length,xt=!0,Wt=[],wt=Wt;if(Ce)xt=!1,Pt=v;else if(nr>=re){var st=je?null:F(ne);if(st)return Q(st);xt=!1,Pt=ee,wt=new Y}else wt=je?[]:Wt;e:for(;++et<nr;){var ut=ne[et],Jt=je?je(ut):ut;if(ut=Ce||ut!==0?ut:0,xt&&Jt===Jt){for(var X=wt.length;X--;)if(wt[X]===Jt)continue e;je&&wt.push(Jt),Wt.push(ut)}else Pt(wt,Jt,Ce)||(wt!==Wt&&wt.push(Jt),Wt.push(ut))}return Wt}Ue.exports=Ee},74318:function(Ue,W,R){var Y=R(11149);function $(v){var ee=new v.constructor(v.byteLength);return new Y(ee).set(new Y(v)),ee}Ue.exports=$},64626:function(Ue,W,R){Ue=R.nmd(Ue);var Y=R(55639),$=W&&!W.nodeType&&W,v=$&&!0&&Ue&&!Ue.nodeType&&Ue,ee=v&&v.exports===$,F=ee?Y.Buffer:void 0,Q=F?F.allocUnsafe:void 0;function re(Ee,ne){if(ne)return Ee.slice();var je=Ee.length,Ce=Q?Q(je):new Ee.constructor(je);return Ee.copy(Ce),Ce}Ue.exports=re},57157:function(Ue,W,R){var Y=R(74318);function $(v,ee){var F=ee?Y(v.buffer):v.buffer;return new v.constructor(F,v.byteOffset,v.byteLength)}Ue.exports=$},93147:function(Ue){var W=/\w*$/;function R(Y){var $=new Y.constructor(Y.source,W.exec(Y));return $.lastIndex=Y.lastIndex,$}Ue.exports=R},40419:function(Ue,W,R){var Y=R(62705),$=Y?Y.prototype:void 0,v=$?$.valueOf:void 0;function ee(F){return v?Object(v.call(F)):{}}Ue.exports=ee},77133:function(Ue,W,R){var Y=R(74318);function $(v,ee){var F=ee?Y(v.buffer):v.buffer;return new v.constructor(F,v.byteOffset,v.length)}Ue.exports=$},278:function(Ue){function W(R,Y){var $=-1,v=R.length;for(Y||(Y=Array(v));++$<v;)Y[$]=R[$];return Y}Ue.exports=W},98363:function(Ue,W,R){var Y=R(34865),$=R(89465);function v(ee,F,Q,re){var Ee=!Q;Q||(Q={});for(var ne=-1,je=F.length;++ne<je;){var Ce=F[ne],et=re?re(Q[Ce],ee[Ce],Ce,Q,ee):void 0;et===void 0&&(et=ee[Ce]),Ee?$(Q,Ce,et):Y(Q,Ce,et)}return Q}Ue.exports=v},18805:function(Ue,W,R){var Y=R(98363),$=R(99551);function v(ee,F){return Y(ee,$(ee),F)}Ue.exports=v},1911:function(Ue,W,R){var Y=R(98363),$=R(51442);function v(ee,F){return Y(ee,$(ee),F)}Ue.exports=v},21463:function(Ue,W,R){var Y=R(5976),$=R(16612);function v(ee){return Y(function(F,Q){var re=-1,Ee=Q.length,ne=Ee>1?Q[Ee-1]:void 0,je=Ee>2?Q[2]:void 0;for(ne=ee.length>3&&typeof ne=="function"?(Ee--,ne):void 0,je&&$(Q[0],Q[1],je)&&(ne=Ee<3?void 0:ne,Ee=1),F=Object(F);++re<Ee;){var Ce=Q[re];Ce&&ee(F,Ce,re,ne)}return F})}Ue.exports=v},25063:function(Ue){function W(R){return function(Y,$,v){for(var ee=-1,F=Object(Y),Q=v(Y),re=Q.length;re--;){var Ee=Q[R?re:++ee];if($(F[Ee],Ee,F)===!1)break}return Y}}Ue.exports=W},98805:function(Ue,W,R){var Y=R(40180),$=R(62689),v=R(83140),ee=R(79833);function F(Q){return function(re){re=ee(re);var Ee=$(re)?v(re):void 0,ne=Ee?Ee[0]:re.charAt(0),je=Ee?Y(Ee,1).join(""):re.slice(1);return ne[Q]()+je}}Ue.exports=F},35393:function(Ue,W,R){var Y=R(62663),$=R(53816),v=R(58748),ee="['\u2019]",F=RegExp(ee,"g");function Q(re){return function(Ee){return Y(v($(Ee).replace(F,"")),re,"")}}Ue.exports=Q},23593:function(Ue,W,R){var Y=R(58525),$=R(50308),v=R(21814),ee=1/0,F=Y&&1/v(new Y([,-0]))[1]==ee?function(Q){return new Y(Q)}:$;Ue.exports=F},69389:function(Ue,W,R){var Y=R(18674),$={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},v=Y($);Ue.exports=v},38777:function(Ue,W,R){var Y=R(10852),$=function(){try{var v=Y(Object,"defineProperty");return v({},"",{}),v}catch(ee){}}();Ue.exports=$},46904:function(Ue,W,R){var Y=R(68866),$=R(51442),v=R(81704);function ee(F){return Y(F,v,$)}Ue.exports=ee},85924:function(Ue,W,R){var Y=R(5569),$=Y(Object.getPrototypeOf,Object);Ue.exports=$},51442:function(Ue,W,R){var Y=R(62488),$=R(85924),v=R(99551),ee=R(70479),F=Object.getOwnPropertySymbols,Q=F?function(re){for(var Ee=[];re;)Y(Ee,v(re)),re=$(re);return Ee}:ee;Ue.exports=Q},93157:function(Ue){var W=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function R(Y){return W.test(Y)}Ue.exports=R},43824:function(Ue){var W=Object.prototype,R=W.hasOwnProperty;function Y($){var v=$.length,ee=new $.constructor(v);return v&&typeof $[0]=="string"&&R.call($,"index")&&(ee.index=$.index,ee.input=$.input),ee}Ue.exports=Y},29148:function(Ue,W,R){var Y=R(74318),$=R(57157),v=R(93147),ee=R(40419),F=R(77133),Q="[object Boolean]",re="[object Date]",Ee="[object Map]",ne="[object Number]",je="[object RegExp]",Ce="[object Set]",et="[object String]",Pt="[object Symbol]",nr="[object ArrayBuffer]",xt="[object DataView]",Wt="[object Float32Array]",wt="[object Float64Array]",st="[object Int8Array]",ut="[object Int16Array]",Jt="[object Int32Array]",X="[object Uint8Array]",Xt="[object Uint8ClampedArray]",vt="[object Uint16Array]",qe="[object Uint32Array]";function pt($e,kt,xr){var Ir=$e.constructor;switch(kt){case nr:return Y($e);case Q:case re:return new Ir(+$e);case xt:return $($e,xr);case Wt:case wt:case st:case ut:case Jt:case X:case Xt:case vt:case qe:return F($e,xr);case Ee:return new Ir;case ne:case et:return new Ir($e);case je:return v($e);case Ce:return new Ir;case Pt:return ee($e)}}Ue.exports=pt},38517:function(Ue,W,R){var Y=R(3118),$=R(85924),v=R(25726);function ee(F){return typeof F.constructor=="function"&&!v(F)?Y($(F)):{}}Ue.exports=ee},16612:function(Ue,W,R){var Y=R(77813),$=R(98612),v=R(65776),ee=R(13218);function F(Q,re,Ee){if(!ee(Ee))return!1;var ne=typeof re;return(ne=="number"?$(Ee)&&v(re,Ee.length):ne=="string"&&re in Ee)?Y(Ee[re],Q):!1}Ue.exports=F},33498:function(Ue){function W(R){var Y=[];if(R!=null)for(var $ in Object(R))Y.push($);return Y}Ue.exports=W},45357:function(Ue,W,R){var Y=R(58380),$=Math.max;function v(ee,F,Q){return F=$(F===void 0?ee.length-1:F,0),function(){for(var re=arguments,Ee=-1,ne=$(re.length-F,0),je=Array(ne);++Ee<ne;)je[Ee]=re[F+Ee];Ee=-1;for(var Ce=Array(F+1);++Ee<F;)Ce[Ee]=re[Ee];return Ce[F]=Q(je),Y(ee,this,Ce)}}Ue.exports=v},36390:function(Ue){function W(R,Y){if(!(Y==="constructor"&&typeof R[Y]=="function")&&Y!="__proto__")return R[Y]}Ue.exports=W},30061:function(Ue,W,R){var Y=R(56560),$=R(21275),v=$(Y);Ue.exports=v},21275:function(Ue){var W=800,R=16,Y=Date.now;function $(v){var ee=0,F=0;return function(){var Q=Y(),re=R-(Q-F);if(F=Q,re>0){if(++ee>=W)return arguments[0]}else ee=0;return v.apply(void 0,arguments)}}Ue.exports=$},42351:function(Ue){function W(R,Y,$){for(var v=$-1,ee=R.length;++v<ee;)if(R[v]===Y)return v;return-1}Ue.exports=W},2757:function(Ue){var W="\\ud800-\\udfff",R="\\u0300-\\u036f",Y="\\ufe20-\\ufe2f",$="\\u20d0-\\u20ff",v=R+Y+$,ee="\\u2700-\\u27bf",F="a-z\\xdf-\\xf6\\xf8-\\xff",Q="\\xac\\xb1\\xd7\\xf7",re="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Ee="\\u2000-\\u206f",ne=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",je="A-Z\\xc0-\\xd6\\xd8-\\xde",Ce="\\ufe0e\\ufe0f",et=Q+re+Ee+ne,Pt="['\u2019]",nr="["+et+"]",xt="["+v+"]",Wt="\\d+",wt="["+ee+"]",st="["+F+"]",ut="[^"+W+et+Wt+ee+F+je+"]",Jt="\\ud83c[\\udffb-\\udfff]",X="(?:"+xt+"|"+Jt+")",Xt="[^"+W+"]",vt="(?:\\ud83c[\\udde6-\\uddff]){2}",qe="[\\ud800-\\udbff][\\udc00-\\udfff]",pt="["+je+"]",$e="\\u200d",kt="(?:"+st+"|"+ut+")",xr="(?:"+pt+"|"+ut+")",Ir="(?:"+Pt+"(?:d|ll|m|re|s|t|ve))?",Wr="(?:"+Pt+"(?:D|LL|M|RE|S|T|VE))?",Me=X+"?",Ye="["+Ce+"]?",Fe="(?:"+$e+"(?:"+[Xt,vt,qe].join("|")+")"+Ye+Me+")*",At="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",gt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Nt=Ye+Me+Fe,qt="(?:"+[wt,vt,qe].join("|")+")"+Nt,Cr=RegExp([pt+"?"+st+"+"+Ir+"(?="+[nr,pt,"$"].join("|")+")",xr+"+"+Wr+"(?="+[nr,pt+kt,"$"].join("|")+")",pt+"?"+kt+"+"+Ir,pt+"+"+Wr,gt,At,Wt,qt].join("|"),"g");function Wn(hn){return hn.match(Cr)||[]}Ue.exports=Wn},68929:function(Ue,W,R){var Y=R(48403),$=R(35393),v=$(function(ee,F,Q){return F=F.toLowerCase(),ee+(Q?Y(F):F)});Ue.exports=v},48403:function(Ue,W,R){var Y=R(79833),$=R(11700);function v(ee){return $(Y(ee).toLowerCase())}Ue.exports=v},74691:function(Ue,W,R){var Y=R(29750),$=R(14841);function v(ee,F,Q){return Q===void 0&&(Q=F,F=void 0),Q!==void 0&&(Q=$(Q),Q=Q===Q?Q:0),F!==void 0&&(F=$(F),F=F===F?F:0),Y($(ee),F,Q)}Ue.exports=v},50361:function(Ue,W,R){var Y=R(85990),$=1,v=4;function ee(F){return Y(F,$|v)}Ue.exports=ee},75703:function(Ue){function W(R){return function(){return R}}Ue.exports=W},53816:function(Ue,W,R){var Y=R(69389),$=R(79833),v=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ee="\\u0300-\\u036f",F="\\ufe20-\\ufe2f",Q="\\u20d0-\\u20ff",re=ee+F+Q,Ee="["+re+"]",ne=RegExp(Ee,"g");function je(Ce){return Ce=$(Ce),Ce&&Ce.replace(v,Y).replace(ne,"")}Ue.exports=je},6557:function(Ue){function W(R){return R}Ue.exports=W},29246:function(Ue,W,R){var Y=R(98612),$=R(37005);function v(ee){return $(ee)&&Y(ee)}Ue.exports=v},56688:function(Ue,W,R){var Y=R(25588),$=R(7518),v=R(31167),ee=v&&v.isMap,F=ee?$(ee):Y;Ue.exports=F},14293:function(Ue){function W(R){return R==null}Ue.exports=W},81763:function(Ue,W,R){var Y=R(44239),$=R(37005),v="[object Number]";function ee(F){return typeof F=="number"||$(F)&&Y(F)==v}Ue.exports=ee},68630:function(Ue,W,R){var Y=R(44239),$=R(85924),v=R(37005),ee="[object Object]",F=Function.prototype,Q=Object.prototype,re=F.toString,Ee=Q.hasOwnProperty,ne=re.call(Object);function je(Ce){if(!v(Ce)||Y(Ce)!=ee)return!1;var et=$(Ce);if(et===null)return!0;var Pt=Ee.call(et,"constructor")&&et.constructor;return typeof Pt=="function"&&Pt instanceof Pt&&re.call(Pt)==ne}Ue.exports=je},72928:function(Ue,W,R){var Y=R(29221),$=R(7518),v=R(31167),ee=v&&v.isSet,F=ee?$(ee):Y;Ue.exports=F},47037:function(Ue,W,R){var Y=R(44239),$=R(1469),v=R(37005),ee="[object String]";function F(Q){return typeof Q=="string"||!$(Q)&&v(Q)&&Y(Q)==ee}Ue.exports=F},81704:function(Ue,W,R){var Y=R(14636),$=R(10313),v=R(98612);function ee(F){return v(F)?Y(F,!0):$(F)}Ue.exports=ee},82492:function(Ue,W,R){var Y=R(42980),$=R(21463),v=$(function(ee,F,Q){Y(ee,F,Q)});Ue.exports=v},30236:function(Ue,W,R){var Y=R(42980),$=R(21463),v=$(function(ee,F,Q,re){Y(ee,F,Q,re)});Ue.exports=v},50308:function(Ue){function W(){}Ue.exports=W},59881:function(Ue,W,R){var Y=R(98363),$=R(81704);function v(ee){return Y(ee,$(ee))}Ue.exports=v},79833:function(Ue,W,R){var Y=R(80531);function $(v){return v==null?"":Y(v)}Ue.exports=$},44908:function(Ue,W,R){var Y=R(45652);function $(v){return v&&v.length?Y(v):[]}Ue.exports=$},11700:function(Ue,W,R){var Y=R(98805),$=Y("toUpperCase");Ue.exports=$},58748:function(Ue,W,R){var Y=R(49029),$=R(93157),v=R(79833),ee=R(2757);function F(Q,re,Ee){return Q=v(Q),re=Ee?void 0:re,re===void 0?$(Q)?ee(Q):Y(Q):Q.match(re)||[]}Ue.exports=F},6158:function(Ue){(function(W,R){Ue.exports=R()})(this,function(){"use strict";var W,R,Y;function $(v,ee){if(!W)W=ee;else if(!R)R=ee;else{var F="var sharedChunk = {}; ("+W+")(sharedChunk); ("+R+")(sharedChunk);",Q={};W(Q),Y=ee(Q),typeof window!="undefined"&&(Y.workerUrl=window.URL.createObjectURL(new Blob([F],{type:"text/javascript"})))}}return $(["exports"],function(v){"use strict";function ee(t,a){return t(a={exports:{}},a.exports),a.exports}var F=Q;function Q(t,a,u,h){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(h-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=h,this.p2x=u,this.p2y=h}Q.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},Q.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},Q.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},Q.prototype.solveCurveX=function(t,a){var u,h,m,x,S;for(a===void 0&&(a=1e-6),m=t,S=0;S<8;S++){if(x=this.sampleCurveX(m)-t,Math.abs(x)<a)return m;var M=this.sampleCurveDerivativeX(m);if(Math.abs(M)<1e-6)break;m-=x/M}if((m=t)<(u=0))return u;if(m>(h=1))return h;for(;u<h;){if(x=this.sampleCurveX(m),Math.abs(x-t)<a)return m;t>x?u=m:h=m,m=.5*(h-u)+u}return m},Q.prototype.solve=function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))};var re=Ee;function Ee(t,a){this.x=t,this.y=a}Ee.prototype={clone:function(){return new Ee(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,a){return this.clone()._rotateAround(t,a)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var a=t.x-this.x,u=t.y-this.y;return a*a+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,a){return Math.atan2(this.x*a-this.y*t,this.x*t+this.y*a)},_matMult:function(t){var a=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=a,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var a=Math.cos(t),u=Math.sin(t),h=u*this.x+a*this.y;return this.x=a*this.x-u*this.y,this.y=h,this},_rotateAround:function(t,a){var u=Math.cos(t),h=Math.sin(t),m=a.y+h*(this.x-a.x)+u*(this.y-a.y);return this.x=a.x+u*(this.x-a.x)-h*(this.y-a.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ee.convert=function(t){return t instanceof Ee?t:Array.isArray(t)?new Ee(t[0],t[1]):t};var ne=typeof self!="undefined"?self:{},je=Math.pow(2,53)-1;function Ce(t,a,u,h){var m=new F(t,a,u,h);return function(x){return m.solve(x)}}var et=Ce(.25,.1,.25,1);function Pt(t,a,u){return Math.min(u,Math.max(a,t))}function nr(t,a,u){var h=u-a,m=((t-a)%h+h)%h+a;return m===a?u:m}function xt(t){for(var a=[],u=arguments.length-1;u-- >0;)a[u]=arguments[u+1];for(var h=0,m=a;h<m.length;h+=1){var x=m[h];for(var S in x)t[S]=x[S]}return t}var Wt=1;function wt(){return Wt++}function st(){return function t(a){return a?(a^16*Math.random()>>a/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function ut(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Jt(t,a){t.forEach(function(u){a[u]&&(a[u]=a[u].bind(a))})}function X(t,a){return t.indexOf(a,t.length-a.length)!==-1}function Xt(t,a,u){var h={};for(var m in t)h[m]=a.call(u||this,t[m],m,t);return h}function vt(t,a,u){var h={};for(var m in t)a.call(u||this,t[m],m,t)&&(h[m]=t[m]);return h}function qe(t){return Array.isArray(t)?t.map(qe):typeof t=="object"&&t?Xt(t,qe):t}var pt={};function $e(t){pt[t]||(typeof console!="undefined"&&console.warn(t),pt[t]=!0)}function kt(t,a,u){return(u.y-t.y)*(a.x-t.x)>(a.y-t.y)*(u.x-t.x)}function xr(t){for(var a=0,u=0,h=t.length,m=h-1,x=void 0,S=void 0;u<h;m=u++)a+=((S=t[m]).x-(x=t[u]).x)*(x.y+S.y);return a}function Ir(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Wr(t){var a={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(h,m,x,S){var M=x||S;return a[m]=!M||M.toLowerCase(),""}),a["max-age"]){var u=parseInt(a["max-age"],10);isNaN(u)?delete a["max-age"]:a["max-age"]=u}return a}var Me=null;function Ye(t){if(Me==null){var a=t.navigator?t.navigator.userAgent:null;Me=!!t.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Me}function Fe(t){try{var a=ne[t];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch(u){return!1}}var At,gt,Nt,qt,Cr=ne.performance&&ne.performance.now?ne.performance.now.bind(ne.performance):Date.now.bind(Date),Wn=ne.requestAnimationFrame||ne.mozRequestAnimationFrame||ne.webkitRequestAnimationFrame||ne.msRequestAnimationFrame,hn=ne.cancelAnimationFrame||ne.mozCancelAnimationFrame||ne.webkitCancelAnimationFrame||ne.msCancelAnimationFrame,Yi={now:Cr,frame:function(t){var a=Wn(t);return{cancel:function(){return hn(a)}}},getImageData:function(t,a){a===void 0&&(a=0);var u=ne.document.createElement("canvas"),h=u.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return u.width=t.width,u.height=t.height,h.drawImage(t,0,0,t.width,t.height),h.getImageData(-a,-a,t.width+2*a,t.height+2*a)},resolveURL:function(t){return At||(At=ne.document.createElement("a")),At.href=t,At.href},hardwareConcurrency:ne.navigator&&ne.navigator.hardwareConcurrency||4,get devicePixelRatio(){return ne.devicePixelRatio},get prefersReducedMotion(){return!!ne.matchMedia&&(gt==null&&(gt=ne.matchMedia("(prefers-reduced-motion: reduce)")),gt.matches)}},Un={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Gn={supported:!1,testSupport:function(t){!di&&qt&&(Xn?ai(t):Nt=t)}},di=!1,Xn=!1;function ai(t){var a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,qt),t.isContextLost())return;Gn.supported=!0}catch(u){}t.deleteTexture(a),di=!0}ne.document&&((qt=ne.document.createElement("img")).onload=function(){Nt&&ai(Nt),Nt=null,Xn=!0},qt.onerror=function(){di=!0,Nt=null},qt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var aa="01",Ri=function(t,a){this._transformRequestFn=t,this._customAccessToken=a,this._createSkuToken()};function Ei(t){return t.indexOf("mapbox:")===0}Ri.prototype._createSkuToken=function(){var t=function(){for(var a="",u=0;u<10;u++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",aa,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Ri.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Ri.prototype.transformRequest=function(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}},Ri.prototype.normalizeStyleURL=function(t,a){if(!Ei(t))return t;var u=ba(t);return u.path="/styles/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||a)},Ri.prototype.normalizeGlyphsURL=function(t,a){if(!Ei(t))return t;var u=ba(t);return u.path="/fonts/v1"+u.path,this._makeAPIURL(u,this._customAccessToken||a)},Ri.prototype.normalizeSourceURL=function(t,a){if(!Ei(t))return t;var u=ba(t);return u.path="/v4/"+u.authority+".json",u.params.push("secure"),this._makeAPIURL(u,this._customAccessToken||a)},Ri.prototype.normalizeSpriteURL=function(t,a,u,h){var m=ba(t);return Ei(t)?(m.path="/styles/v1"+m.path+"/sprite"+a+u,this._makeAPIURL(m,this._customAccessToken||h)):(m.path+=""+a+u,Mn(m))},Ri.prototype.normalizeTileURL=function(t,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ei(t))return t;var u=ba(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,(Yi.devicePixelRatio>=2||a===512?"@2x":"")+(Gn.supported?".webp":"$1")),u.path=u.path.replace(/^.+\/v4\//,"/"),u.path="/v4"+u.path;var h=this._customAccessToken||function(m){for(var x=0,S=m;x<S.length;x+=1){var M=S[x].match(/^access_token=(.*)$/);if(M)return M[1]}return null}(u.params)||Un.ACCESS_TOKEN;return Un.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&u.params.push("sku="+this._skuToken),this._makeAPIURL(u,h)},Ri.prototype.canonicalizeTileURL=function(t,a){var u=ba(t);if(!u.path.match(/(^\/v4\/)/)||!u.path.match(/\.[\w]+$/))return t;var h="mapbox://tiles/";h+=u.path.replace("/v4/","");var m=u.params;return a&&(m=m.filter(function(x){return!x.match(/^access_token=/)})),m.length&&(h+="?"+m.join("&")),h},Ri.prototype.canonicalizeTileset=function(t,a){for(var u=!!a&&Ei(a),h=[],m=0,x=t.tiles||[];m<x.length;m+=1){var S=x[m];ua(S)?h.push(this.canonicalizeTileURL(S,u)):h.push(S)}return h},Ri.prototype._makeAPIURL=function(t,a){var u="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",h=ba(Un.API_URL);if(t.protocol=h.protocol,t.authority=h.authority,t.protocol==="http"){var m=t.params.indexOf("secure");m>=0&&t.params.splice(m,1)}if(h.path!=="/"&&(t.path=""+h.path+t.path),!Un.REQUIRE_ACCESS_TOKEN)return Mn(t);if(!(a=a||Un.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+u);if(a[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params=t.params.filter(function(x){return x.indexOf("access_token")===-1}),t.params.push("access_token="+a),Mn(t)};var ji=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function ua(t){return ji.test(t)}var Si=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ba(t){var a=t.match(Si);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function Mn(t){var a=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+a}function _i(t){if(!t)return null;var a=t.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(decodeURIComponent(ne.atob(a[1]).split("").map(function(u){return"%"+("00"+u.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(u){return null}}var Ui=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Ui.prototype.getStorageKey=function(t){var a,u=_i(Un.ACCESS_TOKEN);return a=u&&u.u?ne.btoa(encodeURIComponent(u.u).replace(/%([0-9A-F]{2})/g,function(h,m){return String.fromCharCode(Number("0x"+m))})):Un.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+a:"mapbox.eventData:"+a},Ui.prototype.fetchEventData=function(){var t=Fe("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{var h=ne.localStorage.getItem(a);h&&(this.eventData=JSON.parse(h));var m=ne.localStorage.getItem(u);m&&(this.anonId=m)}catch(x){$e("Unable to read from LocalStorage")}},Ui.prototype.saveEventData=function(){var t=Fe("localStorage"),a=this.getStorageKey(),u=this.getStorageKey("uuid");if(t)try{ne.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&ne.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(h){$e("Unable to write to LocalStorage")}},Ui.prototype.processRequests=function(t){},Ui.prototype.postEvent=function(t,a,u,h){var m=this;if(Un.EVENTS_URL){var x=ba(Un.EVENTS_URL);x.params.push("access_token="+(h||Un.ACCESS_TOKEN||""));var S={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:aa,userId:this.anonId},M=a?xt(S,a):S,k={url:Mn(x),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=Ca(k,function(U){m.pendingRequest=null,u(U),m.saveEventData(),m.processRequests(h)})}},Ui.prototype.queueRequest=function(t,a){this.queue.push(t),this.processRequests(a)};var qi,Ga,ve=function(t){function a(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postMapLoadEvent=function(u,h,m,x){this.skuToken=m,(Un.EVENTS_URL&&x||Un.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(S){return Ei(S)||ua(S)}))&&this.queueRequest({id:h,timestamp:Date.now()},x)},a.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){var m=this.queue.shift(),x=m.id,S=m.timestamp;x&&this.success[x]||(this.anonId||this.fetchEventData(),ut(this.anonId)||(this.anonId=st()),this.postEvent(S,{skuToken:this.skuToken},function(M){M||x&&(h.success[x]=!0)},u))}},a}(Ui),Ln=new(function(t){function a(u){t.call(this,"appUserTurnstile"),this._customAccessToken=u}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postTurnstileEvent=function(u,h){Un.EVENTS_URL&&Un.ACCESS_TOKEN&&Array.isArray(u)&&u.some(function(m){return Ei(m)||ua(m)})&&this.queueRequest(Date.now(),h)},a.prototype.processRequests=function(u){var h=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var m=_i(Un.ACCESS_TOKEN),x=m?m.u:Un.ACCESS_TOKEN,S=x!==this.eventData.tokenU;ut(this.anonId)||(this.anonId=st(),S=!0);var M=this.queue.shift();if(this.eventData.lastSuccess){var k=new Date(this.eventData.lastSuccess),U=new Date(M),j=(M-this.eventData.lastSuccess)/864e5;S=S||j>=1||j<-1||k.getDate()!==U.getDate()}else S=!0;if(!S)return this.processRequests();this.postEvent(M,{"enabled.telemetry":!1},function(H){H||(h.eventData.lastSuccess=M,h.eventData.tokenU=x)},u)}},a}(Ui)),Ha=Ln.postTurnstileEvent.bind(Ln),os=new ve,Ut=os.postMapLoadEvent.bind(os),ir=500,Pr=50;function I(){ne.caches&&!qi&&(qi=ne.caches.open("mapbox-tiles"))}function or(t){var a=t.indexOf("?");return a<0?t:t.slice(0,a)}var Rn,oi=1/0;function jn(){return Rn==null&&(Rn=ne.OffscreenCanvas&&new ne.OffscreenCanvas(1,1).getContext("2d")&&typeof ne.createImageBitmap=="function"),Rn}var nn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(nn);var Ti=function(t){function a(u,h,m){h===401&&ua(m)&&(u+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,u),this.status=h,this.url=m,this.name=this.constructor.name,this.message=u}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},a}(Error),Mi=Ir()?function(){return self.worker&&self.worker.referrer}:function(){return(ne.location.protocol==="blob:"?ne.parent:ne).location.href},$a,ss,ma=function(t,a){if(!(/^file:/.test(u=t.url)||/^file:/.test(Mi())&&!/^\w+:/.test(u))){if(ne.fetch&&ne.Request&&ne.AbortController&&ne.Request.prototype.hasOwnProperty("signal"))return function(h,m){var x,S=new ne.AbortController,M=new ne.Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Mi(),signal:S.signal}),k=!1,U=!1,j=(x=M.url).indexOf("sku=")>0&&ua(x);h.type==="json"&&M.headers.set("Accept","application/json");var H=function(ue,Te,Oe){if(!U){if(ue&&ue.message!=="SecurityError"&&$e(ue),Te&&Oe)return te(Te);var Ke=Date.now();ne.fetch(M).then(function(ze){if(ze.ok){var ot=j?ze.clone():null;return te(ze,ot,Ke)}return m(new Ti(ze.statusText,ze.status,h.url))}).catch(function(ze){ze.code!==20&&m(new Error(ze.message))})}},te=function(ue,Te,Oe){(h.type==="arrayBuffer"?ue.arrayBuffer():h.type==="json"?ue.json():ue.text()).then(function(Ke){U||(Te&&Oe&&function(ze,ot,Et){if(I(),qi){var Zt={status:ot.status,statusText:ot.statusText,headers:new ne.Headers};ot.headers.forEach(function(cr,Lr){return Zt.headers.set(Lr,cr)});var Ht=Wr(ot.headers.get("Cache-Control")||"");Ht["no-store"]||(Ht["max-age"]&&Zt.headers.set("Expires",new Date(Et+1e3*Ht["max-age"]).toUTCString()),new Date(Zt.headers.get("Expires")).getTime()-Et<42e4||function(cr,Lr){if(Ga===void 0)try{new Response(new ReadableStream),Ga=!0}catch(Vr){Ga=!1}Ga?Lr(cr.body):cr.blob().then(Lr)}(ot,function(cr){var Lr=new ne.Response(cr,Zt);I(),qi&&qi.then(function(Vr){return Vr.put(or(ze.url),Lr)}).catch(function(Vr){return $e(Vr.message)})}))}}(M,Te,Oe),k=!0,m(null,Ke,ue.headers.get("Cache-Control"),ue.headers.get("Expires")))}).catch(function(Ke){U||m(new Error(Ke.message))})};return j?function(ue,Te){if(I(),!qi)return Te(null);var Oe=or(ue.url);qi.then(function(Ke){Ke.match(Oe).then(function(ze){var ot=function(Et){if(!Et)return!1;var Zt=new Date(Et.headers.get("Expires")||0),Ht=Wr(Et.headers.get("Cache-Control")||"");return Zt>Date.now()&&!Ht["no-cache"]}(ze);Ke.delete(Oe),ot&&Ke.put(Oe,ze.clone()),Te(null,ze,ot)}).catch(Te)}).catch(Te)}(M,H):H(null,null),{cancel:function(){U=!0,k||S.abort()}}}(t,a);if(Ir()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,a,void 0,!0)}var u;return function(h,m){var x=new ne.XMLHttpRequest;for(var S in x.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(x.responseType="arraybuffer"),h.headers)x.setRequestHeader(S,h.headers[S]);return h.type==="json"&&(x.responseType="text",x.setRequestHeader("Accept","application/json")),x.withCredentials=h.credentials==="include",x.onerror=function(){m(new Error(x.statusText))},x.onload=function(){if((x.status>=200&&x.status<300||x.status===0)&&x.response!==null){var M=x.response;if(h.type==="json")try{M=JSON.parse(x.response)}catch(k){return m(k)}m(null,M,x.getResponseHeader("Cache-Control"),x.getResponseHeader("Expires"))}else m(new Ti(x.statusText,x.status,h.url))},x.send(h.body),{cancel:function(){return x.abort()}}}(t,a)},Ra=function(t,a){return ma(xt(t,{type:"arrayBuffer"}),a)},Ca=function(t,a){return ma(xt(t,{method:"POST"}),a)},G="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";$a=[],ss=0;var K=function(t,a){if(Gn.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ss>=Un.MAX_PARALLEL_IMAGE_REQUESTS){var u={requestParameters:t,callback:a,cancelled:!1,cancel:function(){this.cancelled=!0}};return $a.push(u),u}ss++;var h=!1,m=function(){if(!h)for(h=!0,ss--;$a.length&&ss<Un.MAX_PARALLEL_IMAGE_REQUESTS;){var S=$a.shift();S.cancelled||(S.cancel=K(S.requestParameters,S.callback).cancel)}},x=Ra(t,function(S,M,k,U){m(),S?a(S):M&&(jn()?function(j,H){var te=new ne.Blob([new Uint8Array(j)],{type:"image/png"});ne.createImageBitmap(te).then(function(ue){H(null,ue)}).catch(function(ue){H(new Error("Could not load image because of "+ue.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(M,a):function(j,H,te,ue){var Te=new ne.Image,Oe=ne.URL;Te.onload=function(){H(null,Te),Oe.revokeObjectURL(Te.src),Te.onload=null,ne.requestAnimationFrame(function(){Te.src=G})},Te.onerror=function(){return H(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var Ke=new ne.Blob([new Uint8Array(j)],{type:"image/png"});Te.cacheControl=te,Te.expires=ue,Te.src=j.byteLength?Oe.createObjectURL(Ke):G}(M,a,k,U))});return{cancel:function(){x.cancel(),m()}}};function se(t,a,u){u[t]&&u[t].indexOf(a)!==-1||(u[t]=u[t]||[],u[t].push(a))}function ge(t,a,u){if(u&&u[t]){var h=u[t].indexOf(a);h!==-1&&u[t].splice(h,1)}}var Le=function(t,a){a===void 0&&(a={}),xt(this,a),this.type=t},Ge=function(t){function a(u,h){h===void 0&&(h={}),t.call(this,"error",xt({error:u},h))}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Le),rt=function(){};rt.prototype.on=function(t,a){return this._listeners=this._listeners||{},se(t,a,this._listeners),this},rt.prototype.off=function(t,a){return ge(t,a,this._listeners),ge(t,a,this._oneTimeListeners),this},rt.prototype.once=function(t,a){return this._oneTimeListeners=this._oneTimeListeners||{},se(t,a,this._oneTimeListeners),this},rt.prototype.fire=function(t,a){typeof t=="string"&&(t=new Le(t,a||{}));var u=t.type;if(this.listens(u)){t.target=this;for(var h=0,m=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];h<m.length;h+=1)m[h].call(this,t);for(var x=0,S=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];x<S.length;x+=1){var M=S[x];ge(u,M,this._oneTimeListeners),M.call(this,t)}var k=this._eventedParent;k&&(xt(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),k.fire(t))}else t instanceof Ge&&console.error(t.error);return this},rt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},rt.prototype.setEventedParent=function(t,a){return this._eventedParent=t,this._eventedParentData=a,this};var pe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Be=function(t,a,u,h){this.message=(t?t+": ":"")+u,h&&(this.identifier=h),a!=null&&a.__line__&&(this.line=a.__line__)};function yt(t){var a=t.value;return a?[new Be(t.key,a,"constants have been deprecated as of v8")]:[]}function dr(t){for(var a=[],u=arguments.length-1;u-- >0;)a[u]=arguments[u+1];for(var h=0,m=a;h<m.length;h+=1){var x=m[h];for(var S in x)t[S]=x[S]}return t}function Dt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Ft(t){if(Array.isArray(t))return t.map(Ft);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var a={};for(var u in t)a[u]=Ft(t[u]);return a}return Dt(t)}var _r=function(t){function a(u,h){t.call(this,h),this.message=h,this.key=u}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Error),En=function(t,a){a===void 0&&(a=[]),this.parent=t,this.bindings={};for(var u=0,h=a;u<h.length;u+=1){var m=h[u];this.bindings[m[0]]=m[1]}};En.prototype.concat=function(t){return new En(this,t)},En.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},En.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var un={kind:"null"},Tt={kind:"number"},on={kind:"string"},Gr={kind:"boolean"},qr={kind:"color"},ni={kind:"object"},tn={kind:"value"},Ci={kind:"collator"},Ji={kind:"formatted"},yi={kind:"resolvedImage"};function Pi(t,a){return{kind:"array",itemType:t,N:a}}function xi(t){if(t.kind==="array"){var a=xi(t.itemType);return typeof t.N=="number"?"array<"+a+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+a+">"}return t.kind}var ei=[un,Tt,on,Gr,qr,Ji,ni,Pi(tn),yi];function Wi(t,a){if(a.kind==="error")return null;if(t.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Wi(t.itemType,a.itemType))&&(typeof t.N!="number"||t.N===a.N))return null}else{if(t.kind===a.kind)return null;if(t.kind==="value"){for(var u=0,h=ei;u<h.length;u+=1)if(!Wi(h[u],a))return null}}return"Expected "+xi(t)+" but found "+xi(a)+" instead."}function La(t,a){return a.some(function(u){return u.kind===t.kind})}function oa(t,a){return a.some(function(u){return u==="null"?t===null:u==="array"?Array.isArray(t):u==="object"?t&&!Array.isArray(t)&&typeof t=="object":u===typeof t})}var Ii=ee(function(t,a){var u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function h(M){return(M=Math.round(M))<0?0:M>255?255:M}function m(M){return h(M[M.length-1]==="%"?parseFloat(M)/100*255:parseInt(M))}function x(M){return(k=M[M.length-1]==="%"?parseFloat(M)/100:parseFloat(M))<0?0:k>1?1:k;var k}function S(M,k,U){return U<0?U+=1:U>1&&(U-=1),6*U<1?M+(k-M)*U*6:2*U<1?k:3*U<2?M+(k-M)*(2/3-U)*6:M}try{a.parseCSSColor=function(M){var k,U=M.replace(/ /g,"").toLowerCase();if(U in u)return u[U].slice();if(U[0]==="#")return U.length===4?(k=parseInt(U.substr(1),16))>=0&&k<=4095?[(3840&k)>>4|(3840&k)>>8,240&k|(240&k)>>4,15&k|(15&k)<<4,1]:null:U.length===7&&(k=parseInt(U.substr(1),16))>=0&&k<=16777215?[(16711680&k)>>16,(65280&k)>>8,255&k,1]:null;var j=U.indexOf("("),H=U.indexOf(")");if(j!==-1&&H+1===U.length){var te=U.substr(0,j),ue=U.substr(j+1,H-(j+1)).split(","),Te=1;switch(te){case"rgba":if(ue.length!==4)return null;Te=x(ue.pop());case"rgb":return ue.length!==3?null:[m(ue[0]),m(ue[1]),m(ue[2]),Te];case"hsla":if(ue.length!==4)return null;Te=x(ue.pop());case"hsl":if(ue.length!==3)return null;var Oe=(parseFloat(ue[0])%360+360)%360/360,Ke=x(ue[1]),ze=x(ue[2]),ot=ze<=.5?ze*(Ke+1):ze+Ke-ze*Ke,Et=2*ze-ot;return[h(255*S(Et,ot,Oe+1/3)),h(255*S(Et,ot,Oe)),h(255*S(Et,ot,Oe-1/3)),Te];default:return null}}return null}}catch(M){}}).parseCSSColor,Vi=function(t,a,u,h){h===void 0&&(h=1),this.r=t,this.g=a,this.b=u,this.a=h};Vi.parse=function(t){if(t){if(t instanceof Vi)return t;if(typeof t=="string"){var a=Ii(t);if(a)return new Vi(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3])}}},Vi.prototype.toString=function(){var t=this.toArray(),a=t[1],u=t[2],h=t[3];return"rgba("+Math.round(t[0])+","+Math.round(a)+","+Math.round(u)+","+h+")"},Vi.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Vi.black=new Vi(0,0,0,1),Vi.white=new Vi(1,1,1,1),Vi.transparent=new Vi(0,0,0,0),Vi.red=new Vi(1,0,0,1);var Na=function(t,a,u){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Na.prototype.compare=function(t,a){return this.collator.compare(t,a)},Na.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var tu=function(t,a,u,h,m){this.text=t,this.image=a,this.scale=u,this.fontStack=h,this.textColor=m},wa=function(t){this.sections=t};wa.fromString=function(t){return new wa([new tu(t,null,null,null,null)])},wa.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},wa.factory=function(t){return t instanceof wa?t:wa.fromString(t)},wa.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},wa.prototype.serialize=function(){for(var t=["format"],a=0,u=this.sections;a<u.length;a+=1){var h=u[a];if(h.image)t.push(["image",h.image.name]);else{t.push(h.text);var m={};h.fontStack&&(m["text-font"]=["literal",h.fontStack.split(",")]),h.scale&&(m["font-scale"]=h.scale),h.textColor&&(m["text-color"]=["rgba"].concat(h.textColor.toArray())),t.push(m)}}return t};var Aa=function(t){this.name=t.name,this.available=t.available};function ms(t,a,u,h){return typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:"Invalid rgba value ["+[t,a,u,h].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof h=="number"?[t,a,u,h]:[t,a,u]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function us(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Vi||t instanceof Na||t instanceof wa||t instanceof Aa)return!0;if(Array.isArray(t)){for(var a=0,u=t;a<u.length;a+=1)if(!us(u[a]))return!1;return!0}if(typeof t=="object"){for(var h in t)if(!us(t[h]))return!1;return!0}return!1}function ta(t){if(t===null)return un;if(typeof t=="string")return on;if(typeof t=="boolean")return Gr;if(typeof t=="number")return Tt;if(t instanceof Vi)return qr;if(t instanceof Na)return Ci;if(t instanceof wa)return Ji;if(t instanceof Aa)return yi;if(Array.isArray(t)){for(var a,u=t.length,h=0,m=t;h<m.length;h+=1){var x=ta(m[h]);if(a){if(a===x)continue;a=tn;break}a=x}return Pi(a||tn,u)}return ni}function Bu(t){var a=typeof t;return t===null?"":a==="string"||a==="number"||a==="boolean"?String(t):t instanceof Vi||t instanceof wa||t instanceof Aa?t.toString():JSON.stringify(t)}Aa.prototype.toString=function(){return this.name},Aa.fromString=function(t){return t?new Aa({name:t,available:!1}):null},Aa.prototype.serialize=function(){return["image",this.name]};var mo=function(t,a){this.type=t,this.value=a};mo.parse=function(t,a){if(t.length!==2)return a.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!us(t[1]))return a.error("invalid value");var u=t[1],h=ta(u),m=a.expectedType;return h.kind!=="array"||h.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(h=m),new mo(h,u)},mo.prototype.evaluate=function(){return this.value},mo.prototype.eachChild=function(){},mo.prototype.outputDefined=function(){return!0},mo.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Vi?["rgba"].concat(this.value.toArray()):this.value instanceof wa?this.value.serialize():this.value};var za=function(t){this.name="ExpressionEvaluationError",this.message=t};za.prototype.toJSON=function(){return this.message};var ro={string:on,number:Tt,boolean:Gr,object:ni},Ki=function(t,a){this.type=t,this.args=a};Ki.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var u,h=1,m=t[0];if(m==="array"){var x,S;if(t.length>2){var M=t[1];if(typeof M!="string"||!(M in ro)||M==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);x=ro[M],h++}else x=tn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);S=t[2],h++}u=Pi(x,S)}else u=ro[m];for(var k=[];h<t.length;h++){var U=a.parse(t[h],h,tn);if(!U)return null;k.push(U)}return new Ki(u,k)},Ki.prototype.evaluate=function(t){for(var a=0;a<this.args.length;a++){var u=this.args[a].evaluate(t);if(!Wi(this.type,ta(u)))return u;if(a===this.args.length-1)throw new za("Expected value to be of type "+xi(this.type)+", but found "+xi(ta(u))+" instead.")}return null},Ki.prototype.eachChild=function(t){this.args.forEach(t)},Ki.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Ki.prototype.serialize=function(){var t=this.type,a=[t.kind];if(t.kind==="array"){var u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){a.push(u.kind);var h=t.N;(typeof h=="number"||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(function(m){return m.serialize()}))};var Ho=function(t){this.type=Ji,this.sections=t};Ho.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var u=t[1];if(!Array.isArray(u)&&typeof u=="object")return a.error("First argument must be an image or text section.");for(var h=[],m=!1,x=1;x<=t.length-1;++x){var S=t[x];if(m&&typeof S=="object"&&!Array.isArray(S)){m=!1;var M=null;if(S["font-scale"]&&!(M=a.parse(S["font-scale"],1,Tt)))return null;var k=null;if(S["text-font"]&&!(k=a.parse(S["text-font"],1,Pi(on))))return null;var U=null;if(S["text-color"]&&!(U=a.parse(S["text-color"],1,qr)))return null;var j=h[h.length-1];j.scale=M,j.font=k,j.textColor=U}else{var H=a.parse(t[x],1,tn);if(!H)return null;var te=H.type.kind;if(te!=="string"&&te!=="value"&&te!=="null"&&te!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:H,scale:null,font:null,textColor:null})}}return new Ho(h)},Ho.prototype.evaluate=function(t){return new wa(this.sections.map(function(a){var u=a.content.evaluate(t);return ta(u)===yi?new tu("",u,null,null,null):new tu(Bu(u),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))},Ho.prototype.eachChild=function(t){for(var a=0,u=this.sections;a<u.length;a+=1){var h=u[a];t(h.content),h.scale&&t(h.scale),h.font&&t(h.font),h.textColor&&t(h.textColor)}},Ho.prototype.outputDefined=function(){return!1},Ho.prototype.serialize=function(){for(var t=["format"],a=0,u=this.sections;a<u.length;a+=1){var h=u[a];t.push(h.content.serialize());var m={};h.scale&&(m["font-scale"]=h.scale.serialize()),h.font&&(m["text-font"]=h.font.serialize()),h.textColor&&(m["text-color"]=h.textColor.serialize()),t.push(m)}return t};var Wo=function(t){this.type=yi,this.input=t};Wo.parse=function(t,a){if(t.length!==2)return a.error("Expected two arguments.");var u=a.parse(t[1],1,on);return u?new Wo(u):a.error("No image name provided.")},Wo.prototype.evaluate=function(t){var a=this.input.evaluate(t),u=Aa.fromString(a);return u&&t.availableImages&&(u.available=t.availableImages.indexOf(a)>-1),u},Wo.prototype.eachChild=function(t){t(this.input)},Wo.prototype.outputDefined=function(){return!1},Wo.prototype.serialize=function(){return["image",this.input.serialize()]};var Nu={"to-boolean":Gr,"to-color":qr,"to-number":Tt,"to-string":on},Co=function(t,a){this.type=t,this.args=a};Co.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var u=t[0];if((u==="to-boolean"||u==="to-string")&&t.length!==2)return a.error("Expected one argument.");for(var h=Nu[u],m=[],x=1;x<t.length;x++){var S=a.parse(t[x],x,tn);if(!S)return null;m.push(S)}return new Co(h,m)},Co.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var a,u,h=0,m=this.args;h<m.length;h+=1){if(u=null,(a=m[h].evaluate(t))instanceof Vi)return a;if(typeof a=="string"){var x=t.parseColor(a);if(x)return x}else if(Array.isArray(a)&&!(u=a.length<3||a.length>4?"Invalid rbga value "+JSON.stringify(a)+": expected an array containing either three or four numeric values.":ms(a[0],a[1],a[2],a[3])))return new Vi(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new za(u||"Could not parse color from value '"+(typeof a=="string"?a:String(JSON.stringify(a)))+"'")}if(this.type.kind==="number"){for(var S=null,M=0,k=this.args;M<k.length;M+=1){if((S=k[M].evaluate(t))===null)return 0;var U=Number(S);if(!isNaN(U))return U}throw new za("Could not convert "+JSON.stringify(S)+" to number.")}return this.type.kind==="formatted"?wa.fromString(Bu(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Aa.fromString(Bu(this.args[0].evaluate(t))):Bu(this.args[0].evaluate(t))},Co.prototype.eachChild=function(t){this.args.forEach(t)},Co.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Co.prototype.serialize=function(){if(this.type.kind==="formatted")return new Ho([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Wo(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(a){t.push(a.serialize())}),t};var Xo=["Unknown","Point","LineString","Polygon"],ga=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ga.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ga.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Xo[this.feature.type]:this.feature.type:null},ga.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ga.prototype.canonicalID=function(){return this.canonical},ga.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ga.prototype.parseColor=function(t){var a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=Vi.parse(t)),a};var go=function(t,a,u,h){this.name=t,this.type=a,this._evaluate=u,this.args=h};go.prototype.evaluate=function(t){return this._evaluate(t,this.args)},go.prototype.eachChild=function(t){this.args.forEach(t)},go.prototype.outputDefined=function(){return!1},go.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},go.parse=function(t,a){var u,h=t[0],m=go.definitions[h];if(!m)return a.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0);for(var x=Array.isArray(m)?m[0]:m.type,S=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,M=S.filter(function(Nn){var pn=Nn[0];return!Array.isArray(pn)||pn.length===t.length-1}),k=null,U=0,j=M;U<j.length;U+=1){var H=j[U],te=H[0],ue=H[1];k=new Vs(a.registry,a.path,null,a.scope);for(var Te=[],Oe=!1,Ke=1;Ke<t.length;Ke++){var ze=t[Ke],ot=Array.isArray(te)?te[Ke-1]:te.type,Et=k.parse(ze,1+Te.length,ot);if(!Et){Oe=!0;break}Te.push(Et)}if(!Oe)if(Array.isArray(te)&&te.length!==Te.length)k.error("Expected "+te.length+" arguments, but found "+Te.length+" instead.");else{for(var Zt=0;Zt<Te.length;Zt++){var Ht=Array.isArray(te)?te[Zt]:te.type,cr=Te[Zt];k.concat(Zt+1).checkSubtype(Ht,cr.type)}if(k.errors.length===0)return new go(h,x,ue,Te)}}if(M.length===1)(u=a.errors).push.apply(u,k.errors);else{for(var Lr=(M.length?M:S).map(function(Nn){var pn;return pn=Nn[0],Array.isArray(pn)?"("+pn.map(xi).join(", ")+")":"("+xi(pn.type)+"...)"}).join(" | "),Vr=[],gn=1;gn<t.length;gn++){var cn=a.parse(t[gn],1+Vr.length);if(!cn)return null;Vr.push(xi(cn.type))}a.error("Expected arguments of type "+Lr+", but found ("+Vr.join(", ")+") instead.")}return null},go.register=function(t,a){for(var u in go.definitions=a,a)t[u]=go};var Yo=function(t,a,u){this.type=Ci,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=a};function no(t,a){t[0]=Math.min(t[0],a[0]),t[1]=Math.min(t[1],a[1]),t[2]=Math.max(t[2],a[0]),t[3]=Math.max(t[3],a[1])}function ru(t,a){return!(t[0]<=a[0]||t[2]>=a[2]||t[1]<=a[1]||t[3]>=a[3])}function _c(t,a){var u=(180+t[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,m=Math.pow(2,a.z);return[Math.round(u*m*8192),Math.round(h*m*8192)]}function Os(t,a,u){return a[1]>t[1]!=u[1]>t[1]&&t[0]<(u[0]-a[0])*(t[1]-a[1])/(u[1]-a[1])+a[0]}function ie(t,a){for(var u,h,m,x,S,M,k,U=!1,j=0,H=a.length;j<H;j++)for(var te=a[j],ue=0,Te=te.length;ue<Te-1;ue++){if((x=(u=t)[0]-(h=te[ue])[0])*(k=u[1]-(m=te[ue+1])[1])-(M=u[0]-m[0])*(S=u[1]-h[1])==0&&x*M<=0&&S*k<=0)return!1;Os(t,te[ue],te[ue+1])&&(U=!U)}return U}function be(t,a){for(var u=0;u<a.length;u++)if(ie(t,a[u]))return!0;return!1}function Qe(t,a,u,h){var m=h[0]-u[0],x=h[1]-u[1],S=(t[0]-u[0])*x-m*(t[1]-u[1]),M=(a[0]-u[0])*x-m*(a[1]-u[1]);return S>0&&M<0||S<0&&M>0}function Ot(t,a,u){for(var h=0,m=u;h<m.length;h+=1)for(var x=m[h],S=0;S<x.length-1;++S)if((H=[(j=x[S+1])[0]-(U=x[S])[0],j[1]-U[1]])[0]*(te=[(k=a)[0]-(M=t)[0],k[1]-M[1]])[1]-H[1]*te[0]!=0&&Qe(M,k,U,j)&&Qe(U,j,M,k))return!0;var M,k,U,j,H,te;return!1}function Dr(t,a){for(var u=0;u<t.length;++u)if(!ie(t[u],a))return!1;for(var h=0;h<t.length-1;++h)if(Ot(t[h],t[h+1],a))return!1;return!0}function lt(t,a){for(var u=0;u<a.length;u++)if(Dr(t,a[u]))return!0;return!1}function Lt(t,a,u){for(var h=[],m=0;m<t.length;m++){for(var x=[],S=0;S<t[m].length;S++){var M=_c(t[m][S],u);no(a,M),x.push(M)}h.push(x)}return h}function io(t,a,u){for(var h=[],m=0;m<t.length;m++){var x=Lt(t[m],a,u);h.push(x)}return h}function $i(t,a,u,h){if(t[0]<u[0]||t[0]>u[2]){var m=.5*h,x=t[0]-u[0]>m?-h:u[0]-t[0]>m?h:0;x===0&&(x=t[0]-u[2]>m?-h:u[2]-t[0]>m?h:0),t[0]+=x}no(a,t)}function Wa(t,a,u,h){for(var m=8192*Math.pow(2,h.z),x=[8192*h.x,8192*h.y],S=[],M=0,k=t;M<k.length;M+=1)for(var U=0,j=k[M];U<j.length;U+=1){var H=j[U],te=[H.x+x[0],H.y+x[1]];$i(te,a,u,m),S.push(te)}return S}function qo(t,a,u,h){for(var m,x=8192*Math.pow(2,h.z),S=[8192*h.x,8192*h.y],M=[],k=0,U=t;k<U.length;k+=1){for(var j=[],H=0,te=U[k];H<te.length;H+=1){var ue=te[H],Te=[ue.x+S[0],ue.y+S[1]];no(a,Te),j.push(Te)}M.push(j)}if(a[2]-a[0]<=x/2){(m=a)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(var Oe=0,Ke=M;Oe<Ke.length;Oe+=1)for(var ze=0,ot=Ke[Oe];ze<ot.length;ze+=1)$i(ot[ze],a,u,x)}return M}Yo.parse=function(t,a){if(t.length!==2)return a.error("Expected one argument.");var u=t[1];if(typeof u!="object"||Array.isArray(u))return a.error("Collator options argument must be an object.");var h=a.parse(u["case-sensitive"]!==void 0&&u["case-sensitive"],1,Gr);if(!h)return null;var m=a.parse(u["diacritic-sensitive"]!==void 0&&u["diacritic-sensitive"],1,Gr);if(!m)return null;var x=null;return u.locale&&!(x=a.parse(u.locale,1,on))?null:new Yo(h,m,x)},Yo.prototype.evaluate=function(t){return new Na(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Yo.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Yo.prototype.outputDefined=function(){return!1},Yo.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var xn=function(t,a){this.type=Gr,this.geojson=t,this.geometries=a};function dn(t){if(t instanceof go&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof xn)return!1;var a=!0;return t.eachChild(function(u){a&&!dn(u)&&(a=!1)}),a}function Kt(t){if(t instanceof go&&t.name==="feature-state")return!1;var a=!0;return t.eachChild(function(u){a&&!Kt(u)&&(a=!1)}),a}function Bo(t,a){if(t instanceof go&&a.indexOf(t.name)>=0)return!1;var u=!0;return t.eachChild(function(h){u&&!Bo(h,a)&&(u=!1)}),u}xn.parse=function(t,a){if(t.length!==2)return a.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(us(t[1])){var u=t[1];if(u.type==="FeatureCollection")for(var h=0;h<u.features.length;++h){var m=u.features[h].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new xn(u,u.features[h].geometry)}else if(u.type==="Feature"){var x=u.geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new xn(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new xn(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")},xn.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,u){var h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(u.type==="Polygon"){var S=Lt(u.coordinates,m,x),M=Wa(a.geometry(),h,m,x);if(!ru(h,m))return!1;for(var k=0,U=M;k<U.length;k+=1)if(!ie(U[k],S))return!1}if(u.type==="MultiPolygon"){var j=io(u.coordinates,m,x),H=Wa(a.geometry(),h,m,x);if(!ru(h,m))return!1;for(var te=0,ue=H;te<ue.length;te+=1)if(!be(ue[te],j))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,u){var h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(u.type==="Polygon"){var S=Lt(u.coordinates,m,x),M=qo(a.geometry(),h,m,x);if(!ru(h,m))return!1;for(var k=0,U=M;k<U.length;k+=1)if(!Dr(U[k],S))return!1}if(u.type==="MultiPolygon"){var j=io(u.coordinates,m,x),H=qo(a.geometry(),h,m,x);if(!ru(h,m))return!1;for(var te=0,ue=H;te<ue.length;te+=1)if(!lt(ue[te],j))return!1}return!0}(t,this.geometries)}return!1},xn.prototype.eachChild=function(){},xn.prototype.outputDefined=function(){return!0},xn.prototype.serialize=function(){return["within",this.geojson]};var xe=function(t,a){this.type=a.type,this.name=t,this.boundExpression=a};xe.parse=function(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");var u=t[1];return a.scope.has(u)?new xe(u,a.scope.get(u)):a.error('Unknown variable "'+u+'". Make sure "'+u+'" has been bound in an enclosing "let" expression before using it.',1)},xe.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},xe.prototype.eachChild=function(){},xe.prototype.outputDefined=function(){return!1},xe.prototype.serialize=function(){return["var",this.name]};var Vs=function(t,a,u,h,m){a===void 0&&(a=[]),h===void 0&&(h=new En),m===void 0&&(m=[]),this.registry=t,this.path=a,this.key=a.map(function(x){return"["+x+"]"}).join(""),this.scope=h,this.errors=m,this.expectedType=u};function nu(t,a){for(var u,h=t.length-1,m=0,x=h,S=0;m<=x;)if((u=t[S=Math.floor((m+x)/2)])<=a){if(S===h||a<t[S+1])return S;m=S+1}else{if(!(u>a))throw new za("Input is not a number.");x=S-1}return 0}Vs.prototype.parse=function(t,a,u,h,m){return m===void 0&&(m={}),a?this.concat(a,u,h)._parse(t,m):this._parse(t,m)},Vs.prototype._parse=function(t,a){function u(U,j,H){return H==="assert"?new Ki(j,[U]):H==="coerce"?new Co(j,[U]):U}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var h=t[0];if(typeof h!="string")return this.error("Expression name must be a string, but found "+typeof h+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var m=this.registry[h];if(m){var x=m.parse(t,this);if(!x)return null;if(this.expectedType){var S=this.expectedType,M=x.type;if(S.kind!=="string"&&S.kind!=="number"&&S.kind!=="boolean"&&S.kind!=="object"&&S.kind!=="array"||M.kind!=="value")if(S.kind!=="color"&&S.kind!=="formatted"&&S.kind!=="resolvedImage"||M.kind!=="value"&&M.kind!=="string"){if(this.checkSubtype(S,M))return null}else x=u(x,S,a.typeAnnotation||"coerce");else x=u(x,S,a.typeAnnotation||"assert")}if(!(x instanceof mo)&&x.type.kind!=="resolvedImage"&&function U(j){if(j instanceof xe)return U(j.boundExpression);if(j instanceof go&&j.name==="error"||j instanceof Yo||j instanceof xn)return!1;var H=j instanceof Co||j instanceof Ki,te=!0;return j.eachChild(function(ue){te=H?te&&U(ue):te&&ue instanceof mo}),!!te&&dn(j)&&Bo(j,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(x)){var k=new ga;try{x=new mo(x.type,x.evaluate(k))}catch(U){return this.error(U.message),null}}return x}return this.error('Unknown expression "'+h+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},Vs.prototype.concat=function(t,a,u){var h=typeof t=="number"?this.path.concat(t):this.path,m=u?this.scope.concat(u):this.scope;return new Vs(this.registry,h,a||null,m,this.errors)},Vs.prototype.error=function(t){for(var a=[],u=arguments.length-1;u-- >0;)a[u]=arguments[u+1];var h=""+this.key+a.map(function(m){return"["+m+"]"}).join("");this.errors.push(new _r(h,t))},Vs.prototype.checkSubtype=function(t,a){var u=Wi(t,a);return u&&this.error(u),u};var ls=function(t,a,u){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(var h=0,m=u;h<m.length;h+=1){var x=m[h],S=x[1];this.labels.push(x[0]),this.outputs.push(S)}};function sa(t,a,u){return t*(1-u)+a*u}ls.parse=function(t,a){if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");var u=a.parse(t[1],1,Tt);if(!u)return null;var h=[],m=null;a.expectedType&&a.expectedType.kind!=="value"&&(m=a.expectedType);for(var x=1;x<t.length;x+=2){var S=x===1?-1/0:t[x],M=t[x+1],k=x,U=x+1;if(typeof S!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(h.length&&h[h.length-1][0]>=S)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',k);var j=a.parse(M,U,m);if(!j)return null;m=m||j.type,h.push([S,j])}return new ls(m,u,h)},ls.prototype.evaluate=function(t){var a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return u[0].evaluate(t);var m=a.length;return h>=a[m-1]?u[m-1].evaluate(t):u[nu(a,h)].evaluate(t)},ls.prototype.eachChild=function(t){t(this.input);for(var a=0,u=this.outputs;a<u.length;a+=1)t(u[a])},ls.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},ls.prototype.serialize=function(){for(var t=["step",this.input.serialize()],a=0;a<this.labels.length;a++)a>0&&t.push(this.labels[a]),t.push(this.outputs[a].serialize());return t};var yo=Object.freeze({__proto__:null,number:sa,color:function(t,a,u){return new Vi(sa(t.r,a.r,u),sa(t.g,a.g,u),sa(t.b,a.b,u),sa(t.a,a.a,u))},array:function(t,a,u){return t.map(function(h,m){return sa(h,a[m],u)})}}),Wl=6/29*3*(6/29),xc=Math.PI/180,zu=180/Math.PI;function bc(t){return t>.008856451679035631?Math.pow(t,1/3):t/Wl+4/29}function El(t){return t>6/29?t*t*t:Wl*(t-4/29)}function Uu(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function iu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Zu(t){var a=iu(t.r),u=iu(t.g),h=iu(t.b),m=bc((.4124564*a+.3575761*u+.1804375*h)/.95047),x=bc((.2126729*a+.7151522*u+.072175*h)/1);return{l:116*x-16,a:500*(m-x),b:200*(x-bc((.0193339*a+.119192*u+.9503041*h)/1.08883)),alpha:t.a}}function g(t){var a=(t.l+16)/116,u=isNaN(t.a)?a:a+t.a/500,h=isNaN(t.b)?a:a-t.b/200;return a=1*El(a),u=.95047*El(u),h=1.08883*El(h),new Vi(Uu(3.2404542*u-1.5371385*a-.4985314*h),Uu(-.969266*u+1.8760108*a+.041556*h),Uu(.0556434*u-.2040259*a+1.0572252*h),t.alpha)}function w(t,a,u){var h=a-t;return t+u*(h>180||h<-180?h-360*Math.round(h/360):h)}var B={forward:Zu,reverse:g,interpolate:function(t,a,u){return{l:sa(t.l,a.l,u),a:sa(t.a,a.a,u),b:sa(t.b,a.b,u),alpha:sa(t.alpha,a.alpha,u)}}},O={forward:function(t){var a=Zu(t),u=a.l,h=a.a,m=a.b,x=Math.atan2(m,h)*zu;return{h:x<0?x+360:x,c:Math.sqrt(h*h+m*m),l:u,alpha:t.a}},reverse:function(t){var a=t.h*xc,u=t.c;return g({l:t.l,a:Math.cos(a)*u,b:Math.sin(a)*u,alpha:t.alpha})},interpolate:function(t,a,u){return{h:w(t.h,a.h,u),c:sa(t.c,a.c,u),l:sa(t.l,a.l,u),alpha:sa(t.alpha,a.alpha,u)}}},q=Object.freeze({__proto__:null,lab:B,hcl:O}),_e=function(t,a,u,h,m){this.type=t,this.operator=a,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(var x=0,S=m;x<S.length;x+=1){var M=S[x],k=M[1];this.labels.push(M[0]),this.outputs.push(k)}};function Xe(t,a,u,h){var m=h-u,x=t-u;return m===0?0:a===1?x/m:(Math.pow(a,x)-1)/(Math.pow(a,m)-1)}_e.interpolationFactor=function(t,a,u,h){var m=0;if(t.name==="exponential")m=Xe(a,t.base,u,h);else if(t.name==="linear")m=Xe(a,1,u,h);else if(t.name==="cubic-bezier"){var x=t.controlPoints;m=new F(x[0],x[1],x[2],x[3]).solve(Xe(a,1,u,h))}return m},_e.parse=function(t,a){var u=t[0],h=t[1],m=t[2],x=t.slice(3);if(!Array.isArray(h)||h.length===0)return a.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){var S=h[1];if(typeof S!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:S}}else{if(h[0]!=="cubic-bezier")return a.error("Unknown interpolation type "+String(h[0]),1,0);var M=h.slice(1);if(M.length!==4||M.some(function(Ke){return typeof Ke!="number"||Ke<0||Ke>1}))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:M}}if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(!(m=a.parse(m,2,Tt)))return null;var k=[],U=null;u==="interpolate-hcl"||u==="interpolate-lab"?U=qr:a.expectedType&&a.expectedType.kind!=="value"&&(U=a.expectedType);for(var j=0;j<x.length;j+=2){var H=x[j],te=x[j+1],ue=j+3,Te=j+4;if(typeof H!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ue);if(k.length&&k[k.length-1][0]>=H)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',ue);var Oe=a.parse(te,Te,U);if(!Oe)return null;U=U||Oe.type,k.push([H,Oe])}return U.kind==="number"||U.kind==="color"||U.kind==="array"&&U.itemType.kind==="number"&&typeof U.N=="number"?new _e(U,u,h,m,k):a.error("Type "+xi(U)+" is not interpolatable.")},_e.prototype.evaluate=function(t){var a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(t);var h=this.input.evaluate(t);if(h<=a[0])return u[0].evaluate(t);var m=a.length;if(h>=a[m-1])return u[m-1].evaluate(t);var x=nu(a,h),S=_e.interpolationFactor(this.interpolation,h,a[x],a[x+1]),M=u[x].evaluate(t),k=u[x+1].evaluate(t);return this.operator==="interpolate"?yo[this.type.kind.toLowerCase()](M,k,S):this.operator==="interpolate-hcl"?O.reverse(O.interpolate(O.forward(M),O.forward(k),S)):B.reverse(B.interpolate(B.forward(M),B.forward(k),S))},_e.prototype.eachChild=function(t){t(this.input);for(var a=0,u=this.outputs;a<u.length;a+=1)t(u[a])},_e.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},_e.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var a=[this.operator,t,this.input.serialize()],u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a};var ct=function(t,a){this.type=t,this.args=a};ct.parse=function(t,a){if(t.length<2)return a.error("Expectected at least one argument.");var u=null,h=a.expectedType;h&&h.kind!=="value"&&(u=h);for(var m=[],x=0,S=t.slice(1);x<S.length;x+=1){var M=a.parse(S[x],1+m.length,u,void 0,{typeAnnotation:"omit"});if(!M)return null;u=u||M.type,m.push(M)}var k=h&&m.some(function(U){return Wi(h,U.type)});return new ct(k?tn:u,m)},ct.prototype.evaluate=function(t){for(var a,u=null,h=0,m=0,x=this.args;m<x.length&&(h++,(u=x[m].evaluate(t))&&u instanceof Aa&&!u.available&&(a||(a=u.name),u=null,h===this.args.length&&(u=a)),u===null);m+=1);return u},ct.prototype.eachChild=function(t){this.args.forEach(t)},ct.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},ct.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(a){t.push(a.serialize())}),t};var mt=function(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a};mt.prototype.evaluate=function(t){return this.result.evaluate(t)},mt.prototype.eachChild=function(t){for(var a=0,u=this.bindings;a<u.length;a+=1)t(u[a][1]);t(this.result)},mt.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var u=[],h=1;h<t.length-1;h+=2){var m=t[h];if(typeof m!="string")return a.error("Expected string, but found "+typeof m+" instead.",h);if(/[^a-zA-Z0-9_]/.test(m))return a.error("Variable names must contain only alphanumeric characters or '_'.",h);var x=a.parse(t[h+1],h+1);if(!x)return null;u.push([m,x])}var S=a.parse(t[t.length-1],t.length-1,a.expectedType,u);return S?new mt(u,S):null},mt.prototype.outputDefined=function(){return this.result.outputDefined()},mt.prototype.serialize=function(){for(var t=["let"],a=0,u=this.bindings;a<u.length;a+=1){var h=u[a];t.push(h[0],h[1].serialize())}return t.push(this.result.serialize()),t};var lr=function(t,a,u){this.type=t,this.index=a,this.input=u};lr.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=a.parse(t[1],1,Tt),h=a.parse(t[2],2,Pi(a.expectedType||tn));return u&&h?new lr(h.type.itemType,u,h):null},lr.prototype.evaluate=function(t){var a=this.index.evaluate(t),u=this.input.evaluate(t);if(a<0)throw new za("Array index out of bounds: "+a+" < 0.");if(a>=u.length)throw new za("Array index out of bounds: "+a+" > "+(u.length-1)+".");if(a!==Math.floor(a))throw new za("Array index must be an integer, but found "+a+" instead.");return u[a]},lr.prototype.eachChild=function(t){t(this.index),t(this.input)},lr.prototype.outputDefined=function(){return!1},lr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Er=function(t,a){this.type=Gr,this.needle=t,this.haystack=a};Er.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var u=a.parse(t[1],1,tn),h=a.parse(t[2],2,tn);return u&&h?La(u.type,[Gr,on,Tt,un,tn])?new Er(u,h):a.error("Expected first argument to be of type boolean, string, number or null, but found "+xi(u.type)+" instead"):null},Er.prototype.evaluate=function(t){var a=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!u)return!1;if(!oa(a,["boolean","string","number","null"]))throw new za("Expected first argument to be of type boolean, string, number or null, but found "+xi(ta(a))+" instead.");if(!oa(u,["string","array"]))throw new za("Expected second argument to be of type array or string, but found "+xi(ta(u))+" instead.");return u.indexOf(a)>=0},Er.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},Er.prototype.outputDefined=function(){return!0},Er.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var In=function(t,a,u){this.type=Tt,this.needle=t,this.haystack=a,this.fromIndex=u};In.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=a.parse(t[1],1,tn),h=a.parse(t[2],2,tn);if(!u||!h)return null;if(!La(u.type,[Gr,on,Tt,un,tn]))return a.error("Expected first argument to be of type boolean, string, number or null, but found "+xi(u.type)+" instead");if(t.length===4){var m=a.parse(t[3],3,Tt);return m?new In(u,h,m):null}return new In(u,h)},In.prototype.evaluate=function(t){var a=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!oa(a,["boolean","string","number","null"]))throw new za("Expected first argument to be of type boolean, string, number or null, but found "+xi(ta(a))+" instead.");if(!oa(u,["string","array"]))throw new za("Expected second argument to be of type array or string, but found "+xi(ta(u))+" instead.");if(this.fromIndex){var h=this.fromIndex.evaluate(t);return u.indexOf(a,h)}return u.indexOf(a)},In.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},In.prototype.outputDefined=function(){return!1},In.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var si=function(t,a,u,h,m,x){this.inputType=t,this.type=a,this.input=u,this.cases=h,this.outputs=m,this.otherwise=x};si.parse=function(t,a){if(t.length<5)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return a.error("Expected an even number of arguments.");var u,h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);for(var m={},x=[],S=2;S<t.length-1;S+=2){var M=t[S],k=t[S+1];Array.isArray(M)||(M=[M]);var U=a.concat(S);if(M.length===0)return U.error("Expected at least one branch label.");for(var j=0,H=M;j<H.length;j+=1){var te=H[j];if(typeof te!="number"&&typeof te!="string")return U.error("Branch labels must be numbers or strings.");if(typeof te=="number"&&Math.abs(te)>Number.MAX_SAFE_INTEGER)return U.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof te=="number"&&Math.floor(te)!==te)return U.error("Numeric branch labels must be integer values.");if(u){if(U.checkSubtype(u,ta(te)))return null}else u=ta(te);if(m[String(te)]!==void 0)return U.error("Branch labels must be unique.");m[String(te)]=x.length}var ue=a.parse(k,S,h);if(!ue)return null;h=h||ue.type,x.push(ue)}var Te=a.parse(t[1],1,tn);if(!Te)return null;var Oe=a.parse(t[t.length-1],t.length-1,h);return Oe?Te.type.kind!=="value"&&a.concat(1).checkSubtype(u,Te.type)?null:new si(u,h,Te,m,x,Oe):null},si.prototype.evaluate=function(t){var a=this.input.evaluate(t);return(ta(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)},si.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},si.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},si.prototype.serialize=function(){for(var t=this,a=["match",this.input.serialize()],u=[],h={},m=0,x=Object.keys(this.cases).sort();m<x.length;m+=1){var S=x[m];(H=h[this.cases[S]])===void 0?(h[this.cases[S]]=u.length,u.push([this.cases[S],[S]])):u[H][1].push(S)}for(var M=function(ue){return t.inputType.kind==="number"?Number(ue):ue},k=0,U=u;k<U.length;k+=1){var j=U[k],H=j[0],te=j[1];a.push(te.length===1?M(te[0]):te.map(M)),a.push(this.outputs[outputIndex$1].serialize())}return a.push(this.otherwise.serialize()),a};var Jn=function(t,a,u){this.type=t,this.branches=a,this.otherwise=u};Jn.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return a.error("Expected an odd number of arguments.");var u;a.expectedType&&a.expectedType.kind!=="value"&&(u=a.expectedType);for(var h=[],m=1;m<t.length-1;m+=2){var x=a.parse(t[m],m,Gr);if(!x)return null;var S=a.parse(t[m+1],m+1,u);if(!S)return null;h.push([x,S]),u=u||S.type}var M=a.parse(t[t.length-1],t.length-1,u);return M?new Jn(u,h,M):null},Jn.prototype.evaluate=function(t){for(var a=0,u=this.branches;a<u.length;a+=1){var h=u[a],m=h[1];if(h[0].evaluate(t))return m.evaluate(t)}return this.otherwise.evaluate(t)},Jn.prototype.eachChild=function(t){for(var a=0,u=this.branches;a<u.length;a+=1){var h=u[a],m=h[1];t(h[0]),t(m)}t(this.otherwise)},Jn.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},Jn.prototype.serialize=function(){var t=["case"];return this.eachChild(function(a){t.push(a.serialize())}),t};var Xi=function(t,a,u,h){this.type=t,this.input=a,this.beginIndex=u,this.endIndex=h};function fa(t,a){return t==="=="||t==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Ia(t,a,u,h){return h.compare(a,u)===0}function Gi(t,a,u){var h=t!=="=="&&t!=="!=";return function(){function m(x,S,M){this.type=Gr,this.lhs=x,this.rhs=S,this.collator=M,this.hasUntypedArgument=x.type.kind==="value"||S.type.kind==="value"}return m.parse=function(x,S){if(x.length!==3&&x.length!==4)return S.error("Expected two or three arguments.");var M=x[0],k=S.parse(x[1],1,tn);if(!k)return null;if(!fa(M,k.type))return S.concat(1).error('"'+M+`" comparisons are not supported for type '`+xi(k.type)+"'.");var U=S.parse(x[2],2,tn);if(!U)return null;if(!fa(M,U.type))return S.concat(2).error('"'+M+`" comparisons are not supported for type '`+xi(U.type)+"'.");if(k.type.kind!==U.type.kind&&k.type.kind!=="value"&&U.type.kind!=="value")return S.error("Cannot compare types '"+xi(k.type)+"' and '"+xi(U.type)+"'.");h&&(k.type.kind==="value"&&U.type.kind!=="value"?k=new Ki(U.type,[k]):k.type.kind!=="value"&&U.type.kind==="value"&&(U=new Ki(k.type,[U])));var j=null;if(x.length===4){if(k.type.kind!=="string"&&U.type.kind!=="string"&&k.type.kind!=="value"&&U.type.kind!=="value")return S.error("Cannot use collator to compare non-string types.");if(!(j=S.parse(x[3],3,Ci)))return null}return new m(k,U,j)},m.prototype.evaluate=function(x){var S=this.lhs.evaluate(x),M=this.rhs.evaluate(x);if(h&&this.hasUntypedArgument){var k=ta(S),U=ta(M);if(k.kind!==U.kind||k.kind!=="string"&&k.kind!=="number")throw new za('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+k.kind+", "+U.kind+") instead.")}if(this.collator&&!h&&this.hasUntypedArgument){var j=ta(S),H=ta(M);if(j.kind!=="string"||H.kind!=="string")return a(x,S,M)}return this.collator?u(x,S,M,this.collator.evaluate(x)):a(x,S,M)},m.prototype.eachChild=function(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)},m.prototype.outputDefined=function(){return!0},m.prototype.serialize=function(){var x=[t];return this.eachChild(function(S){x.push(S.serialize())}),x},m}()}Xi.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var u=a.parse(t[1],1,tn),h=a.parse(t[2],2,Tt);if(!u||!h)return null;if(!La(u.type,[Pi(tn),on,tn]))return a.error("Expected first argument to be of type array or string, but found "+xi(u.type)+" instead");if(t.length===4){var m=a.parse(t[3],3,Tt);return m?new Xi(u.type,u,h,m):null}return new Xi(u.type,u,h)},Xi.prototype.evaluate=function(t){var a=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!oa(a,["string","array"]))throw new za("Expected first argument to be of type array or string, but found "+xi(ta(a))+" instead.");if(this.endIndex){var h=this.endIndex.evaluate(t);return a.slice(u,h)}return a.slice(u)},Xi.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Xi.prototype.outputDefined=function(){return!1},Xi.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Lo=Gi("==",function(t,a,u){return a===u},Ia),gs=Gi("!=",function(t,a,u){return a!==u},function(t,a,u,h){return!Ia(0,a,u,h)}),il=Gi("<",function(t,a,u){return a<u},function(t,a,u,h){return h.compare(a,u)<0}),Xc=Gi(">",function(t,a,u){return a>u},function(t,a,u,h){return h.compare(a,u)>0}),ju=Gi("<=",function(t,a,u){return a<=u},function(t,a,u,h){return h.compare(a,u)<=0}),Ec=Gi(">=",function(t,a,u){return a>=u},function(t,a,u,h){return h.compare(a,u)>=0}),Eu=function(t,a,u,h,m){this.type=on,this.number=t,this.locale=a,this.currency=u,this.minFractionDigits=h,this.maxFractionDigits=m};Eu.parse=function(t,a){if(t.length!==3)return a.error("Expected two arguments.");var u=a.parse(t[1],1,Tt);if(!u)return null;var h=t[2];if(typeof h!="object"||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");var m=null;if(h.locale&&!(m=a.parse(h.locale,1,on)))return null;var x=null;if(h.currency&&!(x=a.parse(h.currency,1,on)))return null;var S=null;if(h["min-fraction-digits"]&&!(S=a.parse(h["min-fraction-digits"],1,Tt)))return null;var M=null;return h["max-fraction-digits"]&&!(M=a.parse(h["max-fraction-digits"],1,Tt))?null:new Eu(u,m,x,S,M)},Eu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Eu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Eu.prototype.outputDefined=function(){return!1},Eu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var hu=function(t){this.type=Tt,this.input=t};hu.parse=function(t,a){if(t.length!==2)return a.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var u=a.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?a.error("Expected argument of type string or array, but found "+xi(u.type)+" instead."):new hu(u):null},hu.prototype.evaluate=function(t){var a=this.input.evaluate(t);if(typeof a=="string"||Array.isArray(a))return a.length;throw new za("Expected value to be of type string or array, but found "+xi(ta(a))+" instead.")},hu.prototype.eachChild=function(t){t(this.input)},hu.prototype.outputDefined=function(){return!1},hu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(a){t.push(a.serialize())}),t};var wo={"==":Lo,"!=":gs,">":Xc,"<":il,">=":Ec,"<=":ju,array:Ki,at:lr,boolean:Ki,case:Jn,coalesce:ct,collator:Yo,format:Ho,image:Wo,in:Er,"index-of":In,interpolate:_e,"interpolate-hcl":_e,"interpolate-lab":_e,length:hu,let:mt,literal:mo,match:si,number:Ki,"number-format":Eu,object:Ki,slice:Xi,step:ls,string:Ki,"to-boolean":Co,"to-color":Co,"to-number":Co,"to-string":Co,var:xe,within:xn};function ha(t,a){var u=a[0],h=a[1],m=a[2],x=a[3];u=u.evaluate(t),h=h.evaluate(t),m=m.evaluate(t);var S=x?x.evaluate(t):1,M=ms(u,h,m,S);if(M)throw new za(M);return new Vi(u/255*S,h/255*S,m/255*S,S)}function oh(t,a){return t in a}function sh(t,a){var u=a[t];return u===void 0?null:u}function fo(t){return{type:t}}function wf(t){return{result:"success",value:t}}function pu(t){return{result:"error",value:t}}function Rs(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function Sc(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function al(t){return!!t.expression&&t.expression.interpolated}function Ea(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Sl(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Xl(t){return t}function ts(t,a,u){return t!==void 0?t:a!==void 0?a:u!==void 0?u:void 0}function Af(t,a,u,h,m){return ts(typeof u===m?h[u]:void 0,t.default,a.default)}function uh(t,a,u){if(Ea(u)!=="number")return ts(t.default,a.default);var h=t.stops.length;if(h===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[h-1][0])return t.stops[h-1][1];var m=nu(t.stops.map(function(x){return x[0]}),u);return t.stops[m][1]}function lh(t,a,u){var h=t.base!==void 0?t.base:1;if(Ea(u)!=="number")return ts(t.default,a.default);var m=t.stops.length;if(m===1||u<=t.stops[0][0])return t.stops[0][1];if(u>=t.stops[m-1][0])return t.stops[m-1][1];var x=nu(t.stops.map(function(H){return H[0]}),u),S=function(H,te,ue,Te){var Oe=Te-ue,Ke=H-ue;return Oe===0?0:te===1?Ke/Oe:(Math.pow(te,Ke)-1)/(Math.pow(te,Oe)-1)}(u,h,t.stops[x][0],t.stops[x+1][0]),M=t.stops[x][1],k=t.stops[x+1][1],U=yo[a.type]||Xl;if(t.colorSpace&&t.colorSpace!=="rgb"){var j=q[t.colorSpace];U=function(H,te){return j.reverse(j.interpolate(j.forward(H),j.forward(te),S))}}return typeof M.evaluate=="function"?{evaluate:function(){for(var H=[],te=arguments.length;te--;)H[te]=arguments[te];var ue=M.evaluate.apply(void 0,H),Te=k.evaluate.apply(void 0,H);if(ue!==void 0&&Te!==void 0)return U(ue,Te,S)}}:U(M,k,S)}function Yc(t,a,u){return a.type==="color"?u=Vi.parse(u):a.type==="formatted"?u=wa.fromString(u.toString()):a.type==="resolvedImage"?u=Aa.fromString(u.toString()):Ea(u)===a.type||a.type==="enum"&&a.values[u]||(u=void 0),ts(u,t.default,a.default)}go.register(wo,{error:[{kind:"error"},[on],function(t,a){throw new za(a[0].evaluate(t))}],typeof:[on,[tn],function(t,a){return xi(ta(a[0].evaluate(t)))}],"to-rgba":[Pi(Tt,4),[qr],function(t,a){return a[0].evaluate(t).toArray()}],rgb:[qr,[Tt,Tt,Tt],ha],rgba:[qr,[Tt,Tt,Tt,Tt],ha],has:{type:Gr,overloads:[[[on],function(t,a){return oh(a[0].evaluate(t),t.properties())}],[[on,ni],function(t,a){var u=a[1];return oh(a[0].evaluate(t),u.evaluate(t))}]]},get:{type:tn,overloads:[[[on],function(t,a){return sh(a[0].evaluate(t),t.properties())}],[[on,ni],function(t,a){var u=a[1];return sh(a[0].evaluate(t),u.evaluate(t))}]]},"feature-state":[tn,[on],function(t,a){return sh(a[0].evaluate(t),t.featureState||{})}],properties:[ni,[],function(t){return t.properties()}],"geometry-type":[on,[],function(t){return t.geometryType()}],id:[tn,[],function(t){return t.id()}],zoom:[Tt,[],function(t){return t.globals.zoom}],"heatmap-density":[Tt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Tt,[],function(t){return t.globals.lineProgress||0}],accumulated:[tn,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Tt,fo(Tt),function(t,a){for(var u=0,h=0,m=a;h<m.length;h+=1)u+=m[h].evaluate(t);return u}],"*":[Tt,fo(Tt),function(t,a){for(var u=1,h=0,m=a;h<m.length;h+=1)u*=m[h].evaluate(t);return u}],"-":{type:Tt,overloads:[[[Tt,Tt],function(t,a){var u=a[1];return a[0].evaluate(t)-u.evaluate(t)}],[[Tt],function(t,a){return-a[0].evaluate(t)}]]},"/":[Tt,[Tt,Tt],function(t,a){var u=a[1];return a[0].evaluate(t)/u.evaluate(t)}],"%":[Tt,[Tt,Tt],function(t,a){var u=a[1];return a[0].evaluate(t)%u.evaluate(t)}],ln2:[Tt,[],function(){return Math.LN2}],pi:[Tt,[],function(){return Math.PI}],e:[Tt,[],function(){return Math.E}],"^":[Tt,[Tt,Tt],function(t,a){var u=a[1];return Math.pow(a[0].evaluate(t),u.evaluate(t))}],sqrt:[Tt,[Tt],function(t,a){return Math.sqrt(a[0].evaluate(t))}],log10:[Tt,[Tt],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN10}],ln:[Tt,[Tt],function(t,a){return Math.log(a[0].evaluate(t))}],log2:[Tt,[Tt],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN2}],sin:[Tt,[Tt],function(t,a){return Math.sin(a[0].evaluate(t))}],cos:[Tt,[Tt],function(t,a){return Math.cos(a[0].evaluate(t))}],tan:[Tt,[Tt],function(t,a){return Math.tan(a[0].evaluate(t))}],asin:[Tt,[Tt],function(t,a){return Math.asin(a[0].evaluate(t))}],acos:[Tt,[Tt],function(t,a){return Math.acos(a[0].evaluate(t))}],atan:[Tt,[Tt],function(t,a){return Math.atan(a[0].evaluate(t))}],min:[Tt,fo(Tt),function(t,a){return Math.min.apply(Math,a.map(function(u){return u.evaluate(t)}))}],max:[Tt,fo(Tt),function(t,a){return Math.max.apply(Math,a.map(function(u){return u.evaluate(t)}))}],abs:[Tt,[Tt],function(t,a){return Math.abs(a[0].evaluate(t))}],round:[Tt,[Tt],function(t,a){var u=a[0].evaluate(t);return u<0?-Math.round(-u):Math.round(u)}],floor:[Tt,[Tt],function(t,a){return Math.floor(a[0].evaluate(t))}],ceil:[Tt,[Tt],function(t,a){return Math.ceil(a[0].evaluate(t))}],"filter-==":[Gr,[on,tn],function(t,a){var u=a[0],h=a[1];return t.properties()[u.value]===h.value}],"filter-id-==":[Gr,[tn],function(t,a){var u=a[0];return t.id()===u.value}],"filter-type-==":[Gr,[on],function(t,a){var u=a[0];return t.geometryType()===u.value}],"filter-<":[Gr,[on,tn],function(t,a){var u=a[0],h=a[1],m=t.properties()[u.value],x=h.value;return typeof m==typeof x&&m<x}],"filter-id-<":[Gr,[tn],function(t,a){var u=a[0],h=t.id(),m=u.value;return typeof h==typeof m&&h<m}],"filter->":[Gr,[on,tn],function(t,a){var u=a[0],h=a[1],m=t.properties()[u.value],x=h.value;return typeof m==typeof x&&m>x}],"filter-id->":[Gr,[tn],function(t,a){var u=a[0],h=t.id(),m=u.value;return typeof h==typeof m&&h>m}],"filter-<=":[Gr,[on,tn],function(t,a){var u=a[0],h=a[1],m=t.properties()[u.value],x=h.value;return typeof m==typeof x&&m<=x}],"filter-id-<=":[Gr,[tn],function(t,a){var u=a[0],h=t.id(),m=u.value;return typeof h==typeof m&&h<=m}],"filter->=":[Gr,[on,tn],function(t,a){var u=a[0],h=a[1],m=t.properties()[u.value],x=h.value;return typeof m==typeof x&&m>=x}],"filter-id->=":[Gr,[tn],function(t,a){var u=a[0],h=t.id(),m=u.value;return typeof h==typeof m&&h>=m}],"filter-has":[Gr,[tn],function(t,a){return a[0].value in t.properties()}],"filter-has-id":[Gr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Gr,[Pi(on)],function(t,a){return a[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Gr,[Pi(tn)],function(t,a){return a[0].value.indexOf(t.id())>=0}],"filter-in-small":[Gr,[on,Pi(tn)],function(t,a){var u=a[0];return a[1].value.indexOf(t.properties()[u.value])>=0}],"filter-in-large":[Gr,[on,Pi(tn)],function(t,a){var u=a[0],h=a[1];return function(m,x,S,M){for(;S<=M;){var k=S+M>>1;if(x[k]===m)return!0;x[k]>m?M=k-1:S=k+1}return!1}(t.properties()[u.value],h.value,0,h.value.length-1)}],all:{type:Gr,overloads:[[[Gr,Gr],function(t,a){var u=a[1];return a[0].evaluate(t)&&u.evaluate(t)}],[fo(Gr),function(t,a){for(var u=0,h=a;u<h.length;u+=1)if(!h[u].evaluate(t))return!1;return!0}]]},any:{type:Gr,overloads:[[[Gr,Gr],function(t,a){var u=a[1];return a[0].evaluate(t)||u.evaluate(t)}],[fo(Gr),function(t,a){for(var u=0,h=a;u<h.length;u+=1)if(h[u].evaluate(t))return!0;return!1}]]},"!":[Gr,[Gr],function(t,a){return!a[0].evaluate(t)}],"is-supported-script":[Gr,[on],function(t,a){var u=t.globals&&t.globals.isSupportedScript;return!u||u(a[0].evaluate(t))}],upcase:[on,[on],function(t,a){return a[0].evaluate(t).toUpperCase()}],downcase:[on,[on],function(t,a){return a[0].evaluate(t).toLowerCase()}],concat:[on,fo(tn),function(t,a){return a.map(function(u){return Bu(u.evaluate(t))}).join("")}],"resolved-locale":[on,[Ci],function(t,a){return a[0].evaluate(t).resolvedLocale()}]});var ol=function(t,a){this.expression=t,this._warningHistory={},this._evaluator=new ga,this._defaultValue=a?function(u){return u.type==="color"&&Sl(u.default)?new Vi(0,0,0,0):u.type==="color"?Vi.parse(u.default)||null:u.default===void 0?null:u.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null};function No(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in wo}function Su(t,a){var u=new Vs(wo,[],a?function(m){var x={color:qr,string:on,number:Tt,enum:on,boolean:Gr,formatted:Ji,resolvedImage:yi};return m.type==="array"?Pi(x[m.value]||tn,m.length):x[m.type]}(a):void 0),h=u.parse(t,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?wf(new ol(h,a)):pu(u.errors)}ol.prototype.evaluateWithoutErrorHandling=function(t,a,u,h,m,x){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)},ol.prototype.evaluate=function(t,a,u,h,m,x){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=x||null;try{var S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new za("Expected value to be one of "+Object.keys(this._enumValues).map(function(M){return JSON.stringify(M)}).join(", ")+", but found "+JSON.stringify(S)+" instead.");return S}catch(M){return this._warningHistory[M.message]||(this._warningHistory[M.message]=!0,typeof console!="undefined"&&console.warn(M.message)),this._defaultValue}};var Vu=function(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!Kt(a.expression)};Vu.prototype.evaluateWithoutErrorHandling=function(t,a,u,h,m,x){return this._styleExpression.evaluateWithoutErrorHandling(t,a,u,h,m,x)},Vu.prototype.evaluate=function(t,a,u,h,m,x){return this._styleExpression.evaluate(t,a,u,h,m,x)};var zo=function(t,a,u,h){this.kind=t,this.zoomStops=u,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!Kt(a.expression),this.interpolationType=h};function Cl(t,a){if((t=Su(t,a)).result==="error")return t;var u=t.value.expression,h=dn(u);if(!h&&!Rs(a))return pu([new _r("","data expressions not supported")]);var m=Bo(u,["zoom"]);if(!m&&!Sc(a))return pu([new _r("","zoom expressions not supported")]);var x=function S(M){var k=null;if(M instanceof mt)k=S(M.result);else if(M instanceof ct)for(var U=0,j=M.args;U<j.length&&!(k=S(j[U]));U+=1);else(M instanceof ls||M instanceof _e)&&M.input instanceof go&&M.input.name==="zoom"&&(k=M);return k instanceof _r||M.eachChild(function(H){var te=S(H);te instanceof _r?k=te:!k&&te?k=new _r("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):k&&te&&k!==te&&(k=new _r("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),k}(u);return x||m?x instanceof _r?pu([x]):x instanceof _e&&!al(a)?pu([new _r("",'"interpolate" expressions cannot be used with this property')]):wf(x?new zo(h?"camera":"composite",t.value,x.labels,x instanceof _e?x.interpolation:void 0):new Vu(h?"constant":"source",t.value)):pu([new _r("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}zo.prototype.evaluateWithoutErrorHandling=function(t,a,u,h,m,x){return this._styleExpression.evaluateWithoutErrorHandling(t,a,u,h,m,x)},zo.prototype.evaluate=function(t,a,u,h,m,x){return this._styleExpression.evaluate(t,a,u,h,m,x)},zo.prototype.interpolationFactor=function(t,a,u){return this.interpolationType?_e.interpolationFactor(this.interpolationType,t,a,u):0};var Gu=function(t,a){this._parameters=t,this._specification=a,dr(this,function u(h,m){var x,S,M,k=m.type==="color",U=h.stops&&typeof h.stops[0][0]=="object",j=U||!(U||h.property!==void 0),H=h.type||(al(m)?"exponential":"interval");if(k&&((h=dr({},h)).stops&&(h.stops=h.stops.map(function(cn){return[cn[0],Vi.parse(cn[1])]})),h.default=Vi.parse(h.default?h.default:m.default)),h.colorSpace&&h.colorSpace!=="rgb"&&!q[h.colorSpace])throw new Error("Unknown color space: "+h.colorSpace);if(H==="exponential")x=lh;else if(H==="interval")x=uh;else if(H==="categorical"){x=Af,S=Object.create(null);for(var te=0,ue=h.stops;te<ue.length;te+=1){var Te=ue[te];S[Te[0]]=Te[1]}M=typeof h.stops[0][0]}else{if(H!=="identity")throw new Error('Unknown function type "'+H+'"');x=Yc}if(U){for(var Oe={},Ke=[],ze=0;ze<h.stops.length;ze++){var ot=h.stops[ze],Et=ot[0].zoom;Oe[Et]===void 0&&(Oe[Et]={zoom:Et,type:h.type,property:h.property,default:h.default,stops:[]},Ke.push(Et)),Oe[Et].stops.push([ot[0].value,ot[1]])}for(var Zt=[],Ht=0,cr=Ke;Ht<cr.length;Ht+=1){var Lr=cr[Ht];Zt.push([Oe[Lr].zoom,u(Oe[Lr],m)])}var Vr={name:"linear"};return{kind:"composite",interpolationType:Vr,interpolationFactor:_e.interpolationFactor.bind(void 0,Vr),zoomStops:Zt.map(function(cn){return cn[0]}),evaluate:function(cn,Nn){var pn=cn.zoom;return lh({stops:Zt,base:h.base},m,pn).evaluate(pn,Nn)}}}if(j){var gn=H==="exponential"?{name:"exponential",base:h.base!==void 0?h.base:1}:null;return{kind:"camera",interpolationType:gn,interpolationFactor:_e.interpolationFactor.bind(void 0,gn),zoomStops:h.stops.map(function(cn){return cn[0]}),evaluate:function(cn){return x(h,m,cn.zoom,S,M)}}}return{kind:"source",evaluate:function(cn,Nn){var pn=Nn&&Nn.properties?Nn.properties[h.property]:void 0;return pn===void 0?ts(h.default,m.default):x(h,m,pn,S,M)}}}(this._parameters,this._specification))};function Gs(t){var a=t.key,u=t.value,h=t.valueSpec||{},m=t.objectElementValidators||{},x=t.style,S=t.styleSpec,M=[],k=Ea(u);if(k!=="object")return[new Be(a,u,"object expected, "+k+" found")];for(var U in u){var j=U.split(".")[0],H=h[j]||h["*"],te=void 0;if(m[j])te=m[j];else if(h[j])te=Di;else if(m["*"])te=m["*"];else{if(!h["*"]){M.push(new Be(a,u[U],'unknown property "'+U+'"'));continue}te=Di}M=M.concat(te({key:(a&&a+".")+U,value:u[U],valueSpec:H,style:x,styleSpec:S,object:u,objectKey:U},u))}for(var ue in h)m[ue]||h[ue].required&&h[ue].default===void 0&&u[ue]===void 0&&M.push(new Be(a,u,'missing required property "'+ue+'"'));return M}function qc(t){var a=t.value,u=t.valueSpec,h=t.style,m=t.styleSpec,x=t.key,S=t.arrayElementValidator||Di;if(Ea(a)!=="array")return[new Be(x,a,"array expected, "+Ea(a)+" found")];if(u.length&&a.length!==u.length)return[new Be(x,a,"array length "+u.length+" expected, length "+a.length+" found")];if(u["min-length"]&&a.length<u["min-length"])return[new Be(x,a,"array length at least "+u["min-length"]+" expected, length "+a.length+" found")];var M={type:u.value,values:u.values};m.$version<7&&(M.function=u.function),Ea(u.value)==="object"&&(M=u.value);for(var k=[],U=0;U<a.length;U++)k=k.concat(S({array:a,arrayIndex:U,value:a[U],valueSpec:M,style:h,styleSpec:m,key:x+"["+U+"]"}));return k}function Kc(t){var a=t.key,u=t.value,h=t.valueSpec,m=Ea(u);return m==="number"&&u!=u&&(m="NaN"),m!=="number"?[new Be(a,u,"number expected, "+m+" found")]:"minimum"in h&&u<h.minimum?[new Be(a,u,u+" is less than the minimum value "+h.minimum)]:"maximum"in h&&u>h.maximum?[new Be(a,u,u+" is greater than the maximum value "+h.maximum)]:[]}function $c(t){var a,u,h,m=t.valueSpec,x=Dt(t.value.type),S={},M=x!=="categorical"&&t.value.property===void 0,k=!M,U=Ea(t.value.stops)==="array"&&Ea(t.value.stops[0])==="array"&&Ea(t.value.stops[0][0])==="object",j=Gs({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(ue){if(x==="identity")return[new Be(ue.key,ue.value,'identity function may not have a "stops" property')];var Te=[],Oe=ue.value;return Te=Te.concat(qc({key:ue.key,value:Oe,valueSpec:ue.valueSpec,style:ue.style,styleSpec:ue.styleSpec,arrayElementValidator:H})),Ea(Oe)==="array"&&Oe.length===0&&Te.push(new Be(ue.key,Oe,"array must have at least one stop")),Te},default:function(ue){return Di({key:ue.key,value:ue.value,valueSpec:m,style:ue.style,styleSpec:ue.styleSpec})}}});return x==="identity"&&M&&j.push(new Be(t.key,t.value,'missing required property "property"')),x==="identity"||t.value.stops||j.push(new Be(t.key,t.value,'missing required property "stops"')),x==="exponential"&&t.valueSpec.expression&&!al(t.valueSpec)&&j.push(new Be(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(k&&!Rs(t.valueSpec)?j.push(new Be(t.key,t.value,"property functions not supported")):M&&!Sc(t.valueSpec)&&j.push(new Be(t.key,t.value,"zoom functions not supported"))),x!=="categorical"&&!U||t.value.property!==void 0||j.push(new Be(t.key,t.value,'"property" property is required')),j;function H(ue){var Te=[],Oe=ue.value,Ke=ue.key;if(Ea(Oe)!=="array")return[new Be(Ke,Oe,"array expected, "+Ea(Oe)+" found")];if(Oe.length!==2)return[new Be(Ke,Oe,"array length 2 expected, length "+Oe.length+" found")];if(U){if(Ea(Oe[0])!=="object")return[new Be(Ke,Oe,"object expected, "+Ea(Oe[0])+" found")];if(Oe[0].zoom===void 0)return[new Be(Ke,Oe,"object stop key must have zoom")];if(Oe[0].value===void 0)return[new Be(Ke,Oe,"object stop key must have value")];if(h&&h>Dt(Oe[0].zoom))return[new Be(Ke,Oe[0].zoom,"stop zoom values must appear in ascending order")];Dt(Oe[0].zoom)!==h&&(h=Dt(Oe[0].zoom),u=void 0,S={}),Te=Te.concat(Gs({key:Ke+"[0]",value:Oe[0],valueSpec:{zoom:{}},style:ue.style,styleSpec:ue.styleSpec,objectElementValidators:{zoom:Kc,value:te}}))}else Te=Te.concat(te({key:Ke+"[0]",value:Oe[0],valueSpec:{},style:ue.style,styleSpec:ue.styleSpec},Oe));return No(Ft(Oe[1]))?Te.concat([new Be(Ke+"[1]",Oe[1],"expressions are not allowed in function stops.")]):Te.concat(Di({key:Ke+"[1]",value:Oe[1],valueSpec:m,style:ue.style,styleSpec:ue.styleSpec}))}function te(ue,Te){var Oe=Ea(ue.value),Ke=Dt(ue.value),ze=ue.value!==null?ue.value:Te;if(a){if(Oe!==a)return[new Be(ue.key,ze,Oe+" stop domain type must match previous stop domain type "+a)]}else a=Oe;if(Oe!=="number"&&Oe!=="string"&&Oe!=="boolean")return[new Be(ue.key,ze,"stop domain value must be a number, string, or boolean")];if(Oe!=="number"&&x!=="categorical"){var ot="number expected, "+Oe+" found";return Rs(m)&&x===void 0&&(ot+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Be(ue.key,ze,ot)]}return x!=="categorical"||Oe!=="number"||isFinite(Ke)&&Math.floor(Ke)===Ke?x!=="categorical"&&Oe==="number"&&u!==void 0&&Ke<u?[new Be(ue.key,ze,"stop domain values must appear in ascending order")]:(u=Ke,x==="categorical"&&Ke in S?[new Be(ue.key,ze,"stop domain values must be unique")]:(S[Ke]=!0,[])):[new Be(ue.key,ze,"integer expected, found "+Ke)]}}function Hu(t){var a=(t.expressionContext==="property"?Cl:Su)(Ft(t.value),t.valueSpec);if(a.result==="error")return a.value.map(function(h){return new Be(""+t.key+h.key,t.value,h.message)});var u=a.value.expression||a.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!u.outputDefined())return[new Be(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Kt(u))return[new Be(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!Kt(u))return[new Be(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Bo(u,["zoom","feature-state"]))return[new Be(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!dn(u))return[new Be(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yl(t){var a=t.key,u=t.value,h=t.valueSpec,m=[];return Array.isArray(h.values)?h.values.indexOf(Dt(u))===-1&&m.push(new Be(a,u,"expected one of ["+h.values.join(", ")+"], "+JSON.stringify(u)+" found")):Object.keys(h.values).indexOf(Dt(u))===-1&&m.push(new Be(a,u,"expected one of ["+Object.keys(h.values).join(", ")+"], "+JSON.stringify(u)+" found")),m}function Cc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var a=0,u=t.slice(1);a<u.length;a+=1){var h=u[a];if(!Cc(h)&&typeof h!="boolean")return!1}return!0;default:return!0}}Gu.deserialize=function(t){return new Gu(t._parameters,t._specification)},Gu.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var Jc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function wc(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};Cc(t)||(t=Ac(t));var a=Su(t,Jc);if(a.result==="error")throw new Error(a.value.map(function(u){return u.key+": "+u.message}).join(", "));return{filter:function(u,h,m){return a.value.evaluate(u,h,{},m)},needGeometry:function u(h){if(!Array.isArray(h))return!1;if(h[0]==="within")return!0;for(var m=1;m<h.length;m++)if(u(h[m]))return!0;return!1}(t)}}function ch(t,a){return t<a?-1:t>a?1:0}function Ac(t){if(!t)return!0;var a,u=t[0];return t.length<=1?u!=="any":u==="=="?sl(t[1],t[2],"=="):u==="!="?Cu(sl(t[1],t[2],"==")):u==="<"||u===">"||u==="<="||u===">="?sl(t[1],t[2],u):u==="any"?(a=t.slice(1),["any"].concat(a.map(Ac))):u==="all"?["all"].concat(t.slice(1).map(Ac)):u==="none"?["all"].concat(t.slice(1).map(Ac).map(Cu)):u==="in"?Qc(t[1],t.slice(2)):u==="!in"?Cu(Qc(t[1],t.slice(2))):u==="has"?ef(t[1]):u==="!has"?Cu(ef(t[1])):u!=="within"||t}function sl(t,a,u){switch(t){case"$type":return["filter-type-"+u,a];case"$id":return["filter-id-"+u,a];default:return["filter-"+u,t,a]}}function Qc(t,a){if(a.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(function(u){return typeof u!=typeof a[0]})?["filter-in-large",t,["literal",a.sort(ch)]]:["filter-in-small",t,["literal",a]]}}function ef(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Cu(t){return["!",t]}function tf(t){return Cc(Ft(t.value))?Hu(dr({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function a(u){var h=u.value,m=u.key;if(Ea(h)!=="array")return[new Be(m,h,"array expected, "+Ea(h)+" found")];var x,S=u.styleSpec,M=[];if(h.length<1)return[new Be(m,h,"filter array must have at least 1 element")];switch(M=M.concat(Yl({key:m+"[0]",value:h[0],valueSpec:S.filter_operator,style:u.style,styleSpec:u.styleSpec})),Dt(h[0])){case"<":case"<=":case">":case">=":h.length>=2&&Dt(h[1])==="$type"&&M.push(new Be(m,h,'"$type" cannot be use with operator "'+h[0]+'"'));case"==":case"!=":h.length!==3&&M.push(new Be(m,h,'filter array for operator "'+h[0]+'" must have 3 elements'));case"in":case"!in":h.length>=2&&(x=Ea(h[1]))!=="string"&&M.push(new Be(m+"[1]",h[1],"string expected, "+x+" found"));for(var k=2;k<h.length;k++)x=Ea(h[k]),Dt(h[1])==="$type"?M=M.concat(Yl({key:m+"["+k+"]",value:h[k],valueSpec:S.geometry_type,style:u.style,styleSpec:u.styleSpec})):x!=="string"&&x!=="number"&&x!=="boolean"&&M.push(new Be(m+"["+k+"]",h[k],"string, number, or boolean expected, "+x+" found"));break;case"any":case"all":case"none":for(var U=1;U<h.length;U++)M=M.concat(a({key:m+"["+U+"]",value:h[U],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":x=Ea(h[1]),h.length!==2?M.push(new Be(m,h,'filter array for "'+h[0]+'" operator must have 2 elements')):x!=="string"&&M.push(new Be(m+"[1]",h[1],"string expected, "+x+" found"));break;case"within":x=Ea(h[1]),h.length!==2?M.push(new Be(m,h,'filter array for "'+h[0]+'" operator must have 2 elements')):x!=="object"&&M.push(new Be(m+"[1]",h[1],"object expected, "+x+" found"))}return M}(t)}function Tf(t,a){var u=t.key,h=t.style,m=t.styleSpec,x=t.value,S=t.objectKey,M=m[a+"_"+t.layerType];if(!M)return[];var k=S.match(/^(.*)-transition$/);if(a==="paint"&&k&&M[k[1]]&&M[k[1]].transition)return Di({key:u,value:x,valueSpec:m.transition,style:h,styleSpec:m});var U,j=t.valueSpec||M[S];if(!j)return[new Be(u,x,'unknown property "'+S+'"')];if(Ea(x)==="string"&&Rs(j)&&!j.tokens&&(U=/^{([^}]+)}$/.exec(x)))return[new Be(u,x,'"'+S+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(U[1])+" }`.")];var H=[];return t.layerType==="symbol"&&(S==="text-field"&&h&&!h.glyphs&&H.push(new Be(u,x,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&Sl(Ft(x))&&Dt(x.type)==="identity"&&H.push(new Be(u,x,'"text-font" does not support identity functions'))),H.concat(Di({key:t.key,value:x,valueSpec:j,style:h,styleSpec:m,expressionContext:"property",propertyType:a,propertyKey:S}))}function fh(t){return Tf(t,"paint")}function wl(t){return Tf(t,"layout")}function $h(t){var a=[],u=t.value,h=t.key,m=t.style,x=t.styleSpec;u.type||u.ref||a.push(new Be(h,u,'either "type" or "ref" is required'));var S,M=Dt(u.type),k=Dt(u.ref);if(u.id)for(var U=Dt(u.id),j=0;j<t.arrayIndex;j++){var H=m.layers[j];Dt(H.id)===U&&a.push(new Be(h,u.id,'duplicate layer id "'+u.id+'", previously used at line '+H.id.__line__))}if("ref"in u)["type","source","source-layer","filter","layout"].forEach(function(Te){Te in u&&a.push(new Be(h,u[Te],'"'+Te+'" is prohibited for ref layers'))}),m.layers.forEach(function(Te){Dt(Te.id)===k&&(S=Te)}),S?S.ref?a.push(new Be(h,u.ref,"ref cannot reference another ref layer")):M=Dt(S.type):a.push(new Be(h,u.ref,'ref layer "'+k+'" not found'));else if(M!=="background")if(u.source){var te=m.sources&&m.sources[u.source],ue=te&&Dt(te.type);te?ue==="vector"&&M==="raster"?a.push(new Be(h,u.source,'layer "'+u.id+'" requires a raster source')):ue==="raster"&&M!=="raster"?a.push(new Be(h,u.source,'layer "'+u.id+'" requires a vector source')):ue!=="vector"||u["source-layer"]?ue==="raster-dem"&&M!=="hillshade"?a.push(new Be(h,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):M!=="line"||!u.paint||!u.paint["line-gradient"]||ue==="geojson"&&te.lineMetrics||a.push(new Be(h,u,'layer "'+u.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):a.push(new Be(h,u,'layer "'+u.id+'" must specify a "source-layer"')):a.push(new Be(h,u.source,'source "'+u.source+'" not found'))}else a.push(new Be(h,u,'missing required property "source"'));return a=a.concat(Gs({key:h,value:u,valueSpec:x.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Di({key:h+".type",value:u.type,valueSpec:x.layer.type,style:t.style,styleSpec:t.styleSpec,object:u,objectKey:"type"})},filter:tf,layout:function(Te){return Gs({layer:u,key:Te.key,value:Te.value,style:Te.style,styleSpec:Te.styleSpec,objectElementValidators:{"*":function(Oe){return wl(dr({layerType:M},Oe))}}})},paint:function(Te){return Gs({layer:u,key:Te.key,value:Te.value,style:Te.style,styleSpec:Te.styleSpec,objectElementValidators:{"*":function(Oe){return fh(dr({layerType:M},Oe))}}})}}}))}function rs(t){var a=t.value,u=t.key,h=Ea(a);return h!=="string"?[new Be(u,a,"string expected, "+h+" found")]:[]}var Xa={promoteId:function(t){var a=t.key,u=t.value;if(Ea(u)==="string")return rs({key:a,value:u});var h=[];for(var m in u)h.push.apply(h,rs({key:a+"."+m,value:u[m]}));return h}};function ql(t){var a=t.value,u=t.key,h=t.styleSpec,m=t.style;if(!a.type)return[new Be(u,a,'"type" is required')];var x,S=Dt(a.type);switch(S){case"vector":case"raster":case"raster-dem":return Gs({key:u,value:a,valueSpec:h["source_"+S.replace("-","_")],style:t.style,styleSpec:h,objectElementValidators:Xa});case"geojson":if(x=Gs({key:u,value:a,valueSpec:h.source_geojson,style:m,styleSpec:h,objectElementValidators:Xa}),a.cluster)for(var M in a.clusterProperties){var k=a.clusterProperties[M],U=k[0],j=typeof U=="string"?[U,["accumulated"],["get",M]]:U;x.push.apply(x,Hu({key:u+"."+M+".map",value:k[1],expressionContext:"cluster-map"})),x.push.apply(x,Hu({key:u+"."+M+".reduce",value:j,expressionContext:"cluster-reduce"}))}return x;case"video":return Gs({key:u,value:a,valueSpec:h.source_video,style:m,styleSpec:h});case"image":return Gs({key:u,value:a,valueSpec:h.source_image,style:m,styleSpec:h});case"canvas":return[new Be(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Yl({key:u+".type",value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,styleSpec:h})}}function Al(t){var a=t.value,u=t.styleSpec,h=u.light,m=t.style,x=[],S=Ea(a);if(a===void 0)return x;if(S!=="object")return x.concat([new Be("light",a,"object expected, "+S+" found")]);for(var M in a){var k=M.match(/^(.*)-transition$/);x=x.concat(k&&h[k[1]]&&h[k[1]].transition?Di({key:M,value:a[M],valueSpec:u.transition,style:m,styleSpec:u}):h[M]?Di({key:M,value:a[M],valueSpec:h[M],style:m,styleSpec:u}):[new Be(M,a[M],'unknown property "'+M+'"')])}return x}var au={"*":function(){return[]},array:qc,boolean:function(t){var a=t.value,u=t.key,h=Ea(a);return h!=="boolean"?[new Be(u,a,"boolean expected, "+h+" found")]:[]},number:Kc,color:function(t){var a=t.key,u=t.value,h=Ea(u);return h!=="string"?[new Be(a,u,"color expected, "+h+" found")]:Ii(u)===null?[new Be(a,u,'color expected, "'+u+'" found')]:[]},constants:yt,enum:Yl,filter:tf,function:$c,layer:$h,object:Gs,source:ql,light:Al,string:rs,formatted:function(t){return rs(t).length===0?[]:Hu(t)},resolvedImage:function(t){return rs(t).length===0?[]:Hu(t)}};function Di(t){var a=t.value,u=t.valueSpec,h=t.styleSpec;return u.expression&&Sl(Dt(a))?$c(t):u.expression&&No(Ft(a))?Hu(t):u.type&&au[u.type]?au[u.type](t):Gs(dr({},t,{valueSpec:u.type?h[u.type]:u}))}function ka(t){var a=t.value,u=t.key,h=rs(t);return h.length||(a.indexOf("{fontstack}")===-1&&h.push(new Be(u,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&h.push(new Be(u,a,'"glyphs" url must include a "{range}" token'))),h}function Ls(t,a){a===void 0&&(a=pe);var u=[];return u=u.concat(Di({key:"",value:t,valueSpec:a.$root,styleSpec:a,style:t,objectElementValidators:{glyphs:ka,"*":function(){return[]}}})),t.constants&&(u=u.concat(yt({key:"constants",value:t.constants,style:t,styleSpec:a}))),rf(u)}function rf(t){return[].concat(t).sort(function(a,u){return a.line-u.line})}function ul(t){return function(){for(var a=[],u=arguments.length;u--;)a[u]=arguments[u];return rf(t.apply(this,a))}}Ls.source=ul(ql),Ls.light=ul(Al),Ls.layer=ul($h),Ls.filter=ul(tf),Ls.paintProperty=ul(fh),Ls.layoutProperty=ul(wl);var nf=Ls,Jh=nf.light,Qh=nf.paintProperty,Tc=nf.layoutProperty;function Kl(t,a){var u=!1;if(a&&a.length)for(var h=0,m=a;h<m.length;h+=1)t.fire(new Ge(new Error(m[h].message))),u=!0;return u}var Wu=ko;function ko(t,a,u){var h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(a=m[1])+2*(u=m[2]);for(var x=0;x<this.d*this.d;x++){var S=m[3+x],M=m[3+x+1];h.push(S===M?null:m.subarray(S,M))}var k=m[3+h.length+1];this.keys=m.subarray(m[3+h.length],k),this.bboxes=m.subarray(k),this.insert=this._insertReadonly}else{this.d=a+2*u;for(var U=0;U<this.d*this.d;U++)h.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=u,this.scale=a/t,this.uid=0;var j=u/a*t;this.min=-j,this.max=t+j}ko.prototype.insert=function(t,a,u,h,m){this._forEachCell(a,u,h,m,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(m)},ko.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ko.prototype._insertCell=function(t,a,u,h,m,x){this.cells[m].push(x)},ko.prototype.query=function(t,a,u,h,m){var x=this.min,S=this.max;if(t<=x&&a<=x&&S<=u&&S<=h&&!m)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(t,a,u,h,this._queryCell,M,{},m),M},ko.prototype._queryCell=function(t,a,u,h,m,x,S,M){var k=this.cells[m];if(k!==null)for(var U=this.keys,j=this.bboxes,H=0;H<k.length;H++){var te=k[H];if(S[te]===void 0){var ue=4*te;(M?M(j[ue+0],j[ue+1],j[ue+2],j[ue+3]):t<=j[ue+2]&&a<=j[ue+3]&&u>=j[ue+0]&&h>=j[ue+1])?(S[te]=!0,x.push(U[te])):S[te]=!1}}},ko.prototype._forEachCell=function(t,a,u,h,m,x,S,M){for(var k=this._convertToCellCoord(t),U=this._convertToCellCoord(a),j=this._convertToCellCoord(u),H=this._convertToCellCoord(h),te=k;te<=j;te++)for(var ue=U;ue<=H;ue++){var Te=this.d*ue+te;if((!M||M(this._convertFromCellCoord(te),this._convertFromCellCoord(ue),this._convertFromCellCoord(te+1),this._convertFromCellCoord(ue+1)))&&m.call(this,t,a,u,h,Te,x,S,M))return}},ko.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ko.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ko.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,a=3+this.cells.length+1+1,u=0,h=0;h<this.cells.length;h++)u+=this.cells[h].length;var m=new Int32Array(a+u+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var x=a,S=0;S<t.length;S++){var M=t[S];m[3+S]=x,m.set(M,x),x+=M.length}return m[3+t.length]=x,m.set(this.keys,x),m[3+t.length+1]=x+=this.keys.length,m.set(this.bboxes,x),x+=this.bboxes.length,m.buffer};var $l=ne.ImageData,Jl=ne.ImageBitmap,Ja={};function yn(t,a,u){u===void 0&&(u={}),Object.defineProperty(a,"_classRegistryKey",{value:t,writeable:!1}),Ja[t]={klass:a,omit:u.omit||[],shallow:u.shallow||[]}}for(var ao in yn("Object",Object),Wu.serialize=function(t,a){var u=t.toArrayBuffer();return a&&a.push(u),{buffer:u}},Wu.deserialize=function(t){return new Wu(t.buffer)},yn("Grid",Wu),yn("Color",Vi),yn("Error",Error),yn("ResolvedImage",Aa),yn("StylePropertyFunction",Gu),yn("StyleExpression",ol,{omit:["_evaluator"]}),yn("ZoomDependentExpression",zo),yn("ZoomConstantExpression",Vu),yn("CompoundExpression",go,{omit:["_evaluate"]}),wo)wo[ao]._classRegistryKey||yn("Expression_"+ao,wo[ao]);function Xu(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Yu(t){return Jl&&t instanceof Jl}function du(t,a){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Xu(t)||Yu(t))return a&&a.push(t),t;if(ArrayBuffer.isView(t)){var u=t;return a&&a.push(u.buffer),u}if(t instanceof $l)return a&&a.push(t.data.buffer),t;if(Array.isArray(t)){for(var h=[],m=0,x=t;m<x.length;m+=1)h.push(du(x[m],a));return h}if(typeof t=="object"){var S=t.constructor,M=S._classRegistryKey;if(!M)throw new Error("can't serialize object of unregistered class");var k=S.serialize?S.serialize(t,a):{};if(!S.serialize){for(var U in t)if(t.hasOwnProperty(U)&&!(Ja[M].omit.indexOf(U)>=0)){var j=t[U];k[U]=Ja[M].shallow.indexOf(U)>=0?j:du(j,a)}t instanceof Error&&(k.message=t.message)}if(k.$name)throw new Error("$name property is reserved for worker serialization logic.");return M!=="Object"&&(k.$name=M),k}throw new Error("can't serialize object of type "+typeof t)}function ks(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Xu(t)||Yu(t)||ArrayBuffer.isView(t)||t instanceof $l)return t;if(Array.isArray(t))return t.map(ks);if(typeof t=="object"){var a=t.$name||"Object",u=Ja[a].klass;if(!u)throw new Error("can't deserialize unregistered class "+a);if(u.deserialize)return u.deserialize(t);for(var h=Object.create(u.prototype),m=0,x=Object.keys(t);m<x.length;m+=1){var S=x[m];if(S!=="$name"){var M=t[S];h[S]=Ja[a].shallow.indexOf(S)>=0?M:ks(M)}}return h}throw new Error("can't deserialize object of type "+typeof t)}var Mf=function(){this.first=!0};Mf.prototype.update=function(t,a){var u=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=u,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=u,!0):(this.lastFloorZoom>u?(this.lastIntegerZoom=u+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<u&&(this.lastIntegerZoom=u,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=u,!0))};var $r={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function af(t){for(var a=0,u=t;a<u.length;a+=1)if(Pf(u[a].charCodeAt(0)))return!0;return!1}function Pf(t){return!(t!==746&&t!==747&&(t<4352||!($r["Bopomofo Extended"](t)||$r.Bopomofo(t)||$r["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||$r["CJK Compatibility Ideographs"](t)||$r["CJK Compatibility"](t)||$r["CJK Radicals Supplement"](t)||$r["CJK Strokes"](t)||!(!$r["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||$r["CJK Unified Ideographs Extension A"](t)||$r["CJK Unified Ideographs"](t)||$r["Enclosed CJK Letters and Months"](t)||$r["Hangul Compatibility Jamo"](t)||$r["Hangul Jamo Extended-A"](t)||$r["Hangul Jamo Extended-B"](t)||$r["Hangul Jamo"](t)||$r["Hangul Syllables"](t)||$r.Hiragana(t)||$r["Ideographic Description Characters"](t)||$r.Kanbun(t)||$r["Kangxi Radicals"](t)||$r["Katakana Phonetic Extensions"](t)||$r.Katakana(t)&&t!==12540||!(!$r["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!$r["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||$r["Unified Canadian Aboriginal Syllabics"](t)||$r["Unified Canadian Aboriginal Syllabics Extended"](t)||$r["Vertical Forms"](t)||$r["Yijing Hexagram Symbols"](t)||$r["Yi Syllables"](t)||$r["Yi Radicals"](t))))}function wu(t){return!(Pf(t)||function(a){return!!($r["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||$r["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||$r["Letterlike Symbols"](a)||$r["Number Forms"](a)||$r["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||$r["Control Pictures"](a)&&a!==9251||$r["Optical Character Recognition"](a)||$r["Enclosed Alphanumerics"](a)||$r["Geometric Shapes"](a)||$r["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||$r["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||$r["CJK Symbols and Punctuation"](a)||$r.Katakana(a)||$r["Private Use Area"](a)||$r["CJK Compatibility Forms"](a)||$r["Small Form Variants"](a)||$r["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(t))}function ja(t){return t>=1424&&t<=2303||$r["Arabic Presentation Forms-A"](t)||$r["Arabic Presentation Forms-B"](t)}function Ds(t,a){return!(!a&&ja(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||$r.Khmer(t))}function of(t){for(var a=0,u=t;a<u.length;a+=1)if(ja(u[a].charCodeAt(0)))return!0;return!1}var Au=null,ws="unavailable",Ao=null,hh=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(ws="error"),Au&&Au(t)};function ya(){If.fire(new Le("pluginStateChange",{pluginStatus:ws,pluginURL:Ao}))}var If=new rt,ph=function(){return ws},Hs=function(){if(ws!=="deferred"||!Ao)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ws="loading",ya(),Ao&&Ra({url:Ao},function(t){t?hh(t):(ws="loaded",ya())})},As={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ws==="loaded"||As.applyArabicShaping!=null},isLoading:function(){return ws==="loading"},setState:function(t){ws=t.pluginStatus,Ao=t.pluginURL},isParsed:function(){return As.applyArabicShaping!=null&&As.processBidirectionalText!=null&&As.processStyledBidirectionalText!=null},getPluginURL:function(){return Ao}},Oi=function(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Mf,this.transition={})};Oi.prototype.isSupportedScript=function(t){return function(a,u){for(var h=0,m=a;h<m.length;h+=1)if(!Ds(m[h].charCodeAt(0),u))return!1;return!0}(t,As.isLoaded())},Oi.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Oi.prototype.getCrossfadeParameters=function(){var t=this.zoom,a=t-Math.floor(t),u=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*u}:{fromScale:.5,toScale:1,t:1-(1-u)*a}};var vu=function(t,a){this.property=t,this.value=a,this.expression=function(u,h){if(Sl(u))return new Gu(u,h);if(No(u)){var m=Cl(u,h);if(m.result==="error")throw new Error(m.value.map(function(S){return S.key+": "+S.message}).join(", "));return m.value}var x=u;return typeof u=="string"&&h.type==="color"&&(x=Vi.parse(u)),{kind:"constant",evaluate:function(){return x}}}(a===void 0?t.specification.default:a,t.specification)};vu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},vu.prototype.possiblyEvaluate=function(t,a,u){return this.property.possiblyEvaluate(this,t,a,u)};var pa=function(t){this.property=t,this.value=new vu(t,void 0)};pa.prototype.transitioned=function(t,a){return new Fs(this.property,this.value,a,xt({},t.transition,this.transition),t.now)},pa.prototype.untransitioned=function(){return new Fs(this.property,this.value,null,{},0)};var ho=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};ho.prototype.getValue=function(t){return qe(this._values[t].value.value)},ho.prototype.setValue=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new pa(this._values[t].property)),this._values[t].value=new vu(this._values[t].property,a===null?void 0:qe(a))},ho.prototype.getTransition=function(t){return qe(this._values[t].transition)},ho.prototype.setTransition=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new pa(this._values[t].property)),this._values[t].transition=qe(a)||void 0},ho.prototype.serialize=function(){for(var t={},a=0,u=Object.keys(this._values);a<u.length;a+=1){var h=u[a],m=this.getValue(h);m!==void 0&&(t[h]=m);var x=this.getTransition(h);x!==void 0&&(t[h+"-transition"]=x)}return t},ho.prototype.transitioned=function(t,a){for(var u=new ou(this._properties),h=0,m=Object.keys(this._values);h<m.length;h+=1){var x=m[h];u._values[x]=this._values[x].transitioned(t,a._values[x])}return u},ho.prototype.untransitioned=function(){for(var t=new ou(this._properties),a=0,u=Object.keys(this._values);a<u.length;a+=1){var h=u[a];t._values[h]=this._values[h].untransitioned()}return t};var Fs=function(t,a,u,h,m){this.property=t,this.value=a,this.begin=m+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=u)};Fs.prototype.possiblyEvaluate=function(t,a,u){var h=t.now||0,m=this.value.possiblyEvaluate(t,a,u),x=this.prior;if(x){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return x.possiblyEvaluate(t,a,u);var S=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,a,u),m,function(M){if(M<=0)return 0;if(M>=1)return 1;var k=M*M,U=k*M;return 4*(M<.5?U:3*(M-k)+U-.75)}(S))}return m};var ou=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};ou.prototype.possiblyEvaluate=function(t,a,u){for(var h=new Ns(this._properties),m=0,x=Object.keys(this._values);m<x.length;m+=1){var S=x[m];h._values[S]=this._values[S].possiblyEvaluate(t,a,u)}return h},ou.prototype.hasTransition=function(){for(var t=0,a=Object.keys(this._values);t<a.length;t+=1)if(this._values[a[t]].prior)return!0;return!1};var Bs=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};Bs.prototype.getValue=function(t){return qe(this._values[t].value)},Bs.prototype.setValue=function(t,a){this._values[t]=new vu(this._values[t].property,a===null?void 0:qe(a))},Bs.prototype.serialize=function(){for(var t={},a=0,u=Object.keys(this._values);a<u.length;a+=1){var h=u[a],m=this.getValue(h);m!==void 0&&(t[h]=m)}return t},Bs.prototype.possiblyEvaluate=function(t,a,u){for(var h=new Ns(this._properties),m=0,x=Object.keys(this._values);m<x.length;m+=1){var S=x[m];h._values[S]=this._values[S].possiblyEvaluate(t,a,u)}return h};var cs=function(t,a,u){this.property=t,this.value=a,this.parameters=u};cs.prototype.isConstant=function(){return this.value.kind==="constant"},cs.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},cs.prototype.evaluate=function(t,a,u,h){return this.property.evaluate(this.value,this.parameters,t,a,u,h)};var Ns=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};Ns.prototype.get=function(t){return this._values[t]};var On=function(t){this.specification=t};On.prototype.possiblyEvaluate=function(t,a){return t.expression.evaluate(a)},On.prototype.interpolate=function(t,a,u){var h=yo[this.specification.type];return h?h(t,a,u):t};var wn=function(t,a){this.specification=t,this.overrides=a};wn.prototype.possiblyEvaluate=function(t,a,u,h){return new cs(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},u,h)}:t.expression,a)},wn.prototype.interpolate=function(t,a,u){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new cs(this,{kind:"constant",value:void 0},t.parameters);var h=yo[this.specification.type];return h?new cs(this,{kind:"constant",value:h(t.value.value,a.value.value,u)},t.parameters):t},wn.prototype.evaluate=function(t,a,u,h,m,x){return t.kind==="constant"?t.value:t.evaluate(a,u,h,m,x)};var Ql=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(u,h,m,x){if(u.value===void 0)return new cs(this,{kind:"constant",value:void 0},h);if(u.expression.kind==="constant"){var S=u.expression.evaluate(h,null,{},m,x),M=u.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,k=this._calculate(M,M,M,h);return new cs(this,{kind:"constant",value:k},h)}if(u.expression.kind==="camera"){var U=this._calculate(u.expression.evaluate({zoom:h.zoom-1}),u.expression.evaluate({zoom:h.zoom}),u.expression.evaluate({zoom:h.zoom+1}),h);return new cs(this,{kind:"constant",value:U},h)}return new cs(this,u.expression,h)},a.prototype.evaluate=function(u,h,m,x,S,M){if(u.kind==="source"){var k=u.evaluate(h,m,x,S,M);return this._calculate(k,k,k,h)}return u.kind==="composite"?this._calculate(u.evaluate({zoom:Math.floor(h.zoom)-1},m,x),u.evaluate({zoom:Math.floor(h.zoom)},m,x),u.evaluate({zoom:Math.floor(h.zoom)+1},m,x),h):u.value},a.prototype._calculate=function(u,h,m,x){return x.zoom>x.zoomHistory.lastIntegerZoom?{from:u,to:h}:{from:m,to:h}},a.prototype.interpolate=function(u){return u},a}(wn),fs=function(t){this.specification=t};fs.prototype.possiblyEvaluate=function(t,a,u,h){if(t.value!==void 0){if(t.expression.kind==="constant"){var m=t.expression.evaluate(a,null,{},u,h);return this._calculate(m,m,m,a)}return this._calculate(t.expression.evaluate(new Oi(Math.floor(a.zoom-1),a)),t.expression.evaluate(new Oi(Math.floor(a.zoom),a)),t.expression.evaluate(new Oi(Math.floor(a.zoom+1),a)),a)}},fs.prototype._calculate=function(t,a,u,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:u,to:a}},fs.prototype.interpolate=function(t){return t};var mu=function(t){this.specification=t};mu.prototype.possiblyEvaluate=function(t,a,u,h){return!!t.expression.evaluate(a,null,{},u,h)},mu.prototype.interpolate=function(){return!1};var Ko=function(t){for(var a in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var u=t[a];u.specification.overridable&&this.overridableProperties.push(a);var h=this.defaultPropertyValues[a]=new vu(u,void 0),m=this.defaultTransitionablePropertyValues[a]=new pa(u);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=h.possiblyEvaluate({})}};yn("DataDrivenProperty",wn),yn("DataConstantProperty",On),yn("CrossFadedDataDrivenProperty",Ql),yn("CrossFadedProperty",fs),yn("ColorRampProperty",mu);var Sa=function(t){function a(u,h){if(t.call(this),this.id=u.id,this.type=u.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},u.type!=="custom"&&(this.metadata=(u=u).metadata,this.minzoom=u.minzoom,this.maxzoom=u.maxzoom,u.type!=="background"&&(this.source=u.source,this.sourceLayer=u["source-layer"],this.filter=u.filter),h.layout&&(this._unevaluatedLayout=new Bs(h.layout)),h.paint)){for(var m in this._transitionablePaint=new ho(h.paint),u.paint)this.setPaintProperty(m,u.paint[m],{validate:!1});for(var x in u.layout)this.setLayoutProperty(x,u.layout[x],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ns(h.paint)}}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},a.prototype.getLayoutProperty=function(u){return u==="visibility"?this.visibility:this._unevaluatedLayout.getValue(u)},a.prototype.setLayoutProperty=function(u,h,m){m===void 0&&(m={}),h!=null&&this._validate(Tc,"layers."+this.id+".layout."+u,u,h,m)||(u!=="visibility"?this._unevaluatedLayout.setValue(u,h):this.visibility=h)},a.prototype.getPaintProperty=function(u){return X(u,"-transition")?this._transitionablePaint.getTransition(u.slice(0,-"-transition".length)):this._transitionablePaint.getValue(u)},a.prototype.setPaintProperty=function(u,h,m){if(m===void 0&&(m={}),h!=null&&this._validate(Qh,"layers."+this.id+".paint."+u,u,h,m))return!1;if(X(u,"-transition"))return this._transitionablePaint.setTransition(u.slice(0,-"-transition".length),h||void 0),!1;var x=this._transitionablePaint._values[u],S=x.property.specification["property-type"]==="cross-faded-data-driven",M=x.value.isDataDriven(),k=x.value;this._transitionablePaint.setValue(u,h),this._handleSpecialPaintPropertyUpdate(u);var U=this._transitionablePaint._values[u].value;return U.isDataDriven()||M||S||this._handleOverridablePaintPropertyUpdate(u,k,U)},a.prototype._handleSpecialPaintPropertyUpdate=function(u){},a.prototype._handleOverridablePaintPropertyUpdate=function(u,h,m){return!1},a.prototype.isHidden=function(u){return!!(this.minzoom&&u<this.minzoom)||!!(this.maxzoom&&u>=this.maxzoom)||this.visibility==="none"},a.prototype.updateTransitions=function(u){this._transitioningPaint=this._transitionablePaint.transitioned(u,this._transitioningPaint)},a.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},a.prototype.recalculate=function(u,h){u.getCrossfadeParameters&&(this._crossfadeParameters=u.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(u,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(u,void 0,h)},a.prototype.serialize=function(){var u={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(u.layout=u.layout||{},u.layout.visibility=this.visibility),vt(u,function(h,m){return!(h===void 0||m==="layout"&&!Object.keys(h).length||m==="paint"&&!Object.keys(h).length)})},a.prototype._validate=function(u,h,m,x,S){return S===void 0&&(S={}),(!S||S.validate!==!1)&&Kl(this,u.call(nf,{key:h,layerType:this.type,objectKey:m,value:x,styleSpec:pe,style:{glyphs:!0,sprite:!0}}))},a.prototype.is3D=function(){return!1},a.prototype.isTileClipped=function(){return!1},a.prototype.hasOffscreenPass=function(){return!1},a.prototype.resize=function(){},a.prototype.isStateDependent=function(){for(var u in this.paint._values){var h=this.paint.get(u);if(h instanceof cs&&Rs(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1},a}(rt),Mc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Pc=function(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},da=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ta(t,a){a===void 0&&(a=1);var u=0,h=0;return{members:t.map(function(m){var x=Mc[m.type].BYTES_PER_ELEMENT,S=u=Ic(u,Math.max(a,x)),M=m.components||1;return h=Math.max(h,x),u+=x*M,{name:m.name,type:m.type,components:M,offset:S}}),size:Ic(u,Math.max(h,a)),alignment:a}}function Ic(t,a){return Math.ceil(t/a)*a}da.serialize=function(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},da.deserialize=function(t){var a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a},da.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},da.prototype.clear=function(){this.length=0},da.prototype.resize=function(t){this.reserve(t),this.length=t},da.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}},da.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Tl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h){var m=this.length;return this.resize(m+1),this.emplace(m,u,h)},a.prototype.emplace=function(u,h,m){var x=2*u;return this.int16[x+0]=h,this.int16[x+1]=m,u},a}(da);Tl.prototype.bytesPerElement=4,yn("StructArrayLayout2i4",Tl);var gu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m,x){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,m,x)},a.prototype.emplace=function(u,h,m,x,S){var M=4*u;return this.int16[M+0]=h,this.int16[M+1]=m,this.int16[M+2]=x,this.int16[M+3]=S,u},a}(da);gu.prototype.bytesPerElement=8,yn("StructArrayLayout4i8",gu);var Ws=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m,x,S,M){var k=this.length;return this.resize(k+1),this.emplace(k,u,h,m,x,S,M)},a.prototype.emplace=function(u,h,m,x,S,M,k){var U=6*u;return this.int16[U+0]=h,this.int16[U+1]=m,this.int16[U+2]=x,this.int16[U+3]=S,this.int16[U+4]=M,this.int16[U+5]=k,u},a}(da);Ws.prototype.bytesPerElement=12,yn("StructArrayLayout2i4i12",Ws);var Do=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m,x,S,M){var k=this.length;return this.resize(k+1),this.emplace(k,u,h,m,x,S,M)},a.prototype.emplace=function(u,h,m,x,S,M,k){var U=4*u,j=8*u;return this.int16[U+0]=h,this.int16[U+1]=m,this.uint8[j+4]=x,this.uint8[j+5]=S,this.uint8[j+6]=M,this.uint8[j+7]=k,u},a}(da);Do.prototype.bytesPerElement=8,yn("StructArrayLayout2i4ub8",Do);var ll=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h){var m=this.length;return this.resize(m+1),this.emplace(m,u,h)},a.prototype.emplace=function(u,h,m){var x=2*u;return this.float32[x+0]=h,this.float32[x+1]=m,u},a}(da);ll.prototype.bytesPerElement=8,yn("StructArrayLayout2f8",ll);var yu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m,x,S,M,k,U,j,H){var te=this.length;return this.resize(te+1),this.emplace(te,u,h,m,x,S,M,k,U,j,H)},a.prototype.emplace=function(u,h,m,x,S,M,k,U,j,H,te){var ue=10*u;return this.uint16[ue+0]=h,this.uint16[ue+1]=m,this.uint16[ue+2]=x,this.uint16[ue+3]=S,this.uint16[ue+4]=M,this.uint16[ue+5]=k,this.uint16[ue+6]=U,this.uint16[ue+7]=j,this.uint16[ue+8]=H,this.uint16[ue+9]=te,u},a}(da);yu.prototype.bytesPerElement=20,yn("StructArrayLayout10ui20",yu);var sf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m,x,S,M,k,U,j,H,te,ue){var Te=this.length;return this.resize(Te+1),this.emplace(Te,u,h,m,x,S,M,k,U,j,H,te,ue)},a.prototype.emplace=function(u,h,m,x,S,M,k,U,j,H,te,ue,Te){var Oe=12*u;return this.int16[Oe+0]=h,this.int16[Oe+1]=m,this.int16[Oe+2]=x,this.int16[Oe+3]=S,this.uint16[Oe+4]=M,this.uint16[Oe+5]=k,this.uint16[Oe+6]=U,this.uint16[Oe+7]=j,this.int16[Oe+8]=H,this.int16[Oe+9]=te,this.int16[Oe+10]=ue,this.int16[Oe+11]=Te,u},a}(da);sf.prototype.bytesPerElement=24,yn("StructArrayLayout4i4ui4i24",sf);var Ml=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m){var x=this.length;return this.resize(x+1),this.emplace(x,u,h,m)},a.prototype.emplace=function(u,h,m,x){var S=3*u;return this.float32[S+0]=h,this.float32[S+1]=m,this.float32[S+2]=x,u},a}(da);Ml.prototype.bytesPerElement=12,yn("StructArrayLayout3f12",Ml);var Pl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},a.prototype.emplace=function(u,h){return this.uint32[1*u+0]=h,u},a}(da);Pl.prototype.bytesPerElement=4,yn("StructArrayLayout1ul4",Pl);var Il=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m,x,S,M,k,U,j){var H=this.length;return this.resize(H+1),this.emplace(H,u,h,m,x,S,M,k,U,j)},a.prototype.emplace=function(u,h,m,x,S,M,k,U,j,H){var te=10*u,ue=5*u;return this.int16[te+0]=h,this.int16[te+1]=m,this.int16[te+2]=x,this.int16[te+3]=S,this.int16[te+4]=M,this.int16[te+5]=k,this.uint32[ue+3]=U,this.uint16[te+8]=j,this.uint16[te+9]=H,u},a}(da);Il.prototype.bytesPerElement=20,yn("StructArrayLayout6i1ul2ui20",Il);var ec=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m,x,S,M){var k=this.length;return this.resize(k+1),this.emplace(k,u,h,m,x,S,M)},a.prototype.emplace=function(u,h,m,x,S,M,k){var U=6*u;return this.int16[U+0]=h,this.int16[U+1]=m,this.int16[U+2]=x,this.int16[U+3]=S,this.int16[U+4]=M,this.int16[U+5]=k,u},a}(da);ec.prototype.bytesPerElement=12,yn("StructArrayLayout2i2i2i12",ec);var cl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m,x,S){var M=this.length;return this.resize(M+1),this.emplace(M,u,h,m,x,S)},a.prototype.emplace=function(u,h,m,x,S,M){var k=4*u,U=8*u;return this.float32[k+0]=h,this.float32[k+1]=m,this.float32[k+2]=x,this.int16[U+6]=S,this.int16[U+7]=M,u},a}(da);cl.prototype.bytesPerElement=16,yn("StructArrayLayout2f1f2i16",cl);var dh=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m,x){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,m,x)},a.prototype.emplace=function(u,h,m,x,S){var M=12*u,k=3*u;return this.uint8[M+0]=h,this.uint8[M+1]=m,this.float32[k+1]=x,this.float32[k+2]=S,u},a}(da);dh.prototype.bytesPerElement=12,yn("StructArrayLayout2ub2f12",dh);var qu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m){var x=this.length;return this.resize(x+1),this.emplace(x,u,h,m)},a.prototype.emplace=function(u,h,m,x){var S=3*u;return this.uint16[S+0]=h,this.uint16[S+1]=m,this.uint16[S+2]=x,u},a}(da);qu.prototype.bytesPerElement=6,yn("StructArrayLayout3ui6",qu);var Tu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m,x,S,M,k,U,j,H,te,ue,Te,Oe,Ke,ze,ot){var Et=this.length;return this.resize(Et+1),this.emplace(Et,u,h,m,x,S,M,k,U,j,H,te,ue,Te,Oe,Ke,ze,ot)},a.prototype.emplace=function(u,h,m,x,S,M,k,U,j,H,te,ue,Te,Oe,Ke,ze,ot,Et){var Zt=24*u,Ht=12*u,cr=48*u;return this.int16[Zt+0]=h,this.int16[Zt+1]=m,this.uint16[Zt+2]=x,this.uint16[Zt+3]=S,this.uint32[Ht+2]=M,this.uint32[Ht+3]=k,this.uint32[Ht+4]=U,this.uint16[Zt+10]=j,this.uint16[Zt+11]=H,this.uint16[Zt+12]=te,this.float32[Ht+7]=ue,this.float32[Ht+8]=Te,this.uint8[cr+36]=Oe,this.uint8[cr+37]=Ke,this.uint8[cr+38]=ze,this.uint32[Ht+10]=ot,this.int16[Zt+22]=Et,u},a}(da);Tu.prototype.bytesPerElement=48,yn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Tu);var Of=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m,x,S,M,k,U,j,H,te,ue,Te,Oe,Ke,ze,ot,Et,Zt,Ht,cr,Lr,Vr,gn,cn,Nn,pn,wi){var Qn=this.length;return this.resize(Qn+1),this.emplace(Qn,u,h,m,x,S,M,k,U,j,H,te,ue,Te,Oe,Ke,ze,ot,Et,Zt,Ht,cr,Lr,Vr,gn,cn,Nn,pn,wi)},a.prototype.emplace=function(u,h,m,x,S,M,k,U,j,H,te,ue,Te,Oe,Ke,ze,ot,Et,Zt,Ht,cr,Lr,Vr,gn,cn,Nn,pn,wi,Qn){var Pn=34*u,Zi=17*u;return this.int16[Pn+0]=h,this.int16[Pn+1]=m,this.int16[Pn+2]=x,this.int16[Pn+3]=S,this.int16[Pn+4]=M,this.int16[Pn+5]=k,this.int16[Pn+6]=U,this.int16[Pn+7]=j,this.uint16[Pn+8]=H,this.uint16[Pn+9]=te,this.uint16[Pn+10]=ue,this.uint16[Pn+11]=Te,this.uint16[Pn+12]=Oe,this.uint16[Pn+13]=Ke,this.uint16[Pn+14]=ze,this.uint16[Pn+15]=ot,this.uint16[Pn+16]=Et,this.uint16[Pn+17]=Zt,this.uint16[Pn+18]=Ht,this.uint16[Pn+19]=cr,this.uint16[Pn+20]=Lr,this.uint16[Pn+21]=Vr,this.uint16[Pn+22]=gn,this.uint32[Zi+12]=cn,this.float32[Zi+13]=Nn,this.float32[Zi+14]=pn,this.float32[Zi+15]=wi,this.float32[Zi+16]=Qn,u},a}(da);Of.prototype.bytesPerElement=68,yn("StructArrayLayout8i15ui1ul4f68",Of);var fl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},a.prototype.emplace=function(u,h){return this.float32[1*u+0]=h,u},a}(da);fl.prototype.bytesPerElement=4,yn("StructArrayLayout1f4",fl);var Xs=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m){var x=this.length;return this.resize(x+1),this.emplace(x,u,h,m)},a.prototype.emplace=function(u,h,m,x){var S=3*u;return this.int16[S+0]=h,this.int16[S+1]=m,this.int16[S+2]=x,u},a}(da);Xs.prototype.bytesPerElement=6,yn("StructArrayLayout3i6",Xs);var uf=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m){var x=this.length;return this.resize(x+1),this.emplace(x,u,h,m)},a.prototype.emplace=function(u,h,m,x){var S=4*u;return this.uint32[2*u+0]=h,this.uint16[S+2]=m,this.uint16[S+3]=x,u},a}(da);uf.prototype.bytesPerElement=8,yn("StructArrayLayout1ul2ui8",uf);var _u=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h){var m=this.length;return this.resize(m+1),this.emplace(m,u,h)},a.prototype.emplace=function(u,h,m){var x=2*u;return this.uint16[x+0]=h,this.uint16[x+1]=m,u},a}(da);_u.prototype.bytesPerElement=4,yn("StructArrayLayout2ui4",_u);var vh=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u){var h=this.length;return this.resize(h+1),this.emplace(h,u)},a.prototype.emplace=function(u,h){return this.uint16[1*u+0]=h,u},a}(da);vh.prototype.bytesPerElement=2,yn("StructArrayLayout1ui2",vh);var tc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(u,h,m,x){var S=this.length;return this.resize(S+1),this.emplace(S,u,h,m,x)},a.prototype.emplace=function(u,h,m,x,S){var M=4*u;return this.float32[M+0]=h,this.float32[M+1]=m,this.float32[M+2]=x,this.float32[M+3]=S,u},a}(da);tc.prototype.bytesPerElement=16,yn("StructArrayLayout4f16",tc);var l=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var u={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return u.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},u.x1.get=function(){return this._structArray.int16[this._pos2+2]},u.y1.get=function(){return this._structArray.int16[this._pos2+3]},u.x2.get=function(){return this._structArray.int16[this._pos2+4]},u.y2.get=function(){return this._structArray.int16[this._pos2+5]},u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.anchorPoint.get=function(){return new re(this.anchorPointX,this.anchorPointY)},Object.defineProperties(a.prototype,u),a}(Pc);l.prototype.size=20;var f=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(u){return new l(this,u)},a}(Il);yn("CollisionBoxArray",f);var c=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},u.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},u.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},u.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},u.segment.get=function(){return this._structArray.uint16[this._pos2+10]},u.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},u.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},u.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},u.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},u.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},u.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},u.placedOrientation.set=function(h){this._structArray.uint8[this._pos1+37]=h},u.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},u.hidden.set=function(h){this._structArray.uint8[this._pos1+38]=h},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+10]=h},u.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(a.prototype,u),a}(Pc);c.prototype.size=48;var d=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(u){return new c(this,u)},a}(Tu);yn("PlacedSymbolArray",d);var b=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var u={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return u.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},u.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},u.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},u.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},u.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},u.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},u.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},u.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},u.key.get=function(){return this._structArray.uint16[this._pos2+8]},u.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},u.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},u.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},u.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},u.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},u.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},u.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},u.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},u.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},u.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},u.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},u.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},u.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},u.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},u.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},u.crossTileID.set=function(h){this._structArray.uint32[this._pos4+12]=h},u.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},u.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},u.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},u.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(a.prototype,u),a}(Pc);b.prototype.size=68;var C=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(u){return new b(this,u)},a}(Of);yn("SymbolInstanceArray",C);var A=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getoffsetX=function(u){return this.float32[1*u+0]},a}(fl);yn("GlyphOffsetArray",A);var L=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getx=function(u){return this.int16[3*u+0]},a.prototype.gety=function(u){return this.int16[3*u+1]},a.prototype.gettileUnitDistanceFromAnchor=function(u){return this.int16[3*u+2]},a}(Xs);yn("SymbolLineVertexArray",L);var Z=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var u={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return u.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},u.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},u.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(a.prototype,u),a}(Pc);Z.prototype.size=8;var V=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(u){return new Z(this,u)},a}(uf);yn("FeatureIndexArray",V);var le=Ta([{name:"a_pos",components:2,type:"Int16"}],4).members,fe=function(t){t===void 0&&(t=[]),this.segments=t};function de(t,a){return 256*(t=Pt(Math.floor(t),0,255))+Pt(Math.floor(a),0,255)}fe.prototype.prepareSegment=function(t,a,u,h){var m=this.segments[this.segments.length-1];return t>fe.MAX_VERTEX_ARRAY_LENGTH&&$e("Max vertices per segment is "+fe.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!m||m.vertexLength+t>fe.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:a.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},h!==void 0&&(m.sortKey=h),this.segments.push(m)),m},fe.prototype.get=function(){return this.segments},fe.prototype.destroy=function(){for(var t=0,a=this.segments;t<a.length;t+=1){var u=a[t];for(var h in u.vaos)u.vaos[h].destroy()}},fe.simpleSegment=function(t,a,u,h){return new fe([{vertexOffset:t,primitiveOffset:a,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])},fe.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yn("SegmentVector",fe);var ke=Ta([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Re=ee(function(t){t.exports=function(a,u){var h,m,x,S,M,k,U,j;for(m=a.length-(h=3&a.length),x=u,M=3432918353,k=461845907,j=0;j<m;)U=255&a.charCodeAt(j)|(255&a.charCodeAt(++j))<<8|(255&a.charCodeAt(++j))<<16|(255&a.charCodeAt(++j))<<24,++j,x=27492+(65535&(S=5*(65535&(x=(x^=U=(65535&(U=(U=(65535&U)*M+(((U>>>16)*M&65535)<<16)&4294967295)<<15|U>>>17))*k+(((U>>>16)*k&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(U=0,h){case 3:U^=(255&a.charCodeAt(j+2))<<16;case 2:U^=(255&a.charCodeAt(j+1))<<8;case 1:x^=U=(65535&(U=(U=(65535&(U^=255&a.charCodeAt(j)))*M+(((U>>>16)*M&65535)<<16)&4294967295)<<15|U>>>17))*k+(((U>>>16)*k&65535)<<16)&4294967295}return x^=a.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}}),He=ee(function(t){t.exports=function(a,u){for(var h,m=a.length,x=u^m,S=0;m>=4;)h=1540483477*(65535&(h=255&a.charCodeAt(S)|(255&a.charCodeAt(++S))<<8|(255&a.charCodeAt(++S))<<16|(255&a.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),m-=4,++S;switch(m){case 3:x^=(255&a.charCodeAt(S+2))<<16;case 2:x^=(255&a.charCodeAt(S+1))<<8;case 1:x=1540483477*(65535&(x^=255&a.charCodeAt(S)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}}),Ae=Re,We=He;Ae.murmur3=Re,Ae.murmur2=We;var tt=function(){this.ids=[],this.positions=[],this.indexed=!1};tt.prototype.add=function(t,a,u,h){this.ids.push(Yt(t)),this.positions.push(a,u,h)},tt.prototype.getPositions=function(t){for(var a=Yt(t),u=0,h=this.ids.length-1;u<h;){var m=u+h>>1;this.ids[m]>=a?h=m:u=m+1}for(var x=[];this.ids[u]===a;)x.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return x},tt.serialize=function(t,a){var u=new Float64Array(t.ids),h=new Uint32Array(t.positions);return function m(x,S,M,k){for(;M<k;){for(var U=x[M+k>>1],j=M-1,H=k+1;;){do j++;while(x[j]<U);do H--;while(x[H]>U);if(j>=H)break;zt(x,j,H),zt(S,3*j,3*H),zt(S,3*j+1,3*H+1),zt(S,3*j+2,3*H+2)}H-M<k-H?(m(x,S,M,H),M=H+1):(m(x,S,H+1,k),k=H)}}(u,h,0,u.length-1),a&&a.push(u.buffer,h.buffer),{ids:u,positions:h}},tt.deserialize=function(t){var a=new tt;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a};var bt=Math.pow(2,53)-1;function Yt(t){var a=+t;return!isNaN(a)&&a<=bt?a:Ae(String(t))}function zt(t,a,u){var h=t[a];t[a]=t[u],t[u]=h}yn("FeaturePositionMap",tt);var $t=function(t,a){this.gl=t.gl,this.location=a},gr=function(t){function a(u,h){t.call(this,u,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))},a}($t),Br=function(t){function a(u,h){t.call(this,u,h),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(u){this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))},a}($t),Fr=function(t){function a(u,h){t.call(this,u,h),this.current=[0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1]))},a}($t),sn=function(t){function a(u,h){t.call(this,u,h),this.current=[0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2]))},a}($t),kn=function(t){function a(u,h){t.call(this,u,h),this.current=[0,0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(u){u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3]))},a}($t),Dn=function(t){function a(u,h){t.call(this,u,h),this.current=Vi.transparent}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(u){u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a))},a}($t),zn=new Float32Array(16),ci=function(t){function a(u,h){t.call(this,u,h),this.current=zn}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(u){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(var h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}},a}($t);function ln(t){return[de(255*t.r,255*t.g),de(255*t.b,255*t.a)]}var Hn=function(t,a,u){this.value=t,this.uniformNames=a.map(function(h){return"u_"+h}),this.type=u};Hn.prototype.setUniform=function(t,a,u){t.set(u.constantOr(this.value))},Hn.prototype.getBinding=function(t,a,u){return this.type==="color"?new Dn(t,a):new Br(t,a)};var fi=function(t,a){this.uniformNames=a.map(function(u){return"u_"+u}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};fi.prototype.setConstantPatternPositions=function(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr},fi.prototype.setUniform=function(t,a,u,h){var m=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)},fi.prototype.getBinding=function(t,a,u){return u.substr(0,9)==="u_pattern"?new kn(t,a):new Br(t,a)};var Yn=function(t,a,u,h){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map(function(m){return{name:"a_"+m,type:"Float32",components:u==="color"?2:1,offset:0}}),this.paintVertexArray=new h};Yn.prototype.populatePaintArray=function(t,a,u,h,m){var x=this.paintVertexArray.length,S=this.expression.evaluate(new Oi(0),a,{},h,[],m);this.paintVertexArray.resize(t),this._setPaintValue(x,t,S)},Yn.prototype.updatePaintArray=function(t,a,u,h){var m=this.expression.evaluate({zoom:0},u,h);this._setPaintValue(t,a,m)},Yn.prototype._setPaintValue=function(t,a,u){if(this.type==="color")for(var h=ln(u),m=t;m<a;m++)this.paintVertexArray.emplace(m,h[0],h[1]);else{for(var x=t;x<a;x++)this.paintVertexArray.emplace(x,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}},Yn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Yn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Zn=function(t,a,u,h,m,x){this.expression=t,this.uniformNames=a.map(function(S){return"u_"+S+"_t"}),this.type=u,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=a.map(function(S){return{name:"a_"+S,type:"Float32",components:u==="color"?4:2,offset:0}}),this.paintVertexArray=new x};Zn.prototype.populatePaintArray=function(t,a,u,h,m){var x=this.expression.evaluate(new Oi(this.zoom),a,{},h,[],m),S=this.expression.evaluate(new Oi(this.zoom+1),a,{},h,[],m),M=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(M,t,x,S)},Zn.prototype.updatePaintArray=function(t,a,u,h){var m=this.expression.evaluate({zoom:this.zoom},u,h),x=this.expression.evaluate({zoom:this.zoom+1},u,h);this._setPaintValue(t,a,m,x)},Zn.prototype._setPaintValue=function(t,a,u,h){if(this.type==="color")for(var m=ln(u),x=ln(h),S=t;S<a;S++)this.paintVertexArray.emplace(S,m[0],m[1],x[0],x[1]);else{for(var M=t;M<a;M++)this.paintVertexArray.emplace(M,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}},Zn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Zn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Zn.prototype.setUniform=function(t,a){var u=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,h=Pt(this.expression.interpolationFactor(u,this.zoom,this.zoom+1),0,1);t.set(h)},Zn.prototype.getBinding=function(t,a,u){return new Br(t,a)};var vi=function(t,a,u,h,m,x){this.expression=t,this.type=a,this.useIntegerZoom=u,this.zoom=h,this.layerId=x,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m};vi.prototype.populatePaintArray=function(t,a,u){var h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,a.patterns&&a.patterns[this.layerId],u)},vi.prototype.updatePaintArray=function(t,a,u,h,m){this._setPaintValues(t,a,u.patterns&&u.patterns[this.layerId],m)},vi.prototype._setPaintValues=function(t,a,u,h){if(h&&u){var m=h[u.min],x=h[u.mid],S=h[u.max];if(m&&x&&S)for(var M=t;M<a;M++)this.zoomInPaintVertexArray.emplace(M,x.tl[0],x.tl[1],x.br[0],x.br[1],m.tl[0],m.tl[1],m.br[0],m.br[1],x.pixelRatio,m.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,x.tl[0],x.tl[1],x.br[0],x.br[1],S.tl[0],S.tl[1],S.br[0],S.br[1],x.pixelRatio,S.pixelRatio)}},vi.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,ke.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,ke.members,this.expression.isStateDependent))},vi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var qn=function(t,a,u){this.binders={},this._buffers=[];var h=[];for(var m in t.paint._values)if(u(m)){var x=t.paint.get(m);if(x instanceof cs&&Rs(x.property.specification)){var S=To(m,t.type),M=x.value,k=x.property.specification.type,U=x.property.useIntegerZoom,j=x.property.specification["property-type"],H=j==="cross-faded"||j==="cross-faded-data-driven";if(M.kind==="constant")this.binders[m]=H?new fi(M.value,S):new Hn(M.value,S,k),h.push("/u_"+m);else if(M.kind==="source"||H){var te=Li(m,k,"source");this.binders[m]=H?new vi(M,k,U,a,te,t.id):new Yn(M,S,k,te),h.push("/a_"+m)}else{var ue=Li(m,k,"composite");this.binders[m]=new Zn(M,S,k,U,a,ue),h.push("/z_"+m)}}}this.cacheKey=h.sort().join("")};qn.prototype.getMaxValue=function(t){var a=this.binders[t];return a instanceof Yn||a instanceof Zn?a.maxValue:0},qn.prototype.populatePaintArrays=function(t,a,u,h,m){for(var x in this.binders){var S=this.binders[x];(S instanceof Yn||S instanceof Zn||S instanceof vi)&&S.populatePaintArray(t,a,u,h,m)}},qn.prototype.setConstantPatternPositions=function(t,a){for(var u in this.binders){var h=this.binders[u];h instanceof fi&&h.setConstantPatternPositions(t,a)}},qn.prototype.updatePaintArrays=function(t,a,u,h,m){var x=!1;for(var S in t)for(var M=0,k=a.getPositions(S);M<k.length;M+=1){var U=k[M],j=u.feature(U.index);for(var H in this.binders){var te=this.binders[H];if((te instanceof Yn||te instanceof Zn||te instanceof vi)&&te.expression.isStateDependent===!0){var ue=h.paint.get(H);te.expression=ue.value,te.updatePaintArray(U.start,U.end,j,t[S],m),x=!0}}}return x},qn.prototype.defines=function(){var t=[];for(var a in this.binders){var u=this.binders[a];(u instanceof Hn||u instanceof fi)&&t.push.apply(t,u.uniformNames.map(function(h){return"#define HAS_UNIFORM_"+h}))}return t},qn.prototype.getBinderAttributes=function(){var t=[];for(var a in this.binders){var u=this.binders[a];if(u instanceof Yn||u instanceof Zn)for(var h=0;h<u.paintVertexAttributes.length;h++)t.push(u.paintVertexAttributes[h].name);else if(u instanceof vi)for(var m=0;m<ke.members.length;m++)t.push(ke.members[m].name)}return t},qn.prototype.getBinderUniforms=function(){var t=[];for(var a in this.binders){var u=this.binders[a];if(u instanceof Hn||u instanceof fi||u instanceof Zn)for(var h=0,m=u.uniformNames;h<m.length;h+=1)t.push(m[h])}return t},qn.prototype.getPaintVertexBuffers=function(){return this._buffers},qn.prototype.getUniforms=function(t,a){var u=[];for(var h in this.binders){var m=this.binders[h];if(m instanceof Hn||m instanceof fi||m instanceof Zn)for(var x=0,S=m.uniformNames;x<S.length;x+=1){var M=S[x];if(a[M]){var k=m.getBinding(t,a[M],M);u.push({name:M,property:h,binding:k})}}}return u},qn.prototype.setUniforms=function(t,a,u,h){for(var m=0,x=a;m<x.length;m+=1){var S=x[m],M=S.name,k=S.property;this.binders[k].setUniform(S.binding,h,u.get(k),M)}},qn.prototype.updatePaintBuffers=function(t){for(var a in this._buffers=[],this.binders){var u=this.binders[a];if(t&&u instanceof vi){var h=t.fromScale===2?u.zoomInPaintVertexBuffer:u.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(u instanceof Yn||u instanceof Zn)&&u.paintVertexBuffer&&this._buffers.push(u.paintVertexBuffer)}},qn.prototype.upload=function(t){for(var a in this.binders){var u=this.binders[a];(u instanceof Yn||u instanceof Zn||u instanceof vi)&&u.upload(t)}this.updatePaintBuffers()},qn.prototype.destroy=function(){for(var t in this.binders){var a=this.binders[t];(a instanceof Yn||a instanceof Zn||a instanceof vi)&&a.destroy()}};var Vn=function(t,a,u){u===void 0&&(u=function(){return!0}),this.programConfigurations={};for(var h=0,m=t;h<m.length;h+=1){var x=m[h];this.programConfigurations[x.id]=new qn(x,a,u)}this.needsUpload=!1,this._featureMap=new tt,this._bufferOffset=0};function To(t,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(a+"-","").replace(/-/g,"_")]}function Li(t,a,u){var h={color:{source:ll,composite:tc},number:{source:fl,composite:ll}},m=function(x){return{"line-pattern":{source:yu,composite:yu},"fill-pattern":{source:yu,composite:yu},"fill-extrusion-pattern":{source:yu,composite:yu}}[x]}(t);return m&&m[u]||h[a][u]}Vn.prototype.populatePaintArrays=function(t,a,u,h,m,x){for(var S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(t,a,h,m,x);a.id!==void 0&&this._featureMap.add(a.id,u,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},Vn.prototype.updatePaintArrays=function(t,a,u,h){for(var m=0,x=u;m<x.length;m+=1){var S=x[m];this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(t,this._featureMap,a,S,h)||this.needsUpload}},Vn.prototype.get=function(t){return this.programConfigurations[t]},Vn.prototype.upload=function(t){if(this.needsUpload){for(var a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}},Vn.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},yn("ConstantBinder",Hn),yn("CrossFadedConstantBinder",fi),yn("SourceExpressionBinder",Yn),yn("CrossFadedCompositeBinder",vi),yn("CompositeExpressionBinder",Zn),yn("ProgramConfiguration",qn,{omit:["_buffers"]}),yn("ProgramConfigurationSet",Vn);var Qi=Math.pow(2,14)-1,_o=-Qi-1;function Ya(t){for(var a=8192/t.extent,u=t.loadGeometry(),h=0;h<u.length;h++)for(var m=u[h],x=0;x<m.length;x++){var S=m[x],M=Math.round(S.x*a),k=Math.round(S.y*a);S.x=Pt(M,_o,Qi),S.y=Pt(k,_o,Qi),(M<S.x||M>S.x+1||k<S.y||k>S.y+1)&&$e("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return u}function Ua(t,a){return{type:t.type,id:t.id,properties:t.properties,geometry:a?Ya(t):[]}}function zs(t,a,u,h,m){t.emplaceBack(2*a+(h+1)/2,2*u+(m+1)/2)}var ys=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Tl,this.indexArray=new qu,this.segments=new fe,this.programConfigurations=new Vn(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Ku(t,a){for(var u=0;u<t.length;u++)if(Ts(a,t[u]))return!0;for(var h=0;h<a.length;h++)if(Ts(t,a[h]))return!0;return!!Oc(t,a)}function _s(t,a,u){return!!Ts(t,a)||!!$u(a,t,u)}function Ys(t,a){if(t.length===1)return hl(a,t[0]);for(var u=0;u<a.length;u++)for(var h=a[u],m=0;m<h.length;m++)if(Ts(t,h[m]))return!0;for(var x=0;x<t.length;x++)if(hl(a,t[x]))return!0;for(var S=0;S<a.length;S++)if(Oc(t,a[S]))return!0;return!1}function xo(t,a,u){if(t.length>1){if(Oc(t,a))return!0;for(var h=0;h<a.length;h++)if($u(a[h],t,u))return!0}for(var m=0;m<t.length;m++)if($u(t[m],a,u))return!0;return!1}function Oc(t,a){if(t.length===0||a.length===0)return!1;for(var u=0;u<t.length-1;u++)for(var h=t[u],m=t[u+1],x=0;x<a.length-1;x++)if(rc(h,m,a[x],a[x+1]))return!0;return!1}function rc(t,a,u,h){return kt(t,u,h)!==kt(a,u,h)&&kt(t,a,u)!==kt(t,a,h)}function $u(t,a,u){var h=u*u;if(a.length===1)return t.distSqr(a[0])<h;for(var m=1;m<a.length;m++)if(su(t,a[m-1],a[m])<h)return!0;return!1}function su(t,a,u){var h=a.distSqr(u);if(h===0)return t.distSqr(a);var m=((t.x-a.x)*(u.x-a.x)+(t.y-a.y)*(u.y-a.y))/h;return t.distSqr(m<0?a:m>1?u:u.sub(a)._mult(m)._add(a))}function hl(t,a){for(var u,h,m,x=!1,S=0;S<t.length;S++)for(var M=0,k=(u=t[S]).length-1;M<u.length;k=M++)(h=u[M]).y>a.y!=(m=u[k]).y>a.y&&a.x<(m.x-h.x)*(a.y-h.y)/(m.y-h.y)+h.x&&(x=!x);return x}function Ts(t,a){for(var u=!1,h=0,m=t.length-1;h<t.length;m=h++){var x=t[h],S=t[m];x.y>a.y!=S.y>a.y&&a.x<(S.x-x.x)*(a.y-x.y)/(S.y-x.y)+x.x&&(u=!u)}return u}function pl(t,a,u){var h=u[0],m=u[2];if(t.x<h.x&&a.x<h.x||t.x>m.x&&a.x>m.x||t.y<h.y&&a.y<h.y||t.y>m.y&&a.y>m.y)return!1;var x=kt(t,a,u[0]);return x!==kt(t,a,u[1])||x!==kt(t,a,u[2])||x!==kt(t,a,u[3])}function uu(t,a,u){var h=a.paint.get(t).value;return h.kind==="constant"?h.value:u.programConfigurations.get(a.id).getMaxValue(t)}function oo(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function qs(t,a,u,h,m){if(!a[0]&&!a[1])return t;var x=re.convert(a)._mult(m);u==="viewport"&&x._rotate(-h);for(var S=[],M=0;M<t.length;M++)S.push(t[M].sub(x));return S}ys.prototype.populate=function(t,a,u){var h=this.layers[0],m=[],x=null;h.type==="circle"&&(x=h.layout.get("circle-sort-key"));for(var S=0,M=t;S<M.length;S+=1){var k=M[S],U=k.feature,j=k.id,H=k.index,te=k.sourceLayerIndex,ue=this.layers[0]._featureFilter.needGeometry,Te=Ua(U,ue);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),Te,u)){var Oe=x?x.evaluate(Te,{},u):void 0,Ke={id:j,properties:U.properties,type:U.type,sourceLayerIndex:te,index:H,geometry:ue?Te.geometry:Ya(U),patterns:{},sortKey:Oe};m.push(Ke)}}x&&m.sort(function(Vr,gn){return Vr.sortKey-gn.sortKey});for(var ze=0,ot=m;ze<ot.length;ze+=1){var Et=ot[ze],Zt=Et.geometry,Ht=Et.index,cr=Et.sourceLayerIndex,Lr=t[Ht].feature;this.addFeature(Et,Zt,Ht,u),a.featureIndex.insert(Lr,Zt,Ht,cr,this.index)}},ys.prototype.update=function(t,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,u)},ys.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ys.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ys.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,le),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},ys.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},ys.prototype.addFeature=function(t,a,u,h){for(var m=0,x=a;m<x.length;m+=1)for(var S=0,M=x[m];S<M.length;S+=1){var k=M[S],U=k.x,j=k.y;if(!(U<0||U>=8192||j<0||j>=8192)){var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),te=H.vertexLength;zs(this.layoutVertexArray,U,j,-1,-1),zs(this.layoutVertexArray,U,j,1,-1),zs(this.layoutVertexArray,U,j,1,1),zs(this.layoutVertexArray,U,j,-1,1),this.indexArray.emplaceBack(te,te+1,te+2),this.indexArray.emplaceBack(te,te+3,te+2),H.vertexLength+=4,H.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},h)},yn("CircleBucket",ys,{omit:["layers"]});var Mu=new Ko({"circle-sort-key":new wn(pe.layout_circle["circle-sort-key"])}),Pu={paint:new Ko({"circle-radius":new wn(pe.paint_circle["circle-radius"]),"circle-color":new wn(pe.paint_circle["circle-color"]),"circle-blur":new wn(pe.paint_circle["circle-blur"]),"circle-opacity":new wn(pe.paint_circle["circle-opacity"]),"circle-translate":new On(pe.paint_circle["circle-translate"]),"circle-translate-anchor":new On(pe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new On(pe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new On(pe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new wn(pe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new wn(pe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new wn(pe.paint_circle["circle-stroke-opacity"])}),layout:Mu},ea=typeof Float32Array!="undefined"?Float32Array:Array;function Ms(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function hs(t,a,u){var h=a[0],m=a[1],x=a[2],S=a[3],M=a[4],k=a[5],U=a[6],j=a[7],H=a[8],te=a[9],ue=a[10],Te=a[11],Oe=a[12],Ke=a[13],ze=a[14],ot=a[15],Et=u[0],Zt=u[1],Ht=u[2],cr=u[3];return t[0]=Et*h+Zt*M+Ht*H+cr*Oe,t[1]=Et*m+Zt*k+Ht*te+cr*Ke,t[2]=Et*x+Zt*U+Ht*ue+cr*ze,t[3]=Et*S+Zt*j+Ht*Te+cr*ot,t[4]=(Et=u[4])*h+(Zt=u[5])*M+(Ht=u[6])*H+(cr=u[7])*Oe,t[5]=Et*m+Zt*k+Ht*te+cr*Ke,t[6]=Et*x+Zt*U+Ht*ue+cr*ze,t[7]=Et*S+Zt*j+Ht*Te+cr*ot,t[8]=(Et=u[8])*h+(Zt=u[9])*M+(Ht=u[10])*H+(cr=u[11])*Oe,t[9]=Et*m+Zt*k+Ht*te+cr*Ke,t[10]=Et*x+Zt*U+Ht*ue+cr*ze,t[11]=Et*S+Zt*j+Ht*Te+cr*ot,t[12]=(Et=u[12])*h+(Zt=u[13])*M+(Ht=u[14])*H+(cr=u[15])*Oe,t[13]=Et*m+Zt*k+Ht*te+cr*Ke,t[14]=Et*x+Zt*U+Ht*ue+cr*ze,t[15]=Et*S+Zt*j+Ht*Te+cr*ot,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,a=0,u=arguments.length;u--;)a+=t[u]*t[u];return Math.sqrt(a)});var Iu,Us=hs;function nc(t,a,u){var h=a[0],m=a[1],x=a[2],S=a[3];return t[0]=u[0]*h+u[4]*m+u[8]*x+u[12]*S,t[1]=u[1]*h+u[5]*m+u[9]*x+u[13]*S,t[2]=u[2]*h+u[6]*m+u[10]*x+u[14]*S,t[3]=u[3]*h+u[7]*m+u[11]*x+u[15]*S,t}Iu=new ea(3),ea!=Float32Array&&(Iu[0]=0,Iu[1]=0,Iu[2]=0),function(){var t=new ea(4);ea!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var lf=(function(){var t=new ea(2);ea!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function a(u){t.call(this,u,Pu)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(u){return new ys(u)},a.prototype.queryRadius=function(u){var h=u;return uu("circle-radius",this,h)+uu("circle-stroke-width",this,h)+oo(this.paint.get("circle-translate"))},a.prototype.queryIntersectsFeature=function(u,h,m,x,S,M,k,U){for(var j=qs(u,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),M.angle,k),H=this.paint.get("circle-radius").evaluate(h,m)+this.paint.get("circle-stroke-width").evaluate(h,m),te=this.paint.get("circle-pitch-alignment")==="map",ue=te?j:function(Lr,Vr){return Lr.map(function(gn){return Ks(gn,Vr)})}(j,U),Te=te?H*k:H,Oe=0,Ke=x;Oe<Ke.length;Oe+=1)for(var ze=0,ot=Ke[Oe];ze<ot.length;ze+=1){var Et=ot[ze],Zt=te?Et:Ks(Et,U),Ht=Te,cr=nc([],[Et.x,Et.y,0,1],U);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ht*=cr[3]/M.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ht*=M.cameraToCenterDistance/cr[3]),_s(ue,Zt,Ht))return!0}return!1},a}(Sa));function Ks(t,a){var u=nc([],[t.x,t.y,0,1],a);return new re(u[0]/u[3],u[1]/u[3])}var ic=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(ys);function lu(t,a,u,h){var m=a.width,x=a.height;if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==m*x*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(m*x*u);return t.width=m,t.height=x,t.data=h,t}function dl(t,a,u){var h=a.width,m=a.height;if(h!==t.width||m!==t.height){var x=lu({},{width:h,height:m},u);Rc(t,x,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,h),height:Math.min(t.height,m)},u),t.width=h,t.height=m,t.data=x.data}}function Rc(t,a,u,h,m,x){if(m.width===0||m.height===0)return a;if(m.width>t.width||m.height>t.height||u.x>t.width-m.width||u.y>t.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>a.width||m.height>a.height||h.x>a.width-m.width||h.y>a.height-m.height)throw new RangeError("out of range destination coordinates for image copy");for(var S=t.data,M=a.data,k=0;k<m.height;k++)for(var U=((u.y+k)*t.width+u.x)*x,j=((h.y+k)*a.width+h.x)*x,H=0;H<m.width*x;H++)M[j+H]=S[U+H];return a}yn("HeatmapBucket",ic,{omit:["layers"]});var $s=function(t,a){lu(this,t,1,a)};$s.prototype.resize=function(t){dl(this,t,1)},$s.prototype.clone=function(){return new $s({width:this.width,height:this.height},new Uint8Array(this.data))},$s.copy=function(t,a,u,h,m){Rc(t,a,u,h,m,1)};var Da=function(t,a){lu(this,t,4,a)};Da.prototype.resize=function(t){dl(this,t,4)},Da.prototype.replace=function(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},Da.prototype.clone=function(){return new Da({width:this.width,height:this.height},new Uint8Array(this.data))},Da.copy=function(t,a,u,h,m){Rc(t,a,u,h,m,4)},yn("AlphaImage",$s),yn("RGBAImage",Da);var Lc={paint:new Ko({"heatmap-radius":new wn(pe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new wn(pe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new On(pe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new mu(pe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new On(pe.paint_heatmap["heatmap-opacity"])})};function Rf(t){var a={},u=t.resolution||256,h=t.clips?t.clips.length:1,m=t.image||new Da({width:u,height:h}),x=function(Te,Oe,Ke){a[t.evaluationKey]=Ke;var ze=t.expression.evaluate(a);m.data[Te+Oe+0]=Math.floor(255*ze.r/ze.a),m.data[Te+Oe+1]=Math.floor(255*ze.g/ze.a),m.data[Te+Oe+2]=Math.floor(255*ze.b/ze.a),m.data[Te+Oe+3]=Math.floor(255*ze.a)};if(t.clips)for(var S=0,M=0;S<h;++S,M+=4*u)for(var k=0,U=0;k<u;k++,U+=4){var j=k/(u-1),H=t.clips[S];x(M,U,H.start*(1-j)+H.end*j)}else for(var te=0,ue=0;te<u;te++,ue+=4)x(0,ue,te/(u-1));return m}var Lf=function(t){function a(u){t.call(this,u,Lc),this._updateColorRamp()}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(u){return new ic(u)},a.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="heatmap-color"&&this._updateColorRamp()},a.prototype._updateColorRamp=function(){this.colorRamp=Rf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},a.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},a}(Sa),cf={paint:new Ko({"hillshade-illumination-direction":new On(pe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new On(pe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new On(pe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new On(pe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new On(pe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new On(pe.paint_hillshade["hillshade-accent-color"])})},mh=function(t){function a(u){t.call(this,u,cf)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},a}(Sa),gh=Ta([{name:"a_pos",components:2,type:"Int16"}],4).members,ac=yh,ff=yh;function yh(t,a,u){u=u||2;var h,m,x,S,M,k,U,j=a&&a.length,H=j?a[0]*u:t.length,te=ep(t,0,H,u,!0),ue=[];if(!te||te.next===te.prev)return ue;if(j&&(te=function(Oe,Ke,ze,ot){var Et,Zt,Ht,cr=[];for(Et=0,Zt=Ke.length;Et<Zt;Et++)(Ht=ep(Oe,Ke[Et]*ot,Et<Zt-1?Ke[Et+1]*ot:Oe.length,ot,!1))===Ht.next&&(Ht.steiner=!0),cr.push(Fp(Ht));for(cr.sort(bd),Et=0;Et<cr.length;Et++)Ed(cr[Et],ze),ze=Ol(ze,ze.next);return ze}(t,a,te,u)),t.length>80*u){h=x=t[0],m=S=t[1];for(var Te=u;Te<H;Te+=u)(M=t[Te])<h&&(h=M),(k=t[Te+1])<m&&(m=k),M>x&&(x=M),k>S&&(S=k);U=(U=Math.max(x-h,S-m))!==0?1/U:0}return hf(te,ue,u,h,m,U),ue}function ep(t,a,u,h,m){var x,S;if(m===Df(t,a,u,h)>0)for(x=a;x<u;x+=h)S=vl(x,t[x],t[x+1],S);else for(x=u-h;x>=a;x-=h)S=vl(x,t[x],t[x+1],S);return S&&_h(S,S.next)&&(oc(S),S=S.next),S}function Ol(t,a){if(!t)return t;a||(a=t);var u,h=t;do if(u=!1,h.steiner||!_h(h,h.next)&&bo(h.prev,h,h.next)!==0)h=h.next;else{if(oc(h),(h=a=h.prev)===h.next)break;u=!0}while(u||h!==a);return a}function hf(t,a,u,h,m,x,S){if(t){!S&&x&&function(j,H,te,ue){var Te=j;do Te.z===null&&(Te.z=rp(Te.x,Te.y,H,te,ue)),Te.prevZ=Te.prev,Te.nextZ=Te.next,Te=Te.next;while(Te!==j);Te.prevZ.nextZ=null,Te.prevZ=null,function(Oe){var Ke,ze,ot,Et,Zt,Ht,cr,Lr,Vr=1;do{for(ze=Oe,Oe=null,Zt=null,Ht=0;ze;){for(Ht++,ot=ze,cr=0,Ke=0;Ke<Vr&&(cr++,ot=ot.nextZ);Ke++);for(Lr=Vr;cr>0||Lr>0&&ot;)cr!==0&&(Lr===0||!ot||ze.z<=ot.z)?(Et=ze,ze=ze.nextZ,cr--):(Et=ot,ot=ot.nextZ,Lr--),Zt?Zt.nextZ=Et:Oe=Et,Et.prevZ=Zt,Zt=Et;ze=ot}Zt.nextZ=null,Vr*=2}while(Ht>1)}(Te)}(t,h,m,x);for(var M,k,U=t;t.prev!==t.next;)if(M=t.prev,k=t.next,x?kp(t,h,m,x):Lp(t))a.push(M.i/u),a.push(t.i/u),a.push(k.i/u),oc(t),t=k.next,U=k.next;else if((t=k)===U){S?S===1?hf(t=kc(Ol(t),a,u),a,u,h,m,x,2):S===2&&tp(t,a,u,h,m,x):hf(Ol(t),a,u,h,m,x,1);break}}}function Lp(t){var a=t.prev,u=t,h=t.next;if(bo(a,u,h)>=0)return!1;for(var m=t.next.next;m!==t.prev;){if(pf(a.x,a.y,u.x,u.y,h.x,h.y,m.x,m.y)&&bo(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function kp(t,a,u,h){var m=t.prev,x=t,S=t.next;if(bo(m,x,S)>=0)return!1;for(var M=m.x>x.x?m.x>S.x?m.x:S.x:x.x>S.x?x.x:S.x,k=m.y>x.y?m.y>S.y?m.y:S.y:x.y>S.y?x.y:S.y,U=rp(m.x<x.x?m.x<S.x?m.x:S.x:x.x<S.x?x.x:S.x,m.y<x.y?m.y<S.y?m.y:S.y:x.y<S.y?x.y:S.y,a,u,h),j=rp(M,k,a,u,h),H=t.prevZ,te=t.nextZ;H&&H.z>=U&&te&&te.z<=j;){if(H!==t.prev&&H!==t.next&&pf(m.x,m.y,x.x,x.y,S.x,S.y,H.x,H.y)&&bo(H.prev,H,H.next)>=0||(H=H.prevZ,te!==t.prev&&te!==t.next&&pf(m.x,m.y,x.x,x.y,S.x,S.y,te.x,te.y)&&bo(te.prev,te,te.next)>=0))return!1;te=te.nextZ}for(;H&&H.z>=U;){if(H!==t.prev&&H!==t.next&&pf(m.x,m.y,x.x,x.y,S.x,S.y,H.x,H.y)&&bo(H.prev,H,H.next)>=0)return!1;H=H.prevZ}for(;te&&te.z<=j;){if(te!==t.prev&&te!==t.next&&pf(m.x,m.y,x.x,x.y,S.x,S.y,te.x,te.y)&&bo(te.prev,te,te.next)>=0)return!1;te=te.nextZ}return!0}function kc(t,a,u){var h=t;do{var m=h.prev,x=h.next.next;!_h(m,x)&&Np(m,h,h.next,x)&&kf(m,x)&&kf(x,m)&&(a.push(m.i/u),a.push(h.i/u),a.push(x.i/u),oc(h),oc(h.next),h=t=x),h=h.next}while(h!==t);return Ol(h)}function tp(t,a,u,h,m,x){var S=t;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&Bp(S,M)){var k=Eh(S,M);return S=Ol(S,S.next),k=Ol(k,k.next),hf(S,a,u,h,m,x),void hf(k,a,u,h,m,x)}M=M.next}S=S.next}while(S!==t)}function bd(t,a){return t.x-a.x}function Ed(t,a){if(a=function(h,m){var x,S=m,M=h.x,k=h.y,U=-1/0;do{if(k<=S.y&&k>=S.next.y&&S.next.y!==S.y){var j=S.x+(k-S.y)*(S.next.x-S.x)/(S.next.y-S.y);if(j<=M&&j>U){if(U=j,j===M){if(k===S.y)return S;if(k===S.next.y)return S.next}x=S.x<S.next.x?S:S.next}}S=S.next}while(S!==m);if(!x)return null;if(M===U)return x;var H,te=x,ue=x.x,Te=x.y,Oe=1/0;S=x;do M>=S.x&&S.x>=ue&&M!==S.x&&pf(k<Te?M:U,k,ue,Te,k<Te?U:M,k,S.x,S.y)&&(H=Math.abs(k-S.y)/(M-S.x),kf(S,h)&&(H<Oe||H===Oe&&(S.x>x.x||S.x===x.x&&Dp(x,S)))&&(x=S,Oe=H)),S=S.next;while(S!==te);return x}(t,a)){var u=Eh(a,t);Ol(a,a.next),Ol(u,u.next)}}function Dp(t,a){return bo(t.prev,t,a.prev)<0&&bo(a.next,t,t.next)<0}function rp(t,a,u,h,m){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-u)*m)|t<<8))|t<<4))|t<<2))|t<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-h)*m)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function Fp(t){var a=t,u=t;do(a.x<u.x||a.x===u.x&&a.y<u.y)&&(u=a),a=a.next;while(a!==t);return u}function pf(t,a,u,h,m,x,S,M){return(m-S)*(a-M)-(t-S)*(x-M)>=0&&(t-S)*(h-M)-(u-S)*(a-M)>=0&&(u-S)*(x-M)-(m-S)*(h-M)>=0}function Bp(t,a){return t.next.i!==a.i&&t.prev.i!==a.i&&!function(u,h){var m=u;do{if(m.i!==u.i&&m.next.i!==u.i&&m.i!==h.i&&m.next.i!==h.i&&Np(m,m.next,u,h))return!0;m=m.next}while(m!==u);return!1}(t,a)&&(kf(t,a)&&kf(a,t)&&function(u,h){var m=u,x=!1,S=(u.x+h.x)/2,M=(u.y+h.y)/2;do m.y>M!=m.next.y>M&&m.next.y!==m.y&&S<(m.next.x-m.x)*(M-m.y)/(m.next.y-m.y)+m.x&&(x=!x),m=m.next;while(m!==u);return x}(t,a)&&(bo(t.prev,t,a.prev)||bo(t,a.prev,a))||_h(t,a)&&bo(t.prev,t,t.next)>0&&bo(a.prev,a,a.next)>0)}function bo(t,a,u){return(a.y-t.y)*(u.x-a.x)-(a.x-t.x)*(u.y-a.y)}function _h(t,a){return t.x===a.x&&t.y===a.y}function Np(t,a,u,h){var m=bh(bo(t,a,u)),x=bh(bo(t,a,h)),S=bh(bo(u,h,t)),M=bh(bo(u,h,a));return m!==x&&S!==M||!(m!==0||!xh(t,u,a))||!(x!==0||!xh(t,h,a))||!(S!==0||!xh(u,t,h))||!(M!==0||!xh(u,a,h))}function xh(t,a,u){return a.x<=Math.max(t.x,u.x)&&a.x>=Math.min(t.x,u.x)&&a.y<=Math.max(t.y,u.y)&&a.y>=Math.min(t.y,u.y)}function bh(t){return t>0?1:t<0?-1:0}function kf(t,a){return bo(t.prev,t,t.next)<0?bo(t,a,t.next)>=0&&bo(t,t.prev,a)>=0:bo(t,a,t.prev)<0||bo(t,t.next,a)<0}function Eh(t,a){var u=new df(t.i,t.x,t.y),h=new df(a.i,a.x,a.y),m=t.next,x=a.prev;return t.next=a,a.prev=t,u.next=m,m.prev=u,h.next=u,u.prev=h,x.next=h,h.prev=x,h}function vl(t,a,u,h){var m=new df(t,a,u);return h?(m.next=h.next,m.prev=h,h.next.prev=m,h.next=m):(m.prev=m,m.next=m),m}function oc(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function df(t,a,u){this.i=t,this.x=a,this.y=u,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Df(t,a,u,h){for(var m=0,x=a,S=u-h;x<u;x+=h)m+=(t[S]-t[x])*(t[x+1]+t[S+1]),S=x;return m}function Sh(t,a,u,h,m){(function x(S,M,k,U,j){for(;U>k;){if(U-k>600){var H=U-k+1,te=M-k+1,ue=Math.log(H),Te=.5*Math.exp(2*ue/3),Oe=.5*Math.sqrt(ue*Te*(H-Te)/H)*(te-H/2<0?-1:1);x(S,M,Math.max(k,Math.floor(M-te*Te/H+Oe)),Math.min(U,Math.floor(M+(H-te)*Te/H+Oe)),j)}var Ke=S[M],ze=k,ot=U;for(Rl(S,k,M),j(S[U],Ke)>0&&Rl(S,k,U);ze<ot;){for(Rl(S,ze,ot),ze++,ot--;j(S[ze],Ke)<0;)ze++;for(;j(S[ot],Ke)>0;)ot--}j(S[k],Ke)===0?Rl(S,k,ot):Rl(S,++ot,U),ot<=M&&(k=ot+1),M<=ot&&(U=ot-1)}})(t,a,u||0,h||t.length-1,m||Ff)}function Rl(t,a,u){var h=t[a];t[a]=t[u],t[u]=h}function Ff(t,a){return t<a?-1:t>a?1:0}function Bf(t,a){var u=t.length;if(u<=1)return[t];for(var h,m,x=[],S=0;S<u;S++){var M=xr(t[S]);M!==0&&(t[S].area=Math.abs(M),m===void 0&&(m=M<0),m===M<0?(h&&x.push(h),h=[t[S]]):h.push(t[S]))}if(h&&x.push(h),a>1)for(var k=0;k<x.length;k++)x[k].length<=a||(Sh(x[k],a,1,x[k].length-1,Ch),x[k]=x[k].slice(0,a));return x}function Ch(t,a){return a.area-t.area}function Dc(t,a,u){for(var h=u.patternDependencies,m=!1,x=0,S=a;x<S.length;x+=1){var M=S[x].paint.get(t+"-pattern");M.isConstant()||(m=!0);var k=M.constantOr(null);k&&(m=!0,h[k.to]=!0,h[k.from]=!0)}return m}function Fc(t,a,u,h,m){for(var x=m.patternDependencies,S=0,M=a;S<M.length;S+=1){var k=M[S],U=k.paint.get(t+"-pattern").value;if(U.kind!=="constant"){var j=U.evaluate({zoom:h-1},u,{},m.availableImages),H=U.evaluate({zoom:h},u,{},m.availableImages),te=U.evaluate({zoom:h+1},u,{},m.availableImages);H=H&&H.name?H.name:H,te=te&&te.name?te.name:te,x[j=j&&j.name?j.name:j]=!0,x[H]=!0,x[te]=!0,u.patterns[k.id]={min:j,mid:H,max:te}}}return u}yh.deviation=function(t,a,u,h){var m=a&&a.length,x=Math.abs(Df(t,0,m?a[0]*u:t.length,u));if(m)for(var S=0,M=a.length;S<M;S++)x-=Math.abs(Df(t,a[S]*u,S<M-1?a[S+1]*u:t.length,u));var k=0;for(S=0;S<h.length;S+=3){var U=h[S]*u,j=h[S+1]*u,H=h[S+2]*u;k+=Math.abs((t[U]-t[H])*(t[j+1]-t[U+1])-(t[U]-t[j])*(t[H+1]-t[U+1]))}return x===0&&k===0?0:Math.abs((k-x)/x)},yh.flatten=function(t){for(var a=t[0][0].length,u={vertices:[],holes:[],dimensions:a},h=0,m=0;m<t.length;m++){for(var x=0;x<t[m].length;x++)for(var S=0;S<a;S++)u.vertices.push(t[m][x][S]);m>0&&u.holes.push(h+=t[m-1].length)}return u},ac.default=ff;var Js=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Tl,this.indexArray=new qu,this.indexArray2=new _u,this.programConfigurations=new Vn(t.layers,t.zoom),this.segments=new fe,this.segments2=new fe,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};Js.prototype.populate=function(t,a,u){this.hasPattern=Dc("fill",this.layers,a);for(var h=this.layers[0].layout.get("fill-sort-key"),m=[],x=0,S=t;x<S.length;x+=1){var M=S[x],k=M.feature,U=M.id,j=M.index,H=M.sourceLayerIndex,te=this.layers[0]._featureFilter.needGeometry,ue=Ua(k,te);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),ue,u)){var Te=h?h.evaluate(ue,{},u,a.availableImages):void 0,Oe={id:U,properties:k.properties,type:k.type,sourceLayerIndex:H,index:j,geometry:te?ue.geometry:Ya(k),patterns:{},sortKey:Te};m.push(Oe)}}h&&m.sort(function(Lr,Vr){return Lr.sortKey-Vr.sortKey});for(var Ke=0,ze=m;Ke<ze.length;Ke+=1){var ot=ze[Ke],Et=ot.geometry,Zt=ot.index,Ht=ot.sourceLayerIndex;if(this.hasPattern){var cr=Fc("fill",this.layers,ot,this.zoom,a);this.patternFeatures.push(cr)}else this.addFeature(ot,Et,Zt,u,{});a.featureIndex.insert(t[Zt].feature,Et,Zt,Ht,this.index)}},Js.prototype.update=function(t,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,u)},Js.prototype.addFeatures=function(t,a,u){for(var h=0,m=this.patternFeatures;h<m.length;h+=1){var x=m[h];this.addFeature(x,x.geometry,x.index,a,u)}},Js.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Js.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Js.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gh),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},Js.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Js.prototype.addFeature=function(t,a,u,h,m){for(var x=0,S=Bf(a,500);x<S.length;x+=1){for(var M=S[x],k=0,U=0,j=M;U<j.length;U+=1)k+=j[U].length;for(var H=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray),te=H.vertexLength,ue=[],Te=[],Oe=0,Ke=M;Oe<Ke.length;Oe+=1){var ze=Ke[Oe];if(ze.length!==0){ze!==M[0]&&Te.push(ue.length/2);var ot=this.segments2.prepareSegment(ze.length,this.layoutVertexArray,this.indexArray2),Et=ot.vertexLength;this.layoutVertexArray.emplaceBack(ze[0].x,ze[0].y),this.indexArray2.emplaceBack(Et+ze.length-1,Et),ue.push(ze[0].x),ue.push(ze[0].y);for(var Zt=1;Zt<ze.length;Zt++)this.layoutVertexArray.emplaceBack(ze[Zt].x,ze[Zt].y),this.indexArray2.emplaceBack(Et+Zt-1,Et+Zt),ue.push(ze[Zt].x),ue.push(ze[Zt].y);ot.vertexLength+=ze.length,ot.primitiveLength+=ze.length}}for(var Ht=ac(ue,Te),cr=0;cr<Ht.length;cr+=3)this.indexArray.emplaceBack(te+Ht[cr],te+Ht[cr+1],te+Ht[cr+2]);H.vertexLength+=k,H.primitiveLength+=Ht.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,m,h)},yn("FillBucket",Js,{omit:["layers","patternFeatures"]});var Nf=new Ko({"fill-sort-key":new wn(pe.layout_fill["fill-sort-key"])}),zf={paint:new Ko({"fill-antialias":new On(pe.paint_fill["fill-antialias"]),"fill-opacity":new wn(pe.paint_fill["fill-opacity"]),"fill-color":new wn(pe.paint_fill["fill-color"]),"fill-outline-color":new wn(pe.paint_fill["fill-outline-color"]),"fill-translate":new On(pe.paint_fill["fill-translate"]),"fill-translate-anchor":new On(pe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ql(pe.paint_fill["fill-pattern"])}),layout:Nf},Uf=function(t){function a(u){t.call(this,u,zf)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h);var m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},a.prototype.createBucket=function(u){return new Js(u)},a.prototype.queryRadius=function(){return oo(this.paint.get("fill-translate"))},a.prototype.queryIntersectsFeature=function(u,h,m,x,S,M,k){return Ys(qs(u,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),M.angle,k),x)},a.prototype.isTileClipped=function(){return!0},a}(Sa),Zf=Ta([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,np=zr;function zr(t,a,u,h,m){this.properties={},this.extent=u,this.type=0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=m,t.readFields(Bc,this,a)}function Bc(t,a,u){t==1?a.id=u.readVarint():t==2?function(h,m){for(var x=h.readVarint()+h.pos;h.pos<x;){var S=m._keys[h.readVarint()],M=m._values[h.readVarint()];m.properties[S]=M}}(u,a):t==3?a.type=u.readVarint():t==4&&(a._geometry=u.pos)}function Qt(t){for(var a,u,h=0,m=0,x=t.length,S=x-1;m<x;S=m++)h+=((u=t[S]).x-(a=t[m]).x)*(a.y+u.y);return h}zr.types=["Unknown","Point","LineString","Polygon"],zr.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var a,u=t.readVarint()+t.pos,h=1,m=0,x=0,S=0,M=[];t.pos<u;){if(m<=0){var k=t.readVarint();h=7&k,m=k>>3}if(m--,h===1||h===2)x+=t.readSVarint(),S+=t.readSVarint(),h===1&&(a&&M.push(a),a=[]),a.push(new re(x,S));else{if(h!==7)throw new Error("unknown command "+h);a&&a.push(a[0].clone())}}return a&&M.push(a),M},zr.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var a=t.readVarint()+t.pos,u=1,h=0,m=0,x=0,S=1/0,M=-1/0,k=1/0,U=-1/0;t.pos<a;){if(h<=0){var j=t.readVarint();u=7&j,h=j>>3}if(h--,u===1||u===2)(m+=t.readSVarint())<S&&(S=m),m>M&&(M=m),(x+=t.readSVarint())<k&&(k=x),x>U&&(U=x);else if(u!==7)throw new Error("unknown command "+u)}return[S,k,M,U]},zr.prototype.toGeoJSON=function(t,a,u){var h,m,x=this.extent*Math.pow(2,u),S=this.extent*t,M=this.extent*a,k=this.loadGeometry(),U=zr.types[this.type];function j(ue){for(var Te=0;Te<ue.length;Te++){var Oe=ue[Te];ue[Te]=[360*(Oe.x+S)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(Oe.y+M)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(h=0;h<k.length;h++)H[h]=k[h][0];j(k=H);break;case 2:for(h=0;h<k.length;h++)j(k[h]);break;case 3:for(k=function(ue){var Te=ue.length;if(Te<=1)return[ue];for(var Oe,Ke,ze=[],ot=0;ot<Te;ot++){var Et=Qt(ue[ot]);Et!==0&&(Ke===void 0&&(Ke=Et<0),Ke===Et<0?(Oe&&ze.push(Oe),Oe=[ue[ot]]):Oe.push(ue[ot]))}return Oe&&ze.push(Oe),ze}(k),h=0;h<k.length;h++)for(m=0;m<k[h].length;m++)j(k[h][m])}k.length===1?k=k[0]:U="Multi"+U;var te={type:"Feature",geometry:{type:U,coordinates:k},properties:this.properties};return"id"in this&&(te.id=this.id),te};var wh=zp;function zp(t,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Up,this,a),this.length=this._features.length}function Up(t,a,u){t===15?a.version=u.readVarint():t===1?a.name=u.readString():t===5?a.extent=u.readVarint():t===2?a._features.push(u.pos):t===3?a._keys.push(u.readString()):t===4&&a._values.push(function(h){for(var m=null,x=h.readVarint()+h.pos;h.pos<x;){var S=h.readVarint()>>3;m=S===1?h.readString():S===2?h.readFloat():S===3?h.readDouble():S===4?h.readVarint64():S===5?h.readVarint():S===6?h.readSVarint():S===7?h.readBoolean():null}return m}(u))}function Zp(t,a,u){if(t===3){var h=new wh(u,u.readVarint()+u.pos);h.length&&(a[h.name]=h)}}zp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var a=this._pbf.readVarint()+this._pbf.pos;return new np(this._pbf,a,this.extent,this._keys,this._values)};var cu={VectorTile:function(t,a){this.layers=t.readFields(Zp,{},a)},VectorTileFeature:np,VectorTileLayer:wh},jp=cu.VectorTileFeature.types,jf=Math.pow(2,13);function ml(t,a,u,h,m,x,S,M){t.emplaceBack(a,u,2*Math.floor(h*jf)+S,m*jf*2,x*jf*2,Math.round(M))}var Ju=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ws,this.indexArray=new qu,this.programConfigurations=new Vn(t.layers,t.zoom),this.segments=new fe,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Vp(t,a){return t.x===a.x&&(t.x<0||t.x>8192)||t.y===a.y&&(t.y<0||t.y>8192)}Ju.prototype.populate=function(t,a,u){this.features=[],this.hasPattern=Dc("fill-extrusion",this.layers,a);for(var h=0,m=t;h<m.length;h+=1){var x=m[h],S=x.feature,M=x.id,k=x.index,U=x.sourceLayerIndex,j=this.layers[0]._featureFilter.needGeometry,H=Ua(S,j);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),H,u)){var te={id:M,sourceLayerIndex:U,index:k,geometry:j?H.geometry:Ya(S),properties:S.properties,type:S.type,patterns:{}};this.hasPattern?this.features.push(Fc("fill-extrusion",this.layers,te,this.zoom,a)):this.addFeature(te,te.geometry,k,u,{}),a.featureIndex.insert(S,te.geometry,k,U,this.index,!0)}}},Ju.prototype.addFeatures=function(t,a,u){for(var h=0,m=this.features;h<m.length;h+=1){var x=m[h];this.addFeature(x,x.geometry,x.index,a,u)}},Ju.prototype.update=function(t,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,u)},Ju.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ju.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ju.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zf),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ju.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ju.prototype.addFeature=function(t,a,u,h,m){for(var x=0,S=Bf(a,500);x<S.length;x+=1){for(var M=S[x],k=0,U=0,j=M;U<j.length;U+=1)k+=j[U].length;for(var H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),te=0,ue=M;te<ue.length;te+=1){var Te=ue[te];if(Te.length!==0&&!((Zi=Te).every(function(bi){return bi.x<0})||Zi.every(function(bi){return bi.x>8192})||Zi.every(function(bi){return bi.y<0})||Zi.every(function(bi){return bi.y>8192})))for(var Oe=0,Ke=0;Ke<Te.length;Ke++){var ze=Te[Ke];if(Ke>=1){var ot=Te[Ke-1];if(!Vp(ze,ot)){H.vertexLength+4>fe.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Et=ze.sub(ot)._perp()._unit(),Zt=ot.dist(ze);Oe+Zt>32768&&(Oe=0),ml(this.layoutVertexArray,ze.x,ze.y,Et.x,Et.y,0,0,Oe),ml(this.layoutVertexArray,ze.x,ze.y,Et.x,Et.y,0,1,Oe),ml(this.layoutVertexArray,ot.x,ot.y,Et.x,Et.y,0,0,Oe+=Zt),ml(this.layoutVertexArray,ot.x,ot.y,Et.x,Et.y,0,1,Oe);var Ht=H.vertexLength;this.indexArray.emplaceBack(Ht,Ht+2,Ht+1),this.indexArray.emplaceBack(Ht+1,Ht+2,Ht+3),H.vertexLength+=4,H.primitiveLength+=2}}}}if(H.vertexLength+k>fe.MAX_VERTEX_ARRAY_LENGTH&&(H=this.segments.prepareSegment(k,this.layoutVertexArray,this.indexArray)),jp[t.type]==="Polygon"){for(var cr=[],Lr=[],Vr=H.vertexLength,gn=0,cn=M;gn<cn.length;gn+=1){var Nn=cn[gn];if(Nn.length!==0){Nn!==M[0]&&Lr.push(cr.length/2);for(var pn=0;pn<Nn.length;pn++){var wi=Nn[pn];ml(this.layoutVertexArray,wi.x,wi.y,0,0,1,1,0),cr.push(wi.x),cr.push(wi.y)}}}for(var Qn=ac(cr,Lr),Pn=0;Pn<Qn.length;Pn+=3)this.indexArray.emplaceBack(Vr+Qn[Pn],Vr+Qn[Pn+2],Vr+Qn[Pn+1]);H.primitiveLength+=Qn.length/3,H.vertexLength+=k}}var Zi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,m,h)},yn("FillExtrusionBucket",Ju,{omit:["layers","features"]});var Gp={paint:new Ko({"fill-extrusion-opacity":new On(pe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new wn(pe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new On(pe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new On(pe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ql(pe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new wn(pe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new wn(pe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new On(pe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Qu=function(t){function a(u){t.call(this,u,Gp)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(u){return new Ju(u)},a.prototype.queryRadius=function(){return oo(this.paint.get("fill-extrusion-translate"))},a.prototype.is3D=function(){return!0},a.prototype.queryIntersectsFeature=function(u,h,m,x,S,M,k,U){var j=qs(u,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),M.angle,k),H=this.paint.get("fill-extrusion-height").evaluate(h,m),te=this.paint.get("fill-extrusion-base").evaluate(h,m),ue=function(Oe,Ke,ze,ot){for(var Et=[],Zt=0,Ht=Oe;Zt<Ht.length;Zt+=1){var cr=Ht[Zt],Lr=[cr.x,cr.y,0,1];nc(Lr,Lr,Ke),Et.push(new re(Lr[0]/Lr[3],Lr[1]/Lr[3]))}return Et}(j,U),Te=function(Oe,Ke,ze,ot){for(var Et=[],Zt=[],Ht=ot[8]*Ke,cr=ot[9]*Ke,Lr=ot[10]*Ke,Vr=ot[11]*Ke,gn=ot[8]*ze,cn=ot[9]*ze,Nn=ot[10]*ze,pn=ot[11]*ze,wi=0,Qn=Oe;wi<Qn.length;wi+=1){for(var Pn=[],Zi=[],bi=0,na=Qn[wi];bi<na.length;bi+=1){var An=na[bi],va=An.x,Ai=An.y,Po=ot[0]*va+ot[4]*Ai+ot[12],So=ot[1]*va+ot[5]*Ai+ot[13],lo=ot[2]*va+ot[6]*Ai+ot[14],ae=ot[3]*va+ot[7]*Ai+ot[15],Qo=lo+Lr,es=ae+Vr,Ps=Po+gn,as=So+cn,Is=lo+Nn,Io=ae+pn,Oo=new re((Po+Ht)/es,(So+cr)/es);Oo.z=Qo/es,Pn.push(Oo);var Hi=new re(Ps/Io,as/Io);Hi.z=Is/Io,Zi.push(Hi)}Et.push(Pn),Zt.push(Zi)}return[Et,Zt]}(x,te,H,U);return function(Oe,Ke,ze){var ot=1/0;Ys(ze,Ke)&&(ot=sc(ze,Ke[0]));for(var Et=0;Et<Ke.length;Et++)for(var Zt=Ke[Et],Ht=Oe[Et],cr=0;cr<Zt.length-1;cr++){var Lr=Zt[cr],Vr=[Lr,Zt[cr+1],Ht[cr+1],Ht[cr],Lr];Ku(ze,Vr)&&(ot=Math.min(ot,sc(ze,Vr)))}return ot!==1/0&&ot}(Te[0],Te[1],ue)},a}(Sa);function Nc(t,a){return t.x*a.x+t.y*a.y}function sc(t,a){if(t.length===1){for(var u,h=0,m=a[h++];!u||m.equals(u);)if(!(u=a[h++]))return 1/0;for(;h<a.length;h++){var x=a[h],S=t[0],M=u.sub(m),k=x.sub(m),U=S.sub(m),j=Nc(M,M),H=Nc(M,k),te=Nc(k,k),ue=Nc(U,M),Te=Nc(U,k),Oe=j*te-H*H,Ke=(te*ue-H*Te)/Oe,ze=(j*Te-H*ue)/Oe,ot=m.z*(1-Ke-ze)+u.z*Ke+x.z*ze;if(isFinite(ot))return ot}return 1/0}for(var Et=1/0,Zt=0,Ht=a;Zt<Ht.length;Zt+=1)Et=Math.min(Et,Ht[Zt].z);return Et}var Ll=Ta([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Hp=Ta([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Ah=cu.VectorTileFeature.types,Vf=Math.cos(Math.PI/180*37.5),Gf=Math.pow(2,14)/.5,_a=function(t){var a=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(u){a.gradients[u.id]={}}),this.layoutVertexArray=new Do,this.layoutVertexArray2=new ll,this.indexArray=new qu,this.programConfigurations=new Vn(t.layers,t.zoom),this.segments=new fe,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};_a.prototype.populate=function(t,a,u){this.hasPattern=Dc("line",this.layers,a);for(var h=this.layers[0].layout.get("line-sort-key"),m=[],x=0,S=t;x<S.length;x+=1){var M=S[x],k=M.feature,U=M.id,j=M.index,H=M.sourceLayerIndex,te=this.layers[0]._featureFilter.needGeometry,ue=Ua(k,te);if(this.layers[0]._featureFilter.filter(new Oi(this.zoom),ue,u)){var Te=h?h.evaluate(ue,{},u):void 0,Oe={id:U,properties:k.properties,type:k.type,sourceLayerIndex:H,index:j,geometry:te?ue.geometry:Ya(k),patterns:{},sortKey:Te};m.push(Oe)}}h&&m.sort(function(Lr,Vr){return Lr.sortKey-Vr.sortKey});for(var Ke=0,ze=m;Ke<ze.length;Ke+=1){var ot=ze[Ke],Et=ot.geometry,Zt=ot.index,Ht=ot.sourceLayerIndex;if(this.hasPattern){var cr=Fc("line",this.layers,ot,this.zoom,a);this.patternFeatures.push(cr)}else this.addFeature(ot,Et,Zt,u,{});a.featureIndex.insert(t[Zt].feature,Et,Zt,Ht,this.index)}},_a.prototype.update=function(t,a,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,u)},_a.prototype.addFeatures=function(t,a,u){for(var h=0,m=this.patternFeatures;h<m.length;h+=1){var x=m[h];this.addFeature(x,x.geometry,x.index,a,u)}},_a.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},_a.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},_a.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Hp)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ll),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},_a.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},_a.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},_a.prototype.addFeature=function(t,a,u,h,m){var x=this.layers[0].layout,S=x.get("line-join").evaluate(t,{}),M=x.get("line-cap"),k=x.get("line-miter-limit"),U=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var j=0,H=a;j<H.length;j+=1)this.addLine(H[j],t,S,M,k,U);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,m,h)},_a.prototype.addLine=function(t,a,u,h,m,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var S=0;S<t.length-1;S++)this.totalDistance+=t[S].dist(t[S+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var M=Ah[a.type]==="Polygon",k=t.length;k>=2&&t[k-1].equals(t[k-2]);)k--;for(var U=0;U<k-1&&t[U].equals(t[U+1]);)U++;if(!(k<(M?3:2))){u==="bevel"&&(m=1.05);var j,H=this.overscaling<=16?122880/(512*this.overscaling):0,te=this.segments.prepareSegment(10*k,this.layoutVertexArray,this.indexArray),ue=void 0,Te=void 0,Oe=void 0,Ke=void 0;this.e1=this.e2=-1,M&&(Ke=t[U].sub(j=t[k-2])._unit()._perp());for(var ze=U;ze<k;ze++)if(!(Te=ze===k-1?M?t[U+1]:void 0:t[ze+1])||!t[ze].equals(Te)){Ke&&(Oe=Ke),j&&(ue=j),j=t[ze],Ke=Te?Te.sub(j)._unit()._perp():Oe;var ot=(Oe=Oe||Ke).add(Ke);ot.x===0&&ot.y===0||ot._unit();var Et=Oe.x*Ke.x+Oe.y*Ke.y,Zt=ot.x*Ke.x+ot.y*Ke.y,Ht=Zt!==0?1/Zt:1/0,cr=2*Math.sqrt(2-2*Zt),Lr=Zt<Vf&&ue&&Te,Vr=Oe.x*Ke.y-Oe.y*Ke.x>0;if(Lr&&ze>U){var gn=j.dist(ue);if(gn>2*H){var cn=j.sub(j.sub(ue)._mult(H/gn)._round());this.updateDistance(ue,cn),this.addCurrentVertex(cn,Oe,0,0,te),ue=cn}}var Nn=ue&&Te,pn=Nn?u:M?"butt":h;if(Nn&&pn==="round"&&(Ht<x?pn="miter":Ht<=2&&(pn="fakeround")),pn==="miter"&&Ht>m&&(pn="bevel"),pn==="bevel"&&(Ht>2&&(pn="flipbevel"),Ht<m&&(pn="miter")),ue&&this.updateDistance(ue,j),pn==="miter")ot._mult(Ht),this.addCurrentVertex(j,ot,0,0,te);else if(pn==="flipbevel"){if(Ht>100)ot=Ke.mult(-1);else{var wi=Ht*Oe.add(Ke).mag()/Oe.sub(Ke).mag();ot._perp()._mult(wi*(Vr?-1:1))}this.addCurrentVertex(j,ot,0,0,te),this.addCurrentVertex(j,ot.mult(-1),0,0,te)}else if(pn==="bevel"||pn==="fakeround"){var Qn=-Math.sqrt(Ht*Ht-1),Pn=Vr?Qn:0,Zi=Vr?0:Qn;if(ue&&this.addCurrentVertex(j,Oe,Pn,Zi,te),pn==="fakeround")for(var bi=Math.round(180*cr/Math.PI/20),na=1;na<bi;na++){var An=na/bi;if(An!==.5){var va=An-.5;An+=An*va*(An-1)*((1.0904+Et*(Et*(3.55645-1.43519*Et)-3.2452))*va*va+(.848013+Et*(.215638*Et-1.06021)))}var Ai=Ke.sub(Oe)._mult(An)._add(Oe)._unit()._mult(Vr?-1:1);this.addHalfVertex(j,Ai.x,Ai.y,!1,Vr,0,te)}Te&&this.addCurrentVertex(j,Ke,-Pn,-Zi,te)}else if(pn==="butt")this.addCurrentVertex(j,ot,0,0,te);else if(pn==="square"){var Po=ue?1:-1;this.addCurrentVertex(j,ot,Po,Po,te)}else pn==="round"&&(ue&&(this.addCurrentVertex(j,Oe,0,0,te),this.addCurrentVertex(j,Oe,1,1,te,!0)),Te&&(this.addCurrentVertex(j,Ke,-1,-1,te,!0),this.addCurrentVertex(j,Ke,0,0,te)));if(Lr&&ze<k-1){var So=j.dist(Te);if(So>2*H){var lo=j.add(Te.sub(j)._mult(H/So)._round());this.updateDistance(j,lo),this.addCurrentVertex(lo,Ke,0,0,te),j=lo}}}}},_a.prototype.addCurrentVertex=function(t,a,u,h,m,x){x===void 0&&(x=!1);var S=a.y*h-a.x,M=-a.y-a.x*h;this.addHalfVertex(t,a.x+a.y*u,a.y-a.x*u,x,!1,u,m),this.addHalfVertex(t,S,M,x,!0,-h,m),this.distance>Gf/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,a,u,h,m,x))},_a.prototype.addHalfVertex=function(t,a,u,h,m,x,S){var M=.5*(this.lineClips?this.scaledDistance*(Gf-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(h?1:0),(t.y<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(x===0?0:x<0?-1:1)|(63&M)<<2,M>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var k=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),S.primitiveLength++),m?this.e2=k:this.e1=k},_a.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},_a.prototype.updateDistance=function(t,a){this.distance+=t.dist(a),this.updateScaledDistance()},yn("LineBucket",_a,{omit:["layers","patternFeatures"]});var uc=new Ko({"line-cap":new On(pe.layout_line["line-cap"]),"line-join":new wn(pe.layout_line["line-join"]),"line-miter-limit":new On(pe.layout_line["line-miter-limit"]),"line-round-limit":new On(pe.layout_line["line-round-limit"]),"line-sort-key":new wn(pe.layout_line["line-sort-key"])}),Fo={paint:new Ko({"line-opacity":new wn(pe.paint_line["line-opacity"]),"line-color":new wn(pe.paint_line["line-color"]),"line-translate":new On(pe.paint_line["line-translate"]),"line-translate-anchor":new On(pe.paint_line["line-translate-anchor"]),"line-width":new wn(pe.paint_line["line-width"]),"line-gap-width":new wn(pe.paint_line["line-gap-width"]),"line-offset":new wn(pe.paint_line["line-offset"]),"line-blur":new wn(pe.paint_line["line-blur"]),"line-dasharray":new fs(pe.paint_line["line-dasharray"]),"line-pattern":new Ql(pe.paint_line["line-pattern"]),"line-gradient":new mu(pe.paint_line["line-gradient"])}),layout:uc},Qs=new(function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(u,h){return h=new Oi(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),t.prototype.possiblyEvaluate.call(this,u,h)},a.prototype.evaluate=function(u,h,m,x){return h=xt({},h,{zoom:Math.floor(h.zoom)}),t.prototype.evaluate.call(this,u,h,m,x)},a}(wn))(Fo.paint.properties["line-width"].specification);Qs.useIntegerZoom=!0;var Wp=function(t){function a(u){t.call(this,u,Fo),this.gradientVersion=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._handleSpecialPaintPropertyUpdate=function(u){u==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof ls,this.gradientVersion=(this.gradientVersion+1)%je)},a.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},a.prototype.recalculate=function(u,h){t.prototype.recalculate.call(this,u,h),this.paint._values["line-floorwidth"]=Qs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,u)},a.prototype.createBucket=function(u){return new _a(u)},a.prototype.queryRadius=function(u){var h=u,m=Xp(uu("line-width",this,h),uu("line-gap-width",this,h)),x=uu("line-offset",this,h);return m/2+Math.abs(x)+oo(this.paint.get("line-translate"))},a.prototype.queryIntersectsFeature=function(u,h,m,x,S,M,k){var U=qs(u,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),M.angle,k),j=k/2*Xp(this.paint.get("line-width").evaluate(h,m),this.paint.get("line-gap-width").evaluate(h,m)),H=this.paint.get("line-offset").evaluate(h,m);return H&&(x=function(te,ue){for(var Te=[],Oe=new re(0,0),Ke=0;Ke<te.length;Ke++){for(var ze=te[Ke],ot=[],Et=0;Et<ze.length;Et++){var Zt=ze[Et],Ht=ze[Et+1],cr=Et===0?Oe:Zt.sub(ze[Et-1])._unit()._perp(),Lr=Et===ze.length-1?Oe:Ht.sub(Zt)._unit()._perp(),Vr=cr._add(Lr)._unit();Vr._mult(1/(Vr.x*Lr.x+Vr.y*Lr.y)),ot.push(Vr._mult(ue)._add(Zt))}Te.push(ot)}return Te}(x,H*k)),function(te,ue,Te){for(var Oe=0;Oe<ue.length;Oe++){var Ke=ue[Oe];if(te.length>=3){for(var ze=0;ze<Ke.length;ze++)if(Ts(te,Ke[ze]))return!0}if(xo(te,Ke,Te))return!0}return!1}(U,x,j)},a.prototype.isTileClipped=function(){return!0},a}(Sa);function Xp(t,a){return a>0?a+2*t:t}var Sd=Ta([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Yp=Ta([{name:"a_projected_pos",components:3,type:"Float32"}],4),Cd=(Ta([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ta([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Th=(Ta([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ta([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),wd=Ta([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function pv(t,a,u){return t.sections.forEach(function(h){h.text=function(m,x,S){var M=x.layout.get("text-transform").evaluate(S,{});return M==="uppercase"?m=m.toLocaleUpperCase():M==="lowercase"&&(m=m.toLocaleLowerCase()),As.applyArabicShaping&&(m=As.applyArabicShaping(m)),m}(h.text,a,u)}),t}Ta([{name:"triangle",components:3,type:"Uint16"}]),Ta([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ta([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ta([{type:"Float32",name:"offsetX"}]),Ta([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Hf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},ip=function(t,a,u,h,m){var x,S,M=8*m-h-1,k=(1<<M)-1,U=k>>1,j=-7,H=u?m-1:0,te=u?-1:1,ue=t[a+H];for(H+=te,x=ue&(1<<-j)-1,ue>>=-j,j+=M;j>0;x=256*x+t[a+H],H+=te,j-=8);for(S=x&(1<<-j)-1,x>>=-j,j+=h;j>0;S=256*S+t[a+H],H+=te,j-=8);if(x===0)x=1-U;else{if(x===k)return S?NaN:1/0*(ue?-1:1);S+=Math.pow(2,h),x-=U}return(ue?-1:1)*S*Math.pow(2,x-h)},ap=function(t,a,u,h,m,x){var S,M,k,U=8*x-m-1,j=(1<<U)-1,H=j>>1,te=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,ue=h?0:x-1,Te=h?1:-1,Oe=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(M=isNaN(a)?1:0,S=j):(S=Math.floor(Math.log(a)/Math.LN2),a*(k=Math.pow(2,-S))<1&&(S--,k*=2),(a+=S+H>=1?te/k:te*Math.pow(2,1-H))*k>=2&&(S++,k/=2),S+H>=j?(M=0,S=j):S+H>=1?(M=(a*k-1)*Math.pow(2,m),S+=H):(M=a*Math.pow(2,H-1)*Math.pow(2,m),S=0));m>=8;t[u+ue]=255&M,ue+=Te,M/=256,m-=8);for(S=S<<m|M,U+=m;U>0;t[u+ue]=255&S,ue+=Te,S/=256,U-=8);t[u+ue-Te]|=128*Oe},Wf=Oa;function Oa(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Oa.Varint=0,Oa.Fixed64=1,Oa.Bytes=2,Oa.Fixed32=5;var Mh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function kl(t){return t.type===Oa.Bytes?t.readVarint()+t.pos:t.pos+1}function vf(t,a,u){return u?4294967296*a+(t>>>0):4294967296*(a>>>0)+(t>>>0)}function op(t,a,u){var h=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));u.realloc(h);for(var m=u.pos-1;m>=t;m--)u.buf[m+h]=u.buf[m]}function qp(t,a){for(var u=0;u<t.length;u++)a.writeVarint(t[u])}function N(t,a){for(var u=0;u<t.length;u++)a.writeSVarint(t[u])}function me(t,a){for(var u=0;u<t.length;u++)a.writeFloat(t[u])}function Pe(t,a){for(var u=0;u<t.length;u++)a.writeDouble(t[u])}function Mt(t,a){for(var u=0;u<t.length;u++)a.writeBoolean(t[u])}function sr(t,a){for(var u=0;u<t.length;u++)a.writeFixed32(t[u])}function Rt(t,a){for(var u=0;u<t.length;u++)a.writeSFixed32(t[u])}function er(t,a){for(var u=0;u<t.length;u++)a.writeFixed64(t[u])}function pr(t,a){for(var u=0;u<t.length;u++)a.writeSFixed64(t[u])}function br(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+16777216*t[a+3]}function wr(t,a,u){t[u]=a,t[u+1]=a>>>8,t[u+2]=a>>>16,t[u+3]=a>>>24}function Mr(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+(t[a+3]<<24)}function Rr(t,a,u){t===1&&u.readMessage(Hr,a)}function Hr(t,a,u){if(t===3){var h=u.readMessage(vr,{}),m=h.width,x=h.height,S=h.left,M=h.top,k=h.advance;a.push({id:h.id,bitmap:new $s({width:m+6,height:x+6},h.bitmap),metrics:{width:m,height:x,left:S,top:M,advance:k}})}}function vr(t,a,u){t===1?a.id=u.readVarint():t===2?a.bitmap=u.readBytes():t===3?a.width=u.readVarint():t===4?a.height=u.readVarint():t===5?a.left=u.readSVarint():t===6?a.top=u.readSVarint():t===7&&(a.advance=u.readVarint())}function Ar(t){for(var a=0,u=0,h=0,m=t;h<m.length;h+=1){var x=m[h];a+=x.w*x.h,u=Math.max(u,x.w)}t.sort(function(Oe,Ke){return Ke.h-Oe.h});for(var S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),u),h:1/0}],M=0,k=0,U=0,j=t;U<j.length;U+=1)for(var H=j[U],te=S.length-1;te>=0;te--){var ue=S[te];if(!(H.w>ue.w||H.h>ue.h)){if(H.x=ue.x,H.y=ue.y,k=Math.max(k,H.y+H.h),M=Math.max(M,H.x+H.w),H.w===ue.w&&H.h===ue.h){var Te=S.pop();te<S.length&&(S[te]=Te)}else H.h===ue.h?(ue.x+=H.w,ue.w-=H.w):H.w===ue.w?(ue.y+=H.h,ue.h-=H.h):(S.push({x:ue.x+H.w,y:ue.y,w:ue.w-H.w,h:H.h}),ue.y+=H.h,ue.h-=H.h);break}}return{w:M,h:k,fill:a/(M*k)||0}}Oa.prototype={destroy:function(){this.buf=null},readFields:function(t,a,u){for(u=u||this.length;this.pos<u;){var h=this.readVarint(),m=h>>3,x=this.pos;this.type=7&h,t(m,a,this),this.pos===x&&this.skip(h)}return a},readMessage:function(t,a){return this.readFields(t,a,this.readVarint()+this.pos)},readFixed32:function(){var t=br(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Mr(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=br(this.buf,this.pos)+4294967296*br(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=br(this.buf,this.pos)+4294967296*Mr(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=ip(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=ip(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var a,u,h=this.buf;return a=127&(u=h[this.pos++]),u<128?a:(a|=(127&(u=h[this.pos++]))<<7,u<128?a:(a|=(127&(u=h[this.pos++]))<<14,u<128?a:(a|=(127&(u=h[this.pos++]))<<21,u<128?a:function(m,x,S){var M,k,U=S.buf;if(M=(112&(k=U[S.pos++]))>>4,k<128||(M|=(127&(k=U[S.pos++]))<<3,k<128)||(M|=(127&(k=U[S.pos++]))<<10,k<128)||(M|=(127&(k=U[S.pos++]))<<17,k<128)||(M|=(127&(k=U[S.pos++]))<<24,k<128)||(M|=(1&(k=U[S.pos++]))<<31,k<128))return vf(m,M,x);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(u=h[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,a=this.pos;return this.pos=t,t-a>=12&&Mh?function(u,h,m){return Mh.decode(u.subarray(h,m))}(this.buf,a,t):function(u,h,m){for(var x="",S=h;S<m;){var M,k,U,j=u[S],H=null,te=j>239?4:j>223?3:j>191?2:1;if(S+te>m)break;te===1?j<128&&(H=j):te===2?(192&(M=u[S+1]))==128&&(H=(31&j)<<6|63&M)<=127&&(H=null):te===3?(k=u[S+2],(192&(M=u[S+1]))==128&&(192&k)==128&&((H=(15&j)<<12|(63&M)<<6|63&k)<=2047||H>=55296&&H<=57343)&&(H=null)):te===4&&(k=u[S+2],U=u[S+3],(192&(M=u[S+1]))==128&&(192&k)==128&&(192&U)==128&&((H=(15&j)<<18|(63&M)<<12|(63&k)<<6|63&U)<=65535||H>=1114112)&&(H=null)),H===null?(H=65533,te=1):H>65535&&(H-=65536,x+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),x+=String.fromCharCode(H),S+=te}return x}(this.buf,a,t)},readBytes:function(){var t=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,t);return this.pos=t,a},readPackedVarint:function(t,a){if(this.type!==Oa.Bytes)return t.push(this.readVarint(a));var u=kl(this);for(t=t||[];this.pos<u;)t.push(this.readVarint(a));return t},readPackedSVarint:function(t){if(this.type!==Oa.Bytes)return t.push(this.readSVarint());var a=kl(this);for(t=t||[];this.pos<a;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Oa.Bytes)return t.push(this.readBoolean());var a=kl(this);for(t=t||[];this.pos<a;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Oa.Bytes)return t.push(this.readFloat());var a=kl(this);for(t=t||[];this.pos<a;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Oa.Bytes)return t.push(this.readDouble());var a=kl(this);for(t=t||[];this.pos<a;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Oa.Bytes)return t.push(this.readFixed32());var a=kl(this);for(t=t||[];this.pos<a;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Oa.Bytes)return t.push(this.readSFixed32());var a=kl(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Oa.Bytes)return t.push(this.readFixed64());var a=kl(this);for(t=t||[];this.pos<a;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Oa.Bytes)return t.push(this.readSFixed64());var a=kl(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed64());return t},skip:function(t){var a=7&t;if(a===Oa.Varint)for(;this.buf[this.pos++]>127;);else if(a===Oa.Bytes)this.pos=this.readVarint()+this.pos;else if(a===Oa.Fixed32)this.pos+=4;else{if(a!==Oa.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(t,a){this.writeVarint(t<<3|a)},realloc:function(t){for(var a=this.length||16;a<this.pos+t;)a*=2;if(a!==this.length){var u=new Uint8Array(a);u.set(this.buf),this.buf=u,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),wr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),wr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),wr(this.buf,-1&t,this.pos),wr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),wr(this.buf,-1&t,this.pos),wr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(a,u){var h,m;if(a>=0?(h=a%4294967296|0,m=a/4294967296|0):(m=~(-a/4294967296),4294967295^(h=~(-a%4294967296))?h=h+1|0:(h=0,m=m+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(x,S,M){M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,x>>>=7,M.buf[M.pos++]=127&x|128,M.buf[M.pos]=127&(x>>>=7)}(h,0,u),function(x,S){var M=(7&x)<<4;S.buf[S.pos++]|=M|((x>>>=3)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x|((x>>>=7)?128:0),x&&(S.buf[S.pos++]=127&x)))))}(m,u)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var a=this.pos;this.pos=function(h,m,x){for(var S,M,k=0;k<m.length;k++){if((S=m.charCodeAt(k))>55295&&S<57344){if(!M){S>56319||k+1===m.length?(h[x++]=239,h[x++]=191,h[x++]=189):M=S;continue}if(S<56320){h[x++]=239,h[x++]=191,h[x++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(h[x++]=239,h[x++]=191,h[x++]=189,M=null);S<128?h[x++]=S:(S<2048?h[x++]=S>>6|192:(S<65536?h[x++]=S>>12|224:(h[x++]=S>>18|240,h[x++]=S>>12&63|128),h[x++]=S>>6&63|128),h[x++]=63&S|128)}return x}(this.buf,t,this.pos);var u=this.pos-a;u>=128&&op(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u},writeFloat:function(t){this.realloc(4),ap(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),ap(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var a=t.length;this.writeVarint(a),this.realloc(a);for(var u=0;u<a;u++)this.buf[this.pos++]=t[u]},writeRawMessage:function(t,a){this.pos++;var u=this.pos;t(a,this);var h=this.pos-u;h>=128&&op(u,h,this),this.pos=u-1,this.writeVarint(h),this.pos+=h},writeMessage:function(t,a,u){this.writeTag(t,Oa.Bytes),this.writeRawMessage(a,u)},writePackedVarint:function(t,a){a.length&&this.writeMessage(t,qp,a)},writePackedSVarint:function(t,a){a.length&&this.writeMessage(t,N,a)},writePackedBoolean:function(t,a){a.length&&this.writeMessage(t,Mt,a)},writePackedFloat:function(t,a){a.length&&this.writeMessage(t,me,a)},writePackedDouble:function(t,a){a.length&&this.writeMessage(t,Pe,a)},writePackedFixed32:function(t,a){a.length&&this.writeMessage(t,sr,a)},writePackedSFixed32:function(t,a){a.length&&this.writeMessage(t,Rt,a)},writePackedFixed64:function(t,a){a.length&&this.writeMessage(t,er,a)},writePackedSFixed64:function(t,a){a.length&&this.writeMessage(t,pr,a)},writeBytesField:function(t,a){this.writeTag(t,Oa.Bytes),this.writeBytes(a)},writeFixed32Field:function(t,a){this.writeTag(t,Oa.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(t,a){this.writeTag(t,Oa.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(t,a){this.writeTag(t,Oa.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(t,a){this.writeTag(t,Oa.Fixed64),this.writeSFixed64(a)},writeVarintField:function(t,a){this.writeTag(t,Oa.Varint),this.writeVarint(a)},writeSVarintField:function(t,a){this.writeTag(t,Oa.Varint),this.writeSVarint(a)},writeStringField:function(t,a){this.writeTag(t,Oa.Bytes),this.writeString(a)},writeFloatField:function(t,a){this.writeTag(t,Oa.Fixed32),this.writeFloat(a)},writeDoubleField:function(t,a){this.writeTag(t,Oa.Fixed64),this.writeDouble(a)},writeBooleanField:function(t,a){this.writeVarintField(t,Boolean(a))}};var at=function(t,a){var u=a.pixelRatio,h=a.version,m=a.stretchX,x=a.stretchY,S=a.content;this.paddedRect=t,this.pixelRatio=u,this.stretchX=m,this.stretchY=x,this.content=S,this.version=h},Gt={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Gt.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Gt.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Gt.tlbr.get=function(){return this.tl.concat(this.br)},Gt.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(at.prototype,Gt);var Sr=function(t,a){var u={},h={};this.haveRenderCallbacks=[];var m=[];this.addImages(t,u,m),this.addImages(a,h,m);var x=Ar(m),S=new Da({width:x.w||1,height:x.h||1});for(var M in t){var k=t[M],U=u[M].paddedRect;Da.copy(k.data,S,{x:0,y:0},{x:U.x+1,y:U.y+1},k.data)}for(var j in a){var H=a[j],te=h[j].paddedRect,ue=te.x+1,Te=te.y+1,Oe=H.data.width,Ke=H.data.height;Da.copy(H.data,S,{x:0,y:0},{x:ue,y:Te},H.data),Da.copy(H.data,S,{x:0,y:Ke-1},{x:ue,y:Te-1},{width:Oe,height:1}),Da.copy(H.data,S,{x:0,y:0},{x:ue,y:Te+Ke},{width:Oe,height:1}),Da.copy(H.data,S,{x:Oe-1,y:0},{x:ue-1,y:Te},{width:1,height:Ke}),Da.copy(H.data,S,{x:0,y:0},{x:ue+Oe,y:Te},{width:1,height:Ke})}this.image=S,this.iconPositions=u,this.patternPositions=h};Sr.prototype.addImages=function(t,a,u){for(var h in t){var m=t[h],x={x:0,y:0,w:m.data.width+2,h:m.data.height+2};u.push(x),a[h]=new at(x,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}},Sr.prototype.patchUpdatedImages=function(t,a){for(var u in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[u],t.getImage(u),a),this.patchUpdatedImage(this.patternPositions[u],t.getImage(u),a)},Sr.prototype.patchUpdatedImage=function(t,a,u){if(t&&a&&t.version!==a.version){t.version=a.version;var h=t.tl;u.update(a.data,void 0,{x:h[0],y:h[1]})}},yn("ImagePosition",at),yn("ImageAtlas",Sr);var Ur={horizontal:1,vertical:2,horizontalOnly:3},fr=function(){this.scale=1,this.fontStack="",this.imageName=null};fr.forText=function(t,a){var u=new fr;return u.scale=t||1,u.fontStack=a,u},fr.forImage=function(t){var a=new fr;return a.imageName=t,a};var kr=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function en(t,a,u,h,m,x,S,M,k,U,j,H,te,ue,Te,Oe){var Ke,ze=kr.fromFeature(t,m);H===Ur.vertical&&ze.verticalizePunctuation();var ot=As.processBidirectionalText,Et=As.processStyledBidirectionalText;if(ot&&ze.sections.length===1){Ke=[];for(var Zt=0,Ht=ot(ze.toString(),Jr(ze,U,x,a,h,ue,Te));Zt<Ht.length;Zt+=1){var cr=Ht[Zt],Lr=new kr;Lr.text=cr,Lr.sections=ze.sections;for(var Vr=0;Vr<cr.length;Vr++)Lr.sectionIndex.push(0);Ke.push(Lr)}}else if(Et){Ke=[];for(var gn=0,cn=Et(ze.text,ze.sectionIndex,Jr(ze,U,x,a,h,ue,Te));gn<cn.length;gn+=1){var Nn=cn[gn],pn=new kr;pn.text=Nn[0],pn.sectionIndex=Nn[1],pn.sections=ze.sections,Ke.push(pn)}}else Ke=function(Pn,Zi){for(var bi=[],na=Pn.text,An=0,va=0,Ai=Zi;va<Ai.length;va+=1){var Po=Ai[va];bi.push(Pn.substring(An,Po)),An=Po}return An<na.length&&bi.push(Pn.substring(An,na.length)),bi}(ze,Jr(ze,U,x,a,h,ue,Te));var wi=[],Qn={positionedLines:wi,text:ze.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(Pn,Zi,bi,na,An,va,Ai,Po,So,lo,ae,Qo){for(var es=0,Ps=-17,as=0,Is=0,Io=Po==="right"?1:Po==="left"?0:.5,Oo=0,Hi=0,Fa=An;Hi<Fa.length;Hi+=1){var Pa=Fa[Hi];Pa.trim();var ia=Pa.getMaxScale(),js=24*(ia-1),bs={positionedGlyphs:[],lineOffset:0};Pn.positionedLines[Oo]=bs;var Qa=bs.positionedGlyphs,Vo=0;if(Pa.length()){for(var Es=0;Es<Pa.length();Es++){var ca=Pa.getSection(Es),Fl=Pa.getSectionIndex(Es),xu=Pa.getCharCode(Es),Bl=0,co=null,Nl=null,el=null,Yf=24,qf=!(So===Ur.horizontal||!ae&&!Pf(xu)||ae&&(Fn[xu]||(fc=xu,$r.Arabic(fc)||$r["Arabic Supplement"](fc)||$r["Arabic Extended-A"](fc)||$r["Arabic Presentation Forms-A"](fc)||$r["Arabic Presentation Forms-B"](fc))));if(ca.imageName){var cc=na[ca.imageName];if(!cc)continue;el=ca.imageName,Pn.iconsInText=Pn.iconsInText||!0,Nl=cc.paddedRect;var zc=cc.displaySize;ca.scale=24*ca.scale/Qo,Bl=js+(24-zc[1]*ca.scale),Yf=(co={width:zc[0],height:zc[1],left:1,top:-3,advance:qf?zc[1]:zc[0]}).advance;var zl=qf?zc[0]*ca.scale-24*ia:zc[1]*ca.scale-24*ia;zl>0&&zl>Vo&&(Vo=zl)}else{var Jp=bi[ca.fontStack],Ih=Jp&&Jp[xu];if(Ih&&Ih.rect)Nl=Ih.rect,co=Ih.metrics;else{var Uc=Zi[ca.fontStack],up=Uc&&Uc[xu];if(!up)continue;co=up.metrics}Bl=24*(ia-ca.scale)}qf?(Pn.verticalizable=!0,Qa.push({glyph:xu,imageName:el,x:es,y:Ps+Bl,vertical:qf,scale:ca.scale,fontStack:ca.fontStack,sectionIndex:Fl,metrics:co,rect:Nl}),es+=Yf*ca.scale+lo):(Qa.push({glyph:xu,imageName:el,x:es,y:Ps+Bl,vertical:qf,scale:ca.scale,fontStack:ca.fontStack,sectionIndex:Fl,metrics:co,rect:Nl}),es+=co.advance*ca.scale+lo)}Qa.length!==0&&(as=Math.max(es-lo,as),mi(Qa,0,Qa.length-1,Io,Vo)),es=0;var lp=va*ia+Vo;bs.lineOffset=Math.max(Vo,js),Ps+=lp,Is=Math.max(lp,Is),++Oo}else Ps+=va,++Oo}var fc,Kf=Ps- -17,$f=Qr(Ai),Zc=$f.horizontalAlign,yf=$f.verticalAlign;(function(Pd,Qp,cp,Oh,ed,Rh,Lh,kh,fp){var Jf,hp=(Qp-cp)*ed;Jf=Rh!==Lh?-kh*Oh- -17:(-Oh*fp+.5)*Lh;for(var Qf=0,Dh=Pd;Qf<Dh.length;Qf+=1)for(var _f=0,Fh=Dh[Qf].positionedGlyphs;_f<Fh.length;_f+=1){var eh=Fh[_f];eh.x+=hp,eh.y+=Jf}})(Pn.positionedLines,Io,Zc,yf,as,Is,va,Kf,An.length),Pn.top+=-yf*Kf,Pn.bottom=Pn.top+Kf,Pn.left+=-Zc*as,Pn.right=Pn.left+as}(Qn,a,u,h,Ke,S,M,k,H,U,te,Oe),!function(Pn){for(var Zi=0,bi=Pn;Zi<bi.length;Zi+=1)if(bi[Zi].positionedGlyphs.length!==0)return!1;return!0}(wi)&&Qn}kr.fromFeature=function(t,a){for(var u=new kr,h=0;h<t.sections.length;h++){var m=t.sections[h];m.image?u.addImageSection(m):u.addTextSection(m,a)}return u},kr.prototype.length=function(){return this.text.length},kr.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},kr.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},kr.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},kr.prototype.verticalizePunctuation=function(){this.text=function(t){for(var a="",u=0;u<t.length;u++){var h=t.charCodeAt(u+1)||null,m=t.charCodeAt(u-1)||null;a+=h&&wu(h)&&!Hf[t[u+1]]||m&&wu(m)&&!Hf[t[u-1]]||!Hf[t[u]]?t[u]:Hf[t[u]]}return a}(this.text)},kr.prototype.trim=function(){for(var t=0,a=0;a<this.text.length&&Fn[this.text.charCodeAt(a)];a++)t++;for(var u=this.text.length,h=this.text.length-1;h>=0&&h>=t&&Fn[this.text.charCodeAt(h)];h--)u--;this.text=this.text.substring(t,u),this.sectionIndex=this.sectionIndex.slice(t,u)},kr.prototype.substring=function(t,a){var u=new kr;return u.text=this.text.substring(t,a),u.sectionIndex=this.sectionIndex.slice(t,a),u.sections=this.sections,u},kr.prototype.toString=function(){return this.text},kr.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(a,u){return Math.max(a,t.sections[u].scale)},0)},kr.prototype.addTextSection=function(t,a){this.text+=t.text,this.sections.push(fr.forText(t.scale,t.fontStack||a));for(var u=this.sections.length-1,h=0;h<t.text.length;++h)this.sectionIndex.push(u)},kr.prototype.addImageSection=function(t){var a=t.image?t.image.name:"";if(a.length!==0){var u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(fr.forImage(a)),this.sectionIndex.push(this.sections.length-1)):$e("Reached maximum number of images 6401")}else $e("Can't add FormattedSection with an empty image.")},kr.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Fn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},tr={};function ar(t,a,u,h,m,x){if(a.imageName){var S=h[a.imageName];return S?S.displaySize[0]*a.scale*24/x+m:0}var M=u[a.fontStack],k=M&&M[t];return k?k.metrics.advance*a.scale+m:0}function Sn(t,a,u,h){var m=Math.pow(t-a,2);return h?t<a?m/2:2*m:m+Math.abs(u)*u}function Xr(t,a,u){var h=0;return t===10&&(h-=1e4),u&&(h+=150),t!==40&&t!==65288||(h+=50),a!==41&&a!==65289||(h+=50),h}function Tr(t,a,u,h,m,x){for(var S=null,M=Sn(a,u,m,x),k=0,U=h;k<U.length;k+=1){var j=U[k],H=Sn(a-j.x,u,m,x)+j.badness;H<=M&&(S=j,M=H)}return{index:t,x:a,priorBreak:S,badness:M}}function Jr(t,a,u,h,m,x,S){if(x!=="point")return[];if(!t)return[];for(var M,k=[],U=function(Ke,ze,ot,Et,Zt,Ht){for(var cr=0,Lr=0;Lr<Ke.length();Lr++){var Vr=Ke.getSection(Lr);cr+=ar(Ke.getCharCode(Lr),Vr,Et,Zt,ze,Ht)}return cr/Math.max(1,Math.ceil(cr/ot))}(t,a,u,h,m,S),j=t.text.indexOf("\u200B")>=0,H=0,te=0;te<t.length();te++){var ue=t.getSection(te),Te=t.getCharCode(te);if(Fn[Te]||(H+=ar(Te,ue,h,m,a,S)),te<t.length()-1){var Oe=!((M=Te)<11904||!($r["Bopomofo Extended"](M)||$r.Bopomofo(M)||$r["CJK Compatibility Forms"](M)||$r["CJK Compatibility Ideographs"](M)||$r["CJK Compatibility"](M)||$r["CJK Radicals Supplement"](M)||$r["CJK Strokes"](M)||$r["CJK Symbols and Punctuation"](M)||$r["CJK Unified Ideographs Extension A"](M)||$r["CJK Unified Ideographs"](M)||$r["Enclosed CJK Letters and Months"](M)||$r["Halfwidth and Fullwidth Forms"](M)||$r.Hiragana(M)||$r["Ideographic Description Characters"](M)||$r["Kangxi Radicals"](M)||$r["Katakana Phonetic Extensions"](M)||$r.Katakana(M)||$r["Vertical Forms"](M)||$r["Yi Radicals"](M)||$r["Yi Syllables"](M)));(tr[Te]||Oe||ue.imageName)&&k.push(Tr(te+1,H,U,k,Xr(Te,t.getCharCode(te+1),Oe&&j),!1))}}return function Ke(ze){return ze?Ke(ze.priorBreak).concat(ze.index):[]}(Tr(t.length(),H,U,k,0,!0))}function Qr(t){var a=.5,u=.5;switch(t){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:a,verticalAlign:u}}function mi(t,a,u,h,m){if(h||m)for(var x=t[u],S=(t[u].x+x.metrics.advance*x.scale)*h,M=a;M<=u;M++)t[M].x-=S,t[M].y+=m}function ri(t,a,u,h,m,x){var S,M=t.image;if(M.content){var k=M.content,U=M.pixelRatio||1;S=[k[0]/U,k[1]/U,M.displaySize[0]-k[2]/U,M.displaySize[1]-k[3]/U]}var j,H,te,ue,Te=a.left*x,Oe=a.right*x;u==="width"||u==="both"?(ue=m[0]+Te-h[3],H=m[0]+Oe+h[1]):H=(ue=m[0]+(Te+Oe-M.displaySize[0])/2)+M.displaySize[0];var Ke=a.top*x,ze=a.bottom*x;return u==="height"||u==="both"?(j=m[1]+Ke-h[0],te=m[1]+ze+h[2]):te=(j=m[1]+(Ke+ze-M.displaySize[1])/2)+M.displaySize[1],{image:M,top:j,right:H,bottom:te,left:ue,collisionPadding:S}}tr[10]=!0,tr[32]=!0,tr[38]=!0,tr[40]=!0,tr[41]=!0,tr[43]=!0,tr[45]=!0,tr[47]=!0,tr[173]=!0,tr[183]=!0,tr[8203]=!0,tr[8208]=!0,tr[8211]=!0,tr[8231]=!0;var Kr=function(t){function a(u,h,m,x){t.call(this,u,h),this.angle=m,x!==void 0&&(this.segment=x)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.clone=function(){return new a(this.x,this.y,this.angle,this.segment)},a}(re);function an(t,a){var u=a.expression;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Oi(t+1))};if(u.kind==="source")return{kind:"source"};for(var h=u.zoomStops,m=u.interpolationType,x=0;x<h.length&&h[x]<=t;)x++;for(var S=x=Math.max(0,x-1);S<h.length&&h[S]<t+1;)S++;S=Math.min(h.length-1,S);var M=h[x],k=h[S];return u.kind==="composite"?{kind:"composite",minZoom:M,maxZoom:k,interpolationType:m}:{kind:"camera",minZoom:M,maxZoom:k,minSize:u.evaluate(new Oi(M)),maxSize:u.evaluate(new Oi(k)),interpolationType:m}}function Kn(t,a,u){var h=a.uSize,m=u.lowerSize;return t.kind==="source"?m/128:t.kind==="composite"?sa(m/128,u.upperSize/128,a.uSizeT):h}function ui(t,a){var u=0,h=0;if(t.kind==="constant")h=t.layoutSize;else if(t.kind!=="source"){var m=t.interpolationType,x=m?Pt(_e.interpolationFactor(m,a,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?h=sa(t.minSize,t.maxSize,x):u=x}return{uSizeT:u,uSize:h}}yn("Anchor",Kr);var Fi=Object.freeze({__proto__:null,getSizeData:an,evaluateSizeForFeature:Kn,evaluateSizeForZoom:ui,SIZE_PACK_FACTOR:128});function so(t,a,u,h,m){if(a.segment===void 0)return!0;for(var x=a,S=a.segment+1,M=0;M>-u/2;){if(--S<0)return!1;M-=t[S].dist(x),x=t[S]}M+=t[S].dist(t[S+1]),S++;for(var k=[],U=0;M<u/2;){var j=t[S],H=t[S+1];if(!H)return!1;var te=t[S-1].angleTo(j)-j.angleTo(H);for(te=Math.abs((te+3*Math.PI)%(2*Math.PI)-Math.PI),k.push({distance:M,angleDelta:te}),U+=te;M-k[0].distance>h;)U-=k.shift().angleDelta;if(U>m)return!1;S++,M+=j.dist(H)}return!0}function po(t){for(var a=0,u=0;u<t.length-1;u++)a+=t[u].dist(t[u+1]);return a}function ki(t,a,u){return t?.6*a*u:0}function ns(t,a){return Math.max(t?t.right-t.left:0,a?a.right-a.left:0)}function qa(t,a,u,h,m,x){for(var S=ki(u,m,x),M=ns(u,h)*x,k=0,U=po(t)/2,j=0;j<t.length-1;j++){var H=t[j],te=t[j+1],ue=H.dist(te);if(k+ue>U){var Te=(U-k)/ue,Oe=sa(H.x,te.x,Te),Ke=sa(H.y,te.y,Te),ze=new Kr(Oe,Ke,te.angleTo(H),j);return ze._round(),!S||so(t,ze,M,S,a)?ze:void 0}k+=ue}}function $o(t,a,u,h,m,x,S,M,k){var U=ki(h,x,S),j=ns(h,m),H=j*S,te=t[0].x===0||t[0].x===k||t[0].y===0||t[0].y===k;return a-H<a/4&&(a=H+a/4),function ue(Te,Oe,Ke,ze,ot,Et,Zt,Ht,cr){for(var Lr=Et/2,Vr=po(Te),gn=0,cn=Oe-Ke,Nn=[],pn=0;pn<Te.length-1;pn++){for(var wi=Te[pn],Qn=Te[pn+1],Pn=wi.dist(Qn),Zi=Qn.angleTo(wi);cn+Ke<gn+Pn;){var bi=((cn+=Ke)-gn)/Pn,na=sa(wi.x,Qn.x,bi),An=sa(wi.y,Qn.y,bi);if(na>=0&&na<cr&&An>=0&&An<cr&&cn-Lr>=0&&cn+Lr<=Vr){var va=new Kr(na,An,Zi,pn);va._round(),ze&&!so(Te,va,Et,ze,ot)||Nn.push(va)}}gn+=Pn}return Ht||Nn.length||Zt||(Nn=ue(Te,gn/2,Ke,ze,ot,Et,Zt,!0,cr)),Nn}(t,te?a/2*M%a:(j/2+2*x)*S*M%a,a,U,u,H,te,!1,k)}function Mo(t,a,u,h,m){for(var x=[],S=0;S<t.length;S++)for(var M=t[S],k=void 0,U=0;U<M.length-1;U++){var j=M[U],H=M[U+1];j.x<a&&H.x<a||(j.x<a?j=new re(a,j.y+(a-j.x)/(H.x-j.x)*(H.y-j.y))._round():H.x<a&&(H=new re(a,j.y+(a-j.x)/(H.x-j.x)*(H.y-j.y))._round()),j.y<u&&H.y<u||(j.y<u?j=new re(j.x+(u-j.y)/(H.y-j.y)*(H.x-j.x),u)._round():H.y<u&&(H=new re(j.x+(u-j.y)/(H.y-j.y)*(H.x-j.x),u)._round()),j.x>=h&&H.x>=h||(j.x>=h?j=new re(h,j.y+(h-j.x)/(H.x-j.x)*(H.y-j.y))._round():H.x>=h&&(H=new re(h,j.y+(h-j.x)/(H.x-j.x)*(H.y-j.y))._round()),j.y>=m&&H.y>=m||(j.y>=m?j=new re(j.x+(m-j.y)/(H.y-j.y)*(H.x-j.x),m)._round():H.y>=m&&(H=new re(j.x+(m-j.y)/(H.y-j.y)*(H.x-j.x),m)._round()),k&&j.equals(k[k.length-1])||x.push(k=[j]),k.push(H)))))}return x}function Jo(t,a,u,h){var m=[],x=t.image,S=x.pixelRatio,M=x.paddedRect.w-2,k=x.paddedRect.h-2,U=t.right-t.left,j=t.bottom-t.top,H=x.stretchX||[[0,M]],te=x.stretchY||[[0,k]],ue=function(na,An){return na+An[1]-An[0]},Te=H.reduce(ue,0),Oe=te.reduce(ue,0),Ke=M-Te,ze=k-Oe,ot=0,Et=Te,Zt=0,Ht=Oe,cr=0,Lr=Ke,Vr=0,gn=ze;if(x.content&&h){var cn=x.content;ot=Uo(H,0,cn[0]),Zt=Uo(te,0,cn[1]),Et=Uo(H,cn[0],cn[2]),Ht=Uo(te,cn[1],cn[3]),cr=cn[0]-ot,Vr=cn[1]-Zt,Lr=cn[2]-cn[0]-Et,gn=cn[3]-cn[1]-Ht}var Nn=function(na,An,va,Ai){var Po=uo(na.stretch-ot,Et,U,t.left),So=gi(na.fixed-cr,Lr,na.stretch,Te),lo=uo(An.stretch-Zt,Ht,j,t.top),ae=gi(An.fixed-Vr,gn,An.stretch,Oe),Qo=uo(va.stretch-ot,Et,U,t.left),es=gi(va.fixed-cr,Lr,va.stretch,Te),Ps=uo(Ai.stretch-Zt,Ht,j,t.top),as=gi(Ai.fixed-Vr,gn,Ai.stretch,Oe),Is=new re(Po,lo),Io=new re(Qo,lo),Oo=new re(Qo,Ps),Hi=new re(Po,Ps),Fa=new re(So/S,ae/S),Pa=new re(es/S,as/S),ia=a*Math.PI/180;if(ia){var js=Math.sin(ia),bs=Math.cos(ia),Qa=[bs,-js,js,bs];Is._matMult(Qa),Io._matMult(Qa),Hi._matMult(Qa),Oo._matMult(Qa)}var Vo=na.stretch+na.fixed,Es=An.stretch+An.fixed;return{tl:Is,tr:Io,bl:Hi,br:Oo,tex:{x:x.paddedRect.x+1+Vo,y:x.paddedRect.y+1+Es,w:va.stretch+va.fixed-Vo,h:Ai.stretch+Ai.fixed-Es},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Fa,pixelOffsetBR:Pa,minFontScaleX:Lr/S/U,minFontScaleY:gn/S/j,isSDF:u}};if(h&&(x.stretchX||x.stretchY))for(var pn=ps(H,Ke,Te),wi=ps(te,ze,Oe),Qn=0;Qn<pn.length-1;Qn++)for(var Pn=pn[Qn],Zi=pn[Qn+1],bi=0;bi<wi.length-1;bi++)m.push(Nn(Pn,wi[bi],Zi,wi[bi+1]));else m.push(Nn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:k+1}));return m}function Uo(t,a,u){for(var h=0,m=0,x=t;m<x.length;m+=1){var S=x[m];h+=Math.max(a,Math.min(u,S[1]))-Math.max(a,Math.min(u,S[0]))}return h}function ps(t,a,u){for(var h=[{fixed:-1,stretch:0}],m=0,x=t;m<x.length;m+=1){var S=x[m],M=S[0],k=S[1],U=h[h.length-1];h.push({fixed:M-U.stretch,stretch:U.stretch}),h.push({fixed:M-U.stretch,stretch:U.stretch+(k-M)})}return h.push({fixed:a+1,stretch:u}),h}function uo(t,a,u,h){return t/a*u+h}function gi(t,a,u,h){return t-a*u/h}var Zo=function(t,a,u,h,m,x,S,M,k,U){if(this.boxStartIndex=t.length,k){var j=x.top,H=x.bottom,te=x.collisionPadding;te&&(j-=te[1],H+=te[3]);var ue=H-j;ue>0&&(ue=Math.max(10,ue),this.circleDiameter=ue)}else{var Te=x.top*S-M,Oe=x.bottom*S+M,Ke=x.left*S-M,ze=x.right*S+M,ot=x.collisionPadding;if(ot&&(Ke-=ot[0]*S,Te-=ot[1]*S,ze+=ot[2]*S,Oe+=ot[3]*S),U){var Et=new re(Ke,Te),Zt=new re(ze,Te),Ht=new re(Ke,Oe),cr=new re(ze,Oe),Lr=U*Math.PI/180;Et._rotate(Lr),Zt._rotate(Lr),Ht._rotate(Lr),cr._rotate(Lr),Ke=Math.min(Et.x,Zt.x,Ht.x,cr.x),ze=Math.max(Et.x,Zt.x,Ht.x,cr.x),Te=Math.min(Et.y,Zt.y,Ht.y,cr.y),Oe=Math.max(Et.y,Zt.y,Ht.y,cr.y)}t.emplaceBack(a.x,a.y,Ke,Te,ze,Oe,u,h,m)}this.boxEndIndex=t.length},ra=function(t,a){if(t===void 0&&(t=[]),a===void 0&&(a=jo),this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(var u=(this.length>>1)-1;u>=0;u--)this._down(u)};function jo(t,a){return t<a?-1:t>a?1:0}function ti(t,a,u){a===void 0&&(a=1),u===void 0&&(u=!1);for(var h=1/0,m=1/0,x=-1/0,S=-1/0,M=t[0],k=0;k<M.length;k++){var U=M[k];(!k||U.x<h)&&(h=U.x),(!k||U.y<m)&&(m=U.y),(!k||U.x>x)&&(x=U.x),(!k||U.y>S)&&(S=U.y)}var j=Math.min(x-h,S-m),H=j/2,te=new ra([],Bi);if(j===0)return new re(h,m);for(var ue=h;ue<x;ue+=j)for(var Te=m;Te<S;Te+=j)te.push(new la(ue+H,Te+H,H,t));for(var Oe=function(ot){for(var Et=0,Zt=0,Ht=0,cr=ot[0],Lr=0,Vr=cr.length,gn=Vr-1;Lr<Vr;gn=Lr++){var cn=cr[Lr],Nn=cr[gn],pn=cn.x*Nn.y-Nn.x*cn.y;Zt+=(cn.x+Nn.x)*pn,Ht+=(cn.y+Nn.y)*pn,Et+=3*pn}return new la(Zt/Et,Ht/Et,0,ot)}(t),Ke=te.length;te.length;){var ze=te.pop();(ze.d>Oe.d||!Oe.d)&&(Oe=ze,u&&console.log("found best %d after %d probes",Math.round(1e4*ze.d)/1e4,Ke)),ze.max-Oe.d<=a||(te.push(new la(ze.p.x-(H=ze.h/2),ze.p.y-H,H,t)),te.push(new la(ze.p.x+H,ze.p.y-H,H,t)),te.push(new la(ze.p.x-H,ze.p.y+H,H,t)),te.push(new la(ze.p.x+H,ze.p.y+H,H,t)),Ke+=4)}return u&&(console.log("num probes: "+Ke),console.log("best distance: "+Oe.d)),Oe.p}function Bi(t,a){return a.max-t.max}function la(t,a,u,h){this.p=new re(t,a),this.h=u,this.d=function(m,x){for(var S=!1,M=1/0,k=0;k<x.length;k++)for(var U=x[k],j=0,H=U.length,te=H-1;j<H;te=j++){var ue=U[j],Te=U[te];ue.y>m.y!=Te.y>m.y&&m.x<(Te.x-ue.x)*(m.y-ue.y)/(Te.y-ue.y)+ue.x&&(S=!S),M=Math.min(M,su(m,ue,Te))}return(S?1:-1)*Math.sqrt(M)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}ra.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},ra.prototype.pop=function(){if(this.length!==0){var t=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),t}},ra.prototype.peek=function(){return this.data[0]},ra.prototype._up=function(t){for(var a=this.data,u=this.compare,h=a[t];t>0;){var m=t-1>>1,x=a[m];if(u(h,x)>=0)break;a[t]=x,t=m}a[t]=h},ra.prototype._down=function(t){for(var a=this.data,u=this.compare,h=this.length>>1,m=a[t];t<h;){var x=1+(t<<1),S=a[x],M=x+1;if(M<this.length&&u(a[M],S)<0&&(x=M,S=a[M]),u(S,m)>=0)break;a[t]=S,t=x}a[t]=m};var Eo=Number.POSITIVE_INFINITY;function gl(t,a){return a[1]!==Eo?function(u,h,m){var x=0,S=0;switch(h=Math.abs(h),m=Math.abs(m),u){case"top-right":case"top-left":case"top":S=m-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-m}switch(u){case"top-right":case"bottom-right":case"right":x=-h;break;case"top-left":case"bottom-left":case"left":x=h}return[x,S]}(t,a[0],a[1]):function(u,h){var m=0,x=0;h<0&&(h=0);var S=h/Math.sqrt(2);switch(u){case"top-right":case"top-left":x=S-7;break;case"bottom-right":case"bottom-left":x=7-S;break;case"bottom":x=7-h;break;case"top":x=h-7}switch(u){case"top-right":case"bottom-right":m=-S;break;case"top-left":case"bottom-left":m=S;break;case"left":m=h;break;case"right":m=-h}return[m,x]}(t,a[0])}function Ie(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Bt(t,a,u,h,m,x,S,M,k,U,j,H,te,ue,Te){var Oe=function(Zt,Ht,cr,Lr,Vr,gn,cn,Nn){for(var pn=Lr.layout.get("text-rotate").evaluate(gn,{})*Math.PI/180,wi=[],Qn=0,Pn=Ht.positionedLines;Qn<Pn.length;Qn+=1)for(var Zi=Pn[Qn],bi=0,na=Zi.positionedGlyphs;bi<na.length;bi+=1){var An=na[bi];if(An.rect){var va=An.rect||{},Ai=4,Po=!0,So=1,lo=0,ae=(Vr||Nn)&&An.vertical,Qo=An.metrics.advance*An.scale/2;if(Nn&&Ht.verticalizable&&(lo=Zi.lineOffset/2-(An.imageName?-(24-An.metrics.width*An.scale)/2:24*(An.scale-1))),An.imageName){var es=cn[An.imageName];Po=es.sdf,Ai=1/(So=es.pixelRatio)}var Ps=Vr?[An.x+Qo,An.y]:[0,0],as=Vr?[0,0]:[An.x+Qo+cr[0],An.y+cr[1]-lo],Is=[0,0];ae&&(Is=as,as=[0,0]);var Io=(An.metrics.left-Ai)*An.scale-Qo+as[0],Oo=(-An.metrics.top-Ai)*An.scale+as[1],Hi=Io+va.w*An.scale/So,Fa=Oo+va.h*An.scale/So,Pa=new re(Io,Oo),ia=new re(Hi,Oo),js=new re(Io,Fa),bs=new re(Hi,Fa);if(ae){var Qa=new re(-Qo,Qo- -17),Vo=-Math.PI/2,Es=12-Qo,ca=new re(22-Es,-(An.imageName?Es:0)),Fl=new(Function.prototype.bind.apply(re,[null].concat(Is)));Pa._rotateAround(Vo,Qa)._add(ca)._add(Fl),ia._rotateAround(Vo,Qa)._add(ca)._add(Fl),js._rotateAround(Vo,Qa)._add(ca)._add(Fl),bs._rotateAround(Vo,Qa)._add(ca)._add(Fl)}if(pn){var xu=Math.sin(pn),Bl=Math.cos(pn),co=[Bl,-xu,xu,Bl];Pa._matMult(co),ia._matMult(co),js._matMult(co),bs._matMult(co)}var Nl=new re(0,0),el=new re(0,0);wi.push({tl:Pa,tr:ia,bl:js,br:bs,tex:va,writingMode:Ht.writingMode,glyphOffset:Ps,sectionIndex:An.sectionIndex,isSDF:Po,pixelOffsetTL:Nl,pixelOffsetBR:el,minFontScaleX:0,minFontScaleY:0})}}return wi}(0,u,M,m,x,S,h,t.allowVerticalPlacement),Ke=t.textSizeData,ze=null;Ke.kind==="source"?(ze=[128*m.layout.get("text-size").evaluate(S,{})])[0]>32640&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):Ke.kind==="composite"&&((ze=[128*ue.compositeTextSizes[0].evaluate(S,{},Te),128*ue.compositeTextSizes[1].evaluate(S,{},Te)])[0]>32640||ze[1]>32640)&&$e(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Oe,ze,M,x,S,U,a,k.lineStartIndex,k.lineLength,te,Te);for(var ot=0,Et=j;ot<Et.length;ot+=1)H[Et[ot]]=t.text.placedSymbolArray.length-1;return 4*Oe.length}function Ct(t){for(var a in t)return t[a];return null}function vn(t,a,u,h){var m=t.compareText;if(a in m){for(var x=m[a],S=x.length-1;S>=0;S--)if(h.dist(x[S])<u)return!0}else m[a]=[];return m[a].push(h),!1}var Ni=cu.VectorTileFeature.types,Se=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function ce(t,a,u,h,m,x,S,M,k,U,j,H,te){var ue=M?Math.min(32640,Math.round(M[0])):0,Te=M?Math.min(32640,Math.round(M[1])):0;t.emplaceBack(a,u,Math.round(32*h),Math.round(32*m),x,S,(ue<<1)+(k?1:0),Te,16*U,16*j,256*H,256*te)}function Ve(t,a,u){t.emplaceBack(a.x,a.y,u),t.emplaceBack(a.x,a.y,u),t.emplaceBack(a.x,a.y,u),t.emplaceBack(a.x,a.y,u)}function dt(t){for(var a=0,u=t.sections;a<u.length;a+=1)if(of(u[a].text))return!0;return!1}var It=function(t){this.layoutVertexArray=new sf,this.indexArray=new qu,this.programConfigurations=t,this.segments=new fe,this.dynamicLayoutVertexArray=new Ml,this.opacityVertexArray=new Pl,this.placedSymbolArray=new d};It.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},It.prototype.upload=function(t,a,u,h){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Sd.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Yp.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Se,!0),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(t))},It.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},yn("SymbolBuffers",It);var Je=function(t,a,u){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new u,this.segments=new fe,this.collisionVertexArray=new dh};Je.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Cd.members,!0)},Je.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},yn("CollisionBuffers",Je);var Ne=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(x){return x.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ms([]),this.placementViewportMatrix=Ms([]);var a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=an(this.zoom,a["text-size"]),this.iconSizeData=an(this.zoom,a["icon-size"]);var u=this.layers[0].layout,h=u.get("symbol-sort-key"),m=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,u.get("symbol-placement")==="point"&&(this.writingModes=u.get("text-writing-mode").map(function(x){return Ur[x]})),this.stateDependentLayerIds=this.layers.filter(function(x){return x.isStateDependent()}).map(function(x){return x.id}),this.sourceID=t.sourceID};Ne.prototype.createArrays=function(){this.text=new It(new Vn(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new It(new Vn(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new A,this.lineVertexArray=new L,this.symbolInstances=new C},Ne.prototype.calculateGlyphDependencies=function(t,a,u,h,m){for(var x=0;x<t.length;x++)if(a[t.charCodeAt(x)]=!0,(u||h)&&m){var S=Hf[t.charAt(x)];S&&(a[S.charCodeAt(0)]=!0)}},Ne.prototype.populate=function(t,a,u){var h=this.layers[0],m=h.layout,x=m.get("text-font"),S=m.get("text-field"),M=m.get("icon-image"),k=(S.value.kind!=="constant"||S.value.value instanceof wa&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),U=M.value.kind!=="constant"||!!M.value.value||Object.keys(M.parameters).length>0,j=m.get("symbol-sort-key");if(this.features=[],k||U){for(var H=a.iconDependencies,te=a.glyphDependencies,ue=a.availableImages,Te=new Oi(this.zoom),Oe=0,Ke=t;Oe<Ke.length;Oe+=1){var ze=Ke[Oe],ot=ze.feature,Et=ze.id,Zt=ze.index,Ht=ze.sourceLayerIndex,cr=h._featureFilter.needGeometry,Lr=Ua(ot,cr);if(h._featureFilter.filter(Te,Lr,u)){cr||(Lr.geometry=Ya(ot));var Vr=void 0;if(k){var gn=h.getValueAndResolveTokens("text-field",Lr,u,ue),cn=wa.factory(gn);dt(cn)&&(this.hasRTLText=!0),(!this.hasRTLText||ph()==="unavailable"||this.hasRTLText&&As.isParsed())&&(Vr=pv(cn,h,Lr))}var Nn=void 0;if(U){var pn=h.getValueAndResolveTokens("icon-image",Lr,u,ue);Nn=pn instanceof Aa?pn:Aa.fromString(pn)}if(Vr||Nn){var wi=this.sortFeaturesByKey?j.evaluate(Lr,{},u):void 0;if(this.features.push({id:Et,text:Vr,icon:Nn,index:Zt,sourceLayerIndex:Ht,geometry:Lr.geometry,properties:ot.properties,type:Ni[ot.type],sortKey:wi}),Nn&&(H[Nn.name]=!0),Vr){var Qn=x.evaluate(Lr,{},u).join(","),Pn=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ur.vertical)>=0;for(var Zi=0,bi=Vr.sections;Zi<bi.length;Zi+=1){var na=bi[Zi];if(na.image)H[na.image.name]=!0;else{var An=af(Vr.toString()),va=na.fontStack||Qn,Ai=te[va]=te[va]||{};this.calculateGlyphDependencies(na.text,Ai,Pn,this.allowVerticalPlacement,An)}}}}}}m.get("symbol-placement")==="line"&&(this.features=function(Po){var So={},lo={},ae=[],Qo=0;function es(Qa){ae.push(Po[Qa]),Qo++}function Ps(Qa,Vo,Es){var ca=lo[Qa];return delete lo[Qa],lo[Vo]=ca,ae[ca].geometry[0].pop(),ae[ca].geometry[0]=ae[ca].geometry[0].concat(Es[0]),ca}function as(Qa,Vo,Es){var ca=So[Vo];return delete So[Vo],So[Qa]=ca,ae[ca].geometry[0].shift(),ae[ca].geometry[0]=Es[0].concat(ae[ca].geometry[0]),ca}function Is(Qa,Vo,Es){var ca=Es?Vo[0][Vo[0].length-1]:Vo[0][0];return Qa+":"+ca.x+":"+ca.y}for(var Io=0;Io<Po.length;Io++){var Oo=Po[Io],Hi=Oo.geometry,Fa=Oo.text?Oo.text.toString():null;if(Fa){var Pa=Is(Fa,Hi),ia=Is(Fa,Hi,!0);if(Pa in lo&&ia in So&&lo[Pa]!==So[ia]){var js=as(Pa,ia,Hi),bs=Ps(Pa,ia,ae[js].geometry);delete So[Pa],delete lo[ia],lo[Is(Fa,ae[bs].geometry,!0)]=bs,ae[js].geometry=null}else Pa in lo?Ps(Pa,ia,Hi):ia in So?as(Pa,ia,Hi):(es(Io),So[Pa]=Qo-1,lo[ia]=Qo-1)}else es(Io)}return ae.filter(function(Qa){return Qa.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Po,So){return Po.sortKey-So.sortKey})}},Ne.prototype.update=function(t,a,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,u),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,u))},Ne.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},Ne.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},Ne.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},Ne.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},Ne.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},Ne.prototype.addToLineVertexArray=function(t,a){var u=this.lineVertexArray.length;if(t.segment!==void 0){for(var h=t.dist(a[t.segment+1]),m=t.dist(a[t.segment]),x={},S=t.segment+1;S<a.length;S++)x[S]={x:a[S].x,y:a[S].y,tileUnitDistanceFromAnchor:h},S<a.length-1&&(h+=a[S+1].dist(a[S]));for(var M=t.segment||0;M>=0;M--)x[M]={x:a[M].x,y:a[M].y,tileUnitDistanceFromAnchor:m},M>0&&(m+=a[M-1].dist(a[M]));for(var k=0;k<a.length;k++){var U=x[k];this.lineVertexArray.emplaceBack(U.x,U.y,U.tileUnitDistanceFromAnchor)}}return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}},Ne.prototype.addSymbols=function(t,a,u,h,m,x,S,M,k,U,j,H){for(var te=t.indexArray,ue=t.layoutVertexArray,Te=t.segments.prepareSegment(4*a.length,ue,te,this.canOverlap?x.sortKey:void 0),Oe=this.glyphOffsetArray.length,Ke=Te.vertexLength,ze=this.allowVerticalPlacement&&S===Ur.vertical?Math.PI/2:0,ot=x.text&&x.text.sections,Et=0;Et<a.length;Et++){var Zt=a[Et],Ht=Zt.tl,cr=Zt.tr,Lr=Zt.bl,Vr=Zt.br,gn=Zt.tex,cn=Zt.pixelOffsetTL,Nn=Zt.pixelOffsetBR,pn=Zt.minFontScaleX,wi=Zt.minFontScaleY,Qn=Zt.glyphOffset,Pn=Zt.isSDF,Zi=Zt.sectionIndex,bi=Te.vertexLength,na=Qn[1];ce(ue,M.x,M.y,Ht.x,na+Ht.y,gn.x,gn.y,u,Pn,cn.x,cn.y,pn,wi),ce(ue,M.x,M.y,cr.x,na+cr.y,gn.x+gn.w,gn.y,u,Pn,Nn.x,cn.y,pn,wi),ce(ue,M.x,M.y,Lr.x,na+Lr.y,gn.x,gn.y+gn.h,u,Pn,cn.x,Nn.y,pn,wi),ce(ue,M.x,M.y,Vr.x,na+Vr.y,gn.x+gn.w,gn.y+gn.h,u,Pn,Nn.x,Nn.y,pn,wi),Ve(t.dynamicLayoutVertexArray,M,ze),te.emplaceBack(bi,bi+1,bi+2),te.emplaceBack(bi+1,bi+2,bi+3),Te.vertexLength+=4,Te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Qn[0]),Et!==a.length-1&&Zi===a[Et+1].sectionIndex||t.programConfigurations.populatePaintArrays(ue.length,x,x.index,{},H,ot&&ot[Zi])}t.placedSymbolArray.emplaceBack(M.x,M.y,Oe,this.glyphOffsetArray.length-Oe,Ke,k,U,M.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],S,0,!1,0,j)},Ne.prototype._addCollisionDebugVertex=function(t,a,u,h,m,x){return a.emplaceBack(0,0),t.emplaceBack(u.x,u.y,h,m,Math.round(x.x),Math.round(x.y))},Ne.prototype.addCollisionDebugVertices=function(t,a,u,h,m,x,S){var M=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),k=M.vertexLength,U=m.layoutVertexArray,j=m.collisionVertexArray,H=S.anchorX,te=S.anchorY;this._addCollisionDebugVertex(U,j,x,H,te,new re(t,a)),this._addCollisionDebugVertex(U,j,x,H,te,new re(u,a)),this._addCollisionDebugVertex(U,j,x,H,te,new re(u,h)),this._addCollisionDebugVertex(U,j,x,H,te,new re(t,h)),M.vertexLength+=4;var ue=m.indexArray;ue.emplaceBack(k,k+1),ue.emplaceBack(k+1,k+2),ue.emplaceBack(k+2,k+3),ue.emplaceBack(k+3,k),M.primitiveLength+=4},Ne.prototype.addDebugCollisionBoxes=function(t,a,u,h){for(var m=t;m<a;m++){var x=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,h?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,u)}},Ne.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Je(ec,Th.members,_u),this.iconCollisionBox=new Je(ec,Th.members,_u);for(var t=0;t<this.symbolInstances.length;t++){var a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}},Ne.prototype._deserializeCollisionBoxesForSymbol=function(t,a,u,h,m,x,S,M,k){for(var U={},j=a;j<u;j++){var H=t.get(j);U.textBox={x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,anchorPointX:H.anchorPointX,anchorPointY:H.anchorPointY},U.textFeatureIndex=H.featureIndex;break}for(var te=h;te<m;te++){var ue=t.get(te);U.verticalTextBox={x1:ue.x1,y1:ue.y1,x2:ue.x2,y2:ue.y2,anchorPointX:ue.anchorPointX,anchorPointY:ue.anchorPointY},U.verticalTextFeatureIndex=ue.featureIndex;break}for(var Te=x;Te<S;Te++){var Oe=t.get(Te);U.iconBox={x1:Oe.x1,y1:Oe.y1,x2:Oe.x2,y2:Oe.y2,anchorPointX:Oe.anchorPointX,anchorPointY:Oe.anchorPointY},U.iconFeatureIndex=Oe.featureIndex;break}for(var Ke=M;Ke<k;Ke++){var ze=t.get(Ke);U.verticalIconBox={x1:ze.x1,y1:ze.y1,x2:ze.x2,y2:ze.y2,anchorPointX:ze.anchorPointX,anchorPointY:ze.anchorPointY},U.verticalIconFeatureIndex=ze.featureIndex;break}return U},Ne.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var a=0;a<this.symbolInstances.length;a++){var u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}},Ne.prototype.hasTextData=function(){return this.text.segments.get().length>0},Ne.prototype.hasIconData=function(){return this.icon.segments.get().length>0},Ne.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},Ne.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},Ne.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},Ne.prototype.addIndicesForPlacedSymbol=function(t,a){for(var u=t.placedSymbolArray.get(a),h=u.vertexStartIndex+4*u.numGlyphs,m=u.vertexStartIndex;m<h;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)},Ne.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var a=Math.sin(t),u=Math.cos(t),h=[],m=[],x=[],S=0;S<this.symbolInstances.length;++S){x.push(S);var M=this.symbolInstances.get(S);h.push(0|Math.round(a*M.anchorX+u*M.anchorY)),m.push(M.featureIndex)}return x.sort(function(k,U){return h[k]-h[U]||m[U]-m[k]}),x},Ne.prototype.addToSortKeyRanges=function(t,a){var u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})},Ne.prototype.sortFeatures=function(t){var a=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var u=0,h=this.symbolInstanceIndexes;u<h.length;u+=1){var m=this.symbolInstances.get(h[u]);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach(function(x,S,M){x>=0&&M.indexOf(x)===S&&a.addIndicesForPlacedSymbol(a.text,x)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},yn("SymbolBucket",Ne,{omit:["layers","collisionBoxArray","features","compareText"]}),Ne.MAX_GLYPHS=65535,Ne.addDynamicAttributes=Ve;var nt=new Ko({"symbol-placement":new On(pe.layout_symbol["symbol-placement"]),"symbol-spacing":new On(pe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new On(pe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new wn(pe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new On(pe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new On(pe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new On(pe.layout_symbol["icon-ignore-placement"]),"icon-optional":new On(pe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new On(pe.layout_symbol["icon-rotation-alignment"]),"icon-size":new wn(pe.layout_symbol["icon-size"]),"icon-text-fit":new On(pe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new On(pe.layout_symbol["icon-text-fit-padding"]),"icon-image":new wn(pe.layout_symbol["icon-image"]),"icon-rotate":new wn(pe.layout_symbol["icon-rotate"]),"icon-padding":new On(pe.layout_symbol["icon-padding"]),"icon-keep-upright":new On(pe.layout_symbol["icon-keep-upright"]),"icon-offset":new wn(pe.layout_symbol["icon-offset"]),"icon-anchor":new wn(pe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new On(pe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new On(pe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new On(pe.layout_symbol["text-rotation-alignment"]),"text-field":new wn(pe.layout_symbol["text-field"]),"text-font":new wn(pe.layout_symbol["text-font"]),"text-size":new wn(pe.layout_symbol["text-size"]),"text-max-width":new wn(pe.layout_symbol["text-max-width"]),"text-line-height":new On(pe.layout_symbol["text-line-height"]),"text-letter-spacing":new wn(pe.layout_symbol["text-letter-spacing"]),"text-justify":new wn(pe.layout_symbol["text-justify"]),"text-radial-offset":new wn(pe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new On(pe.layout_symbol["text-variable-anchor"]),"text-anchor":new wn(pe.layout_symbol["text-anchor"]),"text-max-angle":new On(pe.layout_symbol["text-max-angle"]),"text-writing-mode":new On(pe.layout_symbol["text-writing-mode"]),"text-rotate":new wn(pe.layout_symbol["text-rotate"]),"text-padding":new On(pe.layout_symbol["text-padding"]),"text-keep-upright":new On(pe.layout_symbol["text-keep-upright"]),"text-transform":new wn(pe.layout_symbol["text-transform"]),"text-offset":new wn(pe.layout_symbol["text-offset"]),"text-allow-overlap":new On(pe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new On(pe.layout_symbol["text-ignore-placement"]),"text-optional":new On(pe.layout_symbol["text-optional"])}),ye={paint:new Ko({"icon-opacity":new wn(pe.paint_symbol["icon-opacity"]),"icon-color":new wn(pe.paint_symbol["icon-color"]),"icon-halo-color":new wn(pe.paint_symbol["icon-halo-color"]),"icon-halo-width":new wn(pe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new wn(pe.paint_symbol["icon-halo-blur"]),"icon-translate":new On(pe.paint_symbol["icon-translate"]),"icon-translate-anchor":new On(pe.paint_symbol["icon-translate-anchor"]),"text-opacity":new wn(pe.paint_symbol["text-opacity"]),"text-color":new wn(pe.paint_symbol["text-color"],{runtimeType:qr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new wn(pe.paint_symbol["text-halo-color"]),"text-halo-width":new wn(pe.paint_symbol["text-halo-width"]),"text-halo-blur":new wn(pe.paint_symbol["text-halo-blur"]),"text-translate":new On(pe.paint_symbol["text-translate"]),"text-translate-anchor":new On(pe.paint_symbol["text-translate-anchor"])}),layout:nt},Ze=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:un,this.defaultValue=t};Ze.prototype.evaluate=function(t){if(t.formattedSection){var a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},Ze.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},Ze.prototype.outputDefined=function(){return!1},Ze.prototype.serialize=function(){return null},yn("FormatSectionOverride",Ze,{omit:["defaultValue"]});var we=function(t){function a(u){t.call(this,u,ye)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(u,h){if(t.prototype.recalculate.call(this,u,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var m=this.layout.get("text-writing-mode");if(m){for(var x=[],S=0,M=m;S<M.length;S+=1){var k=M[S];x.indexOf(k)<0&&x.push(k)}this.layout._values["text-writing-mode"]=x}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},a.prototype.getValueAndResolveTokens=function(u,h,m,x){var S=this.layout.get(u).evaluate(h,{},m,x),M=this._unevaluatedLayout._values[u];return M.isDataDriven()||No(M.value)||!S?S:function(k,U){return U.replace(/{([^{}]+)}/g,function(j,H){return H in k?String(k[H]):""})}(h.properties,S)},a.prototype.createBucket=function(u){return new Ne(u)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype._setPaintOverrides=function(){for(var u=0,h=ye.paint.overridableProperties;u<h.length;u+=1){var m=h[u];if(a.hasPaintOverride(this.layout,m)){var x,S=this.paint.get(m),M=new Ze(S),k=new ol(M,S.property.specification);x=S.value.kind==="constant"||S.value.kind==="source"?new Vu("source",k):new zo("composite",k,S.value.zoomStops,S.value._interpolationType),this.paint._values[m]=new cs(S.property,x,S.parameters)}}},a.prototype._handleOverridablePaintPropertyUpdate=function(u,h,m){return!(!this.layout||h.isDataDriven()||m.isDataDriven())&&a.hasPaintOverride(this.layout,u)},a.hasPaintOverride=function(u,h){var m=u.get("text-field"),x=ye.paint.properties[h],S=!1,M=function(j){for(var H=0,te=j;H<te.length;H+=1)if(x.overrides&&x.overrides.hasOverride(te[H]))return void(S=!0)};if(m.value.kind==="constant"&&m.value.value instanceof wa)M(m.value.value.sections);else if(m.value.kind==="source"){var k=function(j){S||(j instanceof mo&&ta(j.value)===Ji?M(j.value.sections):j instanceof Ho?M(j.sections):j.eachChild(k))},U=m.value;U._styleExpression&&k(U._styleExpression.expression)}return S},a}(Sa),ft={paint:new Ko({"background-color":new On(pe.paint_background["background-color"]),"background-pattern":new fs(pe.paint_background["background-pattern"]),"background-opacity":new On(pe.paint_background["background-opacity"])})},St=function(t){function a(u){t.call(this,u,ft)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Sa),hr={paint:new Ko({"raster-opacity":new On(pe.paint_raster["raster-opacity"]),"raster-hue-rotate":new On(pe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new On(pe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new On(pe.paint_raster["raster-brightness-max"]),"raster-saturation":new On(pe.paint_raster["raster-saturation"]),"raster-contrast":new On(pe.paint_raster["raster-contrast"]),"raster-resampling":new On(pe.paint_raster["raster-resampling"]),"raster-fade-duration":new On(pe.paint_raster["raster-fade-duration"])})},Zr=function(t){function a(u){t.call(this,u,hr)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Sa),jr=function(t){function a(u){t.call(this,u,{}),this.implementation=u}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},a.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},a.prototype.recalculate=function(){},a.prototype.updateTransitions=function(){},a.prototype.hasTransition=function(){},a.prototype.serialize=function(){},a.prototype.onAdd=function(u){this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},a.prototype.onRemove=function(u){this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},a}(Sa),rn={circle:lf,heatmap:Lf,hillshade:mh,fill:Uf,"fill-extrusion":Qu,line:Wp,symbol:we,background:St,raster:Zr},Nr=ne.HTMLImageElement,mr=ne.HTMLCanvasElement,ur=ne.HTMLVideoElement,bn=ne.ImageData,Cn=ne.ImageBitmap,mn=function(t,a,u,h){this.context=t,this.format=u,this.texture=t.gl.createTexture(),this.update(a,h)};mn.prototype.update=function(t,a,u){var h=t.width,m=t.height,x=!(this.size&&this.size[0]===h&&this.size[1]===m||u),S=this.context,M=S.gl;if(this.useMipmap=Boolean(a&&a.useMipmap),M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!a||a.premultiply!==!1)),x)this.size=[h,m],t instanceof Nr||t instanceof mr||t instanceof ur||t instanceof bn||Cn&&t instanceof Cn?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,t):M.texImage2D(M.TEXTURE_2D,0,this.format,h,m,0,this.format,M.UNSIGNED_BYTE,t.data);else{var k=u||{x:0,y:0},U=k.x,j=k.y;t instanceof Nr||t instanceof mr||t instanceof ur||t instanceof bn||Cn&&t instanceof Cn?M.texSubImage2D(M.TEXTURE_2D,0,U,j,M.RGBA,M.UNSIGNED_BYTE,t):M.texSubImage2D(M.TEXTURE_2D,0,U,j,h,m,M.RGBA,M.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&M.generateMipmap(M.TEXTURE_2D)},mn.prototype.bind=function(t,a,u){var h=this.context.gl;h.bindTexture(h.TEXTURE_2D,this.texture),u!==h.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(u=h.LINEAR),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,u||t),this.filter=t),a!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrap=a)},mn.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},mn.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var $n=function(t){var a=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){a._triggered=!1,a._callback()})};$n.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},$n.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Ma=function(t,a,u){this.target=t,this.parent=a,this.mapId=u,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Jt(["receive","process"],this),this.invoker=new $n(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ir()?t:ne};function ds(t,a,u){var h=2*Math.PI*6378137/256/Math.pow(2,u);return[t*h-2*Math.PI*6378137/2,a*h-2*Math.PI*6378137/2]}Ma.prototype.send=function(t,a,u,h,m){var x=this;m===void 0&&(m=!1);var S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(this.callbacks[S]=u);var M=Ye(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:h,mustQueue:m,sourceMapId:this.mapId,data:du(a,M)},M),{cancel:function(){u&&delete x.callbacks[S],x.target.postMessage({id:S,type:"<cancel>",targetMapId:h,sourceMapId:x.mapId})}}},Ma.prototype.receive=function(t){var a=t.data,u=a.id;if(u&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){delete this.tasks[u];var h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h()}else Ir()||a.mustQueue?(this.tasks[u]=a,this.taskQueue.push(u),this.invoker.trigger()):this.processTask(u,a)},Ma.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),a=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),a&&this.processTask(t,a)}},Ma.prototype.processTask=function(t,a){var u=this;if(a.type==="<response>"){var h=this.callbacks[t];delete this.callbacks[t],h&&(a.error?h(ks(a.error)):h(null,ks(a.data)))}else{var m=!1,x=Ye(this.globalScope)?void 0:[],S=a.hasCallback?function(j,H){m=!0,delete u.cancelCallbacks[t],u.target.postMessage({id:t,type:"<response>",sourceMapId:u.mapId,error:j?du(j):null,data:du(H,x)},x)}:function(j){m=!0},M=null,k=ks(a.data);if(this.parent[a.type])M=this.parent[a.type](a.sourceMapId,k,S);else if(this.parent.getWorkerSource){var U=a.type.split(".");M=this.parent.getWorkerSource(a.sourceMapId,U[0],k.source)[U[1]](k,S)}else S(new Error("Could not find function "+a.type));!m&&M&&M.cancel&&(this.cancelCallbacks[t]=M.cancel)}},Ma.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Va=function(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Va.prototype.setNorthEast=function(t){return this._ne=t instanceof xa?new xa(t.lng,t.lat):xa.convert(t),this},Va.prototype.setSouthWest=function(t){return this._sw=t instanceof xa?new xa(t.lng,t.lat):xa.convert(t),this},Va.prototype.extend=function(t){var a,u,h=this._sw,m=this._ne;if(t instanceof xa)a=t,u=t;else{if(!(t instanceof Va))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(Va.convert(t)):this.extend(xa.convert(t)):this;if(u=t._ne,!(a=t._sw)||!u)return this}return h||m?(h.lng=Math.min(a.lng,h.lng),h.lat=Math.min(a.lat,h.lat),m.lng=Math.max(u.lng,m.lng),m.lat=Math.max(u.lat,m.lat)):(this._sw=new xa(a.lng,a.lat),this._ne=new xa(u.lng,u.lat)),this},Va.prototype.getCenter=function(){return new xa((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Va.prototype.getSouthWest=function(){return this._sw},Va.prototype.getNorthEast=function(){return this._ne},Va.prototype.getNorthWest=function(){return new xa(this.getWest(),this.getNorth())},Va.prototype.getSouthEast=function(){return new xa(this.getEast(),this.getSouth())},Va.prototype.getWest=function(){return this._sw.lng},Va.prototype.getSouth=function(){return this._sw.lat},Va.prototype.getEast=function(){return this._ne.lng},Va.prototype.getNorth=function(){return this._ne.lat},Va.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Va.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Va.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Va.prototype.contains=function(t){var a=xa.convert(t),u=a.lng,h=a.lat,m=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&m},Va.convert=function(t){return!t||t instanceof Va?t:new Va(t)};var xa=function(t,a){if(isNaN(t)||isNaN(a))throw new Error("Invalid LngLat object: ("+t+", "+a+")");if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};xa.prototype.wrap=function(){return new xa(nr(this.lng,-180,180),this.lat)},xa.prototype.toArray=function(){return[this.lng,this.lat]},xa.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},xa.prototype.distanceTo=function(t){var a=Math.PI/180,u=this.lat*a,h=t.lat*a,m=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((t.lng-this.lng)*a);return 63710088e-1*Math.acos(Math.min(m,1))},xa.prototype.toBounds=function(t){t===void 0&&(t=0);var a=360*t/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new Va(new xa(this.lng-u,this.lat-a),new xa(this.lng+u,this.lat+a))},xa.convert=function(t){if(t instanceof xa)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new xa(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new xa(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Dl=2*Math.PI*63710088e-1;function Zs(t){return Dl*Math.cos(t*Math.PI/180)}function yl(t){return(180+t)/360}function Ou(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Kp(t,a){return t/Zs(a)}function Ru(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var lc=function(t,a,u){u===void 0&&(u=0),this.x=+t,this.y=+a,this.z=+u};lc.fromLngLat=function(t,a){a===void 0&&(a=0);var u=xa.convert(t);return new lc(yl(u.lng),Ou(u.lat),Kp(a,u.lat))},lc.prototype.toLngLat=function(){return new xa(360*this.x-180,Ru(this.y))},lc.prototype.toAltitude=function(){return this.z*Zs(Ru(this.y))},lc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Dl*(t=Ru(this.y),1/Math.cos(t*Math.PI/180));var t};var Ph=function(t,a,u){this.z=t,this.x=a,this.y=u,this.key=$p(0,t,t,a,u)};Ph.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Ph.prototype.url=function(t,a){var u,h,m,x,S,M=(h=this.y,m=this.z,x=ds(256*(u=this.x),256*(h=Math.pow(2,m)-h-1),m),S=ds(256*(u+1),256*(h+1),m),x[0]+","+x[1]+","+S[0]+","+S[1]),k=function(U,j,H){for(var te,ue="",Te=U;Te>0;Te--)ue+=(j&(te=1<<Te-1)?1:0)+(H&te?2:0);return ue}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",k).replace("{bbox-epsg-3857}",M)},Ph.prototype.getTilePoint=function(t){var a=Math.pow(2,this.z);return new re(8192*(t.x*a-this.x),8192*(t.y*a-this.y))},Ph.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var xm=function(t,a){this.wrap=t,this.canonical=a,this.key=$p(t,a.z,a.z,a.x,a.y)},is=function(t,a,u,h,m){this.overscaledZ=t,this.wrap=a,this.canonical=new Ph(u,+h,+m),this.key=$p(a,t,u,h,m)};function $p(t,a,u,h,m){(t*=2)<0&&(t=-1*t-1);var x=1<<u;return(x*x*t+x*m+h).toString(36)+u.toString(36)+a.toString(36)}is.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},is.prototype.scaledTo=function(t){var a=this.canonical.z-t;return t>this.canonical.z?new is(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new is(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)},is.prototype.calculateScaledKey=function(t,a){var u=this.canonical.z-t;return t>this.canonical.z?$p(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):$p(this.wrap*+a,t,t,this.canonical.x>>u,this.canonical.y>>u)},is.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a},is.prototype.children=function(t){if(this.overscaledZ>=t)return[new is(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var a=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new is(a,this.wrap,a,u,h),new is(a,this.wrap,a,u+1,h),new is(a,this.wrap,a,u,h+1),new is(a,this.wrap,a,u+1,h+1)]},is.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},is.prototype.wrapped=function(){return new is(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},is.prototype.unwrapTo=function(t){return new is(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},is.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},is.prototype.toUnwrapped=function(){return new xm(this.wrap,this.canonical)},is.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},is.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new lc(t.x-this.wrap,t.y))},yn("CanonicalTileID",Ph),yn("OverscaledTileID",is,{omit:["posMatrix"]});var mf=function(t,a,u){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return $e('"'+u+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=a.height;var h=this.dim=a.height-2;this.data=new Uint32Array(a.data.buffer),this.encoding=u||"mapbox";for(var m=0;m<h;m++)this.data[this._idx(-1,m)]=this.data[this._idx(0,m)],this.data[this._idx(h,m)]=this.data[this._idx(h-1,m)],this.data[this._idx(m,-1)]=this.data[this._idx(m,0)],this.data[this._idx(m,h)]=this.data[this._idx(m,h-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(h,-1)]=this.data[this._idx(h-1,0)],this.data[this._idx(-1,h)]=this.data[this._idx(0,h-1)],this.data[this._idx(h,h)]=this.data[this._idx(h-1,h-1)]};mf.prototype.get=function(t,a){var u=new Uint8Array(this.data.buffer),h=4*this._idx(t,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(u[h],u[h+1],u[h+2])},mf.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},mf.prototype._idx=function(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)},mf.prototype._unpackMapbox=function(t,a,u){return(256*t*256+256*a+u)/10-1e4},mf.prototype._unpackTerrarium=function(t,a,u){return 256*t+a+u/256-32768},mf.prototype.getPixels=function(){return new Da({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},mf.prototype.backfillBorder=function(t,a,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var h=a*this.dim,m=a*this.dim+this.dim,x=u*this.dim,S=u*this.dim+this.dim;switch(a){case-1:h=m-1;break;case 1:m=h+1}switch(u){case-1:x=S-1;break;case 1:S=x+1}for(var M=-a*this.dim,k=-u*this.dim,U=x;U<S;U++)for(var j=h;j<m;j++)this.data[this._idx(j,U)]=t.data[this._idx(j+M,U+k)]},yn("DEMData",mf);var Ad=function(t){this._stringToNumber={},this._numberToString=[];for(var a=0;a<t.length;a++){var u=t[a];this._stringToNumber[u]=a,this._numberToString[a]=u}};Ad.prototype.encode=function(t){return this._stringToNumber[t]},Ad.prototype.decode=function(t){return this._numberToString[t]};var Td=function(t,a,u,h,m){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=u,t._y=h,this.properties=t.properties,this.id=m},dv={geometry:{configurable:!0}};dv.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},dv.geometry.set=function(t){this._geometry=t},Td.prototype.toJSON=function(){var t={geometry:this.geometry};for(var a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t},Object.defineProperties(Td.prototype,dv);var sp=function(){this.state={},this.stateChanges={},this.deletedStates={}};sp.prototype.updateState=function(t,a,u){var h=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},xt(this.stateChanges[t][h],u),this.deletedStates[t]===null)for(var m in this.deletedStates[t]={},this.state[t])m!==h&&(this.deletedStates[t][m]=null);else if(this.deletedStates[t]&&this.deletedStates[t][h]===null)for(var x in this.deletedStates[t][h]={},this.state[t][h])u[x]||(this.deletedStates[t][h][x]=null);else for(var S in u)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][S]===null&&delete this.deletedStates[t][h][S]},sp.prototype.removeFeatureState=function(t,a,u){if(this.deletedStates[t]!==null){var h=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},u&&a!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][u]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(u in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][u]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}},sp.prototype.getState=function(t,a){var u=String(a),h=xt({},(this.state[t]||{})[u],(this.stateChanges[t]||{})[u]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var m=this.deletedStates[t][a];if(m===null)return{};for(var x in m)delete h[x]}return h},sp.prototype.initializeTileState=function(t,a){t.setFeatureState(this.state,a)},sp.prototype.coalesceChanges=function(t,a){var u={};for(var h in this.stateChanges){this.state[h]=this.state[h]||{};var m={};for(var x in this.stateChanges[h])this.state[h][x]||(this.state[h][x]={}),xt(this.state[h][x],this.stateChanges[h][x]),m[x]=this.state[h][x];u[h]=m}for(var S in this.deletedStates){this.state[S]=this.state[S]||{};var M={};if(this.deletedStates[S]===null)for(var k in this.state[S])M[k]={},this.state[S][k]={};else for(var U in this.deletedStates[S]){if(this.deletedStates[S][U]===null)this.state[S][U]={};else for(var j=0,H=Object.keys(this.deletedStates[S][U]);j<H.length;j+=1)delete this.state[S][U][H[j]];M[U]=this.state[S][U]}u[S]=u[S]||{},xt(u[S],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(u).length!==0)for(var te in t)t[te].setFeatureState(u,a)};var gf=function(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Wu(8192,16,0),this.grid3D=new Wu(8192,16,0),this.featureIndexArray=new V,this.promoteId=a};function bm(t,a,u,h,m){return Xt(t,function(x,S){var M=a instanceof Ns?a.get(S):null;return M&&M.evaluate?M.evaluate(u,h,m):M})}function Em(t){for(var a=1/0,u=1/0,h=-1/0,m=-1/0,x=0,S=t;x<S.length;x+=1){var M=S[x];a=Math.min(a,M.x),u=Math.min(u,M.y),h=Math.max(h,M.x),m=Math.max(m,M.y)}return{minX:a,minY:u,maxX:h,maxY:m}}function Md(t,a){return a-t}gf.prototype.insert=function(t,a,u,h,m,x){var S=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,m);for(var M=x?this.grid3D:this.grid,k=0;k<a.length;k++){for(var U=a[k],j=[1/0,1/0,-1/0,-1/0],H=0;H<U.length;H++){var te=U[H];j[0]=Math.min(j[0],te.x),j[1]=Math.min(j[1],te.y),j[2]=Math.max(j[2],te.x),j[3]=Math.max(j[3],te.y)}j[0]<8192&&j[1]<8192&&j[2]>=0&&j[3]>=0&&M.insert(S,j[0],j[1],j[2],j[3])}},gf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new cu.VectorTile(new Wf(this.rawTileData)).layers,this.sourceLayerCoder=new Ad(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},gf.prototype.query=function(t,a,u,h){var m=this;this.loadVTLayers();for(var x=t.params||{},S=8192/t.tileSize/t.scale,M=wc(x.filter),k=t.queryGeometry,U=t.queryPadding*S,j=Em(k),H=this.grid.query(j.minX-U,j.minY-U,j.maxX+U,j.maxY+U),te=Em(t.cameraQueryGeometry),ue=this.grid3D.query(te.minX-U,te.minY-U,te.maxX+U,te.maxY+U,function(Zt,Ht,cr,Lr){return function(Vr,gn,cn,Nn,pn){for(var wi=0,Qn=Vr;wi<Qn.length;wi+=1){var Pn=Qn[wi];if(gn<=Pn.x&&cn<=Pn.y&&Nn>=Pn.x&&pn>=Pn.y)return!0}var Zi=[new re(gn,cn),new re(gn,pn),new re(Nn,pn),new re(Nn,cn)];if(Vr.length>2){for(var bi=0,na=Zi;bi<na.length;bi+=1)if(Ts(Vr,na[bi]))return!0}for(var An=0;An<Vr.length-1;An++)if(pl(Vr[An],Vr[An+1],Zi))return!0;return!1}(t.cameraQueryGeometry,Zt-U,Ht-U,cr+U,Lr+U)}),Te=0,Oe=ue;Te<Oe.length;Te+=1)H.push(Oe[Te]);H.sort(Md);for(var Ke,ze={},ot=function(Zt){var Ht=H[Zt];if(Ht!==Ke){Ke=Ht;var cr=m.featureIndexArray.get(Ht),Lr=null;m.loadMatchingFeature(ze,cr.bucketIndex,cr.sourceLayerIndex,cr.featureIndex,M,x.layers,x.availableImages,a,u,h,function(Vr,gn,cn){return Lr||(Lr=Ya(Vr)),gn.queryIntersectsFeature(k,Vr,cn,Lr,m.z,t.transform,S,t.pixelPosMatrix)})}},Et=0;Et<H.length;Et++)ot(Et);return ze},gf.prototype.loadMatchingFeature=function(t,a,u,h,m,x,S,M,k,U,j){var H=this.bucketLayerIDs[a];if(!x||function(Vr,gn){for(var cn=0;cn<Vr.length;cn++)if(gn.indexOf(Vr[cn])>=0)return!0;return!1}(x,H)){var te=this.sourceLayerCoder.decode(u),ue=this.vtLayers[te].feature(h);if(m.needGeometry){var Te=Ua(ue,!0);if(!m.filter(new Oi(this.tileID.overscaledZ),Te,this.tileID.canonical))return}else if(!m.filter(new Oi(this.tileID.overscaledZ),ue))return;for(var Oe=this.getId(ue,te),Ke=0;Ke<H.length;Ke++){var ze=H[Ke];if(!(x&&x.indexOf(ze)<0)){var ot=M[ze];if(ot){var Et={};Oe!==void 0&&U&&(Et=U.getState(ot.sourceLayer||"_geojsonTileLayer",Oe));var Zt=xt({},k[ze]);Zt.paint=bm(Zt.paint,ot.paint,ue,Et,S),Zt.layout=bm(Zt.layout,ot.layout,ue,Et,S);var Ht=!j||j(ue,ot,Et);if(Ht){var cr=new Td(ue,this.z,this.x,this.y,Oe);cr.layer=Zt;var Lr=t[ze];Lr===void 0&&(Lr=t[ze]=[]),Lr.push({featureIndex:h,feature:cr,intersectionZ:Ht})}}}}}},gf.prototype.lookupSymbolFeatures=function(t,a,u,h,m,x,S,M){var k={};this.loadVTLayers();for(var U=wc(m),j=0,H=t;j<H.length;j+=1)this.loadMatchingFeature(k,u,h,H[j],U,x,S,M,a);return k},gf.prototype.hasLayer=function(t){for(var a=0,u=this.bucketLayerIDs;a<u.length;a+=1)for(var h=0,m=u[a];h<m.length;h+=1)if(t===m[h])return!0;return!1},gf.prototype.getId=function(t,a){var u=t.id;return this.promoteId&&typeof(u=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]])=="boolean"&&(u=Number(u)),u},yn("FeatureIndex",gf,{omit:["rawTileData","sourceLayerCoder"]});var xs=function(t,a){this.tileID=t,this.uid=wt(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};xs.prototype.registerFadeDuration=function(t){var a=t+this.timeAdded;a<Yi.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)},xs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},xs.prototype.loadVectorData=function(t,a,u){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var h in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(U,j){var H={};if(!j)return H;for(var te=function(){var Oe=Te[ue],Ke=Oe.layerIds.map(function(Et){return j.getLayer(Et)}).filter(Boolean);if(Ke.length!==0){Oe.layers=Ke,Oe.stateDependentLayerIds&&(Oe.stateDependentLayers=Oe.stateDependentLayerIds.map(function(Et){return Ke.filter(function(Zt){return Zt.id===Et})[0]}));for(var ze=0,ot=Ke;ze<ot.length;ze+=1)H[ot[ze].id]=Oe}},ue=0,Te=U;ue<Te.length;ue+=1)te();return H}(t.buckets,a.style),this.hasSymbolBuckets=!1,this.buckets){var m=this.buckets[h];if(m instanceof Ne){if(this.hasSymbolBuckets=!0,!u)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var x in this.buckets){var S=this.buckets[x];if(S instanceof Ne&&S.hasRTLText){this.hasRTLText=!0,As.isLoading()||As.isLoaded()||ph()!=="deferred"||Hs();break}}for(var M in this.queryPadding=0,this.buckets){var k=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(M).queryRadius(k))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},xs.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},xs.prototype.getBucket=function(t){return this.buckets[t.id]},xs.prototype.upload=function(t){for(var a in this.buckets){var u=this.buckets[a];u.uploadPending()&&u.upload(t)}var h=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new mn(t,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new mn(t,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)},xs.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},xs.prototype.queryRenderedFeatures=function(t,a,u,h,m,x,S,M,k,U){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:h,cameraQueryGeometry:m,scale:x,tileSize:this.tileSize,pixelPosMatrix:U,transform:M,params:S,queryPadding:this.queryPadding*k},t,a,u):{}},xs.prototype.querySourceFeatures=function(t,a){var u=this.latestFeatureIndex;if(u&&u.rawTileData){var h=u.loadVTLayers(),m=a?a.sourceLayer:"",x=h._geojsonTileLayer||h[m];if(x)for(var S=wc(a&&a.filter),M=this.tileID.canonical,k=M.z,U=M.x,j=M.y,H={z:k,x:U,y:j},te=0;te<x.length;te++){var ue=x.feature(te);if(S.needGeometry){var Te=Ua(ue,!0);if(!S.filter(new Oi(this.tileID.overscaledZ),Te,this.tileID.canonical))continue}else if(!S.filter(new Oi(this.tileID.overscaledZ),ue))continue;var Oe=u.getId(ue,m),Ke=new Td(ue,k,U,j,Oe);Ke.tile=H,t.push(Ke)}}},xs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},xs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},xs.prototype.setExpiryData=function(t){var a=this.expirationTime;if(t.cacheControl){var u=Wr(t.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var h=Date.now(),m=!1;if(this.expirationTime>h)m=!1;else if(a)if(this.expirationTime<a)m=!0;else{var x=this.expirationTime-a;x?this.expirationTime=h+Math.max(x,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},xs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},xs.prototype.setFeatureState=function(t,a){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var u=this.latestFeatureIndex.loadVTLayers();for(var h in this.buckets)if(a.style.hasLayer(h)){var m=this.buckets[h],x=m.layers[0].sourceLayer||"_geojsonTileLayer",S=u[x],M=t[x];if(S&&M&&Object.keys(M).length!==0){m.update(M,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});var k=a&&a.style&&a.style.getLayer(h);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(m)))}}}},xs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},xs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Yi.now()},xs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},xs.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=Yi.now()+t},xs.prototype.setDependencies=function(t,a){for(var u={},h=0,m=a;h<m.length;h+=1)u[m[h]]=!0;this.dependencies[t]=u},xs.prototype.hasDependency=function(t,a){for(var u=0,h=t;u<h.length;u+=1){var m=this.dependencies[h[u]];if(m){for(var x=0,S=a;x<S.length;x+=1)if(m[S[x]])return!0}}return!1};var Xf=ne.performance,Sm=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Xf.mark(this._marks.start)};Sm.prototype.finish=function(){Xf.mark(this._marks.end);var t=Xf.getEntriesByName(this._marks.measure);return t.length===0&&(Xf.measure(this._marks.measure,this._marks.start,this._marks.end),t=Xf.getEntriesByName(this._marks.measure),Xf.clearMarks(this._marks.start),Xf.clearMarks(this._marks.end),Xf.clearMeasures(this._marks.measure)),t},v.Actor=Ma,v.AlphaImage=$s,v.CanonicalTileID=Ph,v.CollisionBoxArray=f,v.Color=Vi,v.DEMData=mf,v.DataConstantProperty=On,v.DictionaryCoder=Ad,v.EXTENT=8192,v.ErrorEvent=Ge,v.EvaluationParameters=Oi,v.Event=Le,v.Evented=rt,v.FeatureIndex=gf,v.FillBucket=Js,v.FillExtrusionBucket=Ju,v.ImageAtlas=Sr,v.ImagePosition=at,v.LineBucket=_a,v.LngLat=xa,v.LngLatBounds=Va,v.MercatorCoordinate=lc,v.ONE_EM=24,v.OverscaledTileID=is,v.Point=re,v.Point$1=re,v.Properties=Ko,v.Protobuf=Wf,v.RGBAImage=Da,v.RequestManager=Ri,v.RequestPerformance=Sm,v.ResourceType=nn,v.SegmentVector=fe,v.SourceFeatureState=sp,v.StructArrayLayout1ui2=vh,v.StructArrayLayout2f1f2i16=cl,v.StructArrayLayout2i4=Tl,v.StructArrayLayout3ui6=qu,v.StructArrayLayout4i8=gu,v.SymbolBucket=Ne,v.Texture=mn,v.Tile=xs,v.Transitionable=ho,v.Uniform1f=Br,v.Uniform1i=gr,v.Uniform2f=Fr,v.Uniform3f=sn,v.Uniform4f=kn,v.UniformColor=Dn,v.UniformMatrix4f=ci,v.UnwrappedTileID=xm,v.ValidationError=Be,v.WritingMode=Ur,v.ZoomHistory=Mf,v.add=function(t,a,u){return t[0]=a[0]+u[0],t[1]=a[1]+u[1],t[2]=a[2]+u[2],t},v.addDynamicAttributes=Ve,v.asyncAll=function(t,a,u){if(!t.length)return u(null,[]);var h=t.length,m=new Array(t.length),x=null;t.forEach(function(S,M){a(S,function(k,U){k&&(x=k),m[M]=U,--h==0&&u(x,m)})})},v.bezier=Ce,v.bindAll=Jt,v.browser=Yi,v.cacheEntryPossiblyAdded=function(t){++oi>Pr&&(t.getActor().send("enforceCacheSizeLimit",ir),oi=0)},v.clamp=Pt,v.clearTileCache=function(t){var a=ne.caches.delete("mapbox-tiles");t&&a.catch(t).then(function(){return t()})},v.clipLine=Mo,v.clone=function(t){var a=new ea(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},v.clone$1=qe,v.clone$2=function(t){var a=new ea(3);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a},v.collisionCircleLayout=wd,v.config=Un,v.create=function(){var t=new ea(16);return ea!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},v.create$1=function(){var t=new ea(9);return ea!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},v.create$2=function(){var t=new ea(4);return ea!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},v.createCommonjsModule=ee,v.createExpression=Su,v.createLayout=Ta,v.createStyleLayer=function(t){return t.type==="custom"?new jr(t):new rn[t.type](t)},v.cross=function(t,a,u){var h=a[0],m=a[1],x=a[2],S=u[0],M=u[1],k=u[2];return t[0]=m*k-x*M,t[1]=x*S-h*k,t[2]=h*M-m*S,t},v.deepEqual=function t(a,u){if(Array.isArray(a)){if(!Array.isArray(u)||a.length!==u.length)return!1;for(var h=0;h<a.length;h++)if(!t(a[h],u[h]))return!1;return!0}if(typeof a=="object"&&a!==null&&u!==null){if(typeof u!="object"||Object.keys(a).length!==Object.keys(u).length)return!1;for(var m in a)if(!t(a[m],u[m]))return!1;return!0}return a===u},v.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]},v.dot$1=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]},v.ease=et,v.emitValidationErrors=Kl,v.endsWith=X,v.enforceCacheSizeLimit=function(t){I(),qi&&qi.then(function(a){a.keys().then(function(u){for(var h=0;h<u.length-t;h++)a.delete(u[h])})})},v.evaluateSizeForFeature=Kn,v.evaluateSizeForZoom=ui,v.evaluateVariableOffset=gl,v.evented=If,v.extend=xt,v.featureFilter=wc,v.filterObject=vt,v.fromRotation=function(t,a){var u=Math.sin(a),h=Math.cos(a);return t[0]=h,t[1]=u,t[2]=0,t[3]=-u,t[4]=h,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},v.getAnchorAlignment=Qr,v.getAnchorJustification=Ie,v.getArrayBuffer=Ra,v.getImage=K,v.getJSON=function(t,a){return ma(xt(t,{type:"json"}),a)},v.getRTLTextPluginStatus=ph,v.getReferrer=Mi,v.getVideo=function(t,a){var u,h,m=ne.document.createElement("video");m.muted=!0,m.onloadstart=function(){a(null,m)};for(var x=0;x<t.length;x++){var S=ne.document.createElement("source");u=t[x],h=void 0,(h=ne.document.createElement("a")).href=u,(h.protocol!==ne.document.location.protocol||h.host!==ne.document.location.host)&&(m.crossOrigin="Anonymous"),S.src=t[x],m.appendChild(S)}return{cancel:function(){}}},v.identity=Ms,v.invert=function(t,a){var u=a[0],h=a[1],m=a[2],x=a[3],S=a[4],M=a[5],k=a[6],U=a[7],j=a[8],H=a[9],te=a[10],ue=a[11],Te=a[12],Oe=a[13],Ke=a[14],ze=a[15],ot=u*M-h*S,Et=u*k-m*S,Zt=u*U-x*S,Ht=h*k-m*M,cr=h*U-x*M,Lr=m*U-x*k,Vr=j*Oe-H*Te,gn=j*Ke-te*Te,cn=j*ze-ue*Te,Nn=H*Ke-te*Oe,pn=H*ze-ue*Oe,wi=te*ze-ue*Ke,Qn=ot*wi-Et*pn+Zt*Nn+Ht*cn-cr*gn+Lr*Vr;return Qn?(t[0]=(M*wi-k*pn+U*Nn)*(Qn=1/Qn),t[1]=(m*pn-h*wi-x*Nn)*Qn,t[2]=(Oe*Lr-Ke*cr+ze*Ht)*Qn,t[3]=(te*cr-H*Lr-ue*Ht)*Qn,t[4]=(k*cn-S*wi-U*gn)*Qn,t[5]=(u*wi-m*cn+x*gn)*Qn,t[6]=(Ke*Zt-Te*Lr-ze*Et)*Qn,t[7]=(j*Lr-te*Zt+ue*Et)*Qn,t[8]=(S*pn-M*cn+U*Vr)*Qn,t[9]=(h*cn-u*pn-x*Vr)*Qn,t[10]=(Te*cr-Oe*Zt+ze*ot)*Qn,t[11]=(H*Zt-j*cr-ue*ot)*Qn,t[12]=(M*gn-S*Nn-k*Vr)*Qn,t[13]=(u*Nn-h*gn+m*Vr)*Qn,t[14]=(Oe*Et-Te*Ht-Ke*ot)*Qn,t[15]=(j*Ht-H*Et+te*ot)*Qn,t):null},v.isChar=$r,v.isMapboxURL=Ei,v.keysDifference=function(t,a){var u=[];for(var h in t)h in a||u.push(h);return u},v.makeRequest=ma,v.mapObject=Xt,v.mercatorXfromLng=yl,v.mercatorYfromLat=Ou,v.mercatorZfromAltitude=Kp,v.mul=Us,v.multiply=hs,v.mvt=cu,v.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},v.normalize=function(t,a){var u=a[0],h=a[1],m=a[2],x=u*u+h*h+m*m;return x>0&&(x=1/Math.sqrt(x)),t[0]=a[0]*x,t[1]=a[1]*x,t[2]=a[2]*x,t},v.number=sa,v.offscreenCanvasSupported=jn,v.ortho=function(t,a,u,h,m,x,S){var M=1/(a-u),k=1/(h-m),U=1/(x-S);return t[0]=-2*M,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*k,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*U,t[11]=0,t[12]=(a+u)*M,t[13]=(m+h)*k,t[14]=(S+x)*U,t[15]=1,t},v.parseGlyphPBF=function(t){return new Wf(t).readFields(Rr,[])},v.pbf=Wf,v.performSymbolLayout=function(t,a,u,h,m,x,S){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var M=t.layers[0].layout,k=t.layers[0]._unevaluatedLayout._values,U={};if(t.textSizeData.kind==="composite"){var j=t.textSizeData,H=j.maxZoom;U.compositeTextSizes=[k["text-size"].possiblyEvaluate(new Oi(j.minZoom),S),k["text-size"].possiblyEvaluate(new Oi(H),S)]}if(t.iconSizeData.kind==="composite"){var te=t.iconSizeData,ue=te.maxZoom;U.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new Oi(te.minZoom),S),k["icon-size"].possiblyEvaluate(new Oi(ue),S)]}U.layoutTextSize=k["text-size"].possiblyEvaluate(new Oi(t.zoom+1),S),U.layoutIconSize=k["icon-size"].possiblyEvaluate(new Oi(t.zoom+1),S),U.textMaxSize=k["text-size"].possiblyEvaluate(new Oi(18));for(var Te=24*M.get("text-line-height"),Oe=M.get("text-rotation-alignment")==="map"&&M.get("symbol-placement")!=="point",Ke=M.get("text-keep-upright"),ze=M.get("text-size"),ot=function(){var Ht=Zt[Et],cr=M.get("text-font").evaluate(Ht,{},S).join(","),Lr=ze.evaluate(Ht,{},S),Vr=U.layoutTextSize.evaluate(Ht,{},S),gn=U.layoutIconSize.evaluate(Ht,{},S),cn={horizontal:{},vertical:void 0},Nn=Ht.text,pn=[0,0];if(Nn){var wi=Nn.toString(),Qn=24*M.get("text-letter-spacing").evaluate(Ht,{},S),Pn=function(Hi){for(var Fa=0,Pa=Hi;Fa<Pa.length;Fa+=1)if(ia=Pa[Fa].charCodeAt(0),$r.Arabic(ia)||$r["Arabic Supplement"](ia)||$r["Arabic Extended-A"](ia)||$r["Arabic Presentation Forms-A"](ia)||$r["Arabic Presentation Forms-B"](ia))return!1;var ia;return!0}(wi)?Qn:0,Zi=M.get("text-anchor").evaluate(Ht,{},S),bi=M.get("text-variable-anchor");if(!bi){var na=M.get("text-radial-offset").evaluate(Ht,{},S);pn=na?gl(Zi,[24*na,Eo]):M.get("text-offset").evaluate(Ht,{},S).map(function(Hi){return 24*Hi})}var An=Oe?"center":M.get("text-justify").evaluate(Ht,{},S),va=M.get("symbol-placement"),Ai=va==="point"?24*M.get("text-max-width").evaluate(Ht,{},S):0,Po=function(){t.allowVerticalPlacement&&af(wi)&&(cn.vertical=en(Nn,a,u,m,cr,Ai,Te,Zi,"left",Pn,pn,Ur.vertical,!0,va,Vr,Lr))};if(!Oe&&bi){for(var So=An==="auto"?bi.map(function(Hi){return Ie(Hi)}):[An],lo=!1,ae=0;ae<So.length;ae++){var Qo=So[ae];if(!cn.horizontal[Qo])if(lo)cn.horizontal[Qo]=cn.horizontal[0];else{var es=en(Nn,a,u,m,cr,Ai,Te,"center",Qo,Pn,pn,Ur.horizontal,!1,va,Vr,Lr);es&&(cn.horizontal[Qo]=es,lo=es.positionedLines.length===1)}}Po()}else{An==="auto"&&(An=Ie(Zi));var Ps=en(Nn,a,u,m,cr,Ai,Te,Zi,An,Pn,pn,Ur.horizontal,!1,va,Vr,Lr);Ps&&(cn.horizontal[An]=Ps),Po(),af(wi)&&Oe&&Ke&&(cn.vertical=en(Nn,a,u,m,cr,Ai,Te,Zi,An,Pn,pn,Ur.vertical,!1,va,Vr,Lr))}}var as=void 0,Is=!1;if(Ht.icon&&Ht.icon.name){var Io=h[Ht.icon.name];Io&&(as=function(Hi,Fa,Pa){var ia=Qr(Pa),js=Fa[0]-Hi.displaySize[0]*ia.horizontalAlign,bs=Fa[1]-Hi.displaySize[1]*ia.verticalAlign;return{image:Hi,top:bs,bottom:bs+Hi.displaySize[1],left:js,right:js+Hi.displaySize[0]}}(m[Ht.icon.name],M.get("icon-offset").evaluate(Ht,{},S),M.get("icon-anchor").evaluate(Ht,{},S)),Is=Io.sdf,t.sdfIcons===void 0?t.sdfIcons=Io.sdf:t.sdfIcons!==Io.sdf&&$e("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Io.pixelRatio!==t.pixelRatio||M.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var Oo=Ct(cn.horizontal)||cn.vertical;t.iconsInText=!!Oo&&Oo.iconsInText,(Oo||as)&&function(Hi,Fa,Pa,ia,js,bs,Qa,Vo,Es,ca,Fl){var xu=bs.textMaxSize.evaluate(Fa,{});xu===void 0&&(xu=Qa);var Bl,co=Hi.layers[0].layout,Nl=co.get("icon-offset").evaluate(Fa,{},Fl),el=Ct(Pa.horizontal),Yf=Qa/24,qf=Hi.tilePixelRatio*Yf,cc=Hi.tilePixelRatio*xu/24,zc=Hi.tilePixelRatio*Vo,zl=Hi.tilePixelRatio*co.get("symbol-spacing"),Jp=co.get("text-padding")*Hi.tilePixelRatio,Ih=co.get("icon-padding")*Hi.tilePixelRatio,Uc=co.get("text-max-angle")/180*Math.PI,up=co.get("text-rotation-alignment")==="map"&&co.get("symbol-placement")!=="point",lp=co.get("icon-rotation-alignment")==="map"&&co.get("symbol-placement")!=="point",fc=co.get("symbol-placement"),Kf=zl/2,$f=co.get("icon-text-fit");ia&&$f!=="none"&&(Hi.allowVerticalPlacement&&Pa.vertical&&(Bl=ri(ia,Pa.vertical,$f,co.get("icon-text-fit-padding"),Nl,Yf)),el&&(ia=ri(ia,el,$f,co.get("icon-text-fit-padding"),Nl,Yf)));var Zc=function(vv,vs){vs.x<0||vs.x>=8192||vs.y<0||vs.y>=8192||function(Ro,_l,mv,jc,id,Rd,pp,Ul,dp,Bh,vp,mp,ad,Ld,Nh,gv,yv,_v,xv,kd,Lu,od,Dd,Zl,bv){var Fd,jl,th,zh,Uh,Zh=Ro.addToLineVertexArray(_l,mv),Ev=0,Sv=0,Cv=0,wv=0,Bd=-1,Nd=-1,Vc={},Av=Ae(""),zd=0,Ud=0;if(Ul._unevaluatedLayout.getValue("text-radial-offset")===void 0?(zd=(Fd=Ul.layout.get("text-offset").evaluate(Lu,{},Zl).map(function(gp){return 24*gp}))[0],Ud=Fd[1]):(zd=24*Ul.layout.get("text-radial-offset").evaluate(Lu,{},Zl),Ud=Eo),Ro.allowVerticalPlacement&&jc.vertical){var Tv=Ul.layout.get("text-rotate").evaluate(Lu,{},Zl)+90;zh=new Zo(dp,_l,Bh,vp,mp,jc.vertical,ad,Ld,Nh,Tv),pp&&(Uh=new Zo(dp,_l,Bh,vp,mp,pp,yv,_v,Nh,Tv))}if(id){var Zd=Ul.layout.get("icon-rotate").evaluate(Lu,{}),Mv=Ul.layout.get("icon-text-fit")!=="none",Pv=Jo(id,Zd,Dd,Mv),jh=pp?Jo(pp,Zd,Dd,Mv):void 0;th=new Zo(dp,_l,Bh,vp,mp,id,yv,_v,!1,Zd),Ev=4*Pv.length;var Gc=Ro.iconSizeData,Vh=null;Gc.kind==="source"?(Vh=[128*Ul.layout.get("icon-size").evaluate(Lu,{})])[0]>32640&&$e(Ro.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):Gc.kind==="composite"&&((Vh=[128*od.compositeIconSizes[0].evaluate(Lu,{},Zl),128*od.compositeIconSizes[1].evaluate(Lu,{},Zl)])[0]>32640||Vh[1]>32640)&&$e(Ro.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Ro.addSymbols(Ro.icon,Pv,Vh,kd,xv,Lu,!1,_l,Zh.lineStartIndex,Zh.lineLength,-1,Zl),Bd=Ro.icon.placedSymbolArray.length-1,jh&&(Sv=4*jh.length,Ro.addSymbols(Ro.icon,jh,Vh,kd,xv,Lu,Ur.vertical,_l,Zh.lineStartIndex,Zh.lineLength,-1,Zl),Nd=Ro.icon.placedSymbolArray.length-1)}for(var jd in jc.horizontal){var rh=jc.horizontal[jd];if(!jl){Av=Ae(rh.text);var Iv=Ul.layout.get("text-rotate").evaluate(Lu,{},Zl);jl=new Zo(dp,_l,Bh,vp,mp,rh,ad,Ld,Nh,Iv)}var Vd=rh.positionedLines.length===1;if(Cv+=Bt(Ro,_l,rh,Rd,Ul,Nh,Lu,gv,Zh,jc.vertical?Ur.horizontal:Ur.horizontalOnly,Vd?Object.keys(jc.horizontal):[jd],Vc,Bd,od,Zl),Vd)break}jc.vertical&&(wv+=Bt(Ro,_l,jc.vertical,Rd,Ul,Nh,Lu,gv,Zh,Ur.vertical,["vertical"],Vc,Nd,od,Zl));var Cm=jl?jl.boxStartIndex:Ro.collisionBoxArray.length,wm=jl?jl.boxEndIndex:Ro.collisionBoxArray.length,Am=zh?zh.boxStartIndex:Ro.collisionBoxArray.length,Ov=zh?zh.boxEndIndex:Ro.collisionBoxArray.length,Rv=th?th.boxStartIndex:Ro.collisionBoxArray.length,Lv=th?th.boxEndIndex:Ro.collisionBoxArray.length,Gd=Uh?Uh.boxStartIndex:Ro.collisionBoxArray.length,kv=Uh?Uh.boxEndIndex:Ro.collisionBoxArray.length,hc=-1,sd=function(gp,Wd){return gp&&gp.circleDiameter?Math.max(gp.circleDiameter,Wd):Wd};hc=sd(jl,hc),hc=sd(zh,hc),hc=sd(th,hc);var Hd=(hc=sd(Uh,hc))>-1?1:0;Hd&&(hc*=bv/24),Ro.glyphOffsetArray.length>=Ne.MAX_GLYPHS&&$e("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Lu.sortKey!==void 0&&Ro.addToSortKeyRanges(Ro.symbolInstances.length,Lu.sortKey),Ro.symbolInstances.emplaceBack(_l.x,_l.y,Vc.right>=0?Vc.right:-1,Vc.center>=0?Vc.center:-1,Vc.left>=0?Vc.left:-1,Vc.vertical||-1,Bd,Nd,Av,Cm,wm,Am,Ov,Rv,Lv,Gd,kv,Bh,Cv,wv,Ev,Sv,Hd,0,ad,zd,Ud,hc)}(Hi,vs,vv,Pa,ia,js,Bl,Hi.layers[0],Hi.collisionBoxArray,Fa.index,Fa.sourceLayerIndex,Hi.index,qf,Jp,up,Es,zc,Ih,lp,Nl,Fa,bs,ca,Fl,Qa)};if(fc==="line")for(var yf=0,Pd=Mo(Fa.geometry,0,0,8192,8192);yf<Pd.length;yf+=1)for(var Qp=Pd[yf],cp=0,Oh=$o(Qp,zl,Uc,Pa.vertical||el,ia,24,cc,Hi.overscaling,8192);cp<Oh.length;cp+=1){var ed=Oh[cp];el&&vn(Hi,el.text,Kf,ed)||Zc(Qp,ed)}else if(fc==="line-center")for(var Rh=0,Lh=Fa.geometry;Rh<Lh.length;Rh+=1){var kh=Lh[Rh];if(kh.length>1){var fp=qa(kh,Uc,Pa.vertical||el,ia,24,cc);fp&&Zc(kh,fp)}}else if(Fa.type==="Polygon")for(var Jf=0,hp=Bf(Fa.geometry,0);Jf<hp.length;Jf+=1){var Qf=hp[Jf],Dh=ti(Qf,16);Zc(Qf[0],new Kr(Dh.x,Dh.y,0))}else if(Fa.type==="LineString")for(var _f=0,Fh=Fa.geometry;_f<Fh.length;_f+=1){var eh=Fh[_f];Zc(eh,new Kr(eh[0].x,eh[0].y,0))}else if(Fa.type==="Point")for(var td=0,Id=Fa.geometry;td<Id.length;td+=1)for(var rd=0,Od=Id[td];rd<Od.length;rd+=1){var nd=Od[rd];Zc([nd],new Kr(nd.x,nd.y,0))}}(t,Ht,cn,as,h,U,Vr,gn,pn,Is,S)},Et=0,Zt=t.features;Et<Zt.length;Et+=1)ot();x&&t.generateCollisionDebugBuffers()},v.perspective=function(t,a,u,h,m){var x,S=1/Math.tan(a/2);return t[0]=S/u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,m!=null&&m!==1/0?(t[10]=(m+h)*(x=1/(h-m)),t[14]=2*m*h*x):(t[10]=-1,t[14]=-2*h),t},v.pick=function(t,a){for(var u={},h=0;h<a.length;h++){var m=a[h];m in t&&(u[m]=t[m])}return u},v.plugin=As,v.polygonIntersectsPolygon=Ku,v.postMapLoadEvent=Ut,v.postTurnstileEvent=Ha,v.potpack=Ar,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=yn,v.registerForPluginStateChange=function(t){return t({pluginStatus:ws,pluginURL:Ao}),If.on("pluginStateChange",t),t},v.renderColorRamp=Rf,v.rotate=function(t,a,u){var h=a[0],m=a[1],x=a[2],S=a[3],M=Math.sin(u),k=Math.cos(u);return t[0]=h*k+x*M,t[1]=m*k+S*M,t[2]=h*-M+x*k,t[3]=m*-M+S*k,t},v.rotateX=function(t,a,u){var h=Math.sin(u),m=Math.cos(u),x=a[4],S=a[5],M=a[6],k=a[7],U=a[8],j=a[9],H=a[10],te=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=x*m+U*h,t[5]=S*m+j*h,t[6]=M*m+H*h,t[7]=k*m+te*h,t[8]=U*m-x*h,t[9]=j*m-S*h,t[10]=H*m-M*h,t[11]=te*m-k*h,t},v.rotateZ=function(t,a,u){var h=Math.sin(u),m=Math.cos(u),x=a[0],S=a[1],M=a[2],k=a[3],U=a[4],j=a[5],H=a[6],te=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=x*m+U*h,t[1]=S*m+j*h,t[2]=M*m+H*h,t[3]=k*m+te*h,t[4]=U*m-x*h,t[5]=j*m-S*h,t[6]=H*m-M*h,t[7]=te*m-k*h,t},v.scale=function(t,a,u){var h=u[0],m=u[1],x=u[2];return t[0]=a[0]*h,t[1]=a[1]*h,t[2]=a[2]*h,t[3]=a[3]*h,t[4]=a[4]*m,t[5]=a[5]*m,t[6]=a[6]*m,t[7]=a[7]*m,t[8]=a[8]*x,t[9]=a[9]*x,t[10]=a[10]*x,t[11]=a[11]*x,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},v.scale$1=function(t,a,u){return t[0]=a[0]*u,t[1]=a[1]*u,t[2]=a[2]*u,t[3]=a[3]*u,t},v.scale$2=function(t,a,u){return t[0]=a[0]*u,t[1]=a[1]*u,t[2]=a[2]*u,t},v.setCacheLimits=function(t,a){ir=t,Pr=a},v.setRTLTextPlugin=function(t,a,u){if(u===void 0&&(u=!1),ws==="deferred"||ws==="loading"||ws==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Ao=Yi.resolveURL(t),ws="deferred",Au=a,ya(),u||Hs()},v.sphericalToCartesian=function(t){var a=t[0],u=t[1],h=t[2];return u+=90,u*=Math.PI/180,h*=Math.PI/180,{x:a*Math.cos(u)*Math.sin(h),y:a*Math.sin(u)*Math.sin(h),z:a*Math.cos(h)}},v.sqrLen=function(t){var a=t[0],u=t[1];return a*a+u*u},v.styleSpec=pe,v.sub=function(t,a,u){return t[0]=a[0]-u[0],t[1]=a[1]-u[1],t[2]=a[2]-u[2],t},v.symbolSize=Fi,v.transformMat3=function(t,a,u){var h=a[0],m=a[1],x=a[2];return t[0]=h*u[0]+m*u[3]+x*u[6],t[1]=h*u[1]+m*u[4]+x*u[7],t[2]=h*u[2]+m*u[5]+x*u[8],t},v.transformMat4=nc,v.translate=function(t,a,u){var h,m,x,S,M,k,U,j,H,te,ue,Te,Oe=u[0],Ke=u[1],ze=u[2];return a===t?(t[12]=a[0]*Oe+a[4]*Ke+a[8]*ze+a[12],t[13]=a[1]*Oe+a[5]*Ke+a[9]*ze+a[13],t[14]=a[2]*Oe+a[6]*Ke+a[10]*ze+a[14],t[15]=a[3]*Oe+a[7]*Ke+a[11]*ze+a[15]):(m=a[1],x=a[2],S=a[3],M=a[4],k=a[5],U=a[6],j=a[7],H=a[8],te=a[9],ue=a[10],Te=a[11],t[0]=h=a[0],t[1]=m,t[2]=x,t[3]=S,t[4]=M,t[5]=k,t[6]=U,t[7]=j,t[8]=H,t[9]=te,t[10]=ue,t[11]=Te,t[12]=h*Oe+M*Ke+H*ze+a[12],t[13]=m*Oe+k*Ke+te*ze+a[13],t[14]=x*Oe+U*Ke+ue*ze+a[14],t[15]=S*Oe+j*Ke+Te*ze+a[15]),t},v.triggerPluginCompletionEvent=hh,v.uniqueId=wt,v.validateCustomStyleLayer=function(t){var a=[],u=t.id;return u===void 0&&a.push({message:"layers."+u+': missing required property "id"'}),t.render===void 0&&a.push({message:"layers."+u+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&a.push({message:"layers."+u+': property "renderingMode" must be either "2d" or "3d"'}),a},v.validateLight=Jh,v.validateStyle=nf,v.values=function(t){var a=[];for(var u in t)a.push(t[u]);return a},v.vectorTile=cu,v.version="1.13.2",v.warnOnce=$e,v.webpSupported=Gn,v.window=ne,v.wrap=nr}),$(["./shared"],function(v){"use strict";function ee(G){var K=typeof G;if(K==="number"||K==="boolean"||K==="string"||G==null)return JSON.stringify(G);if(Array.isArray(G)){for(var se="[",ge=0,Le=G;ge<Le.length;ge+=1)se+=ee(Le[ge])+",";return se+"]"}for(var Ge=Object.keys(G).sort(),rt="{",pe=0;pe<Ge.length;pe++)rt+=JSON.stringify(Ge[pe])+":"+ee(G[Ge[pe]])+",";return rt+"}"}function F(G){for(var K="",se=0,ge=v.refProperties;se<ge.length;se+=1)K+="/"+ee(G[ge[se]]);return K}var Q=function(G){this.keyCache={},G&&this.replace(G)};Q.prototype.replace=function(G){this._layerConfigs={},this._layers={},this.update(G,[])},Q.prototype.update=function(G,K){for(var se=this,ge=0,Le=G;ge<Le.length;ge+=1){var Ge=Le[ge];this._layerConfigs[Ge.id]=Ge;var rt=this._layers[Ge.id]=v.createStyleLayer(Ge);rt._featureFilter=v.featureFilter(rt.filter),this.keyCache[Ge.id]&&delete this.keyCache[Ge.id]}for(var pe=0,Be=K;pe<Be.length;pe+=1){var yt=Be[pe];delete this.keyCache[yt],delete this._layerConfigs[yt],delete this._layers[yt]}this.familiesBySource={};for(var dr=0,Dt=function(Gr,qr){for(var ni={},tn=0;tn<Gr.length;tn++){var Ci=qr&&qr[Gr[tn].id]||F(Gr[tn]);qr&&(qr[Gr[tn].id]=Ci);var Ji=ni[Ci];Ji||(Ji=ni[Ci]=[]),Ji.push(Gr[tn])}var yi=[];for(var Pi in ni)yi.push(ni[Pi]);return yi}(v.values(this._layerConfigs),this.keyCache);dr<Dt.length;dr+=1){var Ft=Dt[dr].map(function(Gr){return se._layers[Gr.id]}),_r=Ft[0];if(_r.visibility!=="none"){var En=_r.source||"",un=this.familiesBySource[En];un||(un=this.familiesBySource[En]={});var Tt=_r.sourceLayer||"_geojsonTileLayer",on=un[Tt];on||(on=un[Tt]=[]),on.push(Ft)}}};var re=function(G){var K={},se=[];for(var ge in G){var Le=G[ge],Ge=K[ge]={};for(var rt in Le){var pe=Le[+rt];if(pe&&pe.bitmap.width!==0&&pe.bitmap.height!==0){var Be={x:0,y:0,w:pe.bitmap.width+2,h:pe.bitmap.height+2};se.push(Be),Ge[rt]={rect:Be,metrics:pe.metrics}}}}var yt=v.potpack(se),dr=new v.AlphaImage({width:yt.w||1,height:yt.h||1});for(var Dt in G){var Ft=G[Dt];for(var _r in Ft){var En=Ft[+_r];if(En&&En.bitmap.width!==0&&En.bitmap.height!==0){var un=K[Dt][_r].rect;v.AlphaImage.copy(En.bitmap,dr,{x:0,y:0},{x:un.x+1,y:un.y+1},En.bitmap)}}}this.image=dr,this.positions=K};v.register("GlyphAtlas",re);var Ee=function(G){this.tileID=new v.OverscaledTileID(G.tileID.overscaledZ,G.tileID.wrap,G.tileID.canonical.z,G.tileID.canonical.x,G.tileID.canonical.y),this.uid=G.uid,this.zoom=G.zoom,this.pixelRatio=G.pixelRatio,this.tileSize=G.tileSize,this.source=G.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=G.showCollisionBoxes,this.collectResourceTiming=!!G.collectResourceTiming,this.returnDependencies=!!G.returnDependencies,this.promoteId=G.promoteId};function ne(G,K,se){for(var ge=new v.EvaluationParameters(K),Le=0,Ge=G;Le<Ge.length;Le+=1)Ge[Le].recalculate(ge,se)}function je(G,K){var se=v.getArrayBuffer(G.request,function(ge,Le,Ge,rt){ge?K(ge):Le&&K(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(Le)),rawData:Le,cacheControl:Ge,expires:rt})});return function(){se.cancel(),K()}}Ee.prototype.parse=function(G,K,se,ge,Le){var Ge=this;this.status="parsing",this.data=G,this.collisionBoxArray=new v.CollisionBoxArray;var rt=new v.DictionaryCoder(Object.keys(G.layers).sort()),pe=new v.FeatureIndex(this.tileID,this.promoteId);pe.bucketLayerIDs=[];var Be,yt,dr,Dt,Ft={},_r={featureIndex:pe,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:se},En=K.familiesBySource[this.source];for(var un in En){var Tt=G.layers[un];if(Tt){Tt.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+un+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var on=rt.encode(un),Gr=[],qr=0;qr<Tt.length;qr++){var ni=Tt.feature(qr),tn=pe.getId(ni,un);Gr.push({feature:ni,id:tn,index:qr,sourceLayerIndex:on})}for(var Ci=0,Ji=En[un];Ci<Ji.length;Ci+=1){var yi=Ji[Ci],Pi=yi[0];Pi.minzoom&&this.zoom<Math.floor(Pi.minzoom)||Pi.maxzoom&&this.zoom>=Pi.maxzoom||Pi.visibility!=="none"&&(ne(yi,this.zoom,se),(Ft[Pi.id]=Pi.createBucket({index:pe.bucketLayerIDs.length,layers:yi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:on,sourceID:this.source})).populate(Gr,_r,this.tileID.canonical),pe.bucketLayerIDs.push(yi.map(function(oa){return oa.id})))}}}var xi=v.mapObject(_r.glyphDependencies,function(oa){return Object.keys(oa).map(Number)});Object.keys(xi).length?ge.send("getGlyphs",{uid:this.uid,stacks:xi},function(oa,Ii){Be||(Be=oa,yt=Ii,La.call(Ge))}):yt={};var ei=Object.keys(_r.iconDependencies);ei.length?ge.send("getImages",{icons:ei,source:this.source,tileID:this.tileID,type:"icons"},function(oa,Ii){Be||(Be=oa,dr=Ii,La.call(Ge))}):dr={};var Wi=Object.keys(_r.patternDependencies);function La(){if(Be)return Le(Be);if(yt&&dr&&Dt){var oa=new re(yt),Ii=new v.ImageAtlas(dr,Dt);for(var Vi in Ft){var Na=Ft[Vi];Na instanceof v.SymbolBucket?(ne(Na.layers,this.zoom,se),v.performSymbolLayout(Na,yt,oa.positions,dr,Ii.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Na.hasPattern&&(Na instanceof v.LineBucket||Na instanceof v.FillBucket||Na instanceof v.FillExtrusionBucket)&&(ne(Na.layers,this.zoom,se),Na.addFeatures(_r,this.tileID.canonical,Ii.patternPositions))}this.status="done",Le(null,{buckets:v.values(Ft).filter(function(tu){return!tu.isEmpty()}),featureIndex:pe,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:oa.image,imageAtlas:Ii,glyphMap:this.returnDependencies?yt:null,iconMap:this.returnDependencies?dr:null,glyphPositions:this.returnDependencies?oa.positions:null})}}Wi.length?ge.send("getImages",{icons:Wi,source:this.source,tileID:this.tileID,type:"patterns"},function(oa,Ii){Be||(Be=oa,Dt=Ii,La.call(Ge))}):Dt={},La.call(this)};var Ce=function(G,K,se,ge){this.actor=G,this.layerIndex=K,this.availableImages=se,this.loadVectorData=ge||je,this.loading={},this.loaded={}};Ce.prototype.loadTile=function(G,K){var se=this,ge=G.uid;this.loading||(this.loading={});var Le=!!(G&&G.request&&G.request.collectResourceTiming)&&new v.RequestPerformance(G.request),Ge=this.loading[ge]=new Ee(G);Ge.abort=this.loadVectorData(G,function(rt,pe){if(delete se.loading[ge],rt||!pe)return Ge.status="done",se.loaded[ge]=Ge,K(rt);var Be=pe.rawData,yt={};pe.expires&&(yt.expires=pe.expires),pe.cacheControl&&(yt.cacheControl=pe.cacheControl);var dr={};if(Le){var Dt=Le.finish();Dt&&(dr.resourceTiming=JSON.parse(JSON.stringify(Dt)))}Ge.vectorTile=pe.vectorTile,Ge.parse(pe.vectorTile,se.layerIndex,se.availableImages,se.actor,function(Ft,_r){if(Ft||!_r)return K(Ft);K(null,v.extend({rawTileData:Be.slice(0)},_r,yt,dr))}),se.loaded=se.loaded||{},se.loaded[ge]=Ge})},Ce.prototype.reloadTile=function(G,K){var se=this,ge=this.loaded,Le=G.uid,Ge=this;if(ge&&ge[Le]){var rt=ge[Le];rt.showCollisionBoxes=G.showCollisionBoxes;var pe=function(Be,yt){var dr=rt.reloadCallback;dr&&(delete rt.reloadCallback,rt.parse(rt.vectorTile,Ge.layerIndex,se.availableImages,Ge.actor,dr)),K(Be,yt)};rt.status==="parsing"?rt.reloadCallback=pe:rt.status==="done"&&(rt.vectorTile?rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.actor,pe):pe())}},Ce.prototype.abortTile=function(G,K){var se=this.loading,ge=G.uid;se&&se[ge]&&se[ge].abort&&(se[ge].abort(),delete se[ge]),K()},Ce.prototype.removeTile=function(G,K){var se=this.loaded,ge=G.uid;se&&se[ge]&&delete se[ge],K()};var et=v.window.ImageBitmap,Pt=function(){this.loaded={}};function nr(G,K){if(G.length!==0){xt(G[0],K);for(var se=1;se<G.length;se++)xt(G[se],!K)}}function xt(G,K){for(var se=0,ge=0,Le=G.length,Ge=Le-1;ge<Le;Ge=ge++)se+=(G[ge][0]-G[Ge][0])*(G[Ge][1]+G[ge][1]);se>=0!=!!K&&G.reverse()}Pt.prototype.loadTile=function(G,K){var se=G.uid,ge=G.encoding,Le=G.rawImageData,Ge=et&&Le instanceof et?this.getImageData(Le):Le,rt=new v.DEMData(se,Ge,ge);this.loaded=this.loaded||{},this.loaded[se]=rt,K(null,rt)},Pt.prototype.getImageData=function(G){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);var K=this.offscreenCanvasContext.getImageData(-1,-1,G.width+2,G.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:K.width,height:K.height},K.data)},Pt.prototype.removeTile=function(G){var K=this.loaded,se=G.uid;K&&K[se]&&delete K[se]};var Wt=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,wt=function(G){this._feature=G,this.extent=v.EXTENT,this.type=G.type,this.properties=G.tags,"id"in G&&!isNaN(G.id)&&(this.id=parseInt(G.id,10))};wt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var G=[],K=0,se=this._feature.geometry;K<se.length;K+=1){var ge=se[K];G.push([new v.Point$1(ge[0],ge[1])])}return G}for(var Le=[],Ge=0,rt=this._feature.geometry;Ge<rt.length;Ge+=1){for(var pe=[],Be=0,yt=rt[Ge];Be<yt.length;Be+=1){var dr=yt[Be];pe.push(new v.Point$1(dr[0],dr[1]))}Le.push(pe)}return Le},wt.prototype.toGeoJSON=function(G,K,se){return Wt.call(this,G,K,se)};var st=function(G){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=G.length,this._features=G};st.prototype.feature=function(G){return new wt(this._features[G])};var ut=v.vectorTile.VectorTileFeature,Jt=X;function X(G,K){this.options=K||{},this.features=G,this.length=G.length}function Xt(G,K){this.id=typeof G.id=="number"?G.id:void 0,this.type=G.type,this.rawGeometry=G.type===1?[G.geometry]:G.geometry,this.properties=G.tags,this.extent=K||4096}X.prototype.feature=function(G){return new Xt(this.features[G],this.options.extent)},Xt.prototype.loadGeometry=function(){var G=this.rawGeometry;this.geometry=[];for(var K=0;K<G.length;K++){for(var se=G[K],ge=[],Le=0;Le<se.length;Le++)ge.push(new v.Point$1(se[Le][0],se[Le][1]));this.geometry.push(ge)}return this.geometry},Xt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var G=this.geometry,K=1/0,se=-1/0,ge=1/0,Le=-1/0,Ge=0;Ge<G.length;Ge++)for(var rt=G[Ge],pe=0;pe<rt.length;pe++){var Be=rt[pe];K=Math.min(K,Be.x),se=Math.max(se,Be.x),ge=Math.min(ge,Be.y),Le=Math.max(Le,Be.y)}return[K,ge,se,Le]},Xt.prototype.toGeoJSON=ut.prototype.toGeoJSON;var vt=pt,qe=Jt;function pt(G){var K=new v.pbf;return function(se,ge){for(var Le in se.layers)ge.writeMessage(3,$e,se.layers[Le])}(G,K),K.finish()}function $e(G,K){var se;K.writeVarintField(15,G.version||1),K.writeStringField(1,G.name||""),K.writeVarintField(5,G.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(se=0;se<G.length;se++)ge.feature=G.feature(se),K.writeMessage(2,kt,ge);var Le=ge.keys;for(se=0;se<Le.length;se++)K.writeStringField(3,Le[se]);var Ge=ge.values;for(se=0;se<Ge.length;se++)K.writeMessage(4,Ye,Ge[se])}function kt(G,K){var se=G.feature;se.id!==void 0&&K.writeVarintField(1,se.id),K.writeMessage(2,xr,G),K.writeVarintField(3,se.type),K.writeMessage(4,Me,se)}function xr(G,K){var se=G.feature,ge=G.keys,Le=G.values,Ge=G.keycache,rt=G.valuecache;for(var pe in se.properties){var Be=Ge[pe];Be===void 0&&(ge.push(pe),Ge[pe]=Be=ge.length-1),K.writeVarint(Be);var yt=se.properties[pe],dr=typeof yt;dr!=="string"&&dr!=="boolean"&&dr!=="number"&&(yt=JSON.stringify(yt));var Dt=dr+":"+yt,Ft=rt[Dt];Ft===void 0&&(Le.push(yt),rt[Dt]=Ft=Le.length-1),K.writeVarint(Ft)}}function Ir(G,K){return(K<<3)+(7&G)}function Wr(G){return G<<1^G>>31}function Me(G,K){for(var se=G.loadGeometry(),ge=G.type,Le=0,Ge=0,rt=se.length,pe=0;pe<rt;pe++){var Be=se[pe],yt=1;ge===1&&(yt=Be.length),K.writeVarint(Ir(1,yt));for(var dr=ge===3?Be.length-1:Be.length,Dt=0;Dt<dr;Dt++){Dt===1&&ge!==1&&K.writeVarint(Ir(2,dr-1));var Ft=Be[Dt].x-Le,_r=Be[Dt].y-Ge;K.writeVarint(Wr(Ft)),K.writeVarint(Wr(_r)),Le+=Ft,Ge+=_r}ge===3&&K.writeVarint(Ir(7,1))}}function Ye(G,K){var se=typeof G;se==="string"?K.writeStringField(1,G):se==="boolean"?K.writeBooleanField(7,G):se==="number"&&(G%1!=0?K.writeDoubleField(3,G):G<0?K.writeSVarintField(6,G):K.writeVarintField(5,G))}function Fe(G,K,se,ge){At(G,se,ge),At(K,2*se,2*ge),At(K,2*se+1,2*ge+1)}function At(G,K,se){var ge=G[K];G[K]=G[se],G[se]=ge}function gt(G,K,se,ge){var Le=G-se,Ge=K-ge;return Le*Le+Ge*Ge}vt.fromVectorTileJs=pt,vt.fromGeojsonVt=function(G,K){K=K||{};var se={};for(var ge in G)se[ge]=new Jt(G[ge].features,K),se[ge].name=ge,se[ge].version=K.version,se[ge].extent=K.extent;return pt({layers:se})},vt.GeoJSONWrapper=qe;var Nt=function(G){return G[0]},qt=function(G){return G[1]},Cr=function(G,K,se,ge,Le){K===void 0&&(K=Nt),se===void 0&&(se=qt),ge===void 0&&(ge=64),Le===void 0&&(Le=Float64Array),this.nodeSize=ge,this.points=G;for(var Ge=G.length<65536?Uint16Array:Uint32Array,rt=this.ids=new Ge(G.length),pe=this.coords=new Le(2*G.length),Be=0;Be<G.length;Be++)rt[Be]=Be,pe[2*Be]=K(G[Be]),pe[2*Be+1]=se(G[Be]);(function yt(dr,Dt,Ft,_r,En,un){if(!(En-_r<=Ft)){var Tt=_r+En>>1;(function on(Gr,qr,ni,tn,Ci,Ji){for(;Ci>tn;){if(Ci-tn>600){var yi=Ci-tn+1,Pi=ni-tn+1,xi=Math.log(yi),ei=.5*Math.exp(2*xi/3),Wi=.5*Math.sqrt(xi*ei*(yi-ei)/yi)*(Pi-yi/2<0?-1:1);on(Gr,qr,ni,Math.max(tn,Math.floor(ni-Pi*ei/yi+Wi)),Math.min(Ci,Math.floor(ni+(yi-Pi)*ei/yi+Wi)),Ji)}var La=qr[2*ni+Ji],oa=tn,Ii=Ci;for(Fe(Gr,qr,tn,ni),qr[2*Ci+Ji]>La&&Fe(Gr,qr,tn,Ci);oa<Ii;){for(Fe(Gr,qr,oa,Ii),oa++,Ii--;qr[2*oa+Ji]<La;)oa++;for(;qr[2*Ii+Ji]>La;)Ii--}qr[2*tn+Ji]===La?Fe(Gr,qr,tn,Ii):Fe(Gr,qr,++Ii,Ci),Ii<=ni&&(tn=Ii+1),ni<=Ii&&(Ci=Ii-1)}})(dr,Dt,Tt,_r,En,un%2),yt(dr,Dt,Ft,_r,Tt-1,un+1),yt(dr,Dt,Ft,Tt+1,En,un+1)}})(rt,pe,ge,0,rt.length-1,0)};Cr.prototype.range=function(G,K,se,ge){return function(Le,Ge,rt,pe,Be,yt,dr){for(var Dt,Ft,_r=[0,Le.length-1,0],En=[];_r.length;){var un=_r.pop(),Tt=_r.pop(),on=_r.pop();if(Tt-on<=dr)for(var Gr=on;Gr<=Tt;Gr++)Ft=Ge[2*Gr+1],(Dt=Ge[2*Gr])>=rt&&Dt<=Be&&Ft>=pe&&Ft<=yt&&En.push(Le[Gr]);else{var qr=Math.floor((on+Tt)/2);Ft=Ge[2*qr+1],(Dt=Ge[2*qr])>=rt&&Dt<=Be&&Ft>=pe&&Ft<=yt&&En.push(Le[qr]);var ni=(un+1)%2;(un===0?rt<=Dt:pe<=Ft)&&(_r.push(on),_r.push(qr-1),_r.push(ni)),(un===0?Be>=Dt:yt>=Ft)&&(_r.push(qr+1),_r.push(Tt),_r.push(ni))}}return En}(this.ids,this.coords,G,K,se,ge,this.nodeSize)},Cr.prototype.within=function(G,K,se){return function(ge,Le,Ge,rt,pe,Be){for(var yt=[0,ge.length-1,0],dr=[],Dt=pe*pe;yt.length;){var Ft=yt.pop(),_r=yt.pop(),En=yt.pop();if(_r-En<=Be)for(var un=En;un<=_r;un++)gt(Le[2*un],Le[2*un+1],Ge,rt)<=Dt&&dr.push(ge[un]);else{var Tt=Math.floor((En+_r)/2),on=Le[2*Tt],Gr=Le[2*Tt+1];gt(on,Gr,Ge,rt)<=Dt&&dr.push(ge[Tt]);var qr=(Ft+1)%2;(Ft===0?Ge-pe<=on:rt-pe<=Gr)&&(yt.push(En),yt.push(Tt-1),yt.push(qr)),(Ft===0?Ge+pe>=on:rt+pe>=Gr)&&(yt.push(Tt+1),yt.push(_r),yt.push(qr))}}return dr}(this.ids,this.coords,G,K,se,this.nodeSize)};var Wn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(G){return G}},hn=function(G){this.options=aa(Object.create(Wn),G),this.trees=new Array(this.options.maxZoom+1)};function Yi(G,K,se,ge,Le){return{x:G,y:K,zoom:1/0,id:se,parentId:-1,numPoints:ge,properties:Le}}function Un(G,K){var se=G.geometry.coordinates,ge=se[1];return{x:Xn(se[0]),y:ai(ge),zoom:1/0,index:K,parentId:-1}}function Gn(G){return{type:"Feature",id:G.id,properties:di(G),geometry:{type:"Point",coordinates:[(ge=G.x,360*(ge-.5)),(K=G.y,se=(180-360*K)*Math.PI/180,360*Math.atan(Math.exp(se))/Math.PI-90)]}};var K,se,ge}function di(G){var K=G.numPoints,se=K>=1e4?Math.round(K/1e3)+"k":K>=1e3?Math.round(K/100)/10+"k":K;return aa(aa({},G.properties),{cluster:!0,cluster_id:G.id,point_count:K,point_count_abbreviated:se})}function Xn(G){return G/360+.5}function ai(G){var K=Math.sin(G*Math.PI/180),se=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return se<0?0:se>1?1:se}function aa(G,K){for(var se in K)G[se]=K[se];return G}function Ri(G){return G.x}function Ei(G){return G.y}function ji(G,K,se,ge,Le,Ge){var rt=Le-se,pe=Ge-ge;if(rt!==0||pe!==0){var Be=((G-se)*rt+(K-ge)*pe)/(rt*rt+pe*pe);Be>1?(se=Le,ge=Ge):Be>0&&(se+=rt*Be,ge+=pe*Be)}return(rt=G-se)*rt+(pe=K-ge)*pe}function ua(G,K,se,ge){var Le={id:G===void 0?null:G,type:K,geometry:se,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ge){var rt=Ge.geometry,pe=Ge.type;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")Si(Ge,rt);else if(pe==="Polygon"||pe==="MultiLineString")for(var Be=0;Be<rt.length;Be++)Si(Ge,rt[Be]);else if(pe==="MultiPolygon")for(Be=0;Be<rt.length;Be++)for(var yt=0;yt<rt[Be].length;yt++)Si(Ge,rt[Be][yt])}(Le),Le}function Si(G,K){for(var se=0;se<K.length;se+=3)G.minX=Math.min(G.minX,K[se]),G.minY=Math.min(G.minY,K[se+1]),G.maxX=Math.max(G.maxX,K[se]),G.maxY=Math.max(G.maxY,K[se+1])}function ba(G,K,se,ge){if(K.geometry){var Le=K.geometry.coordinates,Ge=K.geometry.type,rt=Math.pow(se.tolerance/((1<<se.maxZoom)*se.extent),2),pe=[],Be=K.id;if(se.promoteId?Be=K.properties[se.promoteId]:se.generateId&&(Be=ge||0),Ge==="Point")Mn(Le,pe);else if(Ge==="MultiPoint")for(var yt=0;yt<Le.length;yt++)Mn(Le[yt],pe);else if(Ge==="LineString")_i(Le,pe,rt,!1);else if(Ge==="MultiLineString"){if(se.lineMetrics){for(yt=0;yt<Le.length;yt++)_i(Le[yt],pe=[],rt,!1),G.push(ua(Be,"LineString",pe,K.properties));return}Ui(Le,pe,rt,!1)}else if(Ge==="Polygon")Ui(Le,pe,rt,!0);else{if(Ge!=="MultiPolygon"){if(Ge==="GeometryCollection"){for(yt=0;yt<K.geometry.geometries.length;yt++)ba(G,{id:Be,geometry:K.geometry.geometries[yt],properties:K.properties},se,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(yt=0;yt<Le.length;yt++){var dr=[];Ui(Le[yt],dr,rt,!0),pe.push(dr)}}G.push(ua(Be,Ge,pe,K.properties))}}function Mn(G,K){K.push(qi(G[0])),K.push(Ga(G[1])),K.push(0)}function _i(G,K,se,ge){for(var Le,Ge,rt=0,pe=0;pe<G.length;pe++){var Be=qi(G[pe][0]),yt=Ga(G[pe][1]);K.push(Be),K.push(yt),K.push(0),pe>0&&(rt+=ge?(Le*yt-Be*Ge)/2:Math.sqrt(Math.pow(Be-Le,2)+Math.pow(yt-Ge,2))),Le=Be,Ge=yt}var dr=K.length-3;K[2]=1,function Dt(Ft,_r,En,un){for(var Tt,on=un,Gr=En-_r>>1,qr=En-_r,ni=Ft[_r],tn=Ft[_r+1],Ci=Ft[En],Ji=Ft[En+1],yi=_r+3;yi<En;yi+=3){var Pi=ji(Ft[yi],Ft[yi+1],ni,tn,Ci,Ji);if(Pi>on)Tt=yi,on=Pi;else if(Pi===on){var xi=Math.abs(yi-Gr);xi<qr&&(Tt=yi,qr=xi)}}on>un&&(Tt-_r>3&&Dt(Ft,_r,Tt,un),Ft[Tt+2]=on,En-Tt>3&&Dt(Ft,Tt,En,un))}(K,0,dr,se),K[dr+2]=1,K.size=Math.abs(rt),K.start=0,K.end=K.size}function Ui(G,K,se,ge){for(var Le=0;Le<G.length;Le++){var Ge=[];_i(G[Le],Ge,se,ge),K.push(Ge)}}function qi(G){return G/360+.5}function Ga(G){var K=Math.sin(G*Math.PI/180),se=.5-.25*Math.log((1+K)/(1-K))/Math.PI;return se<0?0:se>1?1:se}function ve(G,K,se,ge,Le,Ge,rt,pe){if(ge/=K,Ge>=(se/=K)&&rt<ge)return G;if(rt<se||Ge>=ge)return null;for(var Be=[],yt=0;yt<G.length;yt++){var dr=G[yt],Dt=dr.geometry,Ft=dr.type,_r=Le===0?dr.minX:dr.minY,En=Le===0?dr.maxX:dr.maxY;if(_r>=se&&En<ge)Be.push(dr);else if(!(En<se||_r>=ge)){var un=[];if(Ft==="Point"||Ft==="MultiPoint")Ln(Dt,un,se,ge,Le);else if(Ft==="LineString")Ha(Dt,un,se,ge,Le,!1,pe.lineMetrics);else if(Ft==="MultiLineString")Ut(Dt,un,se,ge,Le,!1);else if(Ft==="Polygon")Ut(Dt,un,se,ge,Le,!0);else if(Ft==="MultiPolygon")for(var Tt=0;Tt<Dt.length;Tt++){var on=[];Ut(Dt[Tt],on,se,ge,Le,!0),on.length&&un.push(on)}if(un.length){if(pe.lineMetrics&&Ft==="LineString"){for(Tt=0;Tt<un.length;Tt++)Be.push(ua(dr.id,Ft,un[Tt],dr.tags));continue}Ft!=="LineString"&&Ft!=="MultiLineString"||(un.length===1?(Ft="LineString",un=un[0]):Ft="MultiLineString"),Ft!=="Point"&&Ft!=="MultiPoint"||(Ft=un.length===3?"Point":"MultiPoint"),Be.push(ua(dr.id,Ft,un,dr.tags))}}}return Be.length?Be:null}function Ln(G,K,se,ge,Le){for(var Ge=0;Ge<G.length;Ge+=3){var rt=G[Ge+Le];rt>=se&&rt<=ge&&(K.push(G[Ge]),K.push(G[Ge+1]),K.push(G[Ge+2]))}}function Ha(G,K,se,ge,Le,Ge,rt){for(var pe,Be,yt=os(G),dr=Le===0?Pr:I,Dt=G.start,Ft=0;Ft<G.length-3;Ft+=3){var _r=G[Ft],En=G[Ft+1],un=G[Ft+2],Tt=G[Ft+3],on=G[Ft+4],Gr=Le===0?_r:En,qr=Le===0?Tt:on,ni=!1;rt&&(pe=Math.sqrt(Math.pow(_r-Tt,2)+Math.pow(En-on,2))),Gr<se?qr>se&&(Be=dr(yt,_r,En,Tt,on,se),rt&&(yt.start=Dt+pe*Be)):Gr>ge?qr<ge&&(Be=dr(yt,_r,En,Tt,on,ge),rt&&(yt.start=Dt+pe*Be)):ir(yt,_r,En,un),qr<se&&Gr>=se&&(Be=dr(yt,_r,En,Tt,on,se),ni=!0),qr>ge&&Gr<=ge&&(Be=dr(yt,_r,En,Tt,on,ge),ni=!0),!Ge&&ni&&(rt&&(yt.end=Dt+pe*Be),K.push(yt),yt=os(G)),rt&&(Dt+=pe)}var tn=G.length-3;_r=G[tn],En=G[tn+1],un=G[tn+2],(Gr=Le===0?_r:En)>=se&&Gr<=ge&&ir(yt,_r,En,un),tn=yt.length-3,Ge&&tn>=3&&(yt[tn]!==yt[0]||yt[tn+1]!==yt[1])&&ir(yt,yt[0],yt[1],yt[2]),yt.length&&K.push(yt)}function os(G){var K=[];return K.size=G.size,K.start=G.start,K.end=G.end,K}function Ut(G,K,se,ge,Le,Ge){for(var rt=0;rt<G.length;rt++)Ha(G[rt],K,se,ge,Le,Ge,!1)}function ir(G,K,se,ge){G.push(K),G.push(se),G.push(ge)}function Pr(G,K,se,ge,Le,Ge){var rt=(Ge-K)/(ge-K);return G.push(Ge),G.push(se+(Le-se)*rt),G.push(1),rt}function I(G,K,se,ge,Le,Ge){var rt=(Ge-se)/(Le-se);return G.push(K+(ge-K)*rt),G.push(Ge),G.push(1),rt}function or(G,K){for(var se=[],ge=0;ge<G.length;ge++){var Le,Ge=G[ge],rt=Ge.type;if(rt==="Point"||rt==="MultiPoint"||rt==="LineString")Le=Rn(Ge.geometry,K);else if(rt==="MultiLineString"||rt==="Polygon"){Le=[];for(var pe=0;pe<Ge.geometry.length;pe++)Le.push(Rn(Ge.geometry[pe],K))}else if(rt==="MultiPolygon")for(Le=[],pe=0;pe<Ge.geometry.length;pe++){for(var Be=[],yt=0;yt<Ge.geometry[pe].length;yt++)Be.push(Rn(Ge.geometry[pe][yt],K));Le.push(Be)}se.push(ua(Ge.id,rt,Le,Ge.tags))}return se}function Rn(G,K){var se=[];se.size=G.size,G.start!==void 0&&(se.start=G.start,se.end=G.end);for(var ge=0;ge<G.length;ge+=3)se.push(G[ge]+K,G[ge+1],G[ge+2]);return se}function oi(G,K){if(G.transformed)return G;var se,ge,Le,Ge=1<<G.z,rt=G.x,pe=G.y;for(se=0;se<G.features.length;se++){var Be=G.features[se],yt=Be.geometry,dr=Be.type;if(Be.geometry=[],dr===1)for(ge=0;ge<yt.length;ge+=2)Be.geometry.push(jn(yt[ge],yt[ge+1],K,Ge,rt,pe));else for(ge=0;ge<yt.length;ge++){var Dt=[];for(Le=0;Le<yt[ge].length;Le+=2)Dt.push(jn(yt[ge][Le],yt[ge][Le+1],K,Ge,rt,pe));Be.geometry.push(Dt)}}return G.transformed=!0,G}function jn(G,K,se,ge,Le,Ge){return[Math.round(se*(G*ge-Le)),Math.round(se*(K*ge-Ge))]}function nn(G,K,se,ge,Le){for(var Ge=K===Le.maxZoom?0:Le.tolerance/((1<<K)*Le.extent),rt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:se,y:ge,z:K,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},pe=0;pe<G.length;pe++){rt.numFeatures++,Ti(rt,G[pe],Ge,Le);var Be=G[pe].minX,yt=G[pe].minY,dr=G[pe].maxX,Dt=G[pe].maxY;Be<rt.minX&&(rt.minX=Be),yt<rt.minY&&(rt.minY=yt),dr>rt.maxX&&(rt.maxX=dr),Dt>rt.maxY&&(rt.maxY=Dt)}return rt}function Ti(G,K,se,ge){var Le=K.geometry,Ge=K.type,rt=[];if(Ge==="Point"||Ge==="MultiPoint")for(var pe=0;pe<Le.length;pe+=3)rt.push(Le[pe]),rt.push(Le[pe+1]),G.numPoints++,G.numSimplified++;else if(Ge==="LineString")Mi(rt,Le,G,se,!1,!1);else if(Ge==="MultiLineString"||Ge==="Polygon")for(pe=0;pe<Le.length;pe++)Mi(rt,Le[pe],G,se,Ge==="Polygon",pe===0);else if(Ge==="MultiPolygon")for(var Be=0;Be<Le.length;Be++){var yt=Le[Be];for(pe=0;pe<yt.length;pe++)Mi(rt,yt[pe],G,se,!0,pe===0)}if(rt.length){var dr=K.tags||null;if(Ge==="LineString"&&ge.lineMetrics){for(var Dt in dr={},K.tags)dr[Dt]=K.tags[Dt];dr.mapbox_clip_start=Le.start/Le.size,dr.mapbox_clip_end=Le.end/Le.size}var Ft={geometry:rt,type:Ge==="Polygon"||Ge==="MultiPolygon"?3:Ge==="LineString"||Ge==="MultiLineString"?2:1,tags:dr};K.id!==null&&(Ft.id=K.id),G.features.push(Ft)}}function Mi(G,K,se,ge,Le,Ge){var rt=ge*ge;if(ge>0&&K.size<(Le?rt:ge))se.numPoints+=K.length/3;else{for(var pe=[],Be=0;Be<K.length;Be+=3)(ge===0||K[Be+2]>rt)&&(se.numSimplified++,pe.push(K[Be]),pe.push(K[Be+1])),se.numPoints++;Le&&function(yt,dr){for(var Dt=0,Ft=0,_r=yt.length,En=_r-2;Ft<_r;En=Ft,Ft+=2)Dt+=(yt[Ft]-yt[En])*(yt[Ft+1]+yt[En+1]);if(Dt>0===dr)for(Ft=0,_r=yt.length;Ft<_r/2;Ft+=2){var un=yt[Ft],Tt=yt[Ft+1];yt[Ft]=yt[_r-2-Ft],yt[Ft+1]=yt[_r-1-Ft],yt[_r-2-Ft]=un,yt[_r-1-Ft]=Tt}}(pe,Ge),G.push(pe)}}function $a(G,K){var se=(K=this.options=function(Le,Ge){for(var rt in Ge)Le[rt]=Ge[rt];return Le}(Object.create(this.options),K)).debug;if(se&&console.time("preprocess data"),K.maxZoom<0||K.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(K.promoteId&&K.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(Le,Ge){var rt=[];if(Le.type==="FeatureCollection")for(var pe=0;pe<Le.features.length;pe++)ba(rt,Le.features[pe],Ge,pe);else ba(rt,Le.type==="Feature"?Le:{geometry:Le},Ge);return rt}(G,K);this.tiles={},this.tileCoords=[],se&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",K.indexMaxZoom,K.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ge=function(Le,Ge){var rt=Ge.buffer/Ge.extent,pe=Le,Be=ve(Le,1,-1-rt,rt,0,-1,2,Ge),yt=ve(Le,1,1-rt,2+rt,0,-1,2,Ge);return(Be||yt)&&(pe=ve(Le,1,-rt,1+rt,0,-1,2,Ge)||[],Be&&(pe=or(Be,1).concat(pe)),yt&&(pe=pe.concat(or(yt,-1)))),pe}(ge,K)).length&&this.splitTile(ge,0,0,0),se&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function ss(G,K,se){return 32*((1<<G)*se+K)+G}function ma(G,K){var se=G.tileID.canonical;if(!this._geoJSONIndex)return K(null,null);var ge=this._geoJSONIndex.getTile(se.z,se.x,se.y);if(!ge)return K(null,null);var Le=new st(ge.features),Ge=vt(Le);Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),K(null,{vectorTile:Le,rawData:Ge.buffer})}hn.prototype.load=function(G){var K=this.options,se=K.log,ge=K.minZoom,Le=K.maxZoom,Ge=K.nodeSize;se&&console.time("total time");var rt="prepare "+G.length+" points";se&&console.time(rt),this.points=G;for(var pe=[],Be=0;Be<G.length;Be++)G[Be].geometry&&pe.push(Un(G[Be],Be));this.trees[Le+1]=new Cr(pe,Ri,Ei,Ge,Float32Array),se&&console.timeEnd(rt);for(var yt=Le;yt>=ge;yt--){var dr=+Date.now();pe=this._cluster(pe,yt),this.trees[yt]=new Cr(pe,Ri,Ei,Ge,Float32Array),se&&console.log("z%d: %d clusters in %dms",yt,pe.length,+Date.now()-dr)}return se&&console.timeEnd("total time"),this},hn.prototype.getClusters=function(G,K){var se=((G[0]+180)%360+360)%360-180,ge=Math.max(-90,Math.min(90,G[1])),Le=G[2]===180?180:((G[2]+180)%360+360)%360-180,Ge=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)se=-180,Le=180;else if(se>Le){var rt=this.getClusters([se,ge,180,Ge],K),pe=this.getClusters([-180,ge,Le,Ge],K);return rt.concat(pe)}for(var Be=this.trees[this._limitZoom(K)],yt=[],dr=0,Dt=Be.range(Xn(se),ai(Ge),Xn(Le),ai(ge));dr<Dt.length;dr+=1){var Ft=Be.points[Dt[dr]];yt.push(Ft.numPoints?Gn(Ft):this.points[Ft.index])}return yt},hn.prototype.getChildren=function(G){var K=this._getOriginId(G),se=this._getOriginZoom(G),ge="No cluster with the specified id.",Le=this.trees[se];if(!Le)throw new Error(ge);var Ge=Le.points[K];if(!Ge)throw new Error(ge);for(var rt=this.options.radius/(this.options.extent*Math.pow(2,se-1)),pe=[],Be=0,yt=Le.within(Ge.x,Ge.y,rt);Be<yt.length;Be+=1){var dr=Le.points[yt[Be]];dr.parentId===G&&pe.push(dr.numPoints?Gn(dr):this.points[dr.index])}if(pe.length===0)throw new Error(ge);return pe},hn.prototype.getLeaves=function(G,K,se){var ge=[];return this._appendLeaves(ge,G,K=K||10,se=se||0,0),ge},hn.prototype.getTile=function(G,K,se){var ge=this.trees[this._limitZoom(G)],Le=Math.pow(2,G),Ge=this.options,rt=Ge.radius/Ge.extent,pe=(se-rt)/Le,Be=(se+1+rt)/Le,yt={features:[]};return this._addTileFeatures(ge.range((K-rt)/Le,pe,(K+1+rt)/Le,Be),ge.points,K,se,Le,yt),K===0&&this._addTileFeatures(ge.range(1-rt/Le,pe,1,Be),ge.points,Le,se,Le,yt),K===Le-1&&this._addTileFeatures(ge.range(0,pe,rt/Le,Be),ge.points,-1,se,Le,yt),yt.features.length?yt:null},hn.prototype.getClusterExpansionZoom=function(G){for(var K=this._getOriginZoom(G)-1;K<=this.options.maxZoom;){var se=this.getChildren(G);if(K++,se.length!==1)break;G=se[0].properties.cluster_id}return K},hn.prototype._appendLeaves=function(G,K,se,ge,Le){for(var Ge=0,rt=this.getChildren(K);Ge<rt.length;Ge+=1){var pe=rt[Ge],Be=pe.properties;if(Be&&Be.cluster?Le+Be.point_count<=ge?Le+=Be.point_count:Le=this._appendLeaves(G,Be.cluster_id,se,ge,Le):Le<ge?Le++:G.push(pe),G.length===se)break}return Le},hn.prototype._addTileFeatures=function(G,K,se,ge,Le,Ge){for(var rt=0,pe=G;rt<pe.length;rt+=1){var Be=K[pe[rt]],yt=Be.numPoints,dr={type:1,geometry:[[Math.round(this.options.extent*(Be.x*Le-se)),Math.round(this.options.extent*(Be.y*Le-ge))]],tags:yt?di(Be):this.points[Be.index].properties},Dt=void 0;yt?Dt=Be.id:this.options.generateId?Dt=Be.index:this.points[Be.index].id&&(Dt=this.points[Be.index].id),Dt!==void 0&&(dr.id=Dt),Ge.features.push(dr)}},hn.prototype._limitZoom=function(G){return Math.max(this.options.minZoom,Math.min(+G,this.options.maxZoom+1))},hn.prototype._cluster=function(G,K){for(var se=[],ge=this.options,Le=ge.reduce,Ge=ge.minPoints,rt=ge.radius/(ge.extent*Math.pow(2,K)),pe=0;pe<G.length;pe++){var Be=G[pe];if(!(Be.zoom<=K)){Be.zoom=K;for(var yt=this.trees[K+1],dr=yt.within(Be.x,Be.y,rt),Dt=Be.numPoints||1,Ft=Dt,_r=0,En=dr;_r<En.length;_r+=1){var un=yt.points[En[_r]];un.zoom>K&&(Ft+=un.numPoints||1)}if(Ft>=Ge){for(var Tt=Be.x*Dt,on=Be.y*Dt,Gr=Le&&Dt>1?this._map(Be,!0):null,qr=(pe<<5)+(K+1)+this.points.length,ni=0,tn=dr;ni<tn.length;ni+=1){var Ci=yt.points[tn[ni]];if(!(Ci.zoom<=K)){Ci.zoom=K;var Ji=Ci.numPoints||1;Tt+=Ci.x*Ji,on+=Ci.y*Ji,Ci.parentId=qr,Le&&(Gr||(Gr=this._map(Be,!0)),Le(Gr,this._map(Ci)))}}Be.parentId=qr,se.push(Yi(Tt/Ft,on/Ft,qr,Ft,Gr))}else if(se.push(Be),Ft>1)for(var yi=0,Pi=dr;yi<Pi.length;yi+=1){var xi=yt.points[Pi[yi]];xi.zoom<=K||(xi.zoom=K,se.push(xi))}}}return se},hn.prototype._getOriginId=function(G){return G-this.points.length>>5},hn.prototype._getOriginZoom=function(G){return(G-this.points.length)%32},hn.prototype._map=function(G,K){if(G.numPoints)return K?aa({},G.properties):G.properties;var se=this.points[G.index].properties,ge=this.options.map(se);return K&&ge===se?aa({},ge):ge},$a.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},$a.prototype.splitTile=function(G,K,se,ge,Le,Ge,rt){for(var pe=[G,K,se,ge],Be=this.options,yt=Be.debug;pe.length;){ge=pe.pop(),se=pe.pop(),K=pe.pop(),G=pe.pop();var dr=1<<K,Dt=ss(K,se,ge),Ft=this.tiles[Dt];if(!Ft&&(yt>1&&console.time("creation"),Ft=this.tiles[Dt]=nn(G,K,se,ge,Be),this.tileCoords.push({z:K,x:se,y:ge}),yt)){yt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",K,se,ge,Ft.numFeatures,Ft.numPoints,Ft.numSimplified),console.timeEnd("creation"));var _r="z"+K;this.stats[_r]=(this.stats[_r]||0)+1,this.total++}if(Ft.source=G,Le){if(K===Be.maxZoom||K===Le)continue;var En=1<<Le-K;if(se!==Math.floor(Ge/En)||ge!==Math.floor(rt/En))continue}else if(K===Be.indexMaxZoom||Ft.numPoints<=Be.indexMaxPoints)continue;if(Ft.source=null,G.length!==0){yt>1&&console.time("clipping");var un,Tt,on,Gr,qr,ni,tn=.5*Be.buffer/Be.extent,Ci=.5-tn,Ji=.5+tn,yi=1+tn;un=Tt=on=Gr=null,qr=ve(G,dr,se-tn,se+Ji,0,Ft.minX,Ft.maxX,Be),ni=ve(G,dr,se+Ci,se+yi,0,Ft.minX,Ft.maxX,Be),G=null,qr&&(un=ve(qr,dr,ge-tn,ge+Ji,1,Ft.minY,Ft.maxY,Be),Tt=ve(qr,dr,ge+Ci,ge+yi,1,Ft.minY,Ft.maxY,Be),qr=null),ni&&(on=ve(ni,dr,ge-tn,ge+Ji,1,Ft.minY,Ft.maxY,Be),Gr=ve(ni,dr,ge+Ci,ge+yi,1,Ft.minY,Ft.maxY,Be),ni=null),yt>1&&console.timeEnd("clipping"),pe.push(un||[],K+1,2*se,2*ge),pe.push(Tt||[],K+1,2*se,2*ge+1),pe.push(on||[],K+1,2*se+1,2*ge),pe.push(Gr||[],K+1,2*se+1,2*ge+1)}}},$a.prototype.getTile=function(G,K,se){var ge=this.options,Le=ge.extent,Ge=ge.debug;if(G<0||G>24)return null;var rt=1<<G,pe=ss(G,K=(K%rt+rt)%rt,se);if(this.tiles[pe])return oi(this.tiles[pe],Le);Ge>1&&console.log("drilling down to z%d-%d-%d",G,K,se);for(var Be,yt=G,dr=K,Dt=se;!Be&&yt>0;)yt--,dr=Math.floor(dr/2),Dt=Math.floor(Dt/2),Be=this.tiles[ss(yt,dr,Dt)];return Be&&Be.source?(Ge>1&&console.log("found parent tile z%d-%d-%d",yt,dr,Dt),Ge>1&&console.time("drilling down"),this.splitTile(Be.source,yt,dr,Dt,G,K,se),Ge>1&&console.timeEnd("drilling down"),this.tiles[pe]?oi(this.tiles[pe],Le):null):null};var Ra=function(G){function K(se,ge,Le,Ge){G.call(this,se,ge,Le,ma),Ge&&(this.loadGeoJSON=Ge)}return G&&(K.__proto__=G),(K.prototype=Object.create(G&&G.prototype)).constructor=K,K.prototype.loadData=function(se,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ge,this._pendingLoadDataParams=se,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},K.prototype._loadData=function(){var se=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ge=this._pendingCallback,Le=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ge=!!(Le&&Le.request&&Le.request.collectResourceTiming)&&new v.RequestPerformance(Le.request);this.loadGeoJSON(Le,function(rt,pe){if(rt||!pe)return ge(rt);if(typeof pe!="object")return ge(new Error("Input data given to '"+Le.source+"' is not a valid GeoJSON object."));(function Ft(_r,En){var un,Tt=_r&&_r.type;if(Tt==="FeatureCollection")for(un=0;un<_r.features.length;un++)Ft(_r.features[un],En);else if(Tt==="GeometryCollection")for(un=0;un<_r.geometries.length;un++)Ft(_r.geometries[un],En);else if(Tt==="Feature")Ft(_r.geometry,En);else if(Tt==="Polygon")nr(_r.coordinates,En);else if(Tt==="MultiPolygon")for(un=0;un<_r.coordinates.length;un++)nr(_r.coordinates[un],En);return _r})(pe,!0);try{if(Le.filter){var Be=v.createExpression(Le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map(function(Ft){return Ft.key+": "+Ft.message}).join(", "));var yt=pe.features.filter(function(Ft){return Be.value.evaluate({zoom:0},Ft)});pe={type:"FeatureCollection",features:yt}}se._geoJSONIndex=Le.cluster?new hn(function(Ft){var _r=Ft.superclusterOptions,En=Ft.clusterProperties;if(!En||!_r)return _r;for(var un={},Tt={},on={accumulated:null,zoom:0},Gr={properties:null},qr=Object.keys(En),ni=0,tn=qr;ni<tn.length;ni+=1){var Ci=tn[ni],Ji=En[Ci],yi=Ji[0],Pi=v.createExpression(Ji[1]),xi=v.createExpression(typeof yi=="string"?[yi,["accumulated"],["get",Ci]]:yi);un[Ci]=Pi.value,Tt[Ci]=xi.value}return _r.map=function(ei){Gr.properties=ei;for(var Wi={},La=0,oa=qr;La<oa.length;La+=1){var Ii=oa[La];Wi[Ii]=un[Ii].evaluate(on,Gr)}return Wi},_r.reduce=function(ei,Wi){Gr.properties=Wi;for(var La=0,oa=qr;La<oa.length;La+=1){var Ii=oa[La];on.accumulated=ei[Ii],ei[Ii]=Tt[Ii].evaluate(on,Gr)}},_r}(Le)).load(pe.features):function(Ft,_r){return new $a(Ft,_r)}(pe,Le.geojsonVtOptions)}catch(Ft){return ge(Ft)}se.loaded={};var dr={};if(Ge){var Dt=Ge.finish();Dt&&(dr.resourceTiming={},dr.resourceTiming[Le.source]=JSON.parse(JSON.stringify(Dt)))}ge(null,dr)})}},K.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},K.prototype.reloadTile=function(se,ge){var Le=this.loaded;return Le&&Le[se.uid]?G.prototype.reloadTile.call(this,se,ge):this.loadTile(se,ge)},K.prototype.loadGeoJSON=function(se,ge){if(se.request)v.getJSON(se.request,ge);else{if(typeof se.data!="string")return ge(new Error("Input data given to '"+se.source+"' is not a valid GeoJSON object."));try{return ge(null,JSON.parse(se.data))}catch(Le){return ge(new Error("Input data given to '"+se.source+"' is not a valid GeoJSON object."))}}},K.prototype.removeSource=function(se,ge){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ge()},K.prototype.getClusterExpansionZoom=function(se,ge){try{ge(null,this._geoJSONIndex.getClusterExpansionZoom(se.clusterId))}catch(Le){ge(Le)}},K.prototype.getClusterChildren=function(se,ge){try{ge(null,this._geoJSONIndex.getChildren(se.clusterId))}catch(Le){ge(Le)}},K.prototype.getClusterLeaves=function(se,ge){try{ge(null,this._geoJSONIndex.getLeaves(se.clusterId,se.limit,se.offset))}catch(Le){ge(Le)}},K}(Ce),Ca=function(G){var K=this;this.self=G,this.actor=new v.Actor(G,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:Ce,geojson:Ra},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(se,ge){if(K.workerSourceTypes[se])throw new Error('Worker source with name "'+se+'" already registered.');K.workerSourceTypes[se]=ge},this.self.registerRTLTextPlugin=function(se){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=se.applyArabicShaping,v.plugin.processBidirectionalText=se.processBidirectionalText,v.plugin.processStyledBidirectionalText=se.processStyledBidirectionalText}};return Ca.prototype.setReferrer=function(G,K){this.referrer=K},Ca.prototype.setImages=function(G,K,se){for(var ge in this.availableImages[G]=K,this.workerSources[G]){var Le=this.workerSources[G][ge];for(var Ge in Le)Le[Ge].availableImages=K}se()},Ca.prototype.setLayers=function(G,K,se){this.getLayerIndex(G).replace(K),se()},Ca.prototype.updateLayers=function(G,K,se){this.getLayerIndex(G).update(K.layers,K.removedIds),se()},Ca.prototype.loadTile=function(G,K,se){this.getWorkerSource(G,K.type,K.source).loadTile(K,se)},Ca.prototype.loadDEMTile=function(G,K,se){this.getDEMWorkerSource(G,K.source).loadTile(K,se)},Ca.prototype.reloadTile=function(G,K,se){this.getWorkerSource(G,K.type,K.source).reloadTile(K,se)},Ca.prototype.abortTile=function(G,K,se){this.getWorkerSource(G,K.type,K.source).abortTile(K,se)},Ca.prototype.removeTile=function(G,K,se){this.getWorkerSource(G,K.type,K.source).removeTile(K,se)},Ca.prototype.removeDEMTile=function(G,K){this.getDEMWorkerSource(G,K.source).removeTile(K)},Ca.prototype.removeSource=function(G,K,se){if(this.workerSources[G]&&this.workerSources[G][K.type]&&this.workerSources[G][K.type][K.source]){var ge=this.workerSources[G][K.type][K.source];delete this.workerSources[G][K.type][K.source],ge.removeSource!==void 0?ge.removeSource(K,se):se()}},Ca.prototype.loadWorkerSource=function(G,K,se){try{this.self.importScripts(K.url),se()}catch(ge){se(ge.toString())}},Ca.prototype.syncRTLPluginState=function(G,K,se){try{v.plugin.setState(K);var ge=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&ge!=null){this.self.importScripts(ge);var Le=v.plugin.isParsed();se(Le?void 0:new Error("RTL Text Plugin failed to import scripts from "+ge),Le)}}catch(Ge){se(Ge.toString())}},Ca.prototype.getAvailableImages=function(G){var K=this.availableImages[G];return K||(K=[]),K},Ca.prototype.getLayerIndex=function(G){var K=this.layerIndexes[G];return K||(K=this.layerIndexes[G]=new Q),K},Ca.prototype.getWorkerSource=function(G,K,se){var ge=this;return this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][K]||(this.workerSources[G][K]={}),this.workerSources[G][K][se]||(this.workerSources[G][K][se]=new this.workerSourceTypes[K]({send:function(Le,Ge,rt){ge.actor.send(Le,Ge,rt,G)}},this.getLayerIndex(G),this.getAvailableImages(G))),this.workerSources[G][K][se]},Ca.prototype.getDEMWorkerSource=function(G,K){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][K]||(this.demWorkerSources[G][K]=new Pt),this.demWorkerSources[G][K]},Ca.prototype.enforceCacheSizeLimit=function(G,K){v.enforceCacheSizeLimit(K)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ca(self)),Ca}),$(["./shared"],function(v){"use strict";var ee=v.createCommonjsModule(function(l){function f(b){return!c(b)}function c(b){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var A,L,Z=new Blob([""],{type:"text/javascript"}),V=URL.createObjectURL(Z);try{L=new Worker(V),A=!0}catch(le){A=!1}return L&&L.terminate(),URL.revokeObjectURL(V),A}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var A=document.createElement("canvas");A.width=A.height=1;var L=A.getContext("2d");if(!L)return!1;var Z=L.getImageData(0,0,1,1);return Z&&Z.width===A.width}()?(d[C=b&&b.failIfMajorPerformanceCaveat]===void 0&&(d[C]=function(A){var L=function(V){var le=document.createElement("canvas"),fe=Object.create(f.webGLContextAttributes);return fe.failIfMajorPerformanceCaveat=V,le.probablySupportsContext?le.probablySupportsContext("webgl",fe)||le.probablySupportsContext("experimental-webgl",fe):le.supportsContext?le.supportsContext("webgl",fe)||le.supportsContext("experimental-webgl",fe):le.getContext("webgl",fe)||le.getContext("experimental-webgl",fe)}(A);if(!L)return!1;var Z=L.createShader(L.VERTEX_SHADER);return!(!Z||L.isContextLost())&&(L.shaderSource(Z,"void main() {}"),L.compileShader(Z),L.getShaderParameter(Z,L.COMPILE_STATUS)===!0)}(C)),d[C]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var C}l.exports?l.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=c);var d={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),F={create:function(l,f,c){var d=v.window.document.createElement(l);return f!==void 0&&(d.className=f),c&&c.appendChild(d),d},createNS:function(l,f){return v.window.document.createElementNS(l,f)}},Q=v.window.document&&v.window.document.documentElement.style;function re(l){if(!Q)return l[0];for(var f=0;f<l.length;f++)if(l[f]in Q)return l[f];return l[0]}var Ee,ne=re(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);F.disableDrag=function(){Q&&ne&&(Ee=Q[ne],Q[ne]="none")},F.enableDrag=function(){Q&&ne&&(Q[ne]=Ee)};var je=re(["transform","WebkitTransform"]);F.setTransform=function(l,f){l.style[je]=f};var Ce=!1;try{var et=Object.defineProperty({},"passive",{get:function(){Ce=!0}});v.window.addEventListener("test",et,et),v.window.removeEventListener("test",et,et)}catch(l){Ce=!1}F.addEventListener=function(l,f,c,d){d===void 0&&(d={}),l.addEventListener(f,c,"passive"in d&&Ce?d:d.capture)},F.removeEventListener=function(l,f,c,d){d===void 0&&(d={}),l.removeEventListener(f,c,"passive"in d&&Ce?d:d.capture)};var Pt=function(l){l.preventDefault(),l.stopPropagation(),v.window.removeEventListener("click",Pt,!0)};function nr(l){var f=l.userImage;return!!(f&&f.render&&f.render())&&(l.data.replace(new Uint8Array(f.data.buffer)),!0)}F.suppressClick=function(){v.window.addEventListener("click",Pt,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",Pt,!0)},0)},F.mousePos=function(l,f){var c=l.getBoundingClientRect();return new v.Point(f.clientX-c.left-l.clientLeft,f.clientY-c.top-l.clientTop)},F.touchPos=function(l,f){for(var c=l.getBoundingClientRect(),d=[],b=0;b<f.length;b++)d.push(new v.Point(f[b].clientX-c.left-l.clientLeft,f[b].clientY-c.top-l.clientTop));return d},F.mouseButton=function(l){return v.window.InstallTrigger!==void 0&&l.button===2&&l.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:l.button},F.remove=function(l){l.parentNode&&l.parentNode.removeChild(l)};var xt=function(l){function f(){l.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(c){if(this.loaded!==c&&(this.loaded=c,c)){for(var d=0,b=this.requestors;d<b.length;d+=1){var C=b[d];this._notify(C.ids,C.callback)}this.requestors=[]}},f.prototype.getImage=function(c){return this.images[c]},f.prototype.addImage=function(c,d){this._validate(c,d)&&(this.images[c]=d)},f.prototype._validate=function(c,d){var b=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchX" value'))),b=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "stretchY" value'))),b=!1),this._validateContent(d.content,d)||(this.fire(new v.ErrorEvent(new Error('Image "'+c+'" has invalid "content" value'))),b=!1),b},f.prototype._validateStretch=function(c,d){if(!c)return!0;for(var b=0,C=0,A=c;C<A.length;C+=1){var L=A[C];if(L[0]<b||L[1]<L[0]||d<L[1])return!1;b=L[1]}return!0},f.prototype._validateContent=function(c,d){return!(c&&(c.length!==4||c[0]<0||d.data.width<c[0]||c[1]<0||d.data.height<c[1]||c[2]<0||d.data.width<c[2]||c[3]<0||d.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))},f.prototype.updateImage=function(c,d){d.version=this.images[c].version+1,this.images[c]=d,this.updatedImages[c]=!0},f.prototype.removeImage=function(c){var d=this.images[c];delete this.images[c],delete this.patterns[c],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(c,d){var b=!0;if(!this.isLoaded())for(var C=0,A=c;C<A.length;C+=1)this.images[A[C]]||(b=!1);this.isLoaded()||b?this._notify(c,d):this.requestors.push({ids:c,callback:d})},f.prototype._notify=function(c,d){for(var b={},C=0,A=c;C<A.length;C+=1){var L=A[C];this.images[L]||this.fire(new v.Event("styleimagemissing",{id:L}));var Z=this.images[L];Z?b[L]={data:Z.data.clone(),pixelRatio:Z.pixelRatio,sdf:Z.sdf,version:Z.version,stretchX:Z.stretchX,stretchY:Z.stretchY,content:Z.content,hasRenderCallback:Boolean(Z.userImage&&Z.userImage.render)}:v.warnOnce('Image "'+L+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}d(null,b)},f.prototype.getPixelSize=function(){var c=this.atlasImage;return{width:c.width,height:c.height}},f.prototype.getPattern=function(c){var d=this.patterns[c],b=this.getImage(c);if(!b)return null;if(d&&d.position.version===b.version)return d.position;if(d)d.position.version=b.version;else{var C={w:b.data.width+2,h:b.data.height+2,x:0,y:0},A=new v.ImagePosition(C,b);this.patterns[c]={bin:C,position:A}}return this._updatePatternAtlas(),this.patterns[c].position},f.prototype.bind=function(c){var d=c.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(c,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var c=[];for(var d in this.patterns)c.push(this.patterns[d].bin);var b=v.potpack(c),C=b.w,A=b.h,L=this.atlasImage;for(var Z in L.resize({width:C||1,height:A||1}),this.patterns){var V=this.patterns[Z].bin,le=V.x+1,fe=V.y+1,de=this.images[Z].data,ke=de.width,Re=de.height;v.RGBAImage.copy(de,L,{x:0,y:0},{x:le,y:fe},{width:ke,height:Re}),v.RGBAImage.copy(de,L,{x:0,y:Re-1},{x:le,y:fe-1},{width:ke,height:1}),v.RGBAImage.copy(de,L,{x:0,y:0},{x:le,y:fe+Re},{width:ke,height:1}),v.RGBAImage.copy(de,L,{x:ke-1,y:0},{x:le-1,y:fe},{width:1,height:Re}),v.RGBAImage.copy(de,L,{x:0,y:0},{x:le+ke,y:fe},{width:1,height:Re})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(c){for(var d=0,b=c;d<b.length;d+=1){var C=b[d];if(!this.callbackDispatchedThisFrame[C]){this.callbackDispatchedThisFrame[C]=!0;var A=this.images[C];nr(A)&&this.updateImage(C,A)}}},f}(v.Evented),Wt=ut,wt=ut,st=1e20;function ut(l,f,c,d,b,C){this.fontSize=l||24,this.buffer=f===void 0?3:f,this.cutoff=d||.25,this.fontFamily=b||"sans-serif",this.fontWeight=C||"normal",this.radius=c||8;var A=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=A,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(A*A),this.gridInner=new Float64Array(A*A),this.f=new Float64Array(A),this.d=new Float64Array(A),this.z=new Float64Array(A+1),this.v=new Int16Array(A),this.middle=Math.round(A/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Jt(l,f,c,d,b,C,A){for(var L=0;L<f;L++){for(var Z=0;Z<c;Z++)d[Z]=l[Z*f+L];for(X(d,b,C,A,c),Z=0;Z<c;Z++)l[Z*f+L]=b[Z]}for(Z=0;Z<c;Z++){for(L=0;L<f;L++)d[L]=l[Z*f+L];for(X(d,b,C,A,f),L=0;L<f;L++)l[Z*f+L]=Math.sqrt(b[L])}}function X(l,f,c,d,b){c[0]=0,d[0]=-st,d[1]=+st;for(var C=1,A=0;C<b;C++){for(var L=(l[C]+C*C-(l[c[A]]+c[A]*c[A]))/(2*C-2*c[A]);L<=d[A];)A--,L=(l[C]+C*C-(l[c[A]]+c[A]*c[A]))/(2*C-2*c[A]);c[++A]=C,d[A]=L,d[A+1]=+st}for(C=0,A=0;C<b;C++){for(;d[A+1]<C;)A++;f[C]=(C-c[A])*(C-c[A])+l[c[A]]}}ut.prototype.draw=function(l){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(l,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),c=new Uint8ClampedArray(this.size*this.size),d=0;d<this.size*this.size;d++){var b=f.data[4*d+3]/255;this.gridOuter[d]=b===1?0:b===0?st:Math.pow(Math.max(0,.5-b),2),this.gridInner[d]=b===1?st:b===0?0:Math.pow(Math.max(0,b-.5),2)}for(Jt(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Jt(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),d=0;d<this.size*this.size;d++)c[d]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[d]-this.gridInner[d])/this.radius+this.cutoff))));return c},Wt.default=wt;var Xt=function(l,f){this.requestManager=l,this.localIdeographFontFamily=f,this.entries={}};Xt.prototype.setURL=function(l){this.url=l},Xt.prototype.getGlyphs=function(l,f){var c=this,d=[];for(var b in l)for(var C=0,A=l[b];C<A.length;C+=1)d.push({stack:b,id:A[C]});v.asyncAll(d,function(L,Z){var V=L.stack,le=L.id,fe=c.entries[V];fe||(fe=c.entries[V]={glyphs:{},requests:{},ranges:{}});var de=fe.glyphs[le];if(de===void 0){if(de=c._tinySDF(fe,V,le))return fe.glyphs[le]=de,void Z(null,{stack:V,id:le,glyph:de});var ke=Math.floor(le/256);if(256*ke>65535)Z(new Error("glyphs > 65535 not supported"));else if(fe.ranges[ke])Z(null,{stack:V,id:le,glyph:de});else{var Re=fe.requests[ke];Re||(Re=fe.requests[ke]=[],Xt.loadGlyphRange(V,ke,c.url,c.requestManager,function(He,Ae){if(Ae){for(var We in Ae)c._doesCharSupportLocalGlyph(+We)||(fe.glyphs[+We]=Ae[+We]);fe.ranges[ke]=!0}for(var tt=0,bt=Re;tt<bt.length;tt+=1)(0,bt[tt])(He,Ae);delete fe.requests[ke]})),Re.push(function(He,Ae){He?Z(He):Ae&&Z(null,{stack:V,id:le,glyph:Ae[le]||null})})}}else Z(null,{stack:V,id:le,glyph:de})},function(L,Z){if(L)f(L);else if(Z){for(var V={},le=0,fe=Z;le<fe.length;le+=1){var de=fe[le],ke=de.stack,Re=de.id,He=de.glyph;(V[ke]||(V[ke]={}))[Re]=He&&{id:He.id,bitmap:He.bitmap.clone(),metrics:He.metrics}}f(null,V)}})},Xt.prototype._doesCharSupportLocalGlyph=function(l){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](l)||v.isChar["Hangul Syllables"](l)||v.isChar.Hiragana(l)||v.isChar.Katakana(l))},Xt.prototype._tinySDF=function(l,f,c){var d=this.localIdeographFontFamily;if(d&&this._doesCharSupportLocalGlyph(c)){var b=l.tinySDF;if(!b){var C="400";/bold/i.test(f)?C="900":/medium/i.test(f)?C="500":/light/i.test(f)&&(C="200"),b=l.tinySDF=new Xt.TinySDF(24,3,8,.25,d,C)}return{id:c,bitmap:new v.AlphaImage({width:30,height:30},b.draw(String.fromCharCode(c))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Xt.loadGlyphRange=function(l,f,c,d,b){var C=256*f,A=C+255,L=d.transformRequest(d.normalizeGlyphsURL(c).replace("{fontstack}",l).replace("{range}",C+"-"+A),v.ResourceType.Glyphs);v.getArrayBuffer(L,function(Z,V){if(Z)b(Z);else if(V){for(var le={},fe=0,de=v.parseGlyphPBF(V);fe<de.length;fe+=1){var ke=de[fe];le[ke.id]=ke}b(null,le)}})},Xt.TinySDF=Wt;var vt=function(){this.specification=v.styleSpec.light.position};vt.prototype.possiblyEvaluate=function(l,f){return v.sphericalToCartesian(l.expression.evaluate(f))},vt.prototype.interpolate=function(l,f,c){return{x:v.number(l.x,f.x,c),y:v.number(l.y,f.y,c),z:v.number(l.z,f.z,c)}};var qe=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new vt,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),pt=function(l){function f(c){l.call(this),this._transitionable=new v.Transitionable(qe),this.setLight(c),this._transitioning=this._transitionable.untransitioned()}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(c,d){if(d===void 0&&(d={}),!this._validate(v.validateLight,c,d))for(var b in c){var C=c[b];v.endsWith(b,"-transition")?this._transitionable.setTransition(b.slice(0,-"-transition".length),C):this._transitionable.setValue(b,C)}},f.prototype.updateTransitions=function(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(c){this.properties=this._transitioning.possiblyEvaluate(c)},f.prototype._validate=function(c,d,b){return(!b||b.validate!==!1)&&v.emitValidationErrors(this,c.call(v.validateStyle,v.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},f}(v.Evented),$e=function(l,f){this.width=l,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};$e.prototype.getDash=function(l,f){var c=l.join(",")+String(f);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(l,f)),this.dashEntry[c]},$e.prototype.getDashRanges=function(l,f,c){var d=[],b=l.length%2==1?-l[l.length-1]*c:0,C=l[0]*c,A=!0;d.push({left:b,right:C,isDash:A,zeroLength:l[0]===0});for(var L=l[0],Z=1;Z<l.length;Z++){var V=l[Z];d.push({left:b=L*c,right:C=(L+=V)*c,isDash:A=!A,zeroLength:V===0})}return d},$e.prototype.addRoundDash=function(l,f,c){for(var d=f/2,b=-c;b<=c;b++)for(var C=this.width*(this.nextRow+c+b),A=0,L=l[A],Z=0;Z<this.width;Z++){Z/L.right>1&&(L=l[++A]);var V=Math.abs(Z-L.left),le=Math.abs(Z-L.right),fe=Math.min(V,le),de=void 0,ke=b/c*(d+1);if(L.isDash){var Re=d-Math.abs(ke);de=Math.sqrt(fe*fe+Re*Re)}else de=d-Math.sqrt(fe*fe+ke*ke);this.data[C+Z]=Math.max(0,Math.min(255,de+128))}},$e.prototype.addRegularDash=function(l){for(var f=l.length-1;f>=0;--f){var c=l[f],d=l[f+1];c.zeroLength?l.splice(f,1):d&&d.isDash===c.isDash&&(d.left=c.left,l.splice(f,1))}var b=l[0],C=l[l.length-1];b.isDash===C.isDash&&(b.left=C.left-this.width,C.right=b.right+this.width);for(var A=this.width*this.nextRow,L=0,Z=l[L],V=0;V<this.width;V++){V/Z.right>1&&(Z=l[++L]);var le=Math.abs(V-Z.left),fe=Math.abs(V-Z.right),de=Math.min(le,fe);this.data[A+V]=Math.max(0,Math.min(255,(Z.isDash?de:-de)+128))}},$e.prototype.addDash=function(l,f){var c=f?7:0,d=2*c+1;if(this.nextRow+d>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var b=0,C=0;C<l.length;C++)b+=l[C];if(b!==0){var A=this.width/b,L=this.getDashRanges(l,this.width,A);f?this.addRoundDash(L,A,c):this.addRegularDash(L)}var Z={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:b};return this.nextRow+=d,this.dirty=!0,Z},$e.prototype.bind=function(l){var f=l.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var kt=function l(f,c){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var d=this.workerPool.acquire(this.id),b=0;b<d.length;b++){var C=new l.Actor(d[b],c,this.id);C.name="Worker "+b,this.actors.push(C)}};function xr(l,f,c){var d=function(b,C){if(b)return c(b);if(C){var A=v.pick(v.extend(C,l),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);C.vector_layers&&(A.vectorLayers=C.vector_layers,A.vectorLayerIds=A.vectorLayers.map(function(L){return L.id})),A.tiles=f.canonicalizeTileset(A,l.url),c(null,A)}};return l.url?v.getJSON(f.transformRequest(f.normalizeSourceURL(l.url),v.ResourceType.Source),d):v.browser.frame(function(){return d(null,l)})}kt.prototype.broadcast=function(l,f,c){v.asyncAll(this.actors,function(d,b){d.send(l,f,b)},c=c||function(){})},kt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},kt.prototype.remove=function(){this.actors.forEach(function(l){l.remove()}),this.actors=[],this.workerPool.release(this.id)},kt.Actor=v.Actor;var Ir=function(l,f,c){this.bounds=v.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=f||0,this.maxzoom=c||24};Ir.prototype.validateBounds=function(l){return Array.isArray(l)&&l.length===4?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]},Ir.prototype.contains=function(l){var f=Math.pow(2,l.z),c=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*f),d=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*f),b=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*f),C=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*f);return l.x>=c&&l.x<b&&l.y>=d&&l.y<C};var Wr=function(l){function f(c,d,b,C){if(l.call(this),this.id=c,this.dispatcher=b,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(d,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(C)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(d,b){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):b&&(v.extend(c,b),b.bounds&&(c.tileBounds=new Ir(b.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(b.tiles,c.map._requestManager._customAccessToken),v.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken,c.map._requestManager._customAccessToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setSourceProperty=function(c){this._tileJSONRequest&&this._tileJSONRequest.cancel(),c(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(c){var d=this;return this.setSourceProperty(function(){d._options.tiles=c}),this},f.prototype.setUrl=function(c){var d=this;return this.setSourceProperty(function(){d.url=c,d._options.url=c}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.loadTile=function(c,d){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),C={request:this.map._requestManager.transformRequest(b,v.ResourceType.Tile),uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function A(L,Z){return delete c.request,c.aborted?d(null):L&&L.status!==404?d(L):(Z&&Z.resourceTiming&&(c.resourceTiming=Z.resourceTiming),this.map._refreshExpiredTiles&&Z&&c.setExpiryData(Z),c.loadVectorData(Z,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),d(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}C.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired"?c.state==="loading"?c.reloadCallback=d:c.request=c.actor.send("reloadTile",C,A.bind(this)):(c.actor=this.dispatcher.getActor(),c.request=c.actor.send("loadTile",C,A.bind(this)))},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(c){c.unloadVectorData(),c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Me=function(l){function f(c,d,b,C){l.call(this),this.id=c,this.dispatcher=b,this.setEventedParent(C),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},d),v.extend(this,v.pick(d,["url","scheme","tileSize"]))}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(d,b){c._tileJSONRequest=null,c._loaded=!0,d?c.fire(new v.ErrorEvent(d)):b&&(v.extend(c,b),b.bounds&&(c.tileBounds=new Ir(b.bounds,c.minzoom,c.maxzoom)),v.postTurnstileEvent(b.tiles),v.postMapLoadEvent(b.tiles,c.map._getMapId(),c.map._requestManager._skuToken),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),c.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.hasTile=function(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)},f.prototype.loadTile=function(c,d){var b=this,C=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);c.request=v.getImage(this.map._requestManager.transformRequest(C,v.ResourceType.Tile),function(A,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(A)c.state="errored",d(A);else if(L){b.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var Z=b.map.painter.context,V=Z.gl;c.texture=b.map.painter.getTileTexture(L.width),c.texture?c.texture.update(L,{useMipmap:!0}):(c.texture=new v.Texture(Z,L,V.RGBA,{useMipmap:!0}),c.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST),Z.extTextureFilterAnisotropic&&V.texParameterf(V.TEXTURE_2D,Z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Z.extTextureFilterAnisotropicMax)),c.state="loaded",v.cacheEntryPossiblyAdded(b.dispatcher),d(null)}})},f.prototype.abortTile=function(c,d){c.request&&(c.request.cancel(),delete c.request),d()},f.prototype.unloadTile=function(c,d){c.texture&&this.map.painter.saveTileTexture(c.texture),d()},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Ye=function(l){function f(c,d,b,C){l.call(this,c,d,b,C),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox"}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(c,d){var b=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function C(A,L){A&&(c.state="errored",d(A)),L&&(c.dem=L,c.needsHillshadePrepare=!0,c.state="loaded",d(null))}c.request=v.getImage(this.map._requestManager.transformRequest(b,v.ResourceType.Tile),function(A,L){if(delete c.request,c.aborted)c.state="unloaded",d(null);else if(A)c.state="errored",d(A);else if(L){this.map._refreshExpiredTiles&&c.setExpiryData(L),delete L.cacheControl,delete L.expires;var Z=v.window.ImageBitmap&&L instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?L:v.browser.getImageData(L,1),V={uid:c.uid,coord:c.tileID,source:this.id,rawImageData:Z,encoding:this.encoding};c.actor&&c.state!=="expired"||(c.actor=this.dispatcher.getActor(),c.actor.send("loadDEMTile",V,C.bind(this)))}}.bind(this)),c.neighboringTiles=this._getNeighboringTiles(c.tileID)},f.prototype._getNeighboringTiles=function(c){var d=c.canonical,b=Math.pow(2,d.z),C=(d.x-1+b)%b,A=d.x===0?c.wrap-1:c.wrap,L=(d.x+1+b)%b,Z=d.x+1===b?c.wrap+1:c.wrap,V={};return V[new v.OverscaledTileID(c.overscaledZ,A,d.z,C,d.y).key]={backfilled:!1},V[new v.OverscaledTileID(c.overscaledZ,Z,d.z,L,d.y).key]={backfilled:!1},d.y>0&&(V[new v.OverscaledTileID(c.overscaledZ,A,d.z,C,d.y-1).key]={backfilled:!1},V[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},V[new v.OverscaledTileID(c.overscaledZ,Z,d.z,L,d.y-1).key]={backfilled:!1}),d.y+1<b&&(V[new v.OverscaledTileID(c.overscaledZ,A,d.z,C,d.y+1).key]={backfilled:!1},V[new v.OverscaledTileID(c.overscaledZ,c.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},V[new v.OverscaledTileID(c.overscaledZ,Z,d.z,L,d.y+1).key]={backfilled:!1}),V},f.prototype.unloadTile=function(c){c.demTexture&&this.map.painter.saveTileTexture(c.demTexture),c.fbo&&(c.fbo.destroy(),delete c.fbo),c.dem&&delete c.dem,delete c.neighboringTiles,c.state="unloaded",c.actor&&c.actor.send("removeDEMTile",{uid:c.uid,source:this.id})},f}(Me),Fe=function(l){function f(c,d,b,C){l.call(this),this.id=c,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=b.getActor(),this.setEventedParent(C),this._data=d.data,this._options=v.extend({},d),this._collectResourceTiming=d.collectResourceTiming,this._resourceTiming=[],d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;var A=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*A,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*A,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?Math.min(d.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:v.EXTENT,radius:(d.clusterRadius||50)*A,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(d){if(d)c.fire(new v.ErrorEvent(d));else{var b={dataType:"source",sourceDataType:"metadata"};c._collectResourceTiming&&c._resourceTiming&&c._resourceTiming.length>0&&(b.resourceTiming=c._resourceTiming,c._resourceTiming=[]),c.fire(new v.Event("data",b))}})},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setData=function(c){var d=this;return this._data=c,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(b){if(b)d.fire(new v.ErrorEvent(b));else{var C={dataType:"source",sourceDataType:"content"};d._collectResourceTiming&&d._resourceTiming&&d._resourceTiming.length>0&&(C.resourceTiming=d._resourceTiming,d._resourceTiming=[]),d.fire(new v.Event("data",C))}}),this},f.prototype.getClusterExpansionZoom=function(c,d){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:c,source:this.id},d),this},f.prototype.getClusterChildren=function(c,d){return this.actor.send("geojson.getClusterChildren",{clusterId:c,source:this.id},d),this},f.prototype.getClusterLeaves=function(c,d,b,C){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:c,limit:d,offset:b},C),this},f.prototype._updateWorkerData=function(c){var d=this;this._loaded=!1;var b=v.extend({},this.workerOptions),C=this._data;typeof C=="string"?(b.request=this.map._requestManager.transformRequest(v.browser.resolveURL(C),v.ResourceType.Source),b.request.collectResourceTiming=this._collectResourceTiming):b.data=JSON.stringify(C),this.actor.send(this.type+".loadData",b,function(A,L){d._removed||L&&L.abandoned||(d._loaded=!0,L&&L.resourceTiming&&L.resourceTiming[d.id]&&(d._resourceTiming=L.resourceTiming[d.id].slice(0)),d.actor.send(d.type+".coalesce",{source:b.source},null),c(A))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(c,d){var b=this,C=c.actor?"reloadTile":"loadTile";c.actor=this.actor,c.request=this.actor.send(C,{type:this.type,uid:c.uid,tileID:c.tileID,zoom:c.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(A,L){return delete c.request,c.unloadVectorData(),c.aborted?d(null):A?d(A):(c.loadVectorData(L,b.map.painter,C==="reloadTile"),d(null))})},f.prototype.abortTile=function(c){c.request&&(c.request.cancel(),delete c.request),c.aborted=!0},f.prototype.unloadTile=function(c){c.unloadVectorData(),this.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(v.Evented),At=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),gt=function(l){function f(c,d,b,C){l.call(this),this.id=c,this.dispatcher=b,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(C),this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(c,d){var b=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(C,A){b._loaded=!0,C?b.fire(new v.ErrorEvent(C)):A&&(b.image=A,c&&(b.coordinates=c),d&&d(),b._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(c){var d=this;return this.image&&c.url?(this.options.url=c.url,this.load(c.coordinates,function(){d.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(c){this.map=c,this.load()},f.prototype.setCoordinates=function(c){var d=this;this.coordinates=c;var b=c.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(A){for(var L=1/0,Z=1/0,V=-1/0,le=-1/0,fe=0,de=A;fe<de.length;fe+=1){var ke=de[fe];L=Math.min(L,ke.x),Z=Math.min(Z,ke.y),V=Math.max(V,ke.x),le=Math.max(le,ke.y)}var Re=Math.max(V-L,le-Z),He=Math.max(0,Math.floor(-Math.log(Re)/Math.LN2)),Ae=Math.pow(2,He);return new v.CanonicalTileID(He,Math.floor((L+V)/2*Ae),Math.floor((Z+le)/2*Ae))}(b),this.minzoom=this.maxzoom=this.tileID.z;var C=b.map(function(A){return d.tileID.getTilePoint(A)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(C[0].x,C[0].y,0,0),this._boundsArray.emplaceBack(C[1].x,C[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(C[3].x,C[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(C[2].x,C[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var c=this.map.painter.context,d=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,At.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(c,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[b];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},f.prototype.loadTile=function(c,d){this.tileID&&this.tileID.equals(c.tileID.canonical)?(this.tiles[String(c.tileID.wrap)]=c,c.buckets={},d(null)):(c.state="errored",d(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Nt=function(l){function f(c,d,b,C){l.call(this,c,d,b,C),this.roundZoom=!0,this.type="video",this.options=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){var c=this;this._loaded=!1;var d=this.options;this.urls=[];for(var b=0,C=d.urls;b<C.length;b+=1)this.urls.push(this.map._requestManager.transformRequest(C[b],v.ResourceType.Source).url);v.getVideo(this.urls,function(A,L){c._loaded=!0,A?c.fire(new v.ErrorEvent(A)):L&&(c.video=L,c.video.loop=!0,c.video.addEventListener("playing",function(){c.map.triggerRepaint()}),c.map&&c.video.play(),c._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(c){if(this.video){var d=this.video.seekable;c<d.start(0)||c>d.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+d.start(0)+" and "+d.end(0)+"-second mark."))):this.video.currentTime=c}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(c){this.map||(this.map=c,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var c=this.map.painter.context,d=c.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,At.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(c,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this.tiles){var C=this.tiles[b];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(gt),qt=function(l){function f(c,d,b,C){l.call(this,c,d,b,C),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(function(A){return!Array.isArray(A)||A.length!==2||A.some(function(L){return typeof L!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+c,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(c){this.map=c,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var c=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,c=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,c=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var d=this.map.painter.context,b=d.gl;for(var C in this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,At.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(c||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(d,this.canvas,b.RGBA,{premultiply:!0}),this.tiles){var A=this.tiles[C];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var c=0,d=[this.canvas.width,this.canvas.height];c<d.length;c+=1){var b=d[c];if(isNaN(b)||b<=0)return!0}return!1},f}(gt),Cr={vector:Wr,raster:Me,"raster-dem":Ye,geojson:Fe,video:Nt,image:gt,canvas:qt};function Wn(l,f){var c=v.identity([]);return v.translate(c,c,[1,1,0]),v.scale(c,c,[.5*l.width,.5*l.height,1]),v.multiply(c,c,l.calculatePosMatrix(f.toUnwrapped()))}function hn(l,f,c,d,b,C){var A=function(He,Ae,We){if(He)for(var tt=0,bt=He;tt<bt.length;tt+=1){var Yt=Ae[bt[tt]];if(Yt&&Yt.source===We&&Yt.type==="fill-extrusion")return!0}else for(var zt in Ae){var $t=Ae[zt];if($t.source===We&&$t.type==="fill-extrusion")return!0}return!1}(b&&b.layers,f,l.id),L=C.maxPitchScaleFactor(),Z=l.tilesIn(d,L,A);Z.sort(Yi);for(var V=[],le=0,fe=Z;le<fe.length;le+=1){var de=fe[le];V.push({wrappedTileID:de.tileID.wrapped().key,queryResults:de.tile.queryRenderedFeatures(f,c,l._state,de.queryGeometry,de.cameraQueryGeometry,de.scale,b,C,L,Wn(l.transform,de.tileID))})}var ke=function(He){for(var Ae={},We={},tt=0,bt=He;tt<bt.length;tt+=1){var Yt=bt[tt],zt=Yt.queryResults,$t=Yt.wrappedTileID,gr=We[$t]=We[$t]||{};for(var Br in zt)for(var Fr=zt[Br],sn=gr[Br]=gr[Br]||{},kn=Ae[Br]=Ae[Br]||[],Dn=0,zn=Fr;Dn<zn.length;Dn+=1){var ci=zn[Dn];sn[ci.featureIndex]||(sn[ci.featureIndex]=!0,kn.push(ci))}}return Ae}(V);for(var Re in ke)ke[Re].forEach(function(He){var Ae=He.feature,We=l.getFeatureState(Ae.layer["source-layer"],Ae.id);Ae.source=Ae.layer.source,Ae.layer["source-layer"]&&(Ae.sourceLayer=Ae.layer["source-layer"]),Ae.state=We});return ke}function Yi(l,f){var c=l.tileID,d=f.tileID;return c.overscaledZ-d.overscaledZ||c.canonical.y-d.canonical.y||c.wrap-d.wrap||c.canonical.x-d.canonical.x}var Un=function(l,f){this.max=l,this.onRemove=f,this.reset()};Un.prototype.reset=function(){for(var l in this.data)for(var f=0,c=this.data[l];f<c.length;f+=1){var d=c[f];d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value)}return this.data={},this.order=[],this},Un.prototype.add=function(l,f,c){var d=this,b=l.wrapped().key;this.data[b]===void 0&&(this.data[b]=[]);var C={value:f,timeout:void 0};if(c!==void 0&&(C.timeout=setTimeout(function(){d.remove(l,C)},c)),this.data[b].push(C),this.order.push(b),this.order.length>this.max){var A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this},Un.prototype.has=function(l){return l.wrapped().key in this.data},Un.prototype.getAndRemove=function(l){return this.has(l)?this._getAndRemoveByKey(l.wrapped().key):null},Un.prototype._getAndRemoveByKey=function(l){var f=this.data[l].shift();return f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.order.splice(this.order.indexOf(l),1),f.value},Un.prototype.getByKey=function(l){var f=this.data[l];return f?f[0].value:null},Un.prototype.get=function(l){return this.has(l)?this.data[l.wrapped().key][0].value:null},Un.prototype.remove=function(l,f){if(!this.has(l))return this;var c=l.wrapped().key,d=f===void 0?0:this.data[c].indexOf(f),b=this.data[c][d];return this.data[c].splice(d,1),b.timeout&&clearTimeout(b.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(b.value),this.order.splice(this.order.indexOf(c),1),this},Un.prototype.setMaxSize=function(l){for(this.max=l;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},Un.prototype.filter=function(l){var f=[];for(var c in this.data)for(var d=0,b=this.data[c];d<b.length;d+=1){var C=b[d];l(C.value)||f.push(C)}for(var A=0,L=f;A<L.length;A+=1){var Z=L[A];this.remove(Z.value.tileID,Z)}};var Gn=function(l,f,c){this.context=l;var d=l.gl;this.buffer=d.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Gn.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Gn.prototype.updateData=function(l){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)},Gn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var di={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Xn=function(l,f,c,d){this.length=f.length,this.attributes=c,this.itemSize=f.bytesPerElement,this.dynamicDraw=d,this.context=l;var b=l.gl;this.buffer=b.createBuffer(),l.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Xn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Xn.prototype.updateData=function(l){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,l.arrayBuffer)},Xn.prototype.enableAttributes=function(l,f){for(var c=0;c<this.attributes.length;c++){var d=f.attributes[this.attributes[c].name];d!==void 0&&l.enableVertexAttribArray(d)}},Xn.prototype.setVertexAttribPointers=function(l,f,c){for(var d=0;d<this.attributes.length;d++){var b=this.attributes[d],C=f.attributes[b.name];C!==void 0&&l.vertexAttribPointer(C,b.components,l[di[b.type]],!1,this.itemSize,b.offset+this.itemSize*(c||0))}},Xn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var ai=function(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};ai.prototype.get=function(){return this.current},ai.prototype.set=function(l){},ai.prototype.getDefault=function(){return this.default},ai.prototype.setDefault=function(){this.set(this.default)};var aa=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(ai),Ri=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)},f}(ai),Ei=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)},f}(ai),ji=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(ai),ua=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)},f}(ai),Si=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)},f}(ai),ba=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(c){var d=this.current;(c.func!==d.func||c.ref!==d.ref||c.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)},f}(ai),Mn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)},f}(ai),_i=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=c,this.dirty=!1}},f}(ai),Ui=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)},f}(ai),qi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=c,this.dirty=!1}},f}(ai),Ga=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)},f}(ai),ve=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.BLEND):d.disable(d.BLEND),this.current=c,this.dirty=!1}},f}(ai),Ln=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[c.ONE,c.ZERO]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(c[0],c[1]),this.current=c,this.dirty=!1)},f}(ai),Ha=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(c){var d=this.current;(c.r!==d.r||c.g!==d.g||c.b!==d.b||c.a!==d.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)},f}(ai),os=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.blendEquation(c),this.current=c,this.dirty=!1)},f}(ai),Ut=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;c?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=c,this.dirty=!1}},f}(ai),ir=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)},f}(ai),Pr=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)},f}(ai),I=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.useProgram(c),this.current=c,this.dirty=!1)},f}(ai),or=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)},f}(ai),Rn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){var c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]},f.prototype.set=function(c){var d=this.current;(c[0]!==d[0]||c[1]!==d[1]||c[2]!==d[2]||c[3]!==d[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)},f}(ai),oi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,c),this.current=c,this.dirty=!1}},f}(ai),jn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(ai),nn=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindTexture(d.TEXTURE_2D,c),this.current=c,this.dirty=!1}},f}(ai),Ti=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}},f}(ai),Mi=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){var d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1},f}(ai),$a=function(l){function f(c){l.call(this,c),this.vao=c.extVertexArrayObject}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(c){this.vao&&(c!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(c),this.current=c,this.dirty=!1)},f}(ai),ss=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}},f}(ai),ma=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}},f}(ai),Ra=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(c){if(c!==this.current||this.dirty){var d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}},f}(ai),Ca=function(l){function f(c,d){l.call(this,c),this.context=c,this.parent=d}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(ai),G=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}},f}(Ca),K=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.set=function(c){if(c!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,c),this.current=c,this.dirty=!1}},f}(Ca),se=function(l,f,c,d){this.context=l,this.width=f,this.height=c;var b=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new G(l,b),d&&(this.depthAttachment=new K(l,b))};se.prototype.destroy=function(){var l=this.context.gl,f=this.colorAttachment.get();if(f&&l.deleteTexture(f),this.depthAttachment){var c=this.depthAttachment.get();c&&l.deleteRenderbuffer(c)}l.deleteFramebuffer(this.framebuffer)};var ge=function(l,f,c){this.func=l,this.mask=f,this.range=c};ge.ReadOnly=!1,ge.ReadWrite=!0,ge.disabled=new ge(519,ge.ReadOnly,[0,1]);var Le=function(l,f,c,d,b,C){this.test=l,this.ref=f,this.mask=c,this.fail=d,this.depthFail=b,this.pass=C};Le.disabled=new Le({func:519,mask:0},0,0,7680,7680,7680);var Ge=function(l,f,c){this.blendFunction=l,this.blendColor=f,this.mask=c};Ge.disabled=new Ge(Ge.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),Ge.unblended=new Ge(Ge.Replace,v.Color.transparent,[!0,!0,!0,!0]),Ge.alphaBlended=new Ge([1,771],v.Color.transparent,[!0,!0,!0,!0]);var rt=function(l,f,c){this.enable=l,this.mode=f,this.frontFace=c};rt.disabled=new rt(!1,1029,2305),rt.backCCW=new rt(!0,1029,2305);var pe=function(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new aa(this),this.clearDepth=new Ri(this),this.clearStencil=new Ei(this),this.colorMask=new ji(this),this.depthMask=new ua(this),this.stencilMask=new Si(this),this.stencilFunc=new ba(this),this.stencilOp=new Mn(this),this.stencilTest=new _i(this),this.depthRange=new Ui(this),this.depthTest=new qi(this),this.depthFunc=new Ga(this),this.blend=new ve(this),this.blendFunc=new Ln(this),this.blendColor=new Ha(this),this.blendEquation=new os(this),this.cullFace=new Ut(this),this.cullFaceSide=new ir(this),this.frontFace=new Pr(this),this.program=new I(this),this.activeTexture=new or(this),this.viewport=new Rn(this),this.bindFramebuffer=new oi(this),this.bindRenderbuffer=new jn(this),this.bindTexture=new nn(this),this.bindVertexBuffer=new Ti(this),this.bindElementBuffer=new Mi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new $a(this),this.pixelStoreUnpack=new ss(this),this.pixelStoreUnpackPremultiplyAlpha=new ma(this),this.pixelStoreUnpackFlipY=new Ra(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)};pe.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},pe.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},pe.prototype.createIndexBuffer=function(l,f){return new Gn(this,l,f)},pe.prototype.createVertexBuffer=function(l,f,c){return new Xn(this,l,f,c)},pe.prototype.createRenderbuffer=function(l,f,c){var d=this.gl,b=d.createRenderbuffer();return this.bindRenderbuffer.set(b),d.renderbufferStorage(d.RENDERBUFFER,l,f,c),this.bindRenderbuffer.set(null),b},pe.prototype.createFramebuffer=function(l,f,c){return new se(this,l,f,c)},pe.prototype.clear=function(l){var f=l.color,c=l.depth,d=this.gl,b=0;f&&(b|=d.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=d.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),d.clear(b)},pe.prototype.setCullFace=function(l){l.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))},pe.prototype.setDepthMode=function(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)},pe.prototype.setStencilMode=function(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)},pe.prototype.setColorMode=function(l){v.deepEqual(l.blendFunction,Ge.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)},pe.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Be=function(l){function f(c,d,b){var C=this;l.call(this),this.id=c,this.dispatcher=b,this.on("data",function(A){A.dataType==="source"&&A.sourceDataType==="metadata"&&(C._sourceLoaded=!0),C._sourceLoaded&&!C._paused&&A.dataType==="source"&&A.sourceDataType==="content"&&(C.reload(),C.transform&&C.update(C.transform))}),this.on("error",function(){C._sourceErrored=!0}),this._source=function(A,L,Z,V){var le=new Cr[L.type](A,L,Z,V);if(le.id!==A)throw new Error("Expected Source id to be "+A+" instead of "+le.id);return v.bindAll(["load","abort","unload","serialize","prepare"],le),le}(c,d,b,this),this._tiles={},this._cache=new Un(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){this.map=c,this._maxTileCacheSize=c?c._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(c)},f.prototype.onRemove=function(c){this._source&&this._source.onRemove&&this._source.onRemove(c)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var c in this._tiles){var d=this._tiles[c];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var c=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,c&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(c,d){return this._source.loadTile(c,d)},f.prototype._unloadTile=function(c){if(this._source.unloadTile)return this._source.unloadTile(c,function(){})},f.prototype._abortTile=function(c){if(this._source.abortTile)return this._source.abortTile(c,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(c){for(var d in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var b=this._tiles[d];b.upload(c),b.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return v.values(this._tiles).map(function(c){return c.tileID}).sort(yt).map(function(c){return c.key})},f.prototype.getRenderableIds=function(c){var d=this,b=[];for(var C in this._tiles)this._isIdRenderable(C,c)&&b.push(this._tiles[C]);return c?b.sort(function(A,L){var Z=A.tileID,V=L.tileID,le=new v.Point(Z.canonical.x,Z.canonical.y)._rotate(d.transform.angle),fe=new v.Point(V.canonical.x,V.canonical.y)._rotate(d.transform.angle);return Z.overscaledZ-V.overscaledZ||fe.y-le.y||fe.x-le.x}).map(function(A){return A.tileID.key}):b.map(function(A){return A.tileID}).sort(yt).map(function(A){return A.key})},f.prototype.hasRenderableParent=function(c){var d=this.findLoadedParent(c,0);return!!d&&this._isIdRenderable(d.tileID.key)},f.prototype._isIdRenderable=function(c,d){return this._tiles[c]&&this._tiles[c].hasData()&&!this._coveredTiles[c]&&(d||!this._tiles[c].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var c in this._cache.reset(),this._tiles)this._tiles[c].state!=="errored"&&this._reloadTile(c,"reloading")},f.prototype._reloadTile=function(c,d){var b=this._tiles[c];b&&(b.state!=="loading"&&(b.state=d),this._loadTile(b,this._tileLoaded.bind(this,b,c,d)))},f.prototype._tileLoaded=function(c,d,b,C){if(C)return c.state="errored",void(C.status!==404?this._source.fire(new v.ErrorEvent(C,{tile:c})):this.update(this.transform));c.timeAdded=v.browser.now(),b==="expired"&&(c.refreshedUponExpiration=!0),this._setTileReloadTimer(d,c),this.getSource().type==="raster-dem"&&c.dem&&this._backfillDEM(c),this._state.initializeTileState(c,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:c,coord:c.tileID}))},f.prototype._backfillDEM=function(c){for(var d=this.getRenderableIds(),b=0;b<d.length;b++){var C=d[b];if(c.neighboringTiles&&c.neighboringTiles[C]){var A=this.getTileByID(C);L(c,A),L(A,c)}}function L(Z,V){Z.needsHillshadePrepare=!0;var le=V.tileID.canonical.x-Z.tileID.canonical.x,fe=V.tileID.canonical.y-Z.tileID.canonical.y,de=Math.pow(2,Z.tileID.canonical.z),ke=V.tileID.key;le===0&&fe===0||Math.abs(fe)>1||(Math.abs(le)>1&&(Math.abs(le+de)===1?le+=de:Math.abs(le-de)===1&&(le-=de)),V.dem&&Z.dem&&(Z.dem.backfillBorder(V.dem,le,fe),Z.neighboringTiles&&Z.neighboringTiles[ke]&&(Z.neighboringTiles[ke].backfilled=!0)))}},f.prototype.getTile=function(c){return this.getTileByID(c.key)},f.prototype.getTileByID=function(c){return this._tiles[c]},f.prototype._retainLoadedChildren=function(c,d,b,C){for(var A in this._tiles){var L=this._tiles[A];if(!(C[A]||!L.hasData()||L.tileID.overscaledZ<=d||L.tileID.overscaledZ>b)){for(var Z=L.tileID;L&&L.tileID.overscaledZ>d+1;){var V=L.tileID.scaledTo(L.tileID.overscaledZ-1);(L=this._tiles[V.key])&&L.hasData()&&(Z=V)}for(var le=Z;le.overscaledZ>d;)if(c[(le=le.scaledTo(le.overscaledZ-1)).key]){C[Z.key]=Z;break}}}},f.prototype.findLoadedParent=function(c,d){if(c.key in this._loadedParentTiles){var b=this._loadedParentTiles[c.key];return b&&b.tileID.overscaledZ>=d?b:null}for(var C=c.overscaledZ-1;C>=d;C--){var A=c.scaledTo(C),L=this._getLoadedTile(A);if(L)return L}},f.prototype._getLoadedTile=function(c){var d=this._tiles[c.key];return d&&d.hasData()?d:this._cache.getByKey(c.wrapped().key)},f.prototype.updateCacheSize=function(c){var d=Math.ceil(c.width/this._source.tileSize)+1,b=Math.ceil(c.height/this._source.tileSize)+1,C=Math.floor(d*b*5),A=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,C):C;this._cache.setMaxSize(A)},f.prototype.handleWrapJump=function(c){var d=Math.round((c-(this._prevLng===void 0?c:this._prevLng))/360);if(this._prevLng=c,d){var b={};for(var C in this._tiles){var A=this._tiles[C];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+d),b[A.tileID.key]=A}for(var L in this._tiles=b,this._timers)clearTimeout(this._timers[L]),delete this._timers[L];for(var Z in this._tiles)this._setTileReloadTimer(Z,this._tiles[Z])}},f.prototype.update=function(c){var d=this;if(this.transform=c,this._sourceLoaded&&!this._paused){var b;this.updateCacheSize(c),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?b=c.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(gr){return new v.OverscaledTileID(gr.canonical.z,gr.wrap,gr.canonical.z,gr.canonical.x,gr.canonical.y)}):(b=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(b=b.filter(function(gr){return d._source.hasTile(gr)}))):b=[];var C=c.coveringZoomLevel(this._source),A=Math.max(C-f.maxOverzooming,this._source.minzoom),L=Math.max(C+f.maxUnderzooming,this._source.minzoom),Z=this._updateRetainedTiles(b,C);if(dr(this._source.type)){for(var V={},le={},fe=0,de=Object.keys(Z);fe<de.length;fe+=1){var ke=de[fe],Re=Z[ke],He=this._tiles[ke];if(He&&!(He.fadeEndTime&&He.fadeEndTime<=v.browser.now())){var Ae=this.findLoadedParent(Re,A);Ae&&(this._addTile(Ae.tileID),V[Ae.tileID.key]=Ae.tileID),le[ke]=Re}}for(var We in this._retainLoadedChildren(le,C,L,Z),V)Z[We]||(this._coveredTiles[We]=!0,Z[We]=V[We])}for(var tt in Z)this._tiles[tt].clearFadeHold();for(var bt=0,Yt=v.keysDifference(this._tiles,Z);bt<Yt.length;bt+=1){var zt=Yt[bt],$t=this._tiles[zt];$t.hasSymbolBuckets&&!$t.holdingForFade()?$t.setHoldDuration(this.map._fadeDuration):$t.hasSymbolBuckets&&!$t.symbolFadeFinished()||this._removeTile(zt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var c in this._tiles)this._tiles[c].holdingForFade()&&this._removeTile(c)},f.prototype._updateRetainedTiles=function(c,d){for(var b={},C={},A=Math.max(d-f.maxOverzooming,this._source.minzoom),L=Math.max(d+f.maxUnderzooming,this._source.minzoom),Z={},V=0,le=c;V<le.length;V+=1){var fe=le[V],de=this._addTile(fe);b[fe.key]=fe,de.hasData()||d<this._source.maxzoom&&(Z[fe.key]=fe)}this._retainLoadedChildren(Z,d,L,b);for(var ke=0,Re=c;ke<Re.length;ke+=1){var He=Re[ke],Ae=this._tiles[He.key];if(!Ae.hasData()){if(d+1>this._source.maxzoom){var We=He.children(this._source.maxzoom)[0],tt=this.getTile(We);if(tt&&tt.hasData()){b[We.key]=We;continue}}else{var bt=He.children(this._source.maxzoom);if(b[bt[0].key]&&b[bt[1].key]&&b[bt[2].key]&&b[bt[3].key])continue}for(var Yt=Ae.wasRequested(),zt=He.overscaledZ-1;zt>=A;--zt){var $t=He.scaledTo(zt);if(C[$t.key]||(C[$t.key]=!0,!(Ae=this.getTile($t))&&Yt&&(Ae=this._addTile($t)),Ae&&(b[$t.key]=$t,Yt=Ae.wasRequested(),Ae.hasData())))break}}}return b},f.prototype._updateLoadedParentTileCache=function(){for(var c in this._loadedParentTiles={},this._tiles){for(var d=[],b=void 0,C=this._tiles[c].tileID;C.overscaledZ>0;){if(C.key in this._loadedParentTiles){b=this._loadedParentTiles[C.key];break}d.push(C.key);var A=C.scaledTo(C.overscaledZ-1);if(b=this._getLoadedTile(A))break;C=A}for(var L=0,Z=d;L<Z.length;L+=1)this._loadedParentTiles[Z[L]]=b}},f.prototype._addTile=function(c){var d=this._tiles[c.key];if(d)return d;(d=this._cache.getAndRemove(c))&&(this._setTileReloadTimer(c.key,d),d.tileID=c,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[c.key]&&(clearTimeout(this._cacheTimers[c.key]),delete this._cacheTimers[c.key],this._setTileReloadTimer(c.key,d)));var b=Boolean(d);return b||(d=new v.Tile(c,this._source.tileSize*c.overscaleFactor()),this._loadTile(d,this._tileLoaded.bind(this,d,c.key,d.state))),d?(d.uses++,this._tiles[c.key]=d,b||this._source.fire(new v.Event("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d):null},f.prototype._setTileReloadTimer=function(c,d){var b=this;c in this._timers&&(clearTimeout(this._timers[c]),delete this._timers[c]);var C=d.getExpiryTimeout();C&&(this._timers[c]=setTimeout(function(){b._reloadTile(c,"expired"),delete b._timers[c]},C))},f.prototype._removeTile=function(c){var d=this._tiles[c];d&&(d.uses--,delete this._tiles[c],this._timers[c]&&(clearTimeout(this._timers[c]),delete this._timers[c]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))},f.prototype.clearTiles=function(){for(var c in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(c);this._cache.reset()},f.prototype.tilesIn=function(c,d,b){var C=this,A=[],L=this.transform;if(!L)return A;for(var Z=b?L.getCameraQueryGeometry(c):c,V=c.map(function(zt){return L.pointCoordinate(zt)}),le=Z.map(function(zt){return L.pointCoordinate(zt)}),fe=this.getIds(),de=1/0,ke=1/0,Re=-1/0,He=-1/0,Ae=0,We=le;Ae<We.length;Ae+=1){var tt=We[Ae];de=Math.min(de,tt.x),ke=Math.min(ke,tt.y),Re=Math.max(Re,tt.x),He=Math.max(He,tt.y)}for(var bt=function(zt){var $t=C._tiles[fe[zt]];if(!$t.holdingForFade()){var gr=$t.tileID,Br=Math.pow(2,L.zoom-$t.tileID.overscaledZ),Fr=d*$t.queryPadding*v.EXTENT/$t.tileSize/Br,sn=[gr.getTilePoint(new v.MercatorCoordinate(de,ke)),gr.getTilePoint(new v.MercatorCoordinate(Re,He))];if(sn[0].x-Fr<v.EXTENT&&sn[0].y-Fr<v.EXTENT&&sn[1].x+Fr>=0&&sn[1].y+Fr>=0){var kn=V.map(function(zn){return gr.getTilePoint(zn)}),Dn=le.map(function(zn){return gr.getTilePoint(zn)});A.push({tile:$t,tileID:gr,queryGeometry:kn,cameraQueryGeometry:Dn,scale:Br})}}},Yt=0;Yt<fe.length;Yt++)bt(Yt);return A},f.prototype.getVisibleCoordinates=function(c){for(var d=this,b=this.getRenderableIds(c).map(function(Z){return d._tiles[Z].tileID}),C=0,A=b;C<A.length;C+=1){var L=A[C];L.posMatrix=this.transform.calculatePosMatrix(L.toUnwrapped())}return b},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(dr(this._source.type))for(var c in this._tiles){var d=this._tiles[c];if(d.fadeEndTime!==void 0&&d.fadeEndTime>=v.browser.now())return!0}return!1},f.prototype.setFeatureState=function(c,d,b){this._state.updateState(c=c||"_geojsonTileLayer",d,b)},f.prototype.removeFeatureState=function(c,d,b){this._state.removeFeatureState(c=c||"_geojsonTileLayer",d,b)},f.prototype.getFeatureState=function(c,d){return this._state.getState(c=c||"_geojsonTileLayer",d)},f.prototype.setDependencies=function(c,d,b){var C=this._tiles[c];C&&C.setDependencies(d,b)},f.prototype.reloadTilesForDependencies=function(c,d){for(var b in this._tiles)this._tiles[b].hasDependency(c,d)&&this._reloadTile(b,"reloading");this._cache.filter(function(C){return!C.hasDependency(c,d)})},f}(v.Evented);function yt(l,f){var c=Math.abs(2*l.wrap)-+(l.wrap<0),d=Math.abs(2*f.wrap)-+(f.wrap<0);return l.overscaledZ-f.overscaledZ||d-c||f.canonical.y-l.canonical.y||f.canonical.x-l.canonical.x}function dr(l){return l==="raster"||l==="image"||l==="video"}function Dt(){return new v.window.Worker(tc.workerUrl)}Be.maxOverzooming=10,Be.maxUnderzooming=3;var Ft="mapboxgl_preloaded_worker_pool",_r=function(){this.active={}};_r.prototype.acquire=function(l){if(!this.workers)for(this.workers=[];this.workers.length<_r.workerCount;)this.workers.push(new Dt);return this.active[l]=!0,this.workers.slice()},_r.prototype.release=function(l){delete this.active[l],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},_r.prototype.isPreloaded=function(){return!!this.active[Ft]},_r.prototype.numActive=function(){return Object.keys(this.active).length};var En,un=Math.floor(v.browser.hardwareConcurrency/2);function Tt(){return En||(En=new _r),En}function on(l,f){var c={};for(var d in l)d!=="ref"&&(c[d]=l[d]);return v.refProperties.forEach(function(b){b in f&&(c[b]=f[b])}),c}function Gr(l){l=l.slice();for(var f=Object.create(null),c=0;c<l.length;c++)f[l[c].id]=l[c];for(var d=0;d<l.length;d++)"ref"in l[d]&&(l[d]=on(l[d],f[l[d].ref]));return l}_r.workerCount=Math.max(Math.min(un,6),1);var qr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ni(l,f,c){c.push({command:qr.addSource,args:[l,f[l]]})}function tn(l,f,c){f.push({command:qr.removeSource,args:[l]}),c[l]=!0}function Ci(l,f,c,d){tn(l,c,d),ni(l,f,c)}function Ji(l,f,c){var d;for(d in l[c])if(l[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],f[c][d]))return!1;for(d in f[c])if(f[c].hasOwnProperty(d)&&d!=="data"&&!v.deepEqual(l[c][d],f[c][d]))return!1;return!0}function yi(l,f,c,d,b,C){var A;for(A in f=f||{},l=l||{})l.hasOwnProperty(A)&&(v.deepEqual(l[A],f[A])||c.push({command:C,args:[d,A,f[A],b]}));for(A in f)f.hasOwnProperty(A)&&!l.hasOwnProperty(A)&&(v.deepEqual(l[A],f[A])||c.push({command:C,args:[d,A,f[A],b]}))}function Pi(l){return l.id}function xi(l,f){return l[f.id]=f,l}var ei=function(l,f){this.reset(l,f)};ei.prototype.reset=function(l,f){this.points=l||[],this._distances=[0];for(var c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},ei.prototype.lerp=function(l){if(this.points.length===1)return this.points[0];l=v.clamp(l,0,1);for(var f=1,c=this._distances[f],d=l*this.paddedLength+this.padding;c<d&&f<this._distances.length;)c=this._distances[++f];var b=f-1,C=this._distances[b],A=c-C,L=A>0?(d-C)/A:0;return this.points[b].mult(1-L).add(this.points[f].mult(L))};var Wi=function(l,f,c){var d=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(l/c),this.yCellCount=Math.ceil(f/c);for(var C=0;C<this.xCellCount*this.yCellCount;C++)d.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=f,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function La(l,f,c,d,b){var C=v.create();return f?(v.scale(C,C,[1/b,1/b,1]),c||v.rotateZ(C,C,d.angle)):v.multiply(C,d.labelPlaneMatrix,l),C}function oa(l,f,c,d,b){if(f){var C=v.clone(l);return v.scale(C,C,[b,b,1]),c||v.rotateZ(C,C,-d.angle),C}return d.glCoordMatrix}function Ii(l,f){var c=[l.x,l.y,0,1];za(c,c,f);var d=c[3];return{point:new v.Point(c[0]/d,c[1]/d),signedDistanceFromCamera:d}}function Vi(l,f){return .5+l/f*.5}function Na(l,f){var c=l[0]/l[3],d=l[1]/l[3];return c>=-f[0]&&c<=f[0]&&d>=-f[1]&&d<=f[1]}function tu(l,f,c,d,b,C,A,L){var Z=d?l.textSizeData:l.iconSizeData,V=v.evaluateSizeForZoom(Z,c.transform.zoom),le=[256/c.width*2+1,256/c.height*2+1],fe=d?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;fe.clear();for(var de=l.lineVertexArray,ke=d?l.text.placedSymbolArray:l.icon.placedSymbolArray,Re=c.transform.width/c.transform.height,He=!1,Ae=0;Ae<ke.length;Ae++){var We=ke.get(Ae);if(We.hidden||We.writingMode===v.WritingMode.vertical&&!He)mo(We.numGlyphs,fe);else{He=!1;var tt=[We.anchorX,We.anchorY,0,1];if(v.transformMat4(tt,tt,f),Na(tt,le)){var bt=Vi(c.transform.cameraToCenterDistance,tt[3]),Yt=v.evaluateSizeForFeature(Z,V,We),zt=A?Yt/bt:Yt*bt,$t=new v.Point(We.anchorX,We.anchorY),gr=Ii($t,b).point,Br={},Fr=ms(We,zt,!1,L,f,b,C,l.glyphOffsetArray,de,fe,gr,$t,Br,Re);He=Fr.useVertical,(Fr.notEnoughRoom||He||Fr.needsFlipping&&ms(We,zt,!0,L,f,b,C,l.glyphOffsetArray,de,fe,gr,$t,Br,Re).notEnoughRoom)&&mo(We.numGlyphs,fe)}else mo(We.numGlyphs,fe)}}d?l.text.dynamicLayoutVertexBuffer.updateData(fe):l.icon.dynamicLayoutVertexBuffer.updateData(fe)}function wa(l,f,c,d,b,C,A,L,Z,V,le){var fe=L.glyphStartIndex+L.numGlyphs,de=L.lineStartIndex,ke=L.lineStartIndex+L.lineLength,Re=f.getoffsetX(L.glyphStartIndex),He=f.getoffsetX(fe-1),Ae=ta(l*Re,c,d,b,C,A,L.segment,de,ke,Z,V,le);if(!Ae)return null;var We=ta(l*He,c,d,b,C,A,L.segment,de,ke,Z,V,le);return We?{first:Ae,last:We}:null}function Aa(l,f,c,d){return l===v.WritingMode.horizontal&&Math.abs(c.y-f.y)>Math.abs(c.x-f.x)*d?{useVertical:!0}:(l===v.WritingMode.vertical?f.y<c.y:f.x>c.x)?{needsFlipping:!0}:null}function ms(l,f,c,d,b,C,A,L,Z,V,le,fe,de,ke){var Re,He=f/24,Ae=l.lineOffsetX*He,We=l.lineOffsetY*He;if(l.numGlyphs>1){var tt=l.glyphStartIndex+l.numGlyphs,bt=l.lineStartIndex,Yt=l.lineStartIndex+l.lineLength,zt=wa(He,L,Ae,We,c,le,fe,l,Z,C,de);if(!zt)return{notEnoughRoom:!0};var $t=Ii(zt.first.point,A).point,gr=Ii(zt.last.point,A).point;if(d&&!c){var Br=Aa(l.writingMode,$t,gr,ke);if(Br)return Br}Re=[zt.first];for(var Fr=l.glyphStartIndex+1;Fr<tt-1;Fr++)Re.push(ta(He*L.getoffsetX(Fr),Ae,We,c,le,fe,l.segment,bt,Yt,Z,C,de));Re.push(zt.last)}else{if(d&&!c){var sn=Ii(fe,b).point,kn=l.lineStartIndex+l.segment+1,Dn=new v.Point(Z.getx(kn),Z.gety(kn)),zn=Ii(Dn,b),ci=zn.signedDistanceFromCamera>0?zn.point:us(fe,Dn,sn,1,b),ln=Aa(l.writingMode,sn,ci,ke);if(ln)return ln}var Hn=ta(He*L.getoffsetX(l.glyphStartIndex),Ae,We,c,le,fe,l.segment,l.lineStartIndex,l.lineStartIndex+l.lineLength,Z,C,de);if(!Hn)return{notEnoughRoom:!0};Re=[Hn]}for(var fi=0,Yn=Re;fi<Yn.length;fi+=1){var Zn=Yn[fi];v.addDynamicAttributes(V,Zn.point,Zn.angle)}return{}}function us(l,f,c,d,b){var C=Ii(l.add(l.sub(f)._unit()),b).point,A=c.sub(C);return c.add(A._mult(d/A.mag()))}function ta(l,f,c,d,b,C,A,L,Z,V,le,fe){var de=d?l-f:l+f,ke=de>0?1:-1,Re=0;d&&(ke*=-1,Re=Math.PI),ke<0&&(Re+=Math.PI);for(var He=ke>0?L+A:L+A+1,Ae=b,We=b,tt=0,bt=0,Yt=Math.abs(de),zt=[];tt+bt<=Yt;){if((He+=ke)<L||He>=Z)return null;if(We=Ae,zt.push(Ae),(Ae=fe[He])===void 0){var $t=new v.Point(V.getx(He),V.gety(He)),gr=Ii($t,le);if(gr.signedDistanceFromCamera>0)Ae=fe[He]=gr.point;else{var Br=He-ke;Ae=us(tt===0?C:new v.Point(V.getx(Br),V.gety(Br)),$t,We,Yt-tt+1,le)}}tt+=bt,bt=We.dist(Ae)}var Fr=(Yt-tt)/bt,sn=Ae.sub(We),kn=sn.mult(Fr)._add(We);kn._add(sn._unit()._perp()._mult(c*ke));var Dn=Re+Math.atan2(Ae.y-We.y,Ae.x-We.x);return zt.push(kn),{point:kn,angle:Dn,path:zt}}Wi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Wi.prototype.insert=function(l,f,c,d,b){this._forEachCell(f,c,d,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(f),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(b)},Wi.prototype.insertCircle=function(l,f,c,d){this._forEachCell(f-d,c-d,f+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(f),this.circles.push(c),this.circles.push(d)},Wi.prototype._insertBoxCell=function(l,f,c,d,b,C){this.boxCells[b].push(C)},Wi.prototype._insertCircleCell=function(l,f,c,d,b,C){this.circleCells[b].push(C)},Wi.prototype._query=function(l,f,c,d,b,C){if(c<0||l>this.width||d<0||f>this.height)return!b&&[];var A=[];if(l<=0&&f<=0&&this.width<=c&&this.height<=d){if(b)return!0;for(var L=0;L<this.boxKeys.length;L++)A.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(var Z=0;Z<this.circleKeys.length;Z++){var V=this.circles[3*Z],le=this.circles[3*Z+1],fe=this.circles[3*Z+2];A.push({key:this.circleKeys[Z],x1:V-fe,y1:le-fe,x2:V+fe,y2:le+fe})}return C?A.filter(C):A}return this._forEachCell(l,f,c,d,this._queryCell,A,{hitTest:b,seenUids:{box:{},circle:{}}},C),b?A.length>0:A},Wi.prototype._queryCircle=function(l,f,c,d,b){var C=l-c,A=l+c,L=f-c,Z=f+c;if(A<0||C>this.width||Z<0||L>this.height)return!d&&[];var V=[];return this._forEachCell(C,L,A,Z,this._queryCellCircle,V,{hitTest:d,circle:{x:l,y:f,radius:c},seenUids:{box:{},circle:{}}},b),d?V.length>0:V},Wi.prototype.query=function(l,f,c,d,b){return this._query(l,f,c,d,!1,b)},Wi.prototype.hitTest=function(l,f,c,d,b){return this._query(l,f,c,d,!0,b)},Wi.prototype.hitTestCircle=function(l,f,c,d){return this._queryCircle(l,f,c,!0,d)},Wi.prototype._queryCell=function(l,f,c,d,b,C,A,L){var Z=A.seenUids,V=this.boxCells[b];if(V!==null)for(var le=this.bboxes,fe=0,de=V;fe<de.length;fe+=1){var ke=de[fe];if(!Z.box[ke]){Z.box[ke]=!0;var Re=4*ke;if(l<=le[Re+2]&&f<=le[Re+3]&&c>=le[Re+0]&&d>=le[Re+1]&&(!L||L(this.boxKeys[ke]))){if(A.hitTest)return C.push(!0),!0;C.push({key:this.boxKeys[ke],x1:le[Re],y1:le[Re+1],x2:le[Re+2],y2:le[Re+3]})}}}var He=this.circleCells[b];if(He!==null)for(var Ae=this.circles,We=0,tt=He;We<tt.length;We+=1){var bt=tt[We];if(!Z.circle[bt]){Z.circle[bt]=!0;var Yt=3*bt;if(this._circleAndRectCollide(Ae[Yt],Ae[Yt+1],Ae[Yt+2],l,f,c,d)&&(!L||L(this.circleKeys[bt]))){if(A.hitTest)return C.push(!0),!0;var zt=Ae[Yt],$t=Ae[Yt+1],gr=Ae[Yt+2];C.push({key:this.circleKeys[bt],x1:zt-gr,y1:$t-gr,x2:zt+gr,y2:$t+gr})}}}},Wi.prototype._queryCellCircle=function(l,f,c,d,b,C,A,L){var Z=A.circle,V=A.seenUids,le=this.boxCells[b];if(le!==null)for(var fe=this.bboxes,de=0,ke=le;de<ke.length;de+=1){var Re=ke[de];if(!V.box[Re]){V.box[Re]=!0;var He=4*Re;if(this._circleAndRectCollide(Z.x,Z.y,Z.radius,fe[He+0],fe[He+1],fe[He+2],fe[He+3])&&(!L||L(this.boxKeys[Re])))return C.push(!0),!0}}var Ae=this.circleCells[b];if(Ae!==null)for(var We=this.circles,tt=0,bt=Ae;tt<bt.length;tt+=1){var Yt=bt[tt];if(!V.circle[Yt]){V.circle[Yt]=!0;var zt=3*Yt;if(this._circlesCollide(We[zt],We[zt+1],We[zt+2],Z.x,Z.y,Z.radius)&&(!L||L(this.circleKeys[Yt])))return C.push(!0),!0}}},Wi.prototype._forEachCell=function(l,f,c,d,b,C,A,L){for(var Z=this._convertToXCellCoord(l),V=this._convertToYCellCoord(f),le=this._convertToXCellCoord(c),fe=this._convertToYCellCoord(d),de=Z;de<=le;de++)for(var ke=V;ke<=fe;ke++)if(b.call(this,l,f,c,d,this.xCellCount*ke+de,C,A,L))return},Wi.prototype._convertToXCellCoord=function(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))},Wi.prototype._convertToYCellCoord=function(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))},Wi.prototype._circlesCollide=function(l,f,c,d,b,C){var A=d-l,L=b-f,Z=c+C;return Z*Z>A*A+L*L},Wi.prototype._circleAndRectCollide=function(l,f,c,d,b,C,A){var L=(C-d)/2,Z=Math.abs(l-(d+L));if(Z>L+c)return!1;var V=(A-b)/2,le=Math.abs(f-(b+V));if(le>V+c)return!1;if(Z<=L||le<=V)return!0;var fe=Z-L,de=le-V;return fe*fe+de*de<=c*c};var Bu=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function mo(l,f){for(var c=0;c<l;c++){var d=f.length;f.resize(d+4),f.float32.set(Bu,3*d)}}function za(l,f,c){var d=f[0],b=f[1];return l[0]=c[0]*d+c[4]*b+c[12],l[1]=c[1]*d+c[5]*b+c[13],l[3]=c[3]*d+c[7]*b+c[15],l}var ro=function(l,f,c){f===void 0&&(f=new Wi(l.width+200,l.height+200,25)),c===void 0&&(c=new Wi(l.width+200,l.height+200,25)),this.transform=l,this.grid=f,this.ignoredGrid=c,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+100,this.screenBottomBoundary=l.height+100,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200};function Ki(l,f,c){return f*(v.EXTENT/(l.tileSize*Math.pow(2,c-l.tileID.overscaledZ)))}ro.prototype.placeCollisionBox=function(l,f,c,d,b){var C=this.projectAndGetPerspectiveRatio(d,l.anchorPointX,l.anchorPointY),A=c*C.perspectiveRatio,L=l.x1*A+C.point.x,Z=l.y1*A+C.point.y,V=l.x2*A+C.point.x,le=l.y2*A+C.point.y;return!this.isInsideGrid(L,Z,V,le)||!f&&this.grid.hitTest(L,Z,V,le,b)?{box:[],offscreen:!1}:{box:[L,Z,V,le],offscreen:this.isOffscreen(L,Z,V,le)}},ro.prototype.placeCollisionCircles=function(l,f,c,d,b,C,A,L,Z,V,le,fe,de){var ke=[],Re=new v.Point(f.anchorX,f.anchorY),He=Ii(Re,C),Ae=Vi(this.transform.cameraToCenterDistance,He.signedDistanceFromCamera),We=(V?b/Ae:b*Ae)/v.ONE_EM,tt=Ii(Re,A).point,bt=wa(We,d,f.lineOffsetX*We,f.lineOffsetY*We,!1,tt,Re,f,c,A,{}),Yt=!1,zt=!1,$t=!0;if(bt){for(var gr=.5*fe*Ae+de,Br=new v.Point(-100,-100),Fr=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),sn=new ei,kn=bt.first,Dn=bt.last,zn=[],ci=kn.path.length-1;ci>=1;ci--)zn.push(kn.path[ci]);for(var ln=1;ln<Dn.path.length;ln++)zn.push(Dn.path[ln]);var Hn=2.5*gr;if(L){var fi=zn.map(function(xo){return Ii(xo,L)});zn=fi.some(function(xo){return xo.signedDistanceFromCamera<=0})?[]:fi.map(function(xo){return xo.point})}var Yn=[];if(zn.length>0){for(var Zn=zn[0].clone(),vi=zn[0].clone(),qn=1;qn<zn.length;qn++)Zn.x=Math.min(Zn.x,zn[qn].x),Zn.y=Math.min(Zn.y,zn[qn].y),vi.x=Math.max(vi.x,zn[qn].x),vi.y=Math.max(vi.y,zn[qn].y);Yn=Zn.x>=Br.x&&vi.x<=Fr.x&&Zn.y>=Br.y&&vi.y<=Fr.y?[zn]:vi.x<Br.x||Zn.x>Fr.x||vi.y<Br.y||Zn.y>Fr.y?[]:v.clipLine([zn],Br.x,Br.y,Fr.x,Fr.y)}for(var Vn=0,To=Yn;Vn<To.length;Vn+=1){var Li;sn.reset(To[Vn],.25*gr),Li=sn.length<=.5*gr?1:Math.ceil(sn.paddedLength/Hn)+1;for(var Qi=0;Qi<Li;Qi++){var _o=Qi/Math.max(Li-1,1),Ya=sn.lerp(_o),Ua=Ya.x+100,zs=Ya.y+100;ke.push(Ua,zs,gr,0);var ys=Ua-gr,Ku=zs-gr,_s=Ua+gr,Ys=zs+gr;if($t=$t&&this.isOffscreen(ys,Ku,_s,Ys),zt=zt||this.isInsideGrid(ys,Ku,_s,Ys),!l&&this.grid.hitTestCircle(Ua,zs,gr,le)&&(Yt=!0,!Z))return{circles:[],offscreen:!1,collisionDetected:Yt}}}}return{circles:!Z&&Yt||!zt?[]:ke,offscreen:$t,collisionDetected:Yt}},ro.prototype.queryRenderedSymbols=function(l){if(l.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],c=1/0,d=1/0,b=-1/0,C=-1/0,A=0,L=l;A<L.length;A+=1){var Z=L[A],V=new v.Point(Z.x+100,Z.y+100);c=Math.min(c,V.x),d=Math.min(d,V.y),b=Math.max(b,V.x),C=Math.max(C,V.y),f.push(V)}for(var le={},fe={},de=0,ke=this.grid.query(c,d,b,C).concat(this.ignoredGrid.query(c,d,b,C));de<ke.length;de+=1){var Re=ke[de],He=Re.key;if(le[He.bucketInstanceId]===void 0&&(le[He.bucketInstanceId]={}),!le[He.bucketInstanceId][He.featureIndex]){var Ae=[new v.Point(Re.x1,Re.y1),new v.Point(Re.x2,Re.y1),new v.Point(Re.x2,Re.y2),new v.Point(Re.x1,Re.y2)];v.polygonIntersectsPolygon(f,Ae)&&(le[He.bucketInstanceId][He.featureIndex]=!0,fe[He.bucketInstanceId]===void 0&&(fe[He.bucketInstanceId]=[]),fe[He.bucketInstanceId].push(He.featureIndex))}}return fe},ro.prototype.insertCollisionBox=function(l,f,c,d,b){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:b},l[0],l[1],l[2],l[3])},ro.prototype.insertCollisionCircles=function(l,f,c,d,b){for(var C=f?this.ignoredGrid:this.grid,A={bucketInstanceId:c,featureIndex:d,collisionGroupID:b},L=0;L<l.length;L+=4)C.insertCircle(A,l[L],l[L+1],l[L+2])},ro.prototype.projectAndGetPerspectiveRatio=function(l,f,c){var d=[f,c,0,1];return za(d,d,l),{point:new v.Point((d[0]/d[3]+1)/2*this.transform.width+100,(-d[1]/d[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/d[3]*.5}},ro.prototype.isOffscreen=function(l,f,c,d){return c<100||l>=this.screenRightBoundary||d<100||f>this.screenBottomBoundary},ro.prototype.isInsideGrid=function(l,f,c,d){return c>=0&&l<this.gridRightBoundary&&d>=0&&f<this.gridBottomBoundary},ro.prototype.getViewportMatrix=function(){var l=v.identity([]);return v.translate(l,l,[-100,-100,0]),l};var Ho=function(l,f,c,d){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?f:-f))):d&&c?1:0,this.placed=c};Ho.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Wo=function(l,f,c,d,b){this.text=new Ho(l?l.text:null,f,c,b),this.icon=new Ho(l?l.icon:null,f,d,b)};Wo.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Nu=function(l,f,c){this.text=l,this.icon=f,this.skipFade=c},Co=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},Xo=function(l,f,c,d,b){this.bucketInstanceId=l,this.featureIndex=f,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=b},ga=function(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}};function go(l,f,c,d,b){var C=v.getAnchorAlignment(l),A=-(C.horizontalAlign-.5)*f,L=-(C.verticalAlign-.5)*c,Z=v.evaluateVariableOffset(l,d);return new v.Point(A+Z[0]*b,L+Z[1]*b)}function Yo(l,f,c,d,b,C){var A=l.x1,L=l.x2,Z=l.y1,V=l.y2,le=l.anchorPointX,fe=l.anchorPointY,de=new v.Point(f,c);return d&&de._rotate(b?C:-C),{x1:A+de.x,y1:Z+de.y,x2:L+de.x,y2:V+de.y,anchorPointX:le,anchorPointY:fe}}ga.prototype.get=function(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){var f=++this.maxGroupID;this.collisionGroups[l]={ID:f,predicate:function(c){return c.collisionGroupID===f}}}return this.collisionGroups[l]};var no=function(l,f,c,d){this.transform=l.clone(),this.collisionIndex=new ro(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new ga(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={}};function ru(l,f,c,d,b){l.emplaceBack(f?1:0,c?1:0,d||0,b||0),l.emplaceBack(f?1:0,c?1:0,d||0,b||0),l.emplaceBack(f?1:0,c?1:0,d||0,b||0),l.emplaceBack(f?1:0,c?1:0,d||0,b||0)}no.prototype.getBucketParts=function(l,f,c,d){var b=c.getBucket(f),C=c.latestFeatureIndex;if(b&&C&&f.id===b.layerIds[0]){var A=c.collisionBoxArray,L=b.layers[0].layout,Z=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),V=c.tileSize/v.EXTENT,le=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),fe=L.get("text-pitch-alignment")==="map",de=L.get("text-rotation-alignment")==="map",ke=Ki(c,1,this.transform.zoom),Re=La(le,fe,de,this.transform,ke),He=null;if(fe){var Ae=oa(le,fe,de,this.transform,ke);He=v.multiply([],this.transform.labelPlaneMatrix,Ae)}this.retainedQueryData[b.bucketInstanceId]=new Xo(b.bucketInstanceId,C,b.sourceLayerIndex,b.index,c.tileID);var We={bucket:b,layout:L,posMatrix:le,textLabelPlaneMatrix:Re,labelToScreenMatrix:He,scale:Z,textPixelRatio:V,holdingForFade:c.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(d)for(var tt=0,bt=b.sortKeyRanges;tt<bt.length;tt+=1){var Yt=bt[tt];l.push({sortKey:Yt.sortKey,symbolInstanceStart:Yt.symbolInstanceStart,symbolInstanceEnd:Yt.symbolInstanceEnd,parameters:We})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:We})}},no.prototype.attemptAnchorPlacement=function(l,f,c,d,b,C,A,L,Z,V,le,fe,de,ke,Re){var He,Ae=[fe.textOffset0,fe.textOffset1],We=go(l,c,d,Ae,b),tt=this.collisionIndex.placeCollisionBox(Yo(f,We.x,We.y,C,A,this.transform.angle),le,L,Z,V.predicate);if(!Re||this.collisionIndex.placeCollisionBox(Yo(Re,We.x,We.y,C,A,this.transform.angle),le,L,Z,V.predicate).box.length!==0)return tt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID]&&this.prevPlacement.placements[fe.crossTileID].text&&(He=this.prevPlacement.variableOffsets[fe.crossTileID].anchor),this.variableOffsets[fe.crossTileID]={textOffset:Ae,width:c,height:d,anchor:l,textBoxScale:b,prevAnchor:He},this.markUsedJustification(de,l,fe,ke),de.allowVerticalPlacement&&(this.markUsedOrientation(de,ke,fe),this.placedOrientations[fe.crossTileID]=ke),{shift:We,placedGlyphBoxes:tt}):void 0},no.prototype.placeLayerBucketPart=function(l,f,c){var d=this,b=l.parameters,C=b.bucket,A=b.layout,L=b.posMatrix,Z=b.textLabelPlaneMatrix,V=b.labelToScreenMatrix,le=b.textPixelRatio,fe=b.holdingForFade,de=b.collisionBoxArray,ke=b.partiallyEvaluatedTextSize,Re=b.collisionGroup,He=A.get("text-optional"),Ae=A.get("icon-optional"),We=A.get("text-allow-overlap"),tt=A.get("icon-allow-overlap"),bt=A.get("text-rotation-alignment")==="map",Yt=A.get("text-pitch-alignment")==="map",zt=A.get("icon-text-fit")!=="none",$t=A.get("symbol-z-order")==="viewport-y",gr=We&&(tt||!C.hasIconData()||Ae),Br=tt&&(We||!C.hasTextData()||He);!C.collisionArrays&&de&&C.deserializeCollisionBoxes(de);var Fr=function(ln,Hn){if(!f[ln.crossTileID])if(fe)d.placements[ln.crossTileID]=new Nu(!1,!1,!1);else{var fi,Yn=!1,Zn=!1,vi=!0,qn=null,Vn={box:null,offscreen:null},To={box:null,offscreen:null},Li=null,Qi=null,_o=0,Ya=0,Ua=0;Hn.textFeatureIndex?_o=Hn.textFeatureIndex:ln.useRuntimeCollisionCircles&&(_o=ln.featureIndex),Hn.verticalTextFeatureIndex&&(Ya=Hn.verticalTextFeatureIndex);var zs=Hn.textBox;if(zs){var ys=function(ea){var Ms=v.WritingMode.horizontal;if(C.allowVerticalPlacement&&!ea&&d.prevPlacement){var hs=d.prevPlacement.placedOrientations[ln.crossTileID];hs&&(d.placedOrientations[ln.crossTileID]=hs,d.markUsedOrientation(C,Ms=hs,ln))}return Ms},Ku=function(ea,Ms){if(C.allowVerticalPlacement&&ln.numVerticalGlyphVertices>0&&Hn.verticalTextBox)for(var hs=0,Iu=C.writingModes;hs<Iu.length&&(Iu[hs]===v.WritingMode.vertical?(Vn=Ms(),To=Vn):Vn=ea(),!(Vn&&Vn.box&&Vn.box.length));hs+=1);else Vn=ea()};if(A.get("text-variable-anchor")){var _s=A.get("text-variable-anchor");if(d.prevPlacement&&d.prevPlacement.variableOffsets[ln.crossTileID]){var Ys=d.prevPlacement.variableOffsets[ln.crossTileID];_s.indexOf(Ys.anchor)>0&&(_s=_s.filter(function(ea){return ea!==Ys.anchor})).unshift(Ys.anchor)}var xo=function(ea,Ms,hs){for(var Iu=ea.x2-ea.x1,Us=ea.y2-ea.y1,nc=ln.textBoxScale,lf=zt&&!tt?Ms:null,Ks={box:[],offscreen:!1},ic=We?2*_s.length:_s.length,lu=0;lu<ic;++lu){var dl=d.attemptAnchorPlacement(_s[lu%_s.length],ea,Iu,Us,nc,bt,Yt,le,L,Re,lu>=_s.length,ln,C,hs,lf);if(dl&&(Ks=dl.placedGlyphBoxes)&&Ks.box&&Ks.box.length){Yn=!0,qn=dl.shift;break}}return Ks};Ku(function(){return xo(zs,Hn.iconBox,v.WritingMode.horizontal)},function(){var ea=Hn.verticalTextBox;return C.allowVerticalPlacement&&!(Vn&&Vn.box&&Vn.box.length)&&ln.numVerticalGlyphVertices>0&&ea?xo(ea,Hn.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),Vn&&(Yn=Vn.box,vi=Vn.offscreen);var Oc=ys(Vn&&Vn.box);if(!Yn&&d.prevPlacement){var rc=d.prevPlacement.variableOffsets[ln.crossTileID];rc&&(d.variableOffsets[ln.crossTileID]=rc,d.markUsedJustification(C,rc.anchor,ln,Oc))}}else{var $u=function(ea,Ms){var hs=d.collisionIndex.placeCollisionBox(ea,We,le,L,Re.predicate);return hs&&hs.box&&hs.box.length&&(d.markUsedOrientation(C,Ms,ln),d.placedOrientations[ln.crossTileID]=Ms),hs};Ku(function(){return $u(zs,v.WritingMode.horizontal)},function(){var ea=Hn.verticalTextBox;return C.allowVerticalPlacement&&ln.numVerticalGlyphVertices>0&&ea?$u(ea,v.WritingMode.vertical):{box:null,offscreen:null}}),ys(Vn&&Vn.box&&Vn.box.length)}}if(Yn=(fi=Vn)&&fi.box&&fi.box.length>0,vi=fi&&fi.offscreen,ln.useRuntimeCollisionCircles){var su=C.text.placedSymbolArray.get(ln.centerJustifiedTextSymbolIndex),hl=v.evaluateSizeForFeature(C.textSizeData,ke,su),Ts=A.get("text-padding");Li=d.collisionIndex.placeCollisionCircles(We,su,C.lineVertexArray,C.glyphOffsetArray,hl,L,Z,V,c,Yt,Re.predicate,ln.collisionCircleDiameter,Ts),Yn=We||Li.circles.length>0&&!Li.collisionDetected,vi=vi&&Li.offscreen}if(Hn.iconFeatureIndex&&(Ua=Hn.iconFeatureIndex),Hn.iconBox){var pl=function(ea){var Ms=zt&&qn?Yo(ea,qn.x,qn.y,bt,Yt,d.transform.angle):ea;return d.collisionIndex.placeCollisionBox(Ms,tt,le,L,Re.predicate)};Zn=To&&To.box&&To.box.length&&Hn.verticalIconBox?(Qi=pl(Hn.verticalIconBox)).box.length>0:(Qi=pl(Hn.iconBox)).box.length>0,vi=vi&&Qi.offscreen}var uu=He||ln.numHorizontalGlyphVertices===0&&ln.numVerticalGlyphVertices===0,oo=Ae||ln.numIconVertices===0;if(uu||oo?oo?uu||(Zn=Zn&&Yn):Yn=Zn&&Yn:Zn=Yn=Zn&&Yn,Yn&&fi&&fi.box&&d.collisionIndex.insertCollisionBox(fi.box,A.get("text-ignore-placement"),C.bucketInstanceId,To&&To.box&&Ya?Ya:_o,Re.ID),Zn&&Qi&&d.collisionIndex.insertCollisionBox(Qi.box,A.get("icon-ignore-placement"),C.bucketInstanceId,Ua,Re.ID),Li&&(Yn&&d.collisionIndex.insertCollisionCircles(Li.circles,A.get("text-ignore-placement"),C.bucketInstanceId,_o,Re.ID),c)){var qs=C.bucketInstanceId,Mu=d.collisionCircleArrays[qs];Mu===void 0&&(Mu=d.collisionCircleArrays[qs]=new Co);for(var Pu=0;Pu<Li.circles.length;Pu+=4)Mu.circles.push(Li.circles[Pu+0]),Mu.circles.push(Li.circles[Pu+1]),Mu.circles.push(Li.circles[Pu+2]),Mu.circles.push(Li.collisionDetected?1:0)}d.placements[ln.crossTileID]=new Nu(Yn||gr,Zn||Br,vi||C.justReloaded),f[ln.crossTileID]=!0}};if($t)for(var sn=C.getSortedSymbolIndexes(this.transform.angle),kn=sn.length-1;kn>=0;--kn){var Dn=sn[kn];Fr(C.symbolInstances.get(Dn),C.collisionArrays[Dn])}else for(var zn=l.symbolInstanceStart;zn<l.symbolInstanceEnd;zn++)Fr(C.symbolInstances.get(zn),C.collisionArrays[zn]);if(c&&C.bucketInstanceId in this.collisionCircleArrays){var ci=this.collisionCircleArrays[C.bucketInstanceId];v.invert(ci.invProjMatrix,L),ci.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1},no.prototype.markUsedJustification=function(l,f,c,d){var b;b=d===v.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(f)];for(var C=0,A=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];C<A.length;C+=1){var L=A[C];L>=0&&(l.text.placedSymbolArray.get(L).crossTileID=b>=0&&L!==b?0:c.crossTileID)}},no.prototype.markUsedOrientation=function(l,f,c){for(var d=f===v.WritingMode.horizontal||f===v.WritingMode.horizontalOnly?f:0,b=f===v.WritingMode.vertical?f:0,C=0,A=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];C<A.length;C+=1)l.text.placedSymbolArray.get(A[C]).placedOrientation=d;c.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=b)},no.prototype.commit=function(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,c=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var d=f?f.symbolFadeChange(l):1,b=f?f.opacities:{},C=f?f.variableOffsets:{},A=f?f.placedOrientations:{};for(var L in this.placements){var Z=this.placements[L],V=b[L];V?(this.opacities[L]=new Wo(V,d,Z.text,Z.icon),c=c||Z.text!==V.text.placed||Z.icon!==V.icon.placed):(this.opacities[L]=new Wo(null,d,Z.text,Z.icon,Z.skipFade),c=c||Z.text||Z.icon)}for(var le in b){var fe=b[le];if(!this.opacities[le]){var de=new Wo(fe,d,!1,!1);de.isHidden()||(this.opacities[le]=de,c=c||fe.text.placed||fe.icon.placed)}}for(var ke in C)this.variableOffsets[ke]||!this.opacities[ke]||this.opacities[ke].isHidden()||(this.variableOffsets[ke]=C[ke]);for(var Re in A)this.placedOrientations[Re]||!this.opacities[Re]||this.opacities[Re].isHidden()||(this.placedOrientations[Re]=A[Re]);c?this.lastPlacementChangeTime=l:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:l)},no.prototype.updateLayerOpacities=function(l,f){for(var c={},d=0,b=f;d<b.length;d+=1){var C=b[d],A=C.getBucket(l);A&&C.latestFeatureIndex&&l.id===A.layerIds[0]&&this.updateBucketOpacities(A,c,C.collisionBoxArray)}},no.prototype.updateBucketOpacities=function(l,f,c){var d=this;l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();var b=l.layers[0].layout,C=new Wo(null,0,!1,!1,!0),A=b.get("text-allow-overlap"),L=b.get("icon-allow-overlap"),Z=b.get("text-variable-anchor"),V=b.get("text-rotation-alignment")==="map",le=b.get("text-pitch-alignment")==="map",fe=b.get("icon-text-fit")!=="none",de=new Wo(null,0,A&&(L||!l.hasIconData()||b.get("icon-optional")),L&&(A||!l.hasTextData()||b.get("text-optional")),!0);!l.collisionArrays&&c&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(c);for(var ke=function(We,tt,bt){for(var Yt=0;Yt<tt/4;Yt++)We.opacityVertexArray.emplaceBack(bt)},Re=function(We){var tt=l.symbolInstances.get(We),bt=tt.numHorizontalGlyphVertices,Yt=tt.numVerticalGlyphVertices,zt=tt.crossTileID,$t=d.opacities[zt];f[zt]?$t=C:$t||(d.opacities[zt]=$t=de),f[zt]=!0;var gr=tt.numIconVertices>0,Br=d.placedOrientations[tt.crossTileID],Fr=Br===v.WritingMode.vertical,sn=Br===v.WritingMode.horizontal||Br===v.WritingMode.horizontalOnly;if(bt>0||Yt>0){var kn=lt($t.text);ke(l.text,bt,Fr?Lt:kn),ke(l.text,Yt,sn?Lt:kn);var Dn=$t.text.isHidden();[tt.rightJustifiedTextSymbolIndex,tt.centerJustifiedTextSymbolIndex,tt.leftJustifiedTextSymbolIndex].forEach(function(Vn){Vn>=0&&(l.text.placedSymbolArray.get(Vn).hidden=Dn||Fr?1:0)}),tt.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(tt.verticalPlacedTextSymbolIndex).hidden=Dn||sn?1:0);var zn=d.variableOffsets[tt.crossTileID];zn&&d.markUsedJustification(l,zn.anchor,tt,Br);var ci=d.placedOrientations[tt.crossTileID];ci&&(d.markUsedJustification(l,"left",tt,ci),d.markUsedOrientation(l,ci,tt))}if(gr){var ln=lt($t.icon),Hn=!(fe&&tt.verticalPlacedIconSymbolIndex&&Fr);tt.placedIconSymbolIndex>=0&&(ke(l.icon,tt.numIconVertices,Hn?ln:Lt),l.icon.placedSymbolArray.get(tt.placedIconSymbolIndex).hidden=$t.icon.isHidden()),tt.verticalPlacedIconSymbolIndex>=0&&(ke(l.icon,tt.numVerticalIconVertices,Hn?Lt:ln),l.icon.placedSymbolArray.get(tt.verticalPlacedIconSymbolIndex).hidden=$t.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){var fi=l.collisionArrays[We];if(fi){var Yn=new v.Point(0,0);if(fi.textBox||fi.verticalTextBox){var Zn=!0;if(Z){var vi=d.variableOffsets[zt];vi?(Yn=go(vi.anchor,vi.width,vi.height,vi.textOffset,vi.textBoxScale),V&&Yn._rotate(le?d.transform.angle:-d.transform.angle)):Zn=!1}fi.textBox&&ru(l.textCollisionBox.collisionVertexArray,$t.text.placed,!Zn||Fr,Yn.x,Yn.y),fi.verticalTextBox&&ru(l.textCollisionBox.collisionVertexArray,$t.text.placed,!Zn||sn,Yn.x,Yn.y)}var qn=Boolean(!sn&&fi.verticalIconBox);fi.iconBox&&ru(l.iconCollisionBox.collisionVertexArray,$t.icon.placed,qn,fe?Yn.x:0,fe?Yn.y:0),fi.verticalIconBox&&ru(l.iconCollisionBox.collisionVertexArray,$t.icon.placed,!qn,fe?Yn.x:0,fe?Yn.y:0)}}},He=0;He<l.symbolInstances.length;He++)Re(He);if(l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){var Ae=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ae.invProjMatrix,l.placementViewportMatrix=Ae.viewportMatrix,l.collisionCircleArray=Ae.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}},no.prototype.symbolFadeChange=function(l){return this.fadeDuration===0?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},no.prototype.zoomAdjustment=function(l){return Math.max(0,(this.transform.zoom-l)/1.5)},no.prototype.hasTransitions=function(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration},no.prototype.stillRecent=function(l,f){var c=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*c>l},no.prototype.setStale=function(){this.stale=!0};var _c=Math.pow(2,25),Os=Math.pow(2,24),ie=Math.pow(2,17),be=Math.pow(2,16),Qe=Math.pow(2,9),Ot=Math.pow(2,8),Dr=Math.pow(2,1);function lt(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;var f=l.placed?1:0,c=Math.floor(127*l.opacity);return c*_c+f*Os+c*ie+f*be+c*Qe+f*Ot+c*Dr+f}var Lt=0,io=function(l){this._sortAcrossTiles=l.layout.get("symbol-z-order")!=="viewport-y"&&l.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};io.prototype.continuePlacement=function(l,f,c,d,b){for(var C=this._bucketParts;this._currentTileIndex<l.length;)if(f.getBucketParts(C,d,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,C.sort(function(A,L){return A.sortKey-L.sortKey}));this._currentPartIndex<C.length;)if(f.placeLayerBucketPart(C[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,b())return!0;return!1};var $i=function(l,f,c,d,b,C,A){this.placement=new no(l,b,C,A),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1};$i.prototype.isDone=function(){return this._done},$i.prototype.continuePlacement=function(l,f,c){for(var d=this,b=v.browser.now(),C=function(){var Z=v.browser.now()-b;return!d._forceFullPlacement&&Z>2};this._currentPlacementIndex>=0;){var A=f[l[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=L)&&(!A.maxzoom||A.maxzoom>L)){if(this._inProgressLayer||(this._inProgressLayer=new io(A)),this._inProgressLayer.continuePlacement(c[A.source],this.placement,this._showCollisionBoxes,A,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},$i.prototype.commit=function(l){return this.placement.commit(l),this.placement};var Wa=512/v.EXTENT/2,qo=function(l,f,c){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(var d=0;d<f.length;d++){var b=f.get(d),C=b.key;this.indexedSymbolInstances[C]||(this.indexedSymbolInstances[C]=[]),this.indexedSymbolInstances[C].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,l)})}};qo.prototype.getScaledCoordinates=function(l,f){var c=Wa/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*v.EXTENT+l.anchorX)*c),y:Math.floor((f.canonical.y*v.EXTENT+l.anchorY)*c)}},qo.prototype.findMatches=function(l,f,c){for(var d=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),b=0;b<l.length;b++){var C=l.get(b);if(!C.crossTileID){var A=this.indexedSymbolInstances[C.key];if(A)for(var L=this.getScaledCoordinates(C,f),Z=0,V=A;Z<V.length;Z+=1){var le=V[Z];if(Math.abs(le.coord.x-L.x)<=d&&Math.abs(le.coord.y-L.y)<=d&&!c[le.crossTileID]){c[le.crossTileID]=!0,C.crossTileID=le.crossTileID;break}}}}};var xn=function(){this.maxCrossTileID=0};xn.prototype.generate=function(){return++this.maxCrossTileID};var dn=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};dn.prototype.handleWrapJump=function(l){var f=Math.round((l-this.lng)/360);if(f!==0)for(var c in this.indexes){var d=this.indexes[c],b={};for(var C in d){var A=d[C];A.tileID=A.tileID.unwrapTo(A.tileID.wrap+f),b[A.tileID.key]=A}this.indexes[c]=b}this.lng=l},dn.prototype.addBucket=function(l,f,c){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(var d=0;d<f.symbolInstances.length;d++)f.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});var b=this.usedCrossTileIDs[l.overscaledZ];for(var C in this.indexes){var A=this.indexes[C];if(Number(C)>l.overscaledZ)for(var L in A){var Z=A[L];Z.tileID.isChildOf(l)&&Z.findMatches(f.symbolInstances,l,b)}else{var V=A[l.scaledTo(Number(C)).key];V&&V.findMatches(f.symbolInstances,l,b)}}for(var le=0;le<f.symbolInstances.length;le++){var fe=f.symbolInstances.get(le);fe.crossTileID||(fe.crossTileID=c.generate(),b[fe.crossTileID]=!0)}return this.indexes[l.overscaledZ]===void 0&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new qo(l,f.symbolInstances,f.bucketInstanceId),!0},dn.prototype.removeBucketCrossTileIDs=function(l,f){for(var c in f.indexedSymbolInstances)for(var d=0,b=f.indexedSymbolInstances[c];d<b.length;d+=1)delete this.usedCrossTileIDs[l][b[d].crossTileID]},dn.prototype.removeStaleBuckets=function(l){var f=!1;for(var c in this.indexes){var d=this.indexes[c];for(var b in d)l[d[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[b]),delete d[b],f=!0)}return f};var Kt=function(){this.layerIndexes={},this.crossTileIDs=new xn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Kt.prototype.addLayer=function(l,f,c){var d=this.layerIndexes[l.id];d===void 0&&(d=this.layerIndexes[l.id]=new dn);var b=!1,C={};d.handleWrapJump(c);for(var A=0,L=f;A<L.length;A+=1){var Z=L[A],V=Z.getBucket(l);V&&l.id===V.layerIds[0]&&(V.bucketInstanceId||(V.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(Z.tileID,V,this.crossTileIDs)&&(b=!0),C[V.bucketInstanceId]=!0)}return d.removeStaleBuckets(C)&&(b=!0),b},Kt.prototype.pruneUnusedLayers=function(l){var f={};for(var c in l.forEach(function(d){f[d]=!0}),this.layerIndexes)f[c]||delete this.layerIndexes[c]};var Bo=function(l,f){return v.emitValidationErrors(l,f&&f.filter(function(c){return c.identifier!=="source.canvas"}))},xe=v.pick(qr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Vs=v.pick(qr,["setCenter","setZoom","setBearing","setPitch"]),nu=function(){var l={},f=v.styleSpec.$version;for(var c in v.styleSpec.$root){var d,b=v.styleSpec.$root[c];b.required&&(d=c==="version"?f:b.type==="array"?[]:{})!=null&&(l[c]=d)}return l}(),ls=function(l){function f(c,d){var b=this;d===void 0&&(d={}),l.call(this),this.map=c,this.dispatcher=new kt(Tt(),this),this.imageManager=new xt,this.imageManager.setEventedParent(this),this.glyphManager=new Xt(c._requestManager,d.localIdeographFontFamily),this.lineAtlas=new $e(256,512),this.crossTileSymbolIndex=new Kt,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var C=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(A){C.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:A.pluginStatus,pluginURL:A.pluginURL},function(L,Z){if(v.triggerPluginCompletionEvent(L),Z&&Z.every(function(le){return le}))for(var V in C.sourceCaches)C.sourceCaches[V].reload()})}),this.on("data",function(A){if(A.dataType==="source"&&A.sourceDataType==="metadata"){var L=b.sourceCaches[A.sourceId];if(L){var Z=L.getSource();if(Z&&Z.vectorLayerIds)for(var V in b._layers){var le=b._layers[V];le.source===Z.id&&b._validateLayer(le)}}}})}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.loadURL=function(c,d){var b=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var C=typeof d.validate=="boolean"?d.validate:!v.isMapboxURL(c);c=this.map._requestManager.normalizeStyleURL(c,d.accessToken);var A=this.map._requestManager.transformRequest(c,v.ResourceType.Style);this._request=v.getJSON(A,function(L,Z){b._request=null,L?b.fire(new v.ErrorEvent(L)):Z&&b._load(Z,C)})},f.prototype.loadJSON=function(c,d){var b=this;d===void 0&&(d={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){b._request=null,b._load(c,d.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(nu,!1)},f.prototype._load=function(c,d){if(!d||!Bo(this,v.validateStyle(c))){for(var b in this._loaded=!0,this.stylesheet=c,c.sources)this.addSource(b,c.sources[b],{validate:!1});c.sprite?this._loadSprite(c.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(c.glyphs);var C=Gr(this.stylesheet.layers);this._order=C.map(function(V){return V.id}),this._layers={},this._serializedLayers={};for(var A=0,L=C;A<L.length;A+=1){var Z=L[A];(Z=v.createStyleLayer(Z)).setEventedParent(this,{layer:{id:Z.id}}),this._layers[Z.id]=Z,this._serializedLayers[Z.id]=Z.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new pt(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},f.prototype._loadSprite=function(c){var d=this;this._spriteRequest=function(b,C,A){var L,Z,V,le=v.browser.devicePixelRatio>1?"@2x":"",fe=v.getJSON(C.transformRequest(C.normalizeSpriteURL(b,le,".json"),v.ResourceType.SpriteJSON),function(Re,He){fe=null,V||(V=Re,L=He,ke())}),de=v.getImage(C.transformRequest(C.normalizeSpriteURL(b,le,".png"),v.ResourceType.SpriteImage),function(Re,He){de=null,V||(V=Re,Z=He,ke())});function ke(){if(V)A(V);else if(L&&Z){var Re=v.browser.getImageData(Z),He={};for(var Ae in L){var We=L[Ae],tt=We.width,bt=We.height,Yt=We.x,zt=We.y,$t=We.sdf,gr=We.pixelRatio,Br=We.stretchX,Fr=We.stretchY,sn=We.content,kn=new v.RGBAImage({width:tt,height:bt});v.RGBAImage.copy(Re,kn,{x:Yt,y:zt},{x:0,y:0},{width:tt,height:bt}),He[Ae]={data:kn,pixelRatio:gr,sdf:$t,stretchX:Br,stretchY:Fr,content:sn}}A(null,He)}}return{cancel:function(){fe&&(fe.cancel(),fe=null),de&&(de.cancel(),de=null)}}}(c,this.map._requestManager,function(b,C){if(d._spriteRequest=null,b)d.fire(new v.ErrorEvent(b));else if(C)for(var A in C)d.imageManager.addImage(A,C[A]);d.imageManager.setLoaded(!0),d._availableImages=d.imageManager.listImages(),d.dispatcher.broadcast("setImages",d._availableImages),d.fire(new v.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(c){var d=this.sourceCaches[c.source];if(d){var b=c.sourceLayer;if(b){var C=d.getSource();(C.type==="geojson"||C.vectorLayerIds&&C.vectorLayerIds.indexOf(b)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+b+'" does not exist on source "'+C.id+'" as specified by style layer "'+c.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var c in this.sourceCaches)if(!this.sourceCaches[c].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(c){for(var d=[],b=0,C=c;b<C.length;b+=1){var A=this._layers[C[b]];A.type!=="custom"&&d.push(A.serialize())}return d},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var c in this.sourceCaches)if(this.sourceCaches[c].hasTransition())return!0;for(var d in this._layers)if(this._layers[d].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(c){if(this._loaded){var d=this._changed;if(this._changed){var b=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);for(var A in(b.length||C.length)&&this._updateWorkerLayers(b,C),this._updatedSources){var L=this._updatedSources[A];L==="reload"?this._reloadSource(A):L==="clear"&&this._clearSource(A)}for(var Z in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[Z].updateTransitions(c);this.light.updateTransitions(c),this._resetUpdates()}var V={};for(var le in this.sourceCaches){var fe=this.sourceCaches[le];V[le]=fe.used,fe.used=!1}for(var de=0,ke=this._order;de<ke.length;de+=1){var Re=this._layers[ke[de]];Re.recalculate(c,this._availableImages),!Re.isHidden(c.zoom)&&Re.source&&(this.sourceCaches[Re.source].used=!0)}for(var He in V){var Ae=this.sourceCaches[He];V[He]!==Ae.used&&Ae.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:He}))}this.light.recalculate(c),this.z=c.zoom,d&&this.fire(new v.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var c=Object.keys(this._changedImages);if(c.length){for(var d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],c);this._changedImages={}}},f.prototype._updateWorkerLayers=function(c,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(c),removedIds:d})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(c){var d=this;if(this._checkLoaded(),Bo(this,v.validateStyle(c)))return!1;(c=v.clone$1(c)).layers=Gr(c.layers);var b=function(A,L){if(!A)return[{command:qr.setStyle,args:[L]}];var Z=[];try{if(!v.deepEqual(A.version,L.version))return[{command:qr.setStyle,args:[L]}];v.deepEqual(A.center,L.center)||Z.push({command:qr.setCenter,args:[L.center]}),v.deepEqual(A.zoom,L.zoom)||Z.push({command:qr.setZoom,args:[L.zoom]}),v.deepEqual(A.bearing,L.bearing)||Z.push({command:qr.setBearing,args:[L.bearing]}),v.deepEqual(A.pitch,L.pitch)||Z.push({command:qr.setPitch,args:[L.pitch]}),v.deepEqual(A.sprite,L.sprite)||Z.push({command:qr.setSprite,args:[L.sprite]}),v.deepEqual(A.glyphs,L.glyphs)||Z.push({command:qr.setGlyphs,args:[L.glyphs]}),v.deepEqual(A.transition,L.transition)||Z.push({command:qr.setTransition,args:[L.transition]}),v.deepEqual(A.light,L.light)||Z.push({command:qr.setLight,args:[L.light]});var V={},le=[];(function(de,ke,Re,He){var Ae;for(Ae in ke=ke||{},de=de||{})de.hasOwnProperty(Ae)&&(ke.hasOwnProperty(Ae)||tn(Ae,Re,He));for(Ae in ke)ke.hasOwnProperty(Ae)&&(de.hasOwnProperty(Ae)?v.deepEqual(de[Ae],ke[Ae])||(de[Ae].type==="geojson"&&ke[Ae].type==="geojson"&&Ji(de,ke,Ae)?Re.push({command:qr.setGeoJSONSourceData,args:[Ae,ke[Ae].data]}):Ci(Ae,ke,Re,He)):ni(Ae,ke,Re))})(A.sources,L.sources,le,V);var fe=[];A.layers&&A.layers.forEach(function(de){V[de.source]?Z.push({command:qr.removeLayer,args:[de.id]}):fe.push(de)}),Z=Z.concat(le),function(de,ke,Re){ke=ke||[];var He,Ae,We,tt,bt,Yt,zt,$t=(de=de||[]).map(Pi),gr=ke.map(Pi),Br=de.reduce(xi,{}),Fr=ke.reduce(xi,{}),sn=$t.slice(),kn=Object.create(null);for(He=0,Ae=0;He<$t.length;He++)Fr.hasOwnProperty(We=$t[He])?Ae++:(Re.push({command:qr.removeLayer,args:[We]}),sn.splice(sn.indexOf(We,Ae),1));for(He=0,Ae=0;He<gr.length;He++)sn[sn.length-1-He]!==(We=gr[gr.length-1-He])&&(Br.hasOwnProperty(We)?(Re.push({command:qr.removeLayer,args:[We]}),sn.splice(sn.lastIndexOf(We,sn.length-Ae),1)):Ae++,Re.push({command:qr.addLayer,args:[Fr[We],Yt=sn[sn.length-He]]}),sn.splice(sn.length-He,0,We),kn[We]=!0);for(He=0;He<gr.length;He++)if(tt=Br[We=gr[He]],bt=Fr[We],!kn[We]&&!v.deepEqual(tt,bt))if(v.deepEqual(tt.source,bt.source)&&v.deepEqual(tt["source-layer"],bt["source-layer"])&&v.deepEqual(tt.type,bt.type)){for(zt in yi(tt.layout,bt.layout,Re,We,null,qr.setLayoutProperty),yi(tt.paint,bt.paint,Re,We,null,qr.setPaintProperty),v.deepEqual(tt.filter,bt.filter)||Re.push({command:qr.setFilter,args:[We,bt.filter]}),v.deepEqual(tt.minzoom,bt.minzoom)&&v.deepEqual(tt.maxzoom,bt.maxzoom)||Re.push({command:qr.setLayerZoomRange,args:[We,bt.minzoom,bt.maxzoom]}),tt)tt.hasOwnProperty(zt)&&zt!=="layout"&&zt!=="paint"&&zt!=="filter"&&zt!=="metadata"&&zt!=="minzoom"&&zt!=="maxzoom"&&(zt.indexOf("paint.")===0?yi(tt[zt],bt[zt],Re,We,zt.slice(6),qr.setPaintProperty):v.deepEqual(tt[zt],bt[zt])||Re.push({command:qr.setLayerProperty,args:[We,zt,bt[zt]]}));for(zt in bt)bt.hasOwnProperty(zt)&&!tt.hasOwnProperty(zt)&&zt!=="layout"&&zt!=="paint"&&zt!=="filter"&&zt!=="metadata"&&zt!=="minzoom"&&zt!=="maxzoom"&&(zt.indexOf("paint.")===0?yi(tt[zt],bt[zt],Re,We,zt.slice(6),qr.setPaintProperty):v.deepEqual(tt[zt],bt[zt])||Re.push({command:qr.setLayerProperty,args:[We,zt,bt[zt]]}))}else Re.push({command:qr.removeLayer,args:[We]}),Yt=sn[sn.lastIndexOf(We)+1],Re.push({command:qr.addLayer,args:[bt,Yt]})}(fe,L.layers,Z)}catch(de){console.warn("Unable to compute style diff:",de),Z=[{command:qr.setStyle,args:[L]}]}return Z}(this.serialize(),c).filter(function(A){return!(A.command in Vs)});if(b.length===0)return!1;var C=b.filter(function(A){return!(A.command in xe)});if(C.length>0)throw new Error("Unimplemented: "+C.map(function(A){return A.command}).join(", ")+".");return b.forEach(function(A){A.command!=="setTransition"&&d[A.command].apply(d,A.args)}),this.stylesheet=c,!0},f.prototype.addImage=function(c,d){if(this.getImage(c))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(c,d),this._afterImageUpdated(c)},f.prototype.updateImage=function(c,d){this.imageManager.updateImage(c,d)},f.prototype.getImage=function(c){return this.imageManager.getImage(c)},f.prototype.removeImage=function(c){if(!this.getImage(c))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(c),this._afterImageUpdated(c)},f.prototype._afterImageUpdated=function(c){this._availableImages=this.imageManager.listImages(),this._changedImages[c]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(c,d,b){var C=this;if(b===void 0&&(b={}),this._checkLoaded(),this.sourceCaches[c]!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(d).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(v.validateStyle.source,"sources."+c,d,null,b))){this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);var A=this.sourceCaches[c]=new Be(c,d,this.dispatcher);A.style=this,A.setEventedParent(this,function(){return{isSourceLoaded:C.loaded(),source:A.serialize(),sourceId:c}}),A.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(c){if(this._checkLoaded(),this.sourceCaches[c]===void 0)throw new Error("There is no source with this ID");for(var d in this._layers)if(this._layers[d].source===c)return this.fire(new v.ErrorEvent(new Error('Source "'+c+'" cannot be removed while layer "'+d+'" is using it.')));var b=this.sourceCaches[c];delete this.sourceCaches[c],delete this._updatedSources[c],b.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:c})),b.setEventedParent(null),b.clearTiles(),b.onRemove&&b.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(c,d){this._checkLoaded(),this.sourceCaches[c].getSource().setData(d),this._changed=!0},f.prototype.getSource=function(c){return this.sourceCaches[c]&&this.sourceCaches[c].getSource()},f.prototype.addLayer=function(c,d,b){b===void 0&&(b={}),this._checkLoaded();var C=c.id;if(this.getLayer(C))this.fire(new v.ErrorEvent(new Error('Layer with id "'+C+'" already exists on this map')));else{var A;if(c.type==="custom"){if(Bo(this,v.validateCustomStyleLayer(c)))return;A=v.createStyleLayer(c)}else{if(typeof c.source=="object"&&(this.addSource(C,c.source),c=v.clone$1(c),c=v.extend(c,{source:C})),this._validate(v.validateStyle.layer,"layers."+C,c,{arrayIndex:-1},b))return;A=v.createStyleLayer(c),this._validateLayer(A),A.setEventedParent(this,{layer:{id:C}}),this._serializedLayers[A.id]=A.serialize()}var L=d?this._order.indexOf(d):this._order.length;if(d&&L===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.')));else{if(this._order.splice(L,0,C),this._layerOrderChanged=!0,this._layers[C]=A,this._removedLayers[C]&&A.source&&A.type!=="custom"){var Z=this._removedLayers[C];delete this._removedLayers[C],Z.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",this.sourceCaches[A.source].pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map)}}},f.prototype.moveLayer=function(c,d){if(this._checkLoaded(),this._changed=!0,this._layers[c]){if(c!==d){var b=this._order.indexOf(c);this._order.splice(b,1);var C=d?this._order.indexOf(d):this._order.length;d&&C===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+d+'" does not exist on this map.'))):(this._order.splice(C,0,c),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(c){this._checkLoaded();var d=this._layers[c];if(d){d.setEventedParent(null);var b=this._order.indexOf(c);this._order.splice(b,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[c]=d,delete this._layers[c],delete this._serializedLayers[c],delete this._updatedLayers[c],delete this._updatedPaintProps[c],d.onRemove&&d.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(c){return this._layers[c]},f.prototype.hasLayer=function(c){return c in this._layers},f.prototype.setLayerZoomRange=function(c,d,b){this._checkLoaded();var C=this.getLayer(c);C?C.minzoom===d&&C.maxzoom===b||(d!=null&&(C.minzoom=d),b!=null&&(C.maxzoom=b),this._updateLayer(C)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(c,d,b){b===void 0&&(b={}),this._checkLoaded();var C=this.getLayer(c);if(C){if(!v.deepEqual(C.filter,d))return d==null?(C.filter=void 0,void this._updateLayer(C)):void(this._validate(v.validateStyle.filter,"layers."+C.id+".filter",d,null,b)||(C.filter=v.clone$1(d),this._updateLayer(C)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(c){return v.clone$1(this.getLayer(c).filter)},f.prototype.setLayoutProperty=function(c,d,b,C){C===void 0&&(C={}),this._checkLoaded();var A=this.getLayer(c);A?v.deepEqual(A.getLayoutProperty(d),b)||(A.setLayoutProperty(d,b,C),this._updateLayer(A)):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(c,d){var b=this.getLayer(c);if(b)return b.getLayoutProperty(d);this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(c,d,b,C){C===void 0&&(C={}),this._checkLoaded();var A=this.getLayer(c);A?v.deepEqual(A.getPaintProperty(d),b)||(A.setPaintProperty(d,b,C)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[c]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+c+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(c,d){return this.getLayer(c).getPaintProperty(d)},f.prototype.setFeatureState=function(c,d){this._checkLoaded();var b=c.source,C=c.sourceLayer,A=this.sourceCaches[b];if(A!==void 0){var L=A.getSource().type;L==="geojson"&&C?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):L!=="vector"||C?(c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),A.setFeatureState(C,c.id,d)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(c,d){this._checkLoaded();var b=c.source,C=this.sourceCaches[b];if(C!==void 0){var A=C.getSource().type,L=A==="vector"?c.sourceLayer:void 0;A!=="vector"||L?d&&typeof c.id!="string"&&typeof c.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):C.removeFeatureState(L,c.id,d):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+b+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(c){this._checkLoaded();var d=c.source,b=c.sourceLayer,C=this.sourceCaches[d];if(C!==void 0){if(C.getSource().type!=="vector"||b)return c.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),C.getFeatureState(b,c.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+d+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(c){return c.serialize()}),layers:this._serializeLayers(this._order)},function(c){return c!==void 0})},f.prototype._updateLayer=function(c){this._updatedLayers[c.id]=!0,c.source&&!this._updatedSources[c.source]&&this.sourceCaches[c.source].getSource().type!=="raster"&&(this._updatedSources[c.source]="reload",this.sourceCaches[c.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(c){for(var d=this,b=function(Br){return d._layers[Br].type==="fill-extrusion"},C={},A=[],L=this._order.length-1;L>=0;L--){var Z=this._order[L];if(b(Z)){C[Z]=L;for(var V=0,le=c;V<le.length;V+=1){var fe=le[V][Z];if(fe)for(var de=0,ke=fe;de<ke.length;de+=1)A.push(ke[de])}}}A.sort(function(Br,Fr){return Fr.intersectionZ-Br.intersectionZ});for(var Re=[],He=this._order.length-1;He>=0;He--){var Ae=this._order[He];if(b(Ae))for(var We=A.length-1;We>=0;We--){var tt=A[We].feature;if(C[tt.layer.id]<He)break;Re.push(tt),A.pop()}else for(var bt=0,Yt=c;bt<Yt.length;bt+=1){var zt=Yt[bt][Ae];if(zt)for(var $t=0,gr=zt;$t<gr.length;$t+=1)Re.push(gr[$t].feature)}}return Re},f.prototype.queryRenderedFeatures=function(c,d,b){d&&d.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",d.filter,null,d);var C={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var A=0,L=d.layers;A<L.length;A+=1){var Z=L[A],V=this._layers[Z];if(!V)return this.fire(new v.ErrorEvent(new Error("The layer '"+Z+"' does not exist in the map's style and cannot be queried for features."))),[];C[V.source]=!0}}var le=[];for(var fe in d.availableImages=this._availableImages,this.sourceCaches)d.layers&&!C[fe]||le.push(hn(this.sourceCaches[fe],this._layers,this._serializedLayers,c,d,b));return this.placement&&le.push(function(de,ke,Re,He,Ae,We,tt){for(var bt={},Yt=We.queryRenderedSymbols(He),zt=[],$t=0,gr=Object.keys(Yt).map(Number);$t<gr.length;$t+=1)zt.push(tt[gr[$t]]);zt.sort(Yi);for(var Br=function(){var zn=sn[Fr],ci=zn.featureIndex.lookupSymbolFeatures(Yt[zn.bucketInstanceId],ke,zn.bucketIndex,zn.sourceLayerIndex,Ae.filter,Ae.layers,Ae.availableImages,de);for(var ln in ci){var Hn=bt[ln]=bt[ln]||[],fi=ci[ln];fi.sort(function(vi,qn){var Vn=zn.featureSortOrder;if(Vn){var To=Vn.indexOf(vi.featureIndex);return Vn.indexOf(qn.featureIndex)-To}return qn.featureIndex-vi.featureIndex});for(var Yn=0,Zn=fi;Yn<Zn.length;Yn+=1)Hn.push(Zn[Yn])}},Fr=0,sn=zt;Fr<sn.length;Fr+=1)Br();var kn=function(zn){bt[zn].forEach(function(ci){var ln=ci.feature,Hn=Re[de[zn].source].getFeatureState(ln.layer["source-layer"],ln.id);ln.source=ln.layer.source,ln.layer["source-layer"]&&(ln.sourceLayer=ln.layer["source-layer"]),ln.state=Hn})};for(var Dn in bt)kn(Dn);return bt}(this._layers,this._serializedLayers,this.sourceCaches,c,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(le)},f.prototype.querySourceFeatures=function(c,d){d&&d.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",d.filter,null,d);var b=this.sourceCaches[c];return b?function(C,A){for(var L=C.getRenderableIds().map(function(ke){return C.getTileByID(ke)}),Z=[],V={},le=0;le<L.length;le++){var fe=L[le],de=fe.tileID.canonical.key;V[de]||(V[de]=!0,fe.querySourceFeatures(Z,A))}return Z}(b,d):[]},f.prototype.addSourceType=function(c,d,b){return f.getSourceType(c)?b(new Error('A source type called "'+c+'" already exists.')):(f.setSourceType(c,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:d.workerSourceURL},b):b(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(c,d){d===void 0&&(d={}),this._checkLoaded();var b=this.light.getLight(),C=!1;for(var A in c)if(!v.deepEqual(c[A],b[A])){C=!0;break}if(C){var L={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(c,d),this.light.updateTransitions(L)}},f.prototype._validate=function(c,d,b,C,A){return A===void 0&&(A={}),(!A||A.validate!==!1)&&Bo(this,c.call(v.validateStyle,v.extend({key:d,style:this.serialize(),value:b,styleSpec:v.styleSpec},C)))},f.prototype._remove=function(){for(var c in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[c].setEventedParent(null);for(var d in this.sourceCaches)this.sourceCaches[d].clearTiles(),this.sourceCaches[d].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(c){this.sourceCaches[c].clearTiles()},f.prototype._reloadSource=function(c){this.sourceCaches[c].resume(),this.sourceCaches[c].reload()},f.prototype._updateSources=function(c){for(var d in this.sourceCaches)this.sourceCaches[d].update(c)},f.prototype._generateCollisionBoxes=function(){for(var c in this.sourceCaches)this._reloadSource(c)},f.prototype._updatePlacement=function(c,d,b,C,A){A===void 0&&(A=!1);for(var L=!1,Z=!1,V={},le=0,fe=this._order;le<fe.length;le+=1){var de=this._layers[fe[le]];if(de.type==="symbol"){if(!V[de.source]){var ke=this.sourceCaches[de.source];V[de.source]=ke.getRenderableIds(!0).map(function(tt){return ke.getTileByID(tt)}).sort(function(tt,bt){return bt.tileID.overscaledZ-tt.tileID.overscaledZ||(tt.tileID.isLessThan(bt.tileID)?-1:1)})}var Re=this.crossTileSymbolIndex.addLayer(de,V[de.source],c.center.lng);L=L||Re}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((A=A||this._layerOrderChanged||b===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),c.zoom))&&(this.pauseablePlacement=new $i(c,this._order,A,d,b,C,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,V),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),Z=!0),L&&this.pauseablePlacement.placement.setStale()),Z||L)for(var He=0,Ae=this._order;He<Ae.length;He+=1){var We=this._layers[Ae[He]];We.type==="symbol"&&this.placement.updateLayerOpacities(We,V[We.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var c in this.sourceCaches)this.sourceCaches[c].releaseSymbolFadeTiles()},f.prototype.getImages=function(c,d,b){this.imageManager.getImages(d.icons,b),this._updateTilesForChangedImages();var C=this.sourceCaches[d.source];C&&C.setDependencies(d.tileID.key,d.type,d.icons)},f.prototype.getGlyphs=function(c,d,b){this.glyphManager.getGlyphs(d.stacks,b)},f.prototype.getResource=function(c,d,b){return v.makeRequest(d,b)},f}(v.Evented);ls.getSourceType=function(l){return Cr[l]},ls.setSourceType=function(l,f){Cr[l]=f},ls.registerForPluginStateChange=v.registerForPluginStateChange;var sa=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),yo=Gi(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Wl=Gi(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),xc=Gi(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),zu=Gi(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),bc=Gi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),El=Gi(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Uu=Gi(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),iu=Gi("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Zu=Gi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),g=Gi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),w=Gi(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),B=Gi(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),O=Gi(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),q=Gi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),_e=Gi(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Xe=Gi(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),ct=Gi(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),mt=Gi(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),lr=Gi(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Er=Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),In=Gi(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),si=Gi(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Jn=Gi(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Xi=Gi(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),fa=Gi(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Ia=Gi(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Gi(l,f){var c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=f.match(/attribute ([\w]+) ([\w]+)/g),b=l.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=C?C.concat(b):b,L={};return{fragmentSource:l=l.replace(c,function(Z,V,le,fe,de){return L[de]=!0,V==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
varying `+le+" "+fe+" "+de+`;
#else
uniform `+le+" "+fe+" u_"+de+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+de+`
    `+le+" "+fe+" "+de+" = u_"+de+`;
#endif
`}),vertexSource:f=f.replace(c,function(Z,V,le,fe,de){var ke=fe==="float"?"vec2":"vec4",Re=de.match(/color/)?"color":ke;return L[de]?V==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
uniform lowp float u_`+de+`_t;
attribute `+le+" "+ke+" a_"+de+`;
varying `+le+" "+fe+" "+de+`;
#else
uniform `+le+" "+fe+" u_"+de+`;
#endif
`:Re==="vec4"?`
#ifndef HAS_UNIFORM_u_`+de+`
    `+de+" = a_"+de+`;
#else
    `+le+" "+fe+" "+de+" = u_"+de+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+de+`
    `+de+" = unpack_mix_"+Re+"(a_"+de+", u_"+de+`_t);
#else
    `+le+" "+fe+" "+de+" = u_"+de+`;
#endif
`:V==="define"?`
#ifndef HAS_UNIFORM_u_`+de+`
uniform lowp float u_`+de+`_t;
attribute `+le+" "+ke+" a_"+de+`;
#else
uniform `+le+" "+fe+" u_"+de+`;
#endif
`:Re==="vec4"?`
#ifndef HAS_UNIFORM_u_`+de+`
    `+le+" "+fe+" "+de+" = a_"+de+`;
#else
    `+le+" "+fe+" "+de+" = u_"+de+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+de+`
    `+le+" "+fe+" "+de+" = unpack_mix_"+Re+"(a_"+de+", u_"+de+`_t);
#else
    `+le+" "+fe+" "+de+" = u_"+de+`;
#endif
`}),staticAttributes:d,staticUniforms:A}}var Lo=Object.freeze({__proto__:null,prelude:yo,background:Wl,backgroundPattern:xc,circle:zu,clippingMask:bc,heatmap:El,heatmapTexture:Uu,collisionBox:iu,collisionCircle:Zu,debug:g,fill:w,fillOutline:B,fillOutlinePattern:O,fillPattern:q,fillExtrusion:_e,fillExtrusionPattern:Xe,hillshadePrepare:ct,hillshade:mt,line:lr,lineGradient:Er,linePattern:In,lineSDF:si,raster:Jn,symbolIcon:Xi,symbolSDF:fa,symbolTextAndIcon:Ia}),gs=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function il(l){for(var f=[],c=0;c<l.length;c++)if(l[c]!==null){var d=l[c].split(" ");f.push(d.pop())}return f}gs.prototype.bind=function(l,f,c,d,b,C,A,L){this.context=l;for(var Z=this.boundPaintVertexBuffers.length!==d.length,V=0;!Z&&V<d.length;V++)this.boundPaintVertexBuffers[V]!==d[V]&&(Z=!0);l.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===c&&!Z&&this.boundIndexBuffer===b&&this.boundVertexOffset===C&&this.boundDynamicVertexBuffer===A&&this.boundDynamicVertexBuffer2===L?(l.bindVertexArrayOES.set(this.vao),A&&A.bind(),b&&b.dynamicDraw&&b.bind(),L&&L.bind()):this.freshBind(f,c,d,b,C,A,L)},gs.prototype.freshBind=function(l,f,c,d,b,C,A){var L,Z=l.numAttributes,V=this.context,le=V.gl;if(V.extVertexArrayObject)this.vao&&this.destroy(),this.vao=V.extVertexArrayObject.createVertexArrayOES(),V.bindVertexArrayOES.set(this.vao),L=0,this.boundProgram=l,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=C,this.boundDynamicVertexBuffer2=A;else{L=V.currentNumAttributes||0;for(var fe=Z;fe<L;fe++)le.disableVertexAttribArray(fe)}f.enableAttributes(le,l);for(var de=0,ke=c;de<ke.length;de+=1)ke[de].enableAttributes(le,l);C&&C.enableAttributes(le,l),A&&A.enableAttributes(le,l),f.bind(),f.setVertexAttribPointers(le,l,b);for(var Re=0,He=c;Re<He.length;Re+=1){var Ae=He[Re];Ae.bind(),Ae.setVertexAttribPointers(le,l,b)}C&&(C.bind(),C.setVertexAttribPointers(le,l,b)),d&&d.bind(),A&&(A.bind(),A.setVertexAttribPointers(le,l,b)),V.currentNumAttributes=Z},gs.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Xc=function(l,f,c,d,b,C){var A=l.gl;this.program=A.createProgram();for(var L=il(c.staticAttributes),Z=d?d.getBinderAttributes():[],V=L.concat(Z),le=c.staticUniforms?il(c.staticUniforms):[],fe=d?d.getBinderUniforms():[],de=[],ke=0,Re=le.concat(fe);ke<Re.length;ke+=1){var He=Re[ke];de.indexOf(He)<0&&de.push(He)}var Ae=d?d.defines():[];C&&Ae.push("#define OVERDRAW_INSPECTOR;");var We=Ae.concat(yo.fragmentSource,c.fragmentSource).join(`
`),tt=Ae.concat(yo.vertexSource,c.vertexSource).join(`
`),bt=A.createShader(A.FRAGMENT_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(bt,We),A.compileShader(bt),A.attachShader(this.program,bt);var Yt=A.createShader(A.VERTEX_SHADER);if(A.isContextLost())this.failedToCreate=!0;else{A.shaderSource(Yt,tt),A.compileShader(Yt),A.attachShader(this.program,Yt),this.attributes={};var zt={};this.numAttributes=V.length;for(var $t=0;$t<this.numAttributes;$t++)V[$t]&&(A.bindAttribLocation(this.program,$t,V[$t]),this.attributes[V[$t]]=$t);A.linkProgram(this.program),A.deleteShader(Yt),A.deleteShader(bt);for(var gr=0;gr<de.length;gr++){var Br=de[gr];if(Br&&!zt[Br]){var Fr=A.getUniformLocation(this.program,Br);Fr&&(zt[Br]=Fr)}}this.fixedUniforms=b(l,zt),this.binderUniforms=d?d.getUniforms(l,zt):[]}}};function ju(l,f,c){var d=1/Ki(c,1,f.transform.tileZoom),b=Math.pow(2,c.tileID.overscaledZ),C=c.tileSize*Math.pow(2,f.transform.tileZoom)/b,A=C*(c.tileID.canonical.x+c.tileID.wrap*b),L=C*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[d,l.fromScale,l.toScale],u_fade:l.t,u_pixel_coord_upper:[A>>16,L>>16],u_pixel_coord_lower:[65535&A,65535&L]}}Xc.prototype.draw=function(l,f,c,d,b,C,A,L,Z,V,le,fe,de,ke,Re,He){var Ae,We=l.gl;if(!this.failedToCreate){for(var tt in l.program.set(this.program),l.setDepthMode(c),l.setStencilMode(d),l.setColorMode(b),l.setCullFace(C),this.fixedUniforms)this.fixedUniforms[tt].set(A[tt]);ke&&ke.setUniforms(l,this.binderUniforms,fe,{zoom:de});for(var bt=(Ae={},Ae[We.LINES]=2,Ae[We.TRIANGLES]=3,Ae[We.LINE_STRIP]=1,Ae)[f],Yt=0,zt=le.get();Yt<zt.length;Yt+=1){var $t=zt[Yt],gr=$t.vaos||($t.vaos={});(gr[L]||(gr[L]=new gs)).bind(l,this,Z,ke?ke.getPaintVertexBuffers():[],V,$t.vertexOffset,Re,He),We.drawElements(f,$t.primitiveLength*bt,We.UNSIGNED_SHORT,$t.primitiveOffset*bt*2)}}};var Ec=function(l,f,c,d){var b=f.style.light,C=b.properties.get("position"),A=[C.x,C.y,C.z],L=v.create$1();b.properties.get("anchor")==="viewport"&&v.fromRotation(L,-f.transform.angle),v.transformMat3(A,A,L);var Z=b.properties.get("color");return{u_matrix:l,u_lightpos:A,u_lightintensity:b.properties.get("intensity"),u_lightcolor:[Z.r,Z.g,Z.b],u_vertical_gradient:+c,u_opacity:d}},Eu=function(l,f,c,d,b,C,A){return v.extend(Ec(l,f,c,d),ju(C,f,A),{u_height_factor:-Math.pow(2,b.overscaledZ)/A.tileSize/8})},hu=function(l){return{u_matrix:l}},wo=function(l,f,c,d){return v.extend(hu(l),ju(c,f,d))},ha=function(l,f){return{u_matrix:l,u_world:f}},oh=function(l,f,c,d,b){return v.extend(wo(l,f,c,d),{u_world:b})},sh=function(l,f,c,d){var b,C,A=l.transform;if(d.paint.get("circle-pitch-alignment")==="map"){var L=Ki(c,1,A.zoom);b=!0,C=[L,L]}else b=!1,C=A.pixelsToGLUnits;return{u_camera_to_center_distance:A.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:l.translatePosMatrix(f.posMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:C}},fo=function(l,f,c){var d=Ki(c,1,f.zoom),b=Math.pow(2,f.zoom-c.tileID.overscaledZ),C=c.tileID.overscaleFactor();return{u_matrix:l,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[f.pixelsToGLUnits[0]/(d*b),f.pixelsToGLUnits[1]/(d*b)],u_overscale_factor:C}},wf=function(l,f,c){return{u_matrix:l,u_inv_matrix:f,u_camera_to_center_distance:c.cameraToCenterDistance,u_viewport_size:[c.width,c.height]}},pu=function(l,f,c){return c===void 0&&(c=1),{u_matrix:l,u_color:f,u_overlay:0,u_overlay_scale:c}},Rs=function(l){return{u_matrix:l}},Sc=function(l,f,c,d){return{u_matrix:l,u_extrude_scale:Ki(f,1,c),u_intensity:d}},al=function(l,f,c){var d=l.transform;return{u_matrix:Af(l,f,c),u_ratio:1/Ki(f,1,d.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]]}},Ea=function(l,f,c,d){return v.extend(al(l,f,c),{u_image:0,u_image_height:d})},Sl=function(l,f,c,d){var b=l.transform,C=ts(f,b);return{u_matrix:Af(l,f,c),u_texsize:f.imageAtlasTexture.size,u_ratio:1/Ki(f,1,b.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[C,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Xl=function(l,f,c,d,b){var C=l.lineAtlas,A=ts(f,l.transform),L=c.layout.get("line-cap")==="round",Z=C.getDash(d.from,L),V=C.getDash(d.to,L),le=Z.width*b.fromScale,fe=V.width*b.toScale;return v.extend(al(l,f,c),{u_patternscale_a:[A/le,-Z.height/2],u_patternscale_b:[A/fe,-V.height/2],u_sdfgamma:C.width/(256*Math.min(le,fe)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:Z.y,u_tex_y_b:V.y,u_mix:b.t})};function ts(l,f){return 1/Ki(l,1,f.tileZoom)}function Af(l,f,c){return l.translatePosMatrix(f.tileID.posMatrix,f,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}var uh=function(l,f,c,d,b){return{u_matrix:l,u_tl_parent:f,u_scale_parent:c,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*b.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:b.paint.get("raster-brightness-min"),u_brightness_high:b.paint.get("raster-brightness-max"),u_saturation_factor:(A=b.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(C=b.paint.get("raster-contrast"),C>0?1/(1-C):1+C),u_spin_weights:lh(b.paint.get("raster-hue-rotate"))};var C,A};function lh(l){l*=Math.PI/180;var f=Math.sin(l),c=Math.cos(l);return[(2*c+1)/3,(-Math.sqrt(3)*f-c+1)/3,(Math.sqrt(3)*f-c+1)/3]}var Yc,ol=function(l,f,c,d,b,C,A,L,Z,V){var le=b.transform;return{u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_pitch:le.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:le.width/le.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:A,u_coord_matrix:L,u_is_text:+Z,u_pitch_with_map:+d,u_texsize:V,u_texture:0}},No=function(l,f,c,d,b,C,A,L,Z,V,le){var fe=b.transform;return v.extend(ol(l,f,c,d,b,C,A,L,Z,V),{u_gamma_scale:d?Math.cos(fe._pitch)*fe.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+le})},Su=function(l,f,c,d,b,C,A,L,Z,V){return v.extend(No(l,f,c,d,b,C,A,L,!0,Z,!0),{u_texsize_icon:V,u_texture_icon:1})},Vu=function(l,f,c){return{u_matrix:l,u_opacity:f,u_color:c}},zo=function(l,f,c,d,b,C){return v.extend(function(A,L,Z,V){var le=Z.imageManager.getPattern(A.from.toString()),fe=Z.imageManager.getPattern(A.to.toString()),de=Z.imageManager.getPixelSize(),ke=de.width,Re=de.height,He=Math.pow(2,V.tileID.overscaledZ),Ae=V.tileSize*Math.pow(2,Z.transform.tileZoom)/He,We=Ae*(V.tileID.canonical.x+V.tileID.wrap*He),tt=Ae*V.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:le.tl,u_pattern_br_a:le.br,u_pattern_tl_b:fe.tl,u_pattern_br_b:fe.br,u_texsize:[ke,Re],u_mix:L.t,u_pattern_size_a:le.displaySize,u_pattern_size_b:fe.displaySize,u_scale_a:L.fromScale,u_scale_b:L.toScale,u_tile_units_to_pixels:1/Ki(V,1,Z.transform.tileZoom),u_pixel_coord_upper:[We>>16,tt>>16],u_pixel_coord_lower:[65535&We,65535&tt]}}(d,C,c,b),{u_matrix:l,u_opacity:f})},Cl={fillExtrusion:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fillExtrusionPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_lightpos:new v.Uniform3f(l,f.u_lightpos),u_lightintensity:new v.Uniform1f(l,f.u_lightintensity),u_lightcolor:new v.Uniform3f(l,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(l,f.u_vertical_gradient),u_height_factor:new v.Uniform1f(l,f.u_height_factor),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade),u_opacity:new v.Uniform1f(l,f.u_opacity)}},fill:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},fillPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},fillOutline:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world)}},fillOutlinePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_texsize:new v.Uniform2f(l,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},circle:function(l,f){return{u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(l,f.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},collisionBox:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(l,f.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(l,f.u_extrude_scale),u_overscale_factor:new v.Uniform1f(l,f.u_overscale_factor)}},collisionCircle:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_inv_matrix:new v.UniformMatrix4f(l,f.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(l,f.u_viewport_size)}},debug:function(l,f){return{u_color:new v.UniformColor(l,f.u_color),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_overlay:new v.Uniform1i(l,f.u_overlay),u_overlay_scale:new v.Uniform1f(l,f.u_overlay_scale)}},clippingMask:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmap:function(l,f){return{u_extrude_scale:new v.Uniform1f(l,f.u_extrude_scale),u_intensity:new v.Uniform1f(l,f.u_intensity),u_matrix:new v.UniformMatrix4f(l,f.u_matrix)}},heatmapTexture:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_world:new v.Uniform2f(l,f.u_world),u_image:new v.Uniform1i(l,f.u_image),u_color_ramp:new v.Uniform1i(l,f.u_color_ramp),u_opacity:new v.Uniform1f(l,f.u_opacity)}},hillshade:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_latrange:new v.Uniform2f(l,f.u_latrange),u_light:new v.Uniform2f(l,f.u_light),u_shadow:new v.UniformColor(l,f.u_shadow),u_highlight:new v.UniformColor(l,f.u_highlight),u_accent:new v.UniformColor(l,f.u_accent)}},hillshadePrepare:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_image:new v.Uniform1i(l,f.u_image),u_dimension:new v.Uniform2f(l,f.u_dimension),u_zoom:new v.Uniform1f(l,f.u_zoom),u_unpack:new v.Uniform4f(l,f.u_unpack)}},line:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels)}},lineGradient:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_image:new v.Uniform1i(l,f.u_image),u_image_height:new v.Uniform1f(l,f.u_image_height)}},linePattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_texsize:new v.Uniform2f(l,f.u_texsize),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_image:new v.Uniform1i(l,f.u_image),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_scale:new v.Uniform3f(l,f.u_scale),u_fade:new v.Uniform1f(l,f.u_fade)}},lineSDF:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_ratio:new v.Uniform1f(l,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(l,f.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(l,f.u_patternscale_a),u_patternscale_b:new v.Uniform2f(l,f.u_patternscale_b),u_sdfgamma:new v.Uniform1f(l,f.u_sdfgamma),u_image:new v.Uniform1i(l,f.u_image),u_tex_y_a:new v.Uniform1f(l,f.u_tex_y_a),u_tex_y_b:new v.Uniform1f(l,f.u_tex_y_b),u_mix:new v.Uniform1f(l,f.u_mix)}},raster:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_tl_parent:new v.Uniform2f(l,f.u_tl_parent),u_scale_parent:new v.Uniform1f(l,f.u_scale_parent),u_buffer_scale:new v.Uniform1f(l,f.u_buffer_scale),u_fade_t:new v.Uniform1f(l,f.u_fade_t),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image0:new v.Uniform1i(l,f.u_image0),u_image1:new v.Uniform1i(l,f.u_image1),u_brightness_low:new v.Uniform1f(l,f.u_brightness_low),u_brightness_high:new v.Uniform1f(l,f.u_brightness_high),u_saturation_factor:new v.Uniform1f(l,f.u_saturation_factor),u_contrast_factor:new v.Uniform1f(l,f.u_contrast_factor),u_spin_weights:new v.Uniform3f(l,f.u_spin_weights)}},symbolIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture)}},symbolSDF:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texture:new v.Uniform1i(l,f.u_texture),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},symbolTextAndIcon:function(l,f){return{u_is_size_zoom_constant:new v.Uniform1i(l,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(l,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(l,f.u_size_t),u_size:new v.Uniform1f(l,f.u_size),u_camera_to_center_distance:new v.Uniform1f(l,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(l,f.u_pitch),u_rotate_symbol:new v.Uniform1i(l,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(l,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(l,f.u_fade_change),u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(l,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(l,f.u_coord_matrix),u_is_text:new v.Uniform1i(l,f.u_is_text),u_pitch_with_map:new v.Uniform1i(l,f.u_pitch_with_map),u_texsize:new v.Uniform2f(l,f.u_texsize),u_texsize_icon:new v.Uniform2f(l,f.u_texsize_icon),u_texture:new v.Uniform1i(l,f.u_texture),u_texture_icon:new v.Uniform1i(l,f.u_texture_icon),u_gamma_scale:new v.Uniform1f(l,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(l,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(l,f.u_is_halo)}},background:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_color:new v.UniformColor(l,f.u_color)}},backgroundPattern:function(l,f){return{u_matrix:new v.UniformMatrix4f(l,f.u_matrix),u_opacity:new v.Uniform1f(l,f.u_opacity),u_image:new v.Uniform1i(l,f.u_image),u_pattern_tl_a:new v.Uniform2f(l,f.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(l,f.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(l,f.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(l,f.u_pattern_br_b),u_texsize:new v.Uniform2f(l,f.u_texsize),u_mix:new v.Uniform1f(l,f.u_mix),u_pattern_size_a:new v.Uniform2f(l,f.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(l,f.u_pattern_size_b),u_scale_a:new v.Uniform1f(l,f.u_scale_a),u_scale_b:new v.Uniform1f(l,f.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(l,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(l,f.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(l,f.u_tile_units_to_pixels)}}};function Gu(l,f,c,d,b,C,A){for(var L=l.context,Z=L.gl,V=l.useProgram("collisionBox"),le=[],fe=0,de=0,ke=0;ke<d.length;ke++){var Re=d[ke],He=f.getTile(Re),Ae=He.getBucket(c);if(Ae){var We=Re.posMatrix;b[0]===0&&b[1]===0||(We=l.translatePosMatrix(Re.posMatrix,He,b,C));var tt=A?Ae.textCollisionBox:Ae.iconCollisionBox,bt=Ae.collisionCircleArray;if(bt.length>0){var Yt=v.create(),zt=We;v.mul(Yt,Ae.placementInvProjMatrix,l.transform.glCoordMatrix),v.mul(Yt,Yt,Ae.placementViewportMatrix),le.push({circleArray:bt,circleOffset:de,transform:zt,invTransform:Yt}),de=fe+=bt.length/4}tt&&V.draw(L,Z.LINES,ge.disabled,Le.disabled,l.colorModeForRenderPass(),rt.disabled,fo(We,l.transform,He),c.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,null,l.transform.zoom,null,null,tt.collisionVertexBuffer)}}if(A&&le.length){var $t=l.useProgram("collisionCircle"),gr=new v.StructArrayLayout2f1f2i16;gr.resize(4*fe),gr._trim();for(var Br=0,Fr=0,sn=le;Fr<sn.length;Fr+=1)for(var kn=sn[Fr],Dn=0;Dn<kn.circleArray.length/4;Dn++){var zn=4*Dn,ci=kn.circleArray[zn+0],ln=kn.circleArray[zn+1],Hn=kn.circleArray[zn+2],fi=kn.circleArray[zn+3];gr.emplace(Br++,ci,ln,Hn,fi,0),gr.emplace(Br++,ci,ln,Hn,fi,1),gr.emplace(Br++,ci,ln,Hn,fi,2),gr.emplace(Br++,ci,ln,Hn,fi,3)}(!Yc||Yc.length<2*fe)&&(Yc=function(Li){var Qi=2*Li,_o=new v.StructArrayLayout3ui6;_o.resize(Qi),_o._trim();for(var Ya=0;Ya<Qi;Ya++){var Ua=6*Ya;_o.uint16[Ua+0]=4*Ya+0,_o.uint16[Ua+1]=4*Ya+1,_o.uint16[Ua+2]=4*Ya+2,_o.uint16[Ua+3]=4*Ya+2,_o.uint16[Ua+4]=4*Ya+3,_o.uint16[Ua+5]=4*Ya+0}return _o}(fe));for(var Yn=L.createIndexBuffer(Yc,!0),Zn=L.createVertexBuffer(gr,v.collisionCircleLayout.members,!0),vi=0,qn=le;vi<qn.length;vi+=1){var Vn=qn[vi],To=wf(Vn.transform,Vn.invTransform,l.transform);$t.draw(L,Z.TRIANGLES,ge.disabled,Le.disabled,l.colorModeForRenderPass(),rt.disabled,To,c.id,Zn,Yn,v.SegmentVector.simpleSegment(0,2*Vn.circleOffset,Vn.circleArray.length,Vn.circleArray.length/2),null,l.transform.zoom,null,null,null)}Zn.destroy(),Yn.destroy()}}var Gs=v.identity(new Float32Array(16));function qc(l,f,c,d,b,C){var A=v.getAnchorAlignment(l),L=-(A.horizontalAlign-.5)*f,Z=-(A.verticalAlign-.5)*c,V=v.evaluateVariableOffset(l,d);return new v.Point((L/b+V[0])*C,(Z/b+V[1])*C)}function Kc(l,f,c,d,b,C,A,L,Z,V,le){var fe=l.text.placedSymbolArray,de=l.text.dynamicLayoutVertexArray,ke=l.icon.dynamicLayoutVertexArray,Re={};de.clear();for(var He=0;He<fe.length;He++){var Ae=fe.get(He),We=Ae.hidden||!Ae.crossTileID||l.allowVerticalPlacement&&!Ae.placedOrientation?null:d[Ae.crossTileID];if(We){var tt=new v.Point(Ae.anchorX,Ae.anchorY),bt=Ii(tt,c?L:A),Yt=Vi(C.cameraToCenterDistance,bt.signedDistanceFromCamera),zt=b.evaluateSizeForFeature(l.textSizeData,V,Ae)*Yt/v.ONE_EM;c&&(zt*=l.tilePixelRatio/Z);for(var $t=qc(We.anchor,We.width,We.height,We.textOffset,We.textBoxScale,zt),gr=c?Ii(tt.add($t),A).point:bt.point.add(f?$t.rotate(-C.angle):$t),Br=l.allowVerticalPlacement&&Ae.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,Fr=0;Fr<Ae.numGlyphs;Fr++)v.addDynamicAttributes(de,gr,Br);le&&Ae.associatedIconIndex>=0&&(Re[Ae.associatedIconIndex]={shiftedAnchor:gr,angle:Br})}else mo(Ae.numGlyphs,de)}if(le){ke.clear();for(var sn=l.icon.placedSymbolArray,kn=0;kn<sn.length;kn++){var Dn=sn.get(kn);if(Dn.hidden)mo(Dn.numGlyphs,ke);else{var zn=Re[kn];if(zn)for(var ci=0;ci<Dn.numGlyphs;ci++)v.addDynamicAttributes(ke,zn.shiftedAnchor,zn.angle);else mo(Dn.numGlyphs,ke)}}l.icon.dynamicLayoutVertexBuffer.updateData(ke)}l.text.dynamicLayoutVertexBuffer.updateData(de)}function $c(l,f,c){return c.iconsInText&&f?"symbolTextAndIcon":l?"symbolSDF":"symbolIcon"}function Hu(l,f,c,d,b,C,A,L,Z,V,le,fe){for(var de=l.context,ke=de.gl,Re=l.transform,He=L==="map",Ae=Z==="map",We=He&&c.layout.get("symbol-placement")!=="point",tt=He&&!Ae&&!We,bt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0,Yt=!1,zt=l.depthModeForSublayer(0,ge.ReadOnly),$t=c.layout.get("text-variable-anchor"),gr=[],Br=0,Fr=d;Br<Fr.length;Br+=1){var sn=Fr[Br],kn=f.getTile(sn),Dn=kn.getBucket(c);if(Dn){var zn=b?Dn.text:Dn.icon;if(zn&&zn.segments.get().length){var ci=zn.programConfigurations.get(c.id),ln=b||Dn.sdfIcons,Hn=b?Dn.textSizeData:Dn.iconSizeData,fi=Ae||Re.pitch!==0,Yn=l.useProgram($c(ln,b,Dn),ci),Zn=v.evaluateSizeForZoom(Hn,Re.zoom),vi=void 0,qn=[0,0],Vn=void 0,To=void 0,Li=null,Qi=void 0;if(b)Vn=kn.glyphAtlasTexture,To=ke.LINEAR,vi=kn.glyphAtlasTexture.size,Dn.iconsInText&&(qn=kn.imageAtlasTexture.size,Li=kn.imageAtlasTexture,Qi=fi||l.options.rotating||l.options.zooming||Hn.kind==="composite"||Hn.kind==="camera"?ke.LINEAR:ke.NEAREST);else{var _o=c.layout.get("icon-size").constantOr(0)!==1||Dn.iconsNeedLinear;Vn=kn.imageAtlasTexture,To=ln||l.options.rotating||l.options.zooming||_o||fi?ke.LINEAR:ke.NEAREST,vi=kn.imageAtlasTexture.size}var Ya=Ki(kn,1,l.transform.zoom),Ua=La(sn.posMatrix,Ae,He,l.transform,Ya),zs=oa(sn.posMatrix,Ae,He,l.transform,Ya),ys=$t&&Dn.hasTextData(),Ku=c.layout.get("icon-text-fit")!=="none"&&ys&&Dn.hasIconData();We&&tu(Dn,sn.posMatrix,l,b,Ua,zs,Ae,V);var _s=l.translatePosMatrix(sn.posMatrix,kn,C,A),Ys=We||b&&$t||Ku?Gs:Ua,xo=l.translatePosMatrix(zs,kn,C,A,!0),Oc=ln&&c.paint.get(b?"text-halo-width":"icon-halo-width").constantOr(1)!==0,rc={program:Yn,buffers:zn,uniformValues:ln?Dn.iconsInText?Su(Hn.kind,Zn,tt,Ae,l,_s,Ys,xo,vi,qn):No(Hn.kind,Zn,tt,Ae,l,_s,Ys,xo,b,vi,!0):ol(Hn.kind,Zn,tt,Ae,l,_s,Ys,xo,b,vi),atlasTexture:Vn,atlasTextureIcon:Li,atlasInterpolation:To,atlasInterpolationIcon:Qi,isSDF:ln,hasHalo:Oc};if(bt&&Dn.canOverlap){Yt=!0;for(var $u=0,su=zn.segments.get();$u<su.length;$u+=1){var hl=su[$u];gr.push({segments:new v.SegmentVector([hl]),sortKey:hl.sortKey,state:rc})}}else gr.push({segments:zn.segments,sortKey:0,state:rc})}}}Yt&&gr.sort(function(Mu,Pu){return Mu.sortKey-Pu.sortKey});for(var Ts=0,pl=gr;Ts<pl.length;Ts+=1){var uu=pl[Ts],oo=uu.state;if(de.activeTexture.set(ke.TEXTURE0),oo.atlasTexture.bind(oo.atlasInterpolation,ke.CLAMP_TO_EDGE),oo.atlasTextureIcon&&(de.activeTexture.set(ke.TEXTURE1),oo.atlasTextureIcon&&oo.atlasTextureIcon.bind(oo.atlasInterpolationIcon,ke.CLAMP_TO_EDGE)),oo.isSDF){var qs=oo.uniformValues;oo.hasHalo&&(qs.u_is_halo=1,Yl(oo.buffers,uu.segments,c,l,oo.program,zt,le,fe,qs)),qs.u_is_halo=0}Yl(oo.buffers,uu.segments,c,l,oo.program,zt,le,fe,oo.uniformValues)}}function Yl(l,f,c,d,b,C,A,L,Z){var V=d.context;b.draw(V,V.gl.TRIANGLES,C,A,L,rt.disabled,Z,c.id,l.layoutVertexBuffer,l.indexBuffer,f,c.paint,d.transform.zoom,l.programConfigurations.get(c.id),l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer)}function Cc(l,f,c,d,b,C,A){var L,Z,V,le,fe,de=l.context.gl,ke=c.paint.get("fill-pattern"),Re=ke&&ke.constantOr(1),He=c.getCrossfadeParameters();A?(Z=Re&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=de.LINES):(Z=Re?"fillPattern":"fill",L=de.TRIANGLES);for(var Ae=0,We=d;Ae<We.length;Ae+=1){var tt=We[Ae],bt=f.getTile(tt);if(!Re||bt.patternsLoaded()){var Yt=bt.getBucket(c);if(Yt){var zt=Yt.programConfigurations.get(c.id),$t=l.useProgram(Z,zt);Re&&(l.context.activeTexture.set(de.TEXTURE0),bt.imageAtlasTexture.bind(de.LINEAR,de.CLAMP_TO_EDGE),zt.updatePaintBuffers(He));var gr=ke.constantOr(null);if(gr&&bt.imageAtlas){var Br=bt.imageAtlas,Fr=Br.patternPositions[gr.to.toString()],sn=Br.patternPositions[gr.from.toString()];Fr&&sn&&zt.setConstantPatternPositions(Fr,sn)}var kn=l.translatePosMatrix(tt.posMatrix,bt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(A){le=Yt.indexBuffer2,fe=Yt.segments2;var Dn=[de.drawingBufferWidth,de.drawingBufferHeight];V=Z==="fillOutlinePattern"&&Re?oh(kn,l,He,bt,Dn):ha(kn,Dn)}else le=Yt.indexBuffer,fe=Yt.segments,V=Re?wo(kn,l,He,bt):hu(kn);$t.draw(l.context,L,b,l.stencilModeForClipping(tt),C,rt.disabled,V,c.id,Yt.layoutVertexBuffer,le,fe,c.paint,l.transform.zoom,zt)}}}}function Jc(l,f,c,d,b,C,A){for(var L=l.context,Z=L.gl,V=c.paint.get("fill-extrusion-pattern"),le=V.constantOr(1),fe=c.getCrossfadeParameters(),de=c.paint.get("fill-extrusion-opacity"),ke=0,Re=d;ke<Re.length;ke+=1){var He=Re[ke],Ae=f.getTile(He),We=Ae.getBucket(c);if(We){var tt=We.programConfigurations.get(c.id),bt=l.useProgram(le?"fillExtrusionPattern":"fillExtrusion",tt);le&&(l.context.activeTexture.set(Z.TEXTURE0),Ae.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),tt.updatePaintBuffers(fe));var Yt=V.constantOr(null);if(Yt&&Ae.imageAtlas){var zt=Ae.imageAtlas,$t=zt.patternPositions[Yt.to.toString()],gr=zt.patternPositions[Yt.from.toString()];$t&&gr&&tt.setConstantPatternPositions($t,gr)}var Br=l.translatePosMatrix(He.posMatrix,Ae,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),Fr=c.paint.get("fill-extrusion-vertical-gradient"),sn=le?Eu(Br,l,Fr,de,He,fe,Ae):Ec(Br,l,Fr,de);bt.draw(L,L.gl.TRIANGLES,b,C,A,rt.backCCW,sn,c.id,We.layoutVertexBuffer,We.indexBuffer,We.segments,c.paint,l.transform.zoom,tt)}}}function wc(l,f,c,d,b,C){var A=l.context,L=A.gl,Z=f.fbo;if(Z){var V=l.useProgram("hillshade");A.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,Z.colorAttachment.get());var le=function(fe,de,ke){var Re=ke.paint.get("hillshade-shadow-color"),He=ke.paint.get("hillshade-highlight-color"),Ae=ke.paint.get("hillshade-accent-color"),We=ke.paint.get("hillshade-illumination-direction")*(Math.PI/180);ke.paint.get("hillshade-illumination-anchor")==="viewport"&&(We-=fe.transform.angle);var tt,bt,Yt,zt=!fe.options.moving;return{u_matrix:fe.transform.calculatePosMatrix(de.tileID.toUnwrapped(),zt),u_image:0,u_latrange:(tt=de.tileID,bt=Math.pow(2,tt.canonical.z),Yt=tt.canonical.y,[new v.MercatorCoordinate(0,Yt/bt).toLngLat().lat,new v.MercatorCoordinate(0,(Yt+1)/bt).toLngLat().lat]),u_light:[ke.paint.get("hillshade-exaggeration"),We],u_shadow:Re,u_highlight:He,u_accent:Ae}}(l,f,c);V.draw(A,L.TRIANGLES,d,b,C,rt.disabled,le,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}}function ch(l,f,c,d,b,C){var A=l.context,L=A.gl,Z=f.dem;if(Z&&Z.data){var V=Z.dim,le=Z.stride,fe=Z.getPixels();if(A.activeTexture.set(L.TEXTURE1),A.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||l.getTileTexture(le),f.demTexture){var de=f.demTexture;de.update(fe,{premultiply:!1}),de.bind(L.NEAREST,L.CLAMP_TO_EDGE)}else f.demTexture=new v.Texture(A,fe,L.RGBA,{premultiply:!1}),f.demTexture.bind(L.NEAREST,L.CLAMP_TO_EDGE);A.activeTexture.set(L.TEXTURE0);var ke=f.fbo;if(!ke){var Re=new v.Texture(A,{width:V,height:V,data:null},L.RGBA);Re.bind(L.LINEAR,L.CLAMP_TO_EDGE),(ke=f.fbo=A.createFramebuffer(V,V,!0)).colorAttachment.set(Re.texture)}A.bindFramebuffer.set(ke.framebuffer),A.viewport.set([0,0,V,V]),l.useProgram("hillshadePrepare").draw(A,L.TRIANGLES,d,b,C,rt.disabled,function(He,Ae){var We=Ae.stride,tt=v.create();return v.ortho(tt,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(tt,tt,[0,-v.EXTENT,0]),{u_matrix:tt,u_image:1,u_dimension:[We,We],u_zoom:He.overscaledZ,u_unpack:Ae.getUnpackVector()}}(f.tileID,Z),c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function Ac(l,f,c,d,b){var C=d.paint.get("raster-fade-duration");if(C>0){var A=v.browser.now(),L=(A-l.timeAdded)/C,Z=f?(A-f.timeAdded)/C:-1,V=c.getSource(),le=b.coveringZoomLevel({tileSize:V.tileSize,roundZoom:V.roundZoom}),fe=!f||Math.abs(f.tileID.overscaledZ-le)>Math.abs(l.tileID.overscaledZ-le),de=fe&&l.refreshedUponExpiration?1:v.clamp(fe?L:1-Z,0,1);return l.refreshedUponExpiration&&L>=1&&(l.refreshedUponExpiration=!1),f?{opacity:1,mix:1-de}:{opacity:de,mix:0}}return{opacity:1,mix:0}}var sl=new v.Color(1,0,0,1),Qc=new v.Color(0,1,0,1),ef=new v.Color(0,0,1,1),Cu=new v.Color(1,0,1,1),tf=new v.Color(0,1,1,1);function Tf(l,f,c,d){wl(l,0,f+c/2,l.transform.width,c,d)}function fh(l,f,c,d){wl(l,f-c/2,0,c,l.transform.height,d)}function wl(l,f,c,d,b,C){var A=l.context,L=A.gl;L.enable(L.SCISSOR_TEST),L.scissor(f*v.browser.devicePixelRatio,c*v.browser.devicePixelRatio,d*v.browser.devicePixelRatio,b*v.browser.devicePixelRatio),A.clear({color:C}),L.disable(L.SCISSOR_TEST)}function $h(l,f,c){var d=l.context,b=d.gl,C=c.posMatrix,A=l.useProgram("debug"),L=ge.disabled,Z=Le.disabled,V=l.colorModeForRenderPass();d.activeTexture.set(b.TEXTURE0),l.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),A.draw(d,b.LINE_STRIP,L,Z,V,rt.disabled,pu(C,v.Color.red),"$debug",l.debugBuffer,l.tileBorderIndexBuffer,l.debugSegments);var le=f.getTileByID(c.key).latestRawTileData,fe=Math.floor((le&&le.byteLength||0)/1024),de=f.getTile(c).tileSize,ke=512/Math.min(de,512)*(c.overscaledZ/l.transform.zoom)*.5,Re=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Re+=" => "+c.overscaledZ),function(He,Ae){He.initDebugOverlayCanvas();var We=He.debugOverlayCanvas,tt=He.context.gl,bt=He.debugOverlayCanvas.getContext("2d");bt.clearRect(0,0,We.width,We.height),bt.shadowColor="white",bt.shadowBlur=2,bt.lineWidth=1.5,bt.strokeStyle="white",bt.textBaseline="top",bt.font="bold 36px Open Sans, sans-serif",bt.fillText(Ae,5,5),bt.strokeText(Ae,5,5),He.debugOverlayTexture.update(We),He.debugOverlayTexture.bind(tt.LINEAR,tt.CLAMP_TO_EDGE)}(l,Re+" "+fe+"kb"),A.draw(d,b.TRIANGLES,L,Z,Ge.alphaBlended,rt.disabled,pu(C,v.Color.transparent,ke),"$debug",l.debugBuffer,l.quadTriangleIndexBuffer,l.debugSegments)}var rs={symbol:function(l,f,c,d,b){if(l.renderPass==="translucent"){var C=Le.disabled,A=l.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(L,Z,V,le,fe,de,ke){for(var Re=Z.transform,He=fe==="map",Ae=de==="map",We=0,tt=L;We<tt.length;We+=1){var bt=tt[We],Yt=le.getTile(bt),zt=Yt.getBucket(V);if(zt&&zt.text&&zt.text.segments.get().length){var $t=v.evaluateSizeForZoom(zt.textSizeData,Re.zoom),gr=Ki(Yt,1,Z.transform.zoom),Br=La(bt.posMatrix,Ae,He,Z.transform,gr),Fr=V.layout.get("icon-text-fit")!=="none"&&zt.hasIconData();if($t){var sn=Math.pow(2,Re.zoom-Yt.tileID.overscaledZ);Kc(zt,He,Ae,ke,v.symbolSize,Re,Br,bt.posMatrix,sn,$t,Fr)}}}}(d,l,c,f,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),b),c.paint.get("icon-opacity").constantOr(1)!==0&&Hu(l,f,c,d,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),C,A),c.paint.get("text-opacity").constantOr(1)!==0&&Hu(l,f,c,d,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),C,A),f.map.showCollisionBoxes&&(Gu(l,f,c,d,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Gu(l,f,c,d,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))}},circle:function(l,f,c,d){if(l.renderPass==="translucent"){var b=c.paint.get("circle-opacity"),C=c.paint.get("circle-stroke-width"),A=c.paint.get("circle-stroke-opacity"),L=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(b.constantOr(1)!==0||C.constantOr(1)!==0&&A.constantOr(1)!==0){for(var Z=l.context,V=Z.gl,le=l.depthModeForSublayer(0,ge.ReadOnly),fe=Le.disabled,de=l.colorModeForRenderPass(),ke=[],Re=0;Re<d.length;Re++){var He=d[Re],Ae=f.getTile(He),We=Ae.getBucket(c);if(We){var tt=We.programConfigurations.get(c.id),bt={programConfiguration:tt,program:l.useProgram("circle",tt),layoutVertexBuffer:We.layoutVertexBuffer,indexBuffer:We.indexBuffer,uniformValues:sh(l,He,Ae,c)};if(L)for(var Yt=0,zt=We.segments.get();Yt<zt.length;Yt+=1){var $t=zt[Yt];ke.push({segments:new v.SegmentVector([$t]),sortKey:$t.sortKey,state:bt})}else ke.push({segments:We.segments,sortKey:0,state:bt})}}L&&ke.sort(function(kn,Dn){return kn.sortKey-Dn.sortKey});for(var gr=0,Br=ke;gr<Br.length;gr+=1){var Fr=Br[gr],sn=Fr.state;sn.program.draw(Z,V.TRIANGLES,le,fe,de,rt.disabled,sn.uniformValues,c.id,sn.layoutVertexBuffer,sn.indexBuffer,Fr.segments,c.paint,l.transform.zoom,sn.programConfiguration)}}}},heatmap:function(l,f,c,d){if(c.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){var b=l.context,C=b.gl,A=Le.disabled,L=new Ge([C.ONE,C.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(ke,Re,He){var Ae=ke.gl;ke.activeTexture.set(Ae.TEXTURE1),ke.viewport.set([0,0,Re.width/4,Re.height/4]);var We=He.heatmapFbo;if(We)Ae.bindTexture(Ae.TEXTURE_2D,We.colorAttachment.get()),ke.bindFramebuffer.set(We.framebuffer);else{var tt=Ae.createTexture();Ae.bindTexture(Ae.TEXTURE_2D,tt),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_S,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_WRAP_T,Ae.CLAMP_TO_EDGE),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MIN_FILTER,Ae.LINEAR),Ae.texParameteri(Ae.TEXTURE_2D,Ae.TEXTURE_MAG_FILTER,Ae.LINEAR),We=He.heatmapFbo=ke.createFramebuffer(Re.width/4,Re.height/4,!1),function(bt,Yt,zt,$t){var gr=bt.gl;gr.texImage2D(gr.TEXTURE_2D,0,gr.RGBA,Yt.width/4,Yt.height/4,0,gr.RGBA,bt.extRenderToTextureHalfFloat?bt.extTextureHalfFloat.HALF_FLOAT_OES:gr.UNSIGNED_BYTE,null),$t.colorAttachment.set(zt)}(ke,Re,tt,We)}})(b,l,c),b.clear({color:v.Color.transparent});for(var Z=0;Z<d.length;Z++){var V=d[Z];if(!f.hasRenderableParent(V)){var le=f.getTile(V),fe=le.getBucket(c);if(fe){var de=fe.programConfigurations.get(c.id);l.useProgram("heatmap",de).draw(b,C.TRIANGLES,ge.disabled,A,L,rt.disabled,Sc(V.posMatrix,le,l.transform.zoom,c.paint.get("heatmap-intensity")),c.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,c.paint,l.transform.zoom,de)}}}b.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(ke,Re){var He=ke.context,Ae=He.gl,We=Re.heatmapFbo;if(We){He.activeTexture.set(Ae.TEXTURE0),Ae.bindTexture(Ae.TEXTURE_2D,We.colorAttachment.get()),He.activeTexture.set(Ae.TEXTURE1);var tt=Re.colorRampTexture;tt||(tt=Re.colorRampTexture=new v.Texture(He,Re.colorRamp,Ae.RGBA)),tt.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),ke.useProgram("heatmapTexture").draw(He,Ae.TRIANGLES,ge.disabled,Le.disabled,ke.colorModeForRenderPass(),rt.disabled,function(bt,Yt,zt,$t){var gr=v.create();v.ortho(gr,0,bt.width,bt.height,0,0,1);var Br=bt.context.gl;return{u_matrix:gr,u_world:[Br.drawingBufferWidth,Br.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Yt.paint.get("heatmap-opacity")}}(ke,Re),Re.id,ke.viewportBuffer,ke.quadTriangleIndexBuffer,ke.viewportSegments,Re.paint,ke.transform.zoom)}}(l,c))},line:function(l,f,c,d){if(l.renderPass==="translucent"){var b=c.paint.get("line-opacity"),C=c.paint.get("line-width");if(b.constantOr(1)!==0&&C.constantOr(1)!==0)for(var A=l.depthModeForSublayer(0,ge.ReadOnly),L=l.colorModeForRenderPass(),Z=c.paint.get("line-dasharray"),V=c.paint.get("line-pattern"),le=V.constantOr(1),fe=c.paint.get("line-gradient"),de=c.getCrossfadeParameters(),ke=le?"linePattern":Z?"lineSDF":fe?"lineGradient":"line",Re=l.context,He=Re.gl,Ae=!0,We=0,tt=d;We<tt.length;We+=1){var bt=tt[We],Yt=f.getTile(bt);if(!le||Yt.patternsLoaded()){var zt=Yt.getBucket(c);if(zt){var $t=zt.programConfigurations.get(c.id),gr=l.context.program.get(),Br=l.useProgram(ke,$t),Fr=Ae||Br.program!==gr,sn=V.constantOr(null);if(sn&&Yt.imageAtlas){var kn=Yt.imageAtlas,Dn=kn.patternPositions[sn.to.toString()],zn=kn.patternPositions[sn.from.toString()];Dn&&zn&&$t.setConstantPatternPositions(Dn,zn)}var ci=le?Sl(l,Yt,c,de):Z?Xl(l,Yt,c,Z,de):fe?Ea(l,Yt,c,zt.lineClipsArray.length):al(l,Yt,c);if(le)Re.activeTexture.set(He.TEXTURE0),Yt.imageAtlasTexture.bind(He.LINEAR,He.CLAMP_TO_EDGE),$t.updatePaintBuffers(de);else if(Z&&(Fr||l.lineAtlas.dirty))Re.activeTexture.set(He.TEXTURE0),l.lineAtlas.bind(Re);else if(fe){var ln=zt.gradients[c.id],Hn=ln.texture;if(c.gradientVersion!==ln.version){var fi=256;if(c.stepInterpolant){var Yn=f.getSource().maxzoom,Zn=bt.canonical.z===Yn?Math.ceil(1<<l.transform.maxZoom-bt.canonical.z):1;fi=v.clamp(v.nextPowerOfTwo(zt.maxLineLength/v.EXTENT*1024*Zn),256,Re.maxTextureSize)}ln.gradient=v.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:fi,image:ln.gradient||void 0,clips:zt.lineClipsArray}),ln.texture?ln.texture.update(ln.gradient):ln.texture=new v.Texture(Re,ln.gradient,He.RGBA),ln.version=c.gradientVersion,Hn=ln.texture}Re.activeTexture.set(He.TEXTURE0),Hn.bind(c.stepInterpolant?He.NEAREST:He.LINEAR,He.CLAMP_TO_EDGE)}Br.draw(Re,He.TRIANGLES,A,l.stencilModeForClipping(bt),L,rt.disabled,ci,c.id,zt.layoutVertexBuffer,zt.indexBuffer,zt.segments,c.paint,l.transform.zoom,$t,zt.layoutVertexBuffer2),Ae=!1}}}}},fill:function(l,f,c,d){var b=c.paint.get("fill-color"),C=c.paint.get("fill-opacity");if(C.constantOr(1)!==0){var A=l.colorModeForRenderPass(),L=c.paint.get("fill-pattern"),Z=l.opaquePassEnabledForLayer()&&!L.constantOr(1)&&b.constantOr(v.Color.transparent).a===1&&C.constantOr(0)===1?"opaque":"translucent";if(l.renderPass===Z){var V=l.depthModeForSublayer(1,l.renderPass==="opaque"?ge.ReadWrite:ge.ReadOnly);Cc(l,f,c,d,V,A,!1)}if(l.renderPass==="translucent"&&c.paint.get("fill-antialias")){var le=l.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,ge.ReadOnly);Cc(l,f,c,d,le,A,!0)}}},"fill-extrusion":function(l,f,c,d){var b=c.paint.get("fill-extrusion-opacity");if(b!==0&&l.renderPass==="translucent"){var C=new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D);if(b!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))Jc(l,f,c,d,C,Le.disabled,Ge.disabled),Jc(l,f,c,d,C,l.stencilModeFor3D(),l.colorModeForRenderPass());else{var A=l.colorModeForRenderPass();Jc(l,f,c,d,C,Le.disabled,A)}}},hillshade:function(l,f,c,d){if(l.renderPass==="offscreen"||l.renderPass==="translucent"){for(var b=l.context,C=l.depthModeForSublayer(0,ge.ReadOnly),A=l.colorModeForRenderPass(),L=l.renderPass==="translucent"?l.stencilConfigForOverlap(d):[{},d],Z=L[0],V=0,le=L[1];V<le.length;V+=1){var fe=le[V],de=f.getTile(fe);de.needsHillshadePrepare&&l.renderPass==="offscreen"?ch(l,de,c,C,Le.disabled,A):l.renderPass==="translucent"&&wc(l,de,c,C,Z[fe.overscaledZ],A)}b.viewport.set([0,0,l.width,l.height])}},raster:function(l,f,c,d){if(l.renderPass==="translucent"&&c.paint.get("raster-opacity")!==0&&d.length)for(var b=l.context,C=b.gl,A=f.getSource(),L=l.useProgram("raster"),Z=l.colorModeForRenderPass(),V=A instanceof gt?[{},d]:l.stencilConfigForOverlap(d),le=V[0],fe=V[1],de=fe[fe.length-1].overscaledZ,ke=!l.options.moving,Re=0,He=fe;Re<He.length;Re+=1){var Ae=He[Re],We=l.depthModeForSublayer(Ae.overscaledZ-de,c.paint.get("raster-opacity")===1?ge.ReadWrite:ge.ReadOnly,C.LESS),tt=f.getTile(Ae),bt=l.transform.calculatePosMatrix(Ae.toUnwrapped(),ke);tt.registerFadeDuration(c.paint.get("raster-fade-duration"));var Yt=f.findLoadedParent(Ae,0),zt=Ac(tt,Yt,f,c,l.transform),$t=void 0,gr=void 0,Br=c.paint.get("raster-resampling")==="nearest"?C.NEAREST:C.LINEAR;b.activeTexture.set(C.TEXTURE0),tt.texture.bind(Br,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),b.activeTexture.set(C.TEXTURE1),Yt?(Yt.texture.bind(Br,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),$t=Math.pow(2,Yt.tileID.overscaledZ-tt.tileID.overscaledZ),gr=[tt.tileID.canonical.x*$t%1,tt.tileID.canonical.y*$t%1]):tt.texture.bind(Br,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST);var Fr=uh(bt,gr||[0,0],$t||1,zt,c);A instanceof gt?L.draw(b,C.TRIANGLES,We,Le.disabled,Z,rt.disabled,Fr,c.id,A.boundsBuffer,l.quadTriangleIndexBuffer,A.boundsSegments):L.draw(b,C.TRIANGLES,We,le[Ae.overscaledZ],Z,rt.disabled,Fr,c.id,l.rasterBoundsBuffer,l.quadTriangleIndexBuffer,l.rasterBoundsSegments)}},background:function(l,f,c){var d=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(b!==0){var C=l.context,A=C.gl,L=l.transform,Z=L.tileSize,V=c.paint.get("background-pattern");if(!l.isPatternMissing(V)){var le=!V&&d.a===1&&b===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass===le){var fe=Le.disabled,de=l.depthModeForSublayer(0,le==="opaque"?ge.ReadWrite:ge.ReadOnly),ke=l.colorModeForRenderPass(),Re=l.useProgram(V?"backgroundPattern":"background"),He=L.coveringTiles({tileSize:Z});V&&(C.activeTexture.set(A.TEXTURE0),l.imageManager.bind(l.context));for(var Ae=c.getCrossfadeParameters(),We=0,tt=He;We<tt.length;We+=1){var bt=tt[We],Yt=l.transform.calculatePosMatrix(bt.toUnwrapped()),zt=V?zo(Yt,b,l,V,{tileID:bt,tileSize:Z},Ae):Vu(Yt,b,d);Re.draw(C,A.TRIANGLES,de,fe,ke,rt.disabled,zt,c.id,l.tileExtentBuffer,l.quadTriangleIndexBuffer,l.tileExtentSegments)}}}}},debug:function(l,f,c){for(var d=0;d<c.length;d++)$h(l,f,c[d])},custom:function(l,f,c){var d=l.context,b=c.implementation;if(l.renderPass==="offscreen"){var C=b.prerender;C&&(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),C.call(b,d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState())}else if(l.renderPass==="translucent"){l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(Le.disabled);var A=b.renderingMode==="3d"?new ge(l.context.gl.LEQUAL,ge.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,ge.ReadOnly);d.setDepthMode(A),b.render(d.gl,l.transform.customLayerMatrix()),d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}},Xa=function(l,f){this.context=new pe(l),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=Be.maxUnderzooming+Be.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Kt,this.gpuTimers={}};Xa.prototype.resize=function(l,f){if(this.width=l*v.browser.devicePixelRatio,this.height=f*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var c=0,d=this.style._order;c<d.length;c+=1)this.style._layers[d[c]].resize()},Xa.prototype.setup=function(){var l=this.context,f=new v.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(v.EXTENT,0),f.emplaceBack(0,v.EXTENT),f.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(f,sa.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var c=new v.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(v.EXTENT,0),c.emplaceBack(0,v.EXTENT),c.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=l.createVertexBuffer(c,sa.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var d=new v.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(v.EXTENT,0,v.EXTENT,0),d.emplaceBack(0,v.EXTENT,0,v.EXTENT),d.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=l.createVertexBuffer(d,At.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var b=new v.StructArrayLayout2i4;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(b,sa.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var C=new v.StructArrayLayout1ui2;C.emplaceBack(0),C.emplaceBack(1),C.emplaceBack(3),C.emplaceBack(2),C.emplaceBack(0),this.tileBorderIndexBuffer=l.createIndexBuffer(C);var A=new v.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(A),this.emptyTexture=new v.Texture(l,{width:1,height:1,data:new Uint8Array([0,0,0,0])},l.gl.RGBA);var L=this.context.gl;this.stencilClearMode=new Le({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)},Xa.prototype.clearStencil=function(){var l=this.context,f=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var c=v.create();v.ortho(c,0,this.width,this.height,0,0,1),v.scale(c,c,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(l,f.TRIANGLES,ge.disabled,this.stencilClearMode,Ge.disabled,rt.disabled,Rs(c),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Xa.prototype._renderTileClippingMasks=function(l,f){if(this.currentStencilSource!==l.source&&l.isTileClipped()&&f&&f.length){this.currentStencilSource=l.source;var c=this.context,d=c.gl;this.nextStencilID+f.length>256&&this.clearStencil(),c.setColorMode(Ge.disabled),c.setDepthMode(ge.disabled);var b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var C=0,A=f;C<A.length;C+=1){var L=A[C],Z=this._tileClippingMaskIDs[L.key]=this.nextStencilID++;b.draw(c,d.TRIANGLES,ge.disabled,new Le({func:d.ALWAYS,mask:0},Z,255,d.KEEP,d.KEEP,d.REPLACE),Ge.disabled,rt.disabled,Rs(L.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Xa.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var l=this.nextStencilID++,f=this.context.gl;return new Le({func:f.NOTEQUAL,mask:255},l,255,f.KEEP,f.KEEP,f.REPLACE)},Xa.prototype.stencilModeForClipping=function(l){var f=this.context.gl;return new Le({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,f.KEEP,f.KEEP,f.REPLACE)},Xa.prototype.stencilConfigForOverlap=function(l){var f,c=this.context.gl,d=l.sort(function(Z,V){return V.overscaledZ-Z.overscaledZ}),b=d[d.length-1].overscaledZ,C=d[0].overscaledZ-b+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();for(var A={},L=0;L<C;L++)A[L+b]=new Le({func:c.GEQUAL,mask:255},L+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=C,[A,d]}return[(f={},f[b]=Le.disabled,f),d]},Xa.prototype.colorModeForRenderPass=function(){var l=this.context.gl;return this._showOverdrawInspector?new Ge([l.CONSTANT_COLOR,l.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ge.unblended:Ge.alphaBlended},Xa.prototype.depthModeForSublayer=function(l,f,c){if(!this.opaquePassEnabledForLayer())return ge.disabled;var d=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new ge(c||this.context.gl.LEQUAL,f,[d,d])},Xa.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Xa.prototype.render=function(l,f){var c=this;this.style=l,this.options=f,this.lineAtlas=l.lineAtlas,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var d=this.style._order,b=this.style.sourceCaches;for(var C in b){var A=b[C];A.used&&A.prepare(this.context)}var L,Z,V={},le={},fe={};for(var de in b){var ke=b[de];V[de]=ke.getVisibleCoordinates(),le[de]=V[de].slice().reverse(),fe[de]=ke.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Re=0;Re<d.length;Re++)if(this.style._layers[d[Re]].is3D()){this.opaquePassCutoff=Re;break}this.renderPass="offscreen";for(var He=0,Ae=d;He<Ae.length;He+=1){var We=this.style._layers[Ae[He]];if(We.hasOffscreenPass()&&!We.isHidden(this.transform.zoom)){var tt=le[We.source];(We.type==="custom"||tt.length)&&this.renderLayer(this,b[We.source],We,tt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(l._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){var bt=this.style._layers[d[this.currentLayer]],Yt=b[bt.source],zt=V[bt.source];this._renderTileClippingMasks(bt,zt),this.renderLayer(this,Yt,bt,zt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){var $t=this.style._layers[d[this.currentLayer]],gr=b[$t.source],Br=($t.type==="symbol"?fe:le)[$t.source];this._renderTileClippingMasks($t,V[$t.source]),this.renderLayer(this,gr,$t,Br)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(Fr){Fr.source&&!Fr.isHidden(c.transform.zoom)&&(Fr.source!==(Z&&Z.id)&&(Z=c.style.sourceCaches[Fr.source]),(!L||L.getSource().maxzoom<Z.getSource().maxzoom)&&(L=Z))}),L&&rs.debug(this,L,L.getVisibleCoordinates())),this.options.showPadding&&function(Fr){var sn=Fr.transform.padding;Tf(Fr,Fr.transform.height-(sn.top||0),3,sl),Tf(Fr,sn.bottom||0,3,Qc),fh(Fr,sn.left||0,3,ef),fh(Fr,Fr.transform.width-(sn.right||0),3,Cu);var kn=Fr.transform.centerPoint;(function(Dn,zn,ci,ln){wl(Dn,zn-1,ci-10,2,20,ln),wl(Dn,zn-10,ci-1,20,2,ln)})(Fr,kn.x,Fr.transform.height-kn.y,tf)}(this),this.context.setDefault()},Xa.prototype.renderLayer=function(l,f,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||d.length)&&(this.id=c.id,this.gpuTimingStart(c),rs[c.type](l,f,c,d,this.style.placement.variableOffsets),this.gpuTimingEnd())},Xa.prototype.gpuTimingStart=function(l){if(this.options.gpuTiming){var f=this.context.extTimerQuery,c=this.gpuTimers[l.id];c||(c=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),c.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,c.query)}},Xa.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}},Xa.prototype.collectGpuTimers=function(){var l=this.gpuTimers;return this.gpuTimers={},l},Xa.prototype.queryGpuTimers=function(l){var f={};for(var c in l){var d=l[c],b=this.context.extTimerQuery,C=b.getQueryObjectEXT(d.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(d.query),f[c]=C}return f},Xa.prototype.translatePosMatrix=function(l,f,c,d,b){if(!c[0]&&!c[1])return l;var C=b?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(C){var A=Math.sin(C),L=Math.cos(C);c=[c[0]*L-c[1]*A,c[0]*A+c[1]*L]}var Z=[b?c[0]:Ki(f,c[0],this.transform.zoom),b?c[1]:Ki(f,c[1],this.transform.zoom),0],V=new Float32Array(16);return v.translate(V,l,Z),V},Xa.prototype.saveTileTexture=function(l){var f=this._tileTextures[l.size[0]];f?f.push(l):this._tileTextures[l.size[0]]=[l]},Xa.prototype.getTileTexture=function(l){var f=this._tileTextures[l];return f&&f.length>0?f.pop():null},Xa.prototype.isPatternMissing=function(l){if(!l)return!1;if(!l.from||!l.to)return!0;var f=this.imageManager.getPattern(l.from.toString()),c=this.imageManager.getPattern(l.to.toString());return!f||!c},Xa.prototype.useProgram=function(l,f){this.cache=this.cache||{};var c=""+l+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[c]||(this.cache[c]=new Xc(this.context,l,Lo[l],f,Cl[l],this._showOverdrawInspector)),this.cache[c]},Xa.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Xa.prototype.setBaseState=function(){var l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)},Xa.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Xa.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var ql=function(l,f){this.points=l,this.planes=f};ql.fromInvProjectionMatrix=function(l,f,c){var d=Math.pow(2,c),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(A){return v.transformMat4([],A,l)}).map(function(A){return v.scale$1([],A,1/A[3]/f*d)}),C=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(A){var L=v.sub([],b[A[0]],b[A[1]]),Z=v.sub([],b[A[2]],b[A[1]]),V=v.normalize([],v.cross([],L,Z)),le=-v.dot(V,b[A[1]]);return V.concat(le)});return new ql(b,C)};var Al=function(l,f){this.min=l,this.max=f,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};Al.prototype.quadrant=function(l){for(var f=[l%2==0,l<2],c=v.clone$2(this.min),d=v.clone$2(this.max),b=0;b<f.length;b++)c[b]=f[b]?this.min[b]:this.center[b],d[b]=f[b]?this.center[b]:this.max[b];return d[2]=this.max[2],new Al(c,d)},Al.prototype.distanceX=function(l){return Math.max(Math.min(this.max[0],l[0]),this.min[0])-l[0]},Al.prototype.distanceY=function(l){return Math.max(Math.min(this.max[1],l[1]),this.min[1])-l[1]},Al.prototype.intersects=function(l){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],c=!0,d=0;d<l.planes.length;d++){for(var b=l.planes[d],C=0,A=0;A<f.length;A++)C+=v.dot$1(b,f[A])>=0;if(C===0)return 0;C!==f.length&&(c=!1)}if(c)return 2;for(var L=0;L<3;L++){for(var Z=Number.MAX_VALUE,V=-Number.MAX_VALUE,le=0;le<l.points.length;le++){var fe=l.points[le][L]-this.min[L];Z=Math.min(Z,fe),V=Math.max(V,fe)}if(V<0||Z>this.max[L]-this.min[L])return 0}return 1};var au=function(l,f,c,d){if(l===void 0&&(l=0),f===void 0&&(f=0),c===void 0&&(c=0),d===void 0&&(d=0),isNaN(l)||l<0||isNaN(f)||f<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=f,this.left=c,this.right=d};au.prototype.interpolate=function(l,f,c){return f.top!=null&&l.top!=null&&(this.top=v.number(l.top,f.top,c)),f.bottom!=null&&l.bottom!=null&&(this.bottom=v.number(l.bottom,f.bottom,c)),f.left!=null&&l.left!=null&&(this.left=v.number(l.left,f.left,c)),f.right!=null&&l.right!=null&&(this.right=v.number(l.right,f.right,c)),this},au.prototype.getCenter=function(l,f){var c=v.clamp((this.left+l-this.right)/2,0,l),d=v.clamp((this.top+f-this.bottom)/2,0,f);return new v.Point(c,d)},au.prototype.equals=function(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right},au.prototype.clone=function(){return new au(this.top,this.bottom,this.left,this.right)},au.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Di=function(l,f,c,d,b){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=b===void 0||b,this._minZoom=l||0,this._maxZoom=f||22,this._minPitch=c==null?0:c,this._maxPitch=d==null?60:d,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new au,this._posMatrixCache={},this._alignedPosMatrixCache={}},ka={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Di.prototype.clone=function(){var l=new Di(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return l.tileSize=this.tileSize,l.latRange=this.latRange,l.width=this.width,l.height=this.height,l._center=this._center,l.zoom=this.zoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._calcMatrices(),l},ka.minZoom.get=function(){return this._minZoom},ka.minZoom.set=function(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))},ka.maxZoom.get=function(){return this._maxZoom},ka.maxZoom.set=function(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))},ka.minPitch.get=function(){return this._minPitch},ka.minPitch.set=function(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))},ka.maxPitch.get=function(){return this._maxPitch},ka.maxPitch.set=function(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))},ka.renderWorldCopies.get=function(){return this._renderWorldCopies},ka.renderWorldCopies.set=function(l){l===void 0?l=!0:l===null&&(l=!1),this._renderWorldCopies=l},ka.worldSize.get=function(){return this.tileSize*this.scale},ka.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},ka.size.get=function(){return new v.Point(this.width,this.height)},ka.bearing.get=function(){return-this.angle/Math.PI*180},ka.bearing.set=function(l){var f=-v.wrap(l,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},ka.pitch.get=function(){return this._pitch/Math.PI*180},ka.pitch.set=function(l){var f=v.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},ka.fov.get=function(){return this._fov/Math.PI*180},ka.fov.set=function(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=l/180*Math.PI,this._calcMatrices())},ka.zoom.get=function(){return this._zoom},ka.zoom.set=function(l){var f=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},ka.center.get=function(){return this._center},ka.center.set=function(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._constrain(),this._calcMatrices())},ka.padding.get=function(){return this._edgeInsets.toJSON()},ka.padding.set=function(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())},ka.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Di.prototype.isPaddingEqual=function(l){return this._edgeInsets.equals(l)},Di.prototype.interpolatePadding=function(l,f,c){this._unmodified=!1,this._edgeInsets.interpolate(l,f,c),this._constrain(),this._calcMatrices()},Di.prototype.coveringZoomLevel=function(l){var f=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,f)},Di.prototype.getVisibleUnwrappedCoordinates=function(l){var f=[new v.UnwrappedTileID(0,l)];if(this._renderWorldCopies)for(var c=this.pointCoordinate(new v.Point(0,0)),d=this.pointCoordinate(new v.Point(this.width,0)),b=this.pointCoordinate(new v.Point(this.width,this.height)),C=this.pointCoordinate(new v.Point(0,this.height)),A=Math.floor(Math.min(c.x,d.x,b.x,C.x)),L=Math.floor(Math.max(c.x,d.x,b.x,C.x)),Z=A-1;Z<=L+1;Z++)Z!==0&&f.push(new v.UnwrappedTileID(Z,l));return f},Di.prototype.coveringTiles=function(l){var f=this.coveringZoomLevel(l),c=f;if(l.minzoom!==void 0&&f<l.minzoom)return[];l.maxzoom!==void 0&&f>l.maxzoom&&(f=l.maxzoom);var d=v.MercatorCoordinate.fromLngLat(this.center),b=Math.pow(2,f),C=[b*d.x,b*d.y,0],A=ql.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),L=l.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(L=f);var Z=function(Fr){return{aabb:new Al([Fr*b,0,0],[(Fr+1)*b,b,0]),zoom:0,x:0,y:0,wrap:Fr,fullyVisible:!1}},V=[],le=[],fe=f,de=l.reparseOverscaled?c:f;if(this._renderWorldCopies)for(var ke=1;ke<=3;ke++)V.push(Z(-ke)),V.push(Z(ke));for(V.push(Z(0));V.length>0;){var Re=V.pop(),He=Re.x,Ae=Re.y,We=Re.fullyVisible;if(!We){var tt=Re.aabb.intersects(A);if(tt===0)continue;We=tt===2}var bt=Re.aabb.distanceX(C),Yt=Re.aabb.distanceY(C),zt=Math.max(Math.abs(bt),Math.abs(Yt));if(Re.zoom===fe||zt>3+(1<<fe-Re.zoom)-2&&Re.zoom>=L)le.push({tileID:new v.OverscaledTileID(Re.zoom===fe?de:Re.zoom,Re.wrap,Re.zoom,He,Ae),distanceSq:v.sqrLen([C[0]-.5-He,C[1]-.5-Ae])});else for(var $t=0;$t<4;$t++){var gr=(He<<1)+$t%2,Br=(Ae<<1)+($t>>1);V.push({aabb:Re.aabb.quadrant($t),zoom:Re.zoom+1,x:gr,y:Br,wrap:Re.wrap,fullyVisible:We})}}return le.sort(function(Fr,sn){return Fr.distanceSq-sn.distanceSq}).map(function(Fr){return Fr.tileID})},Di.prototype.resize=function(l,f){this.width=l,this.height=f,this.pixelsToGLUnits=[2/l,-2/f],this._constrain(),this._calcMatrices()},ka.unmodified.get=function(){return this._unmodified},Di.prototype.zoomScale=function(l){return Math.pow(2,l)},Di.prototype.scaleZoom=function(l){return Math.log(l)/Math.LN2},Di.prototype.project=function(l){var f=v.clamp(l.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(l.lng)*this.worldSize,v.mercatorYfromLat(f)*this.worldSize)},Di.prototype.unproject=function(l){return new v.MercatorCoordinate(l.x/this.worldSize,l.y/this.worldSize).toLngLat()},ka.point.get=function(){return this.project(this.center)},Di.prototype.setLocationAtPoint=function(l,f){var c=this.pointCoordinate(f),d=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(l),C=new v.MercatorCoordinate(b.x-(c.x-d.x),b.y-(c.y-d.y));this.center=this.coordinateLocation(C),this._renderWorldCopies&&(this.center=this.center.wrap())},Di.prototype.locationPoint=function(l){return this.coordinatePoint(this.locationCoordinate(l))},Di.prototype.pointLocation=function(l){return this.coordinateLocation(this.pointCoordinate(l))},Di.prototype.locationCoordinate=function(l){return v.MercatorCoordinate.fromLngLat(l)},Di.prototype.coordinateLocation=function(l){return l.toLngLat()},Di.prototype.pointCoordinate=function(l){var f=[l.x,l.y,0,1],c=[l.x,l.y,1,1];v.transformMat4(f,f,this.pixelMatrixInverse),v.transformMat4(c,c,this.pixelMatrixInverse);var d=f[3],b=c[3],C=f[1]/d,A=c[1]/b,L=f[2]/d,Z=c[2]/b,V=L===Z?0:(0-L)/(Z-L);return new v.MercatorCoordinate(v.number(f[0]/d,c[0]/b,V)/this.worldSize,v.number(C,A,V)/this.worldSize)},Di.prototype.coordinatePoint=function(l){var f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix),new v.Point(f[0]/f[3],f[1]/f[3])},Di.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},Di.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Di.prototype.setMaxBounds=function(l){l?(this.lngRange=[l.getWest(),l.getEast()],this.latRange=[l.getSouth(),l.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Di.prototype.calculatePosMatrix=function(l,f){f===void 0&&(f=!1);var c=l.key,d=f?this._alignedPosMatrixCache:this._posMatrixCache;if(d[c])return d[c];var b=l.canonical,C=this.worldSize/this.zoomScale(b.z),A=b.x+Math.pow(2,b.z)*l.wrap,L=v.identity(new Float64Array(16));return v.translate(L,L,[A*C,b.y*C,0]),v.scale(L,L,[C/v.EXTENT,C/v.EXTENT,1]),v.multiply(L,f?this.alignedProjMatrix:this.projMatrix,L),d[c]=new Float32Array(L),d[c]},Di.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Di.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var l,f,c,d,b=-90,C=90,A=-180,L=180,Z=this.size,V=this._unmodified;if(this.latRange){var le=this.latRange;b=v.mercatorYfromLat(le[1])*this.worldSize,l=(C=v.mercatorYfromLat(le[0])*this.worldSize)-b<Z.y?Z.y/(C-b):0}if(this.lngRange){var fe=this.lngRange;A=v.mercatorXfromLng(fe[0])*this.worldSize,f=(L=v.mercatorXfromLng(fe[1])*this.worldSize)-A<Z.x?Z.x/(L-A):0}var de=this.point,ke=Math.max(f||0,l||0);if(ke)return this.center=this.unproject(new v.Point(f?(L+A)/2:de.x,l?(C+b)/2:de.y)),this.zoom+=this.scaleZoom(ke),this._unmodified=V,void(this._constraining=!1);if(this.latRange){var Re=de.y,He=Z.y/2;Re-He<b&&(d=b+He),Re+He>C&&(d=C-He)}if(this.lngRange){var Ae=de.x,We=Z.x/2;Ae-We<A&&(c=A+We),Ae+We>L&&(c=L-We)}c===void 0&&d===void 0||(this.center=this.unproject(new v.Point(c!==void 0?c:de.x,d!==void 0?d:de.y))),this._unmodified=V,this._constraining=!1}},Di.prototype._calcMatrices=function(){if(this.height){var l=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,c=this._fov*(.5+l.y/this.height),d=Math.sin(c)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-f-c,.01,Math.PI-.01)),b=this.point,C=b.x,A=b.y,L=1.01*(Math.cos(Math.PI/2-this._pitch)*d+this.cameraToCenterDistance),Z=this.height/50,V=new Float64Array(16);v.perspective(V,this._fov,this.width/this.height,Z,L),V[8]=2*-l.x/this.width,V[9]=2*l.y/this.height,v.scale(V,V,[1,-1,1]),v.translate(V,V,[0,0,-this.cameraToCenterDistance]),v.rotateX(V,V,this._pitch),v.rotateZ(V,V,this.angle),v.translate(V,V,[-C,-A,0]),this.mercatorMatrix=v.scale([],V,[this.worldSize,this.worldSize,this.worldSize]),v.scale(V,V,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=V,this.invProjMatrix=v.invert([],this.projMatrix);var le=this.width%2/2,fe=this.height%2/2,de=Math.cos(this.angle),ke=Math.sin(this.angle),Re=C-Math.round(C)+de*le+ke*fe,He=A-Math.round(A)+de*fe+ke*le,Ae=new Float64Array(V);if(v.translate(Ae,Ae,[Re>.5?Re-1:Re,He>.5?He-1:He,0]),this.alignedProjMatrix=Ae,V=v.create(),v.scale(V,V,[this.width/2,-this.height/2,1]),v.translate(V,V,[1,-1,0]),this.labelPlaneMatrix=V,V=v.create(),v.scale(V,V,[1,-1,1]),v.translate(V,V,[-1,-1,0]),v.scale(V,V,[2/this.width,2/this.height,1]),this.glCoordMatrix=V,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(V=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=V,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Di.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var l=this.pointCoordinate(new v.Point(0,0)),f=[l.x*this.worldSize,l.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},Di.prototype.getCameraPoint=function(){var l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,l))},Di.prototype.getCameraQueryGeometry=function(l){var f=this.getCameraPoint();if(l.length===1)return[l[0],f];for(var c=f.x,d=f.y,b=f.x,C=f.y,A=0,L=l;A<L.length;A+=1){var Z=L[A];c=Math.min(c,Z.x),d=Math.min(d,Z.y),b=Math.max(b,Z.x),C=Math.max(C,Z.y)}return[new v.Point(c,d),new v.Point(b,d),new v.Point(b,C),new v.Point(c,C),new v.Point(c,d)]},Object.defineProperties(Di.prototype,ka);var Ls=function(l){var f,c,d,b;this._hashName=l&&encodeURIComponent(l),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),c=!1,d=null,b=function(){d=null,c&&(f(),d=setTimeout(b,300),c=!1)},function(){return c=!0,d||b(),d})};Ls.prototype.addTo=function(l){return this._map=l,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Ls.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Ls.prototype.getHashString=function(l){var f=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,d),C=Math.round(f.lng*b)/b,A=Math.round(f.lat*b)/b,L=this._map.getBearing(),Z=this._map.getPitch(),V="";if(V+=l?"/"+C+"/"+A+"/"+c:c+"/"+A+"/"+C,(L||Z)&&(V+="/"+Math.round(10*L)/10),Z&&(V+="/"+Math.round(Z)),this._hashName){var le=this._hashName,fe=!1,de=v.window.location.hash.slice(1).split("&").map(function(ke){var Re=ke.split("=")[0];return Re===le?(fe=!0,Re+"="+V):ke}).filter(function(ke){return ke});return fe||de.push(le+"="+V),"#"+de.join("&")}return"#"+V},Ls.prototype._getCurrentHash=function(){var l,f=this,c=v.window.location.hash.replace("#","");return this._hashName?(c.split("&").map(function(d){return d.split("=")}).forEach(function(d){d[0]===f._hashName&&(l=d)}),(l&&l[1]||"").split("/")):c.split("/")},Ls.prototype._onHashChange=function(){var l=this._getCurrentHash();if(l.length>=3&&!l.some(function(c){return isNaN(c)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(l[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:f,pitch:+(l[4]||0)}),!0}return!1},Ls.prototype._updateHashUnthrottled=function(){var l=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,l)}catch(f){}};var rf={linearity:.3,easing:v.bezier(0,0,.3,1)},ul=v.extend({deceleration:2500,maxSpeed:1400},rf),nf=v.extend({deceleration:20,maxSpeed:1400},rf),Jh=v.extend({deceleration:1e3,maxSpeed:360},rf),Qh=v.extend({deceleration:1e3,maxSpeed:90},rf),Tc=function(l){this._map=l,this.clear()};function Kl(l,f){(!l.duration||l.duration<f.duration)&&(l.duration=f.duration,l.easing=f.easing)}function Wu(l,f,c){var d=c.maxSpeed,b=c.linearity,C=c.deceleration,A=v.clamp(l*b/(f/1e3),-d,d),L=Math.abs(A)/(C*b);return{easing:c.easing,duration:1e3*L,amount:A*(L/2)}}Tc.prototype.clear=function(){this._inertiaBuffer=[]},Tc.prototype.record=function(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:l})},Tc.prototype._drainInertiaBuffer=function(){for(var l=this._inertiaBuffer,f=v.browser.now();l.length>0&&f-l[0].time>160;)l.shift()},Tc.prototype._onMoveEnd=function(l){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},c=0,d=this._inertiaBuffer;c<d.length;c+=1){var b=d[c].settings;f.zoom+=b.zoomDelta||0,f.bearing+=b.bearingDelta||0,f.pitch+=b.pitchDelta||0,b.panDelta&&f.pan._add(b.panDelta),b.around&&(f.around=b.around),b.pinchAround&&(f.pinchAround=b.pinchAround)}var C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,A={};if(f.pan.mag()){var L=Wu(f.pan.mag(),C,v.extend({},ul,l||{}));A.offset=f.pan.mult(L.amount/f.pan.mag()),A.center=this._map.transform.center,Kl(A,L)}if(f.zoom){var Z=Wu(f.zoom,C,nf);A.zoom=this._map.transform.zoom+Z.amount,Kl(A,Z)}if(f.bearing){var V=Wu(f.bearing,C,Jh);A.bearing=this._map.transform.bearing+v.clamp(V.amount,-179,179),Kl(A,V)}if(f.pitch){var le=Wu(f.pitch,C,Qh);A.pitch=this._map.transform.pitch+le.amount,Kl(A,le)}if(A.zoom||A.bearing){var fe=f.pinchAround===void 0?f.around:f.pinchAround;A.around=fe?this._map.unproject(fe):this._map.getCenter()}return this.clear(),v.extend(A,{noMoveStart:!0})}};var ko=function(l){function f(d,b,C,A){A===void 0&&(A={});var L=F.mousePos(b.getCanvasContainer(),C),Z=b.unproject(L);l.call(this,d,v.extend({point:L,lngLat:Z,originalEvent:C},A)),this._defaultPrevented=!1,this.target=b}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),$l=function(l){function f(d,b,C){var A=d==="touchend"?C.changedTouches:C.touches,L=F.touchPos(b.getCanvasContainer(),A),Z=L.map(function(fe){return b.unproject(fe)}),V=L.reduce(function(fe,de,ke,Re){return fe.add(de.div(Re.length))},new v.Point(0,0)),le=b.unproject(V);l.call(this,d,{points:L,point:V,lngLats:Z,lngLat:le,originalEvent:C}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),Jl=function(l){function f(d,b,C){l.call(this,d,{originalEvent:C}),this._defaultPrevented=!1}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},c.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,c),f}(v.Event),Ja=function(l,f){this._map=l,this._clickTolerance=f.clickTolerance};Ja.prototype.reset=function(){delete this._mousedownPos},Ja.prototype.wheel=function(l){return this._firePreventable(new Jl(l.type,this._map,l))},Ja.prototype.mousedown=function(l,f){return this._mousedownPos=f,this._firePreventable(new ko(l.type,this._map,l))},Ja.prototype.mouseup=function(l){this._map.fire(new ko(l.type,this._map,l))},Ja.prototype.click=function(l,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new ko(l.type,this._map,l))},Ja.prototype.dblclick=function(l){return this._firePreventable(new ko(l.type,this._map,l))},Ja.prototype.mouseover=function(l){this._map.fire(new ko(l.type,this._map,l))},Ja.prototype.mouseout=function(l){this._map.fire(new ko(l.type,this._map,l))},Ja.prototype.touchstart=function(l){return this._firePreventable(new $l(l.type,this._map,l))},Ja.prototype.touchmove=function(l){this._map.fire(new $l(l.type,this._map,l))},Ja.prototype.touchend=function(l){this._map.fire(new $l(l.type,this._map,l))},Ja.prototype.touchcancel=function(l){this._map.fire(new $l(l.type,this._map,l))},Ja.prototype._firePreventable=function(l){if(this._map.fire(l),l.defaultPrevented)return{}},Ja.prototype.isEnabled=function(){return!0},Ja.prototype.isActive=function(){return!1},Ja.prototype.enable=function(){},Ja.prototype.disable=function(){};var yn=function(l){this._map=l};yn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},yn.prototype.mousemove=function(l){this._map.fire(new ko(l.type,this._map,l))},yn.prototype.mousedown=function(){this._delayContextMenu=!0},yn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ko("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},yn.prototype.contextmenu=function(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new ko(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()},yn.prototype.isEnabled=function(){return!0},yn.prototype.isActive=function(){return!1},yn.prototype.enable=function(){},yn.prototype.disable=function(){};var ao=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=f.clickTolerance||1};function Xu(l,f){for(var c={},d=0;d<l.length;d++)c[l[d].identifier]=f[d];return c}ao.prototype.isEnabled=function(){return!!this._enabled},ao.prototype.isActive=function(){return!!this._active},ao.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ao.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ao.prototype.mousedown=function(l,f){this.isEnabled()&&l.shiftKey&&l.button===0&&(F.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},ao.prototype.mousemoveWindow=function(l,f){if(this._active){var c=f;if(!(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)){var d=this._startPos;this._lastPos=c,this._box||(this._box=F.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));var b=Math.min(d.x,c.x),C=Math.max(d.x,c.x),A=Math.min(d.y,c.y),L=Math.max(d.y,c.y);F.setTransform(this._box,"translate("+b+"px,"+A+"px)"),this._box.style.width=C-b+"px",this._box.style.height=L-A+"px"}}},ao.prototype.mouseupWindow=function(l,f){var c=this;if(this._active&&l.button===0){var d=this._startPos,b=f;if(this.reset(),F.suppressClick(),d.x!==b.x||d.y!==b.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:function(C){return C.fitScreenCoordinates(d,b,c._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",l)}},ao.prototype.keydown=function(l){this._active&&l.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",l))},ao.prototype.blur=function(){this.reset()},ao.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(F.remove(this._box),this._box=null),F.enableDrag(),delete this._startPos,delete this._lastPos},ao.prototype._fireEvent=function(l,f){return this._map.fire(new v.Event(l,{originalEvent:f}))};var Yu=function(l){this.reset(),this.numTouches=l.numTouches};Yu.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Yu.prototype.touchstart=function(l,f,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=l.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){for(var b=new v.Point(0,0),C=0,A=d;C<A.length;C+=1)b._add(A[C]);return b.div(d.length)}(f),this.touches=Xu(c,f)))},Yu.prototype.touchmove=function(l,f,c){if(!this.aborted&&this.centroid){var d=Xu(c,f);for(var b in this.touches){var C=d[b];(!C||C.dist(this.touches[b])>30)&&(this.aborted=!0)}}},Yu.prototype.touchend=function(l,f,c){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){var d=!this.aborted&&this.centroid;if(this.reset(),d)return d}};var du=function(l){this.singleTap=new Yu(l),this.numTaps=l.numTaps,this.reset()};du.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},du.prototype.touchstart=function(l,f,c){this.singleTap.touchstart(l,f,c)},du.prototype.touchmove=function(l,f,c){this.singleTap.touchmove(l,f,c)},du.prototype.touchend=function(l,f,c){var d=this.singleTap.touchend(l,f,c);if(d){var b=l.timeStamp-this.lastTime<500,C=!this.lastTap||this.lastTap.dist(d)<30;if(b&&C||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}};var ks=function(){this._zoomIn=new du({numTouches:1,numTaps:2}),this._zoomOut=new du({numTouches:2,numTaps:1}),this.reset()};ks.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ks.prototype.touchstart=function(l,f,c){this._zoomIn.touchstart(l,f,c),this._zoomOut.touchstart(l,f,c)},ks.prototype.touchmove=function(l,f,c){this._zoomIn.touchmove(l,f,c),this._zoomOut.touchmove(l,f,c)},ks.prototype.touchend=function(l,f,c){var d=this,b=this._zoomIn.touchend(l,f,c),C=this._zoomOut.touchend(l,f,c);return b?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(A){return A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(b)},{originalEvent:l})}}):C?(this._active=!0,l.preventDefault(),setTimeout(function(){return d.reset()},0),{cameraAnimation:function(A){return A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(C)},{originalEvent:l})}}):void 0},ks.prototype.touchcancel=function(){this.reset()},ks.prototype.enable=function(){this._enabled=!0},ks.prototype.disable=function(){this._enabled=!1,this.reset()},ks.prototype.isEnabled=function(){return this._enabled},ks.prototype.isActive=function(){return this._active};var Mf={0:1,2:2},$r=function(l){this.reset(),this._clickTolerance=l.clickTolerance||1};$r.prototype.blur=function(){this.reset()},$r.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},$r.prototype._correctButton=function(l,f){return!1},$r.prototype._move=function(l,f){return{}},$r.prototype.mousedown=function(l,f){if(!this._lastPoint){var c=F.mouseButton(l);this._correctButton(l,c)&&(this._lastPoint=f,this._eventButton=c)}},$r.prototype.mousemoveWindow=function(l,f){var c=this._lastPoint;if(c){if(l.preventDefault(),function(d,b){var C=Mf[b];return d.buttons===void 0||(d.buttons&C)!==C}(l,this._eventButton))this.reset();else if(this._moved||!(f.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(c,f)}},$r.prototype.mouseupWindow=function(l){this._lastPoint&&F.mouseButton(l)===this._eventButton&&(this._moved&&F.suppressClick(),this.reset())},$r.prototype.enable=function(){this._enabled=!0},$r.prototype.disable=function(){this._enabled=!1,this.reset()},$r.prototype.isEnabled=function(){return this._enabled},$r.prototype.isActive=function(){return this._active};var af=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.mousedown=function(c,d){l.prototype.mousedown.call(this,c,d),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(c,d){return d===0&&!c.ctrlKey},f.prototype._move=function(c,d){return{around:d,panDelta:d.sub(c)}},f}($r),Pf=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var b=.8*(d.x-c.x);if(b)return this._active=!0,{bearingDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}($r),wu=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype._correctButton=function(c,d){return d===0&&c.ctrlKey||d===2},f.prototype._move=function(c,d){var b=-.5*(d.y-c.y);if(b)return this._active=!0,{pitchDelta:b}},f.prototype.contextmenu=function(c){c.preventDefault()},f}($r),ja=function(l){this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset()};ja.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},ja.prototype.touchstart=function(l,f,c){return this._calculateTransform(l,f,c)},ja.prototype.touchmove=function(l,f,c){if(this._active&&!(c.length<this._minTouches))return l.preventDefault(),this._calculateTransform(l,f,c)},ja.prototype.touchend=function(l,f,c){this._calculateTransform(l,f,c),this._active&&c.length<this._minTouches&&this.reset()},ja.prototype.touchcancel=function(){this.reset()},ja.prototype._calculateTransform=function(l,f,c){c.length>0&&(this._active=!0);var d=Xu(c,f),b=new v.Point(0,0),C=new v.Point(0,0),A=0;for(var L in d){var Z=d[L],V=this._touches[L];V&&(b._add(Z),C._add(Z.sub(V)),A++,d[L]=Z)}if(this._touches=d,!(A<this._minTouches)&&C.mag()){var le=C.div(A);if(this._sum._add(le),!(this._sum.mag()<this._clickTolerance))return{around:b.div(A),panDelta:le}}},ja.prototype.enable=function(){this._enabled=!0},ja.prototype.disable=function(){this._enabled=!1,this.reset()},ja.prototype.isEnabled=function(){return this._enabled},ja.prototype.isActive=function(){return this._active};var Ds=function(){this.reset()};function of(l,f,c){for(var d=0;d<l.length;d++)if(l[d].identifier===c)return f[d]}function Au(l,f){return Math.log(l/f)/Math.LN2}Ds.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ds.prototype._start=function(l){},Ds.prototype._move=function(l,f,c){return{}},Ds.prototype.touchstart=function(l,f,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([f[0],f[1]]))},Ds.prototype.touchmove=function(l,f,c){if(this._firstTwoTouches){l.preventDefault();var d=this._firstTwoTouches,b=d[1],C=of(c,f,d[0]),A=of(c,f,b);if(C&&A){var L=this._aroundCenter?null:C.add(A).div(2);return this._move([C,A],L,l)}}},Ds.prototype.touchend=function(l,f,c){if(this._firstTwoTouches){var d=this._firstTwoTouches,b=d[1],C=of(c,f,d[0]),A=of(c,f,b);C&&A||(this._active&&F.suppressClick(),this.reset())}},Ds.prototype.touchcancel=function(){this.reset()},Ds.prototype.enable=function(l){this._enabled=!0,this._aroundCenter=!!l&&l.around==="center"},Ds.prototype.disable=function(){this._enabled=!1,this.reset()},Ds.prototype.isEnabled=function(){return this._enabled},Ds.prototype.isActive=function(){return this._active};var ws=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(c){this._startDistance=this._distance=c[0].dist(c[1])},f.prototype._move=function(c,d){var b=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs(Au(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Au(this._distance,b),pinchAround:d}},f}(Ds);function Ao(l,f){return 180*l.angleWith(f)/Math.PI}var hh=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])},f.prototype._move=function(c,d){var b=this._vector;if(this._vector=c[0].sub(c[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ao(this._vector,b),pinchAround:d}},f.prototype._isBelowThreshold=function(c){this._minDiameter=Math.min(this._minDiameter,c.mag());var d=25/(Math.PI*this._minDiameter)*360,b=Ao(c,this._startVector);return Math.abs(b)<d},f}(Ds);function ya(l){return Math.abs(l.y)>Math.abs(l.x)}var If=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.reset=function(){l.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(c){this._lastPoints=c,ya(c[0].sub(c[1]))&&(this._valid=!1)},f.prototype._move=function(c,d,b){var C=c[0].sub(this._lastPoints[0]),A=c[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(C,A,b.timeStamp),this._valid)return this._lastPoints=c,this._active=!0,{pitchDelta:(C.y+A.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(c,d,b){if(this._valid!==void 0)return this._valid;var C=c.mag()>=2,A=d.mag()>=2;if(C||A){if(!C||!A)return this._firstMove===void 0&&(this._firstMove=b),b-this._firstMove<100&&void 0;var L=c.y>0==d.y>0;return ya(c)&&ya(d)&&L}},f}(Ds),ph={panStep:100,bearingStep:15,pitchStep:10},Hs=function(){var l=ph;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1};function As(l){return l*(2-l)}Hs.prototype.blur=function(){this.reset()},Hs.prototype.reset=function(){this._active=!1},Hs.prototype.keydown=function(l){var f=this;if(!(l.altKey||l.ctrlKey||l.metaKey)){var c=0,d=0,b=0,C=0,A=0;switch(l.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:l.shiftKey?d=-1:(l.preventDefault(),C=-1);break;case 39:l.shiftKey?d=1:(l.preventDefault(),C=1);break;case 38:l.shiftKey?b=1:(l.preventDefault(),A=-1);break;case 40:l.shiftKey?b=-1:(l.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(d=0,b=0),{cameraAnimation:function(L){var Z=L.getZoom();L.easeTo({duration:300,easeId:"keyboardHandler",easing:As,zoom:c?Math.round(Z)+c*(l.shiftKey?2:1):Z,bearing:L.getBearing()+d*f._bearingStep,pitch:L.getPitch()+b*f._pitchStep,offset:[-C*f._panStep,-A*f._panStep],center:L.getCenter()},{originalEvent:l})}}}},Hs.prototype.enable=function(){this._enabled=!0},Hs.prototype.disable=function(){this._enabled=!1,this.reset()},Hs.prototype.isEnabled=function(){return this._enabled},Hs.prototype.isActive=function(){return this._active},Hs.prototype.disableRotation=function(){this._rotationDisabled=!0},Hs.prototype.enableRotation=function(){this._rotationDisabled=!1};var Oi=function(l,f){this._map=l,this._el=l.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};Oi.prototype.setZoomRate=function(l){this._defaultZoomRate=l},Oi.prototype.setWheelZoomRate=function(l){this._wheelZoomRate=l},Oi.prototype.isEnabled=function(){return!!this._enabled},Oi.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Oi.prototype.isZooming=function(){return!!this._zooming},Oi.prototype.enable=function(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=l&&l.around==="center")},Oi.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Oi.prototype.wheel=function(l){if(this.isEnabled()){var f=l.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY,c=v.browser.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(d*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),l.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=l,this._delta-=f,this._active||this._start(l)),l.preventDefault()}},Oi.prototype._onTimeout=function(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},Oi.prototype._start=function(l){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=F.mousePos(this._el,l);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Oi.prototype.renderFrame=function(){var l=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var c=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,d=2/(1+Math.exp(-Math.abs(this._delta*c)));this._delta<0&&d!==0&&(d=1/d);var b=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(b*d))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var C,A=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,L=this._startZoom,Z=this._easing,V=!1;if(this._type==="wheel"&&L&&Z){var le=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),fe=Z(le);C=v.number(L,A,fe),le<1?this._frameId||(this._frameId=!0):V=!0}else C=A,V=!0;return this._active=!0,V&&(this._active=!1,this._finishTimeout=setTimeout(function(){l._zooming=!1,l._handler._triggerRenderFrame(),delete l._targetZoom,delete l._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!V,zoomDelta:C-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Oi.prototype._smoothOutEasing=function(l){var f=v.ease;if(this._prevEase){var c=this._prevEase,d=(v.browser.now()-c.start)/c.duration,b=c.easing(d+.01)-c.easing(d),C=.27/Math.sqrt(b*b+1e-4)*.01,A=Math.sqrt(.0729-C*C);f=v.bezier(C,A,.25,1)}return this._prevEase={start:v.browser.now(),duration:l,easing:f},f},Oi.prototype.blur=function(){this.reset()},Oi.prototype.reset=function(){this._active=!1};var vu=function(l,f){this._clickZoom=l,this._tapZoom=f};vu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},vu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},vu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},vu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var pa=function(){this.reset()};pa.prototype.reset=function(){this._active=!1},pa.prototype.blur=function(){this.reset()},pa.prototype.dblclick=function(l,f){return l.preventDefault(),{cameraAnimation:function(c){c.easeTo({duration:300,zoom:c.getZoom()+(l.shiftKey?-1:1),around:c.unproject(f)},{originalEvent:l})}}},pa.prototype.enable=function(){this._enabled=!0},pa.prototype.disable=function(){this._enabled=!1,this.reset()},pa.prototype.isEnabled=function(){return this._enabled},pa.prototype.isActive=function(){return this._active};var ho=function(){this._tap=new du({numTouches:1,numTaps:1}),this.reset()};ho.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},ho.prototype.touchstart=function(l,f,c){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=f[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(l,f,c))},ho.prototype.touchmove=function(l,f,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;var d=f[0],b=d.y-this._swipePoint.y;return this._swipePoint=d,l.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(l,f,c)},ho.prototype.touchend=function(l,f,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(l,f,c)&&(this._tapTime=l.timeStamp)},ho.prototype.touchcancel=function(){this.reset()},ho.prototype.enable=function(){this._enabled=!0},ho.prototype.disable=function(){this._enabled=!1,this.reset()},ho.prototype.isEnabled=function(){return this._enabled},ho.prototype.isActive=function(){return this._active};var Fs=function(l,f,c){this._el=l,this._mousePan=f,this._touchPan=c};Fs.prototype.enable=function(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Fs.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Fs.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Fs.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var ou=function(l,f,c){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=f,this._mousePitch=c};ou.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},ou.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},ou.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},ou.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var Bs=function(l,f,c,d){this._el=l,this._touchZoom=f,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0};Bs.prototype.enable=function(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},Bs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},Bs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},Bs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},Bs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},Bs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var cs=function(l){return l.zoom||l.drag||l.pitch||l.rotate},Ns=function(l){function f(){l.apply(this,arguments)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f}(v.Event);function On(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}var wn=function(l,f){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Tc(l),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),v.bindAll(["handleEvent","handleWindowEvent"],this);var c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[v.window,"blur",void 0]];for(var d=0,b=this._listeners;d<b.length;d+=1){var C=b[d],A=C[0];F.addEventListener(A,C[1],A===v.window.document?this.handleWindowEvent:this.handleEvent,C[2])}};wn.prototype.destroy=function(){for(var l=0,f=this._listeners;l<f.length;l+=1){var c=f[l],d=c[0];F.removeEventListener(d,c[1],d===v.window.document?this.handleWindowEvent:this.handleEvent,c[2])}},wn.prototype._addDefaultHandlers=function(l){var f=this._map,c=f.getCanvasContainer();this._add("mapEvent",new Ja(f,l));var d=f.boxZoom=new ao(f,l);this._add("boxZoom",d);var b=new ks,C=new pa;f.doubleClickZoom=new vu(C,b),this._add("tapZoom",b),this._add("clickZoom",C);var A=new ho;this._add("tapDragZoom",A);var L=f.touchPitch=new If;this._add("touchPitch",L);var Z=new Pf(l),V=new wu(l);f.dragRotate=new ou(l,Z,V),this._add("mouseRotate",Z,["mousePitch"]),this._add("mousePitch",V,["mouseRotate"]);var le=new af(l),fe=new ja(l);f.dragPan=new Fs(c,le,fe),this._add("mousePan",le),this._add("touchPan",fe,["touchZoom","touchRotate"]);var de=new hh,ke=new ws;f.touchZoomRotate=new Bs(c,ke,de,A),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",ke,["touchPan","touchRotate"]);var Re=f.scrollZoom=new Oi(f,this);this._add("scrollZoom",Re,["mousePan"]);var He=f.keyboard=new Hs;this._add("keyboard",He),this._add("blockableMapEvent",new yn(f));for(var Ae=0,We=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Ae<We.length;Ae+=1){var tt=We[Ae];l.interactive&&l[tt]&&f[tt].enable(l[tt])}},wn.prototype._add=function(l,f,c){this._handlers.push({handlerName:l,handler:f,allowed:c}),this._handlersById[l]=f},wn.prototype.stop=function(l){if(!this._updatingCamera){for(var f=0,c=this._handlers;f<c.length;f+=1)c[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}},wn.prototype.isActive=function(){for(var l=0,f=this._handlers;l<f.length;l+=1)if(f[l].handler.isActive())return!0;return!1},wn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},wn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},wn.prototype.isMoving=function(){return Boolean(cs(this._eventsInProgress))||this.isZooming()},wn.prototype._blockedByActive=function(l,f,c){for(var d in l)if(d!==c&&(!f||f.indexOf(d)<0))return!0;return!1},wn.prototype.handleWindowEvent=function(l){this.handleEvent(l,l.type+"Window")},wn.prototype._getMapTouches=function(l){for(var f=[],c=0,d=l;c<d.length;c+=1){var b=d[c];this._el.contains(b.target)&&f.push(b)}return f},wn.prototype.handleEvent=function(l,f){this._updatingCamera=!0;for(var c=l.type==="renderFrame"?void 0:l,d={needsRenderFrame:!1},b={},C={},A=l.touches?this._getMapTouches(l.touches):void 0,L=A?F.touchPos(this._el,A):F.mousePos(this._el,l),Z=0,V=this._handlers;Z<V.length;Z+=1){var le=V[Z],fe=le.handlerName,de=le.handler,ke=le.allowed;if(de.isEnabled()){var Re=void 0;this._blockedByActive(C,ke,fe)?de.reset():de[f||l.type]&&(Re=de[f||l.type](l,L,A),this.mergeHandlerResult(d,b,Re,fe,c),Re&&Re.needsRenderFrame&&this._triggerRenderFrame()),(Re||de.isActive())&&(C[fe]=de)}}var He={};for(var Ae in this._previousActiveHandlers)C[Ae]||(He[Ae]=c);this._previousActiveHandlers=C,(Object.keys(He).length||On(d))&&(this._changes.push([d,b,He]),this._triggerRenderFrame()),(Object.keys(C).length||On(d))&&this._map._stop(!0),this._updatingCamera=!1;var We=d.cameraAnimation;We&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],We(this._map))},wn.prototype.mergeHandlerResult=function(l,f,c,d,b){if(c){v.extend(l,c);var C={handlerName:d,originalEvent:c.originalEvent||b};c.zoomDelta!==void 0&&(f.zoom=C),c.panDelta!==void 0&&(f.drag=C),c.pitchDelta!==void 0&&(f.pitch=C),c.bearingDelta!==void 0&&(f.rotate=C)}},wn.prototype._applyChanges=function(){for(var l={},f={},c={},d=0,b=this._changes;d<b.length;d+=1){var C=b[d],A=C[0],L=C[1],Z=C[2];A.panDelta&&(l.panDelta=(l.panDelta||new v.Point(0,0))._add(A.panDelta)),A.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+A.zoomDelta),A.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+A.bearingDelta),A.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+A.pitchDelta),A.around!==void 0&&(l.around=A.around),A.pinchAround!==void 0&&(l.pinchAround=A.pinchAround),A.noInertia&&(l.noInertia=A.noInertia),v.extend(f,L),v.extend(c,Z)}this._updateMapTransform(l,f,c),this._changes=[]},wn.prototype._updateMapTransform=function(l,f,c){var d=this._map,b=d.transform;if(!On(l))return this._fireEvents(f,c,!0);var C=l.panDelta,A=l.zoomDelta,L=l.bearingDelta,Z=l.pitchDelta,V=l.around,le=l.pinchAround;le!==void 0&&(V=le),d._stop(!0),V=V||d.transform.centerPoint;var fe=b.pointLocation(C?V.sub(C):V);L&&(b.bearing+=L),Z&&(b.pitch+=Z),A&&(b.zoom+=A),b.setLocationAtPoint(fe,V),this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(f,c,!0)},wn.prototype._fireEvents=function(l,f,c){var d=this,b=cs(this._eventsInProgress),C=cs(l),A={};for(var L in l)this._eventsInProgress[L]||(A[L+"start"]=l[L].originalEvent),this._eventsInProgress[L]=l[L];for(var Z in!b&&C&&this._fireEvent("movestart",C.originalEvent),A)this._fireEvent(Z,A[Z]);for(var V in C&&this._fireEvent("move",C.originalEvent),l)this._fireEvent(V,l[V].originalEvent);var le,fe={};for(var de in this._eventsInProgress){var ke=this._eventsInProgress[de],Re=ke.handlerName,He=ke.originalEvent;this._handlersById[Re].isActive()||(delete this._eventsInProgress[de],fe[de+"end"]=le=f[Re]||He)}for(var Ae in fe)this._fireEvent(Ae,fe[Ae]);var We=cs(this._eventsInProgress);if(c&&(b||C)&&!We){this._updatingCamera=!0;var tt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),bt=function(Yt){return Yt!==0&&-d._bearingSnap<Yt&&Yt<d._bearingSnap};tt?(bt(tt.bearing||this._map.getBearing())&&(tt.bearing=0),this._map.easeTo(tt,{originalEvent:le})):(this._map.fire(new v.Event("moveend",{originalEvent:le})),bt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},wn.prototype._fireEvent=function(l,f){this._map.fire(new v.Event(l,f?{originalEvent:f}:{}))},wn.prototype._requestFrame=function(){var l=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete l._frameId,l.handleEvent(new Ns("renderFrame",{timeStamp:f})),l._applyChanges()})},wn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Ql=function(l){function f(c,d){l.call(this),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=d.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(c,d){return this.jumpTo({center:c},d)},f.prototype.panBy=function(c,d,b){return c=v.Point.convert(c).mult(-1),this.panTo(this.transform.center,v.extend({offset:c},d),b)},f.prototype.panTo=function(c,d,b){return this.easeTo(v.extend({center:c},d),b)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(c,d){return this.jumpTo({zoom:c},d),this},f.prototype.zoomTo=function(c,d,b){return this.easeTo(v.extend({zoom:c},d),b)},f.prototype.zoomIn=function(c,d){return this.zoomTo(this.getZoom()+1,c,d),this},f.prototype.zoomOut=function(c,d){return this.zoomTo(this.getZoom()-1,c,d),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(c,d){return this.jumpTo({bearing:c},d),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(c,d){return this.jumpTo({padding:c},d),this},f.prototype.rotateTo=function(c,d,b){return this.easeTo(v.extend({bearing:c},d),b)},f.prototype.resetNorth=function(c,d){return this.rotateTo(0,v.extend({duration:1e3},c),d),this},f.prototype.resetNorthPitch=function(c,d){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},c),d),this},f.prototype.snapToNorth=function(c,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,d):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(c,d){return this.jumpTo({pitch:c},d),this},f.prototype.cameraForBounds=function(c,d){c=v.LngLatBounds.convert(c);var b=d&&d.bearing||0;return this._cameraForBoxAndBearing(c.getNorthWest(),c.getSouthEast(),b,d)},f.prototype._cameraForBoxAndBearing=function(c,d,b,C){var A={top:0,bottom:0,right:0,left:0};if(typeof(C=v.extend({padding:A,offset:[0,0],maxZoom:this.transform.maxZoom},C)).padding=="number"){var L=C.padding;C.padding={top:L,bottom:L,right:L,left:L}}C.padding=v.extend(A,C.padding);var Z=this.transform,V=Z.padding,le=Z.project(v.LngLat.convert(c)),fe=Z.project(v.LngLat.convert(d)),de=le.rotate(-b*Math.PI/180),ke=fe.rotate(-b*Math.PI/180),Re=new v.Point(Math.max(de.x,ke.x),Math.max(de.y,ke.y)),He=new v.Point(Math.min(de.x,ke.x),Math.min(de.y,ke.y)),Ae=Re.sub(He),We=(Z.width-(V.left+V.right+C.padding.left+C.padding.right))/Ae.x,tt=(Z.height-(V.top+V.bottom+C.padding.top+C.padding.bottom))/Ae.y;if(!(tt<0||We<0)){var bt=Math.min(Z.scaleZoom(Z.scale*Math.min(We,tt)),C.maxZoom),Yt=typeof C.offset.x=="number"?new v.Point(C.offset.x,C.offset.y):v.Point.convert(C.offset),zt=new v.Point((C.padding.left-C.padding.right)/2,(C.padding.top-C.padding.bottom)/2).rotate(b*Math.PI/180),$t=Yt.add(zt).mult(Z.scale/Z.zoomScale(bt));return{center:Z.unproject(le.add(fe).div(2).sub($t)),zoom:bt,bearing:b}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(c,d,b){return this._fitInternal(this.cameraForBounds(c,d),d,b)},f.prototype.fitScreenCoordinates=function(c,d,b,C,A){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(c)),this.transform.pointLocation(v.Point.convert(d)),b,C),C,A)},f.prototype._fitInternal=function(c,d,b){return c?(delete(d=v.extend(c,d)).padding,d.linear?this.easeTo(d,b):this.flyTo(d,b)):this},f.prototype.jumpTo=function(c,d){this.stop();var b=this.transform,C=!1,A=!1,L=!1;return"zoom"in c&&b.zoom!==+c.zoom&&(C=!0,b.zoom=+c.zoom),c.center!==void 0&&(b.center=v.LngLat.convert(c.center)),"bearing"in c&&b.bearing!==+c.bearing&&(A=!0,b.bearing=+c.bearing),"pitch"in c&&b.pitch!==+c.pitch&&(L=!0,b.pitch=+c.pitch),c.padding==null||b.isPaddingEqual(c.padding)||(b.padding=c.padding),this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),C&&this.fire(new v.Event("zoomstart",d)).fire(new v.Event("zoom",d)).fire(new v.Event("zoomend",d)),A&&this.fire(new v.Event("rotatestart",d)).fire(new v.Event("rotate",d)).fire(new v.Event("rotateend",d)),L&&this.fire(new v.Event("pitchstart",d)).fire(new v.Event("pitch",d)).fire(new v.Event("pitchend",d)),this.fire(new v.Event("moveend",d))},f.prototype.easeTo=function(c,d){var b=this;this._stop(!1,c.easeId),((c=v.extend({offset:[0,0],duration:500,easing:v.ease},c)).animate===!1||!c.essential&&v.browser.prefersReducedMotion)&&(c.duration=0);var C=this.transform,A=this.getZoom(),L=this.getBearing(),Z=this.getPitch(),V=this.getPadding(),le="zoom"in c?+c.zoom:A,fe="bearing"in c?this._normalizeBearing(c.bearing,L):L,de="pitch"in c?+c.pitch:Z,ke="padding"in c?c.padding:C.padding,Re=v.Point.convert(c.offset),He=C.centerPoint.add(Re),Ae=C.pointLocation(He),We=v.LngLat.convert(c.center||Ae);this._normalizeCenter(We);var tt,bt,Yt=C.project(Ae),zt=C.project(We).sub(Yt),$t=C.zoomScale(le-A);c.around&&(tt=v.LngLat.convert(c.around),bt=C.locationPoint(tt));var gr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||le!==A,this._rotating=this._rotating||L!==fe,this._pitching=this._pitching||de!==Z,this._padding=!C.isPaddingEqual(ke),this._easeId=c.easeId,this._prepareEase(d,c.noMoveStart,gr),this._ease(function(Br){if(b._zooming&&(C.zoom=v.number(A,le,Br)),b._rotating&&(C.bearing=v.number(L,fe,Br)),b._pitching&&(C.pitch=v.number(Z,de,Br)),b._padding&&(C.interpolatePadding(V,ke,Br),He=C.centerPoint.add(Re)),tt)C.setLocationAtPoint(tt,bt);else{var Fr=C.zoomScale(C.zoom-A),sn=le>A?Math.min(2,$t):Math.max(.5,$t),kn=Math.pow(sn,1-Br),Dn=C.unproject(Yt.add(zt.mult(Br*kn)).mult(Fr));C.setLocationAtPoint(C.renderWorldCopies?Dn.wrap():Dn,He)}b._fireMoveEvents(d)},function(Br){b._afterEase(d,Br)},c),this},f.prototype._prepareEase=function(c,d,b){b===void 0&&(b={}),this._moving=!0,d||b.moving||this.fire(new v.Event("movestart",c)),this._zooming&&!b.zooming&&this.fire(new v.Event("zoomstart",c)),this._rotating&&!b.rotating&&this.fire(new v.Event("rotatestart",c)),this._pitching&&!b.pitching&&this.fire(new v.Event("pitchstart",c))},f.prototype._fireMoveEvents=function(c){this.fire(new v.Event("move",c)),this._zooming&&this.fire(new v.Event("zoom",c)),this._rotating&&this.fire(new v.Event("rotate",c)),this._pitching&&this.fire(new v.Event("pitch",c))},f.prototype._afterEase=function(c,d){if(!this._easeId||!d||this._easeId!==d){delete this._easeId;var b=this._zooming,C=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new v.Event("zoomend",c)),C&&this.fire(new v.Event("rotateend",c)),A&&this.fire(new v.Event("pitchend",c)),this.fire(new v.Event("moveend",c))}},f.prototype.flyTo=function(c,d){var b=this;if(!c.essential&&v.browser.prefersReducedMotion){var C=v.pick(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(C,d)}this.stop(),c=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},c);var A=this.transform,L=this.getZoom(),Z=this.getBearing(),V=this.getPitch(),le=this.getPadding(),fe="zoom"in c?v.clamp(+c.zoom,A.minZoom,A.maxZoom):L,de="bearing"in c?this._normalizeBearing(c.bearing,Z):Z,ke="pitch"in c?+c.pitch:V,Re="padding"in c?c.padding:A.padding,He=A.zoomScale(fe-L),Ae=v.Point.convert(c.offset),We=A.centerPoint.add(Ae),tt=A.pointLocation(We),bt=v.LngLat.convert(c.center||tt);this._normalizeCenter(bt);var Yt=A.project(tt),zt=A.project(bt).sub(Yt),$t=c.curve,gr=Math.max(A.width,A.height),Br=gr/He,Fr=zt.mag();if("minZoom"in c){var sn=v.clamp(Math.min(c.minZoom,L,fe),A.minZoom,A.maxZoom),kn=gr/A.zoomScale(sn-L);$t=Math.sqrt(kn/Fr*2)}var Dn=$t*$t;function zn(qn){var Vn=(Br*Br-gr*gr+(qn?-1:1)*Dn*Dn*Fr*Fr)/(2*(qn?Br:gr)*Dn*Fr);return Math.log(Math.sqrt(Vn*Vn+1)-Vn)}function ci(qn){return(Math.exp(qn)-Math.exp(-qn))/2}function ln(qn){return(Math.exp(qn)+Math.exp(-qn))/2}var Hn=zn(0),fi=function(qn){return ln(Hn)/ln(Hn+$t*qn)},Yn=function(qn){return gr*((ln(Hn)*(ci(Vn=Hn+$t*qn)/ln(Vn))-ci(Hn))/Dn)/Fr;var Vn},Zn=(zn(1)-Hn)/$t;if(Math.abs(Fr)<1e-6||!isFinite(Zn)){if(Math.abs(gr-Br)<1e-6)return this.easeTo(c,d);var vi=Br<gr?-1:1;Zn=Math.abs(Math.log(Br/gr))/$t,Yn=function(){return 0},fi=function(qn){return Math.exp(vi*$t*qn)}}return c.duration="duration"in c?+c.duration:1e3*Zn/("screenSpeed"in c?+c.screenSpeed/$t:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0),this._zooming=!0,this._rotating=Z!==de,this._pitching=ke!==V,this._padding=!A.isPaddingEqual(Re),this._prepareEase(d,!1),this._ease(function(qn){var Vn=qn*Zn,To=1/fi(Vn);A.zoom=qn===1?fe:L+A.scaleZoom(To),b._rotating&&(A.bearing=v.number(Z,de,qn)),b._pitching&&(A.pitch=v.number(V,ke,qn)),b._padding&&(A.interpolatePadding(le,Re,qn),We=A.centerPoint.add(Ae));var Li=qn===1?bt:A.unproject(Yt.add(zt.mult(Yn(Vn))).mult(To));A.setLocationAtPoint(A.renderWorldCopies?Li.wrap():Li,We),b._fireMoveEvents(d)},function(){return b._afterEase(d)},c),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(c,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var b=this._onEaseEnd;delete this._onEaseEnd,b.call(this,d)}if(!c){var C=this.handlers;C&&C.stop(!1)}return this},f.prototype._ease=function(c,d,b){b.animate===!1||b.duration===0?(c(1),d()):(this._easeStart=v.browser.now(),this._easeOptions=b,this._onEaseFrame=c,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var c=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(c,d){c=v.wrap(c,-180,180);var b=Math.abs(c-d);return Math.abs(c-360-d)<b&&(c-=360),Math.abs(c+360-d)<b&&(c+=360),c},f.prototype._normalizeCenter=function(c){var d=this.transform;if(d.renderWorldCopies&&!d.lngRange){var b=c.lng-d.center.lng;c.lng+=b>180?-360:b<-180?360:0}},f}(v.Evented),fs=function(l){l===void 0&&(l={}),this.options=l,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};fs.prototype.getDefaultPosition=function(){return"bottom-right"},fs.prototype.onAdd=function(l){var f=this.options&&this.options.compact;return this._map=l,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=F.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},fs.prototype.onRemove=function(){F.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},fs.prototype._setElementTitle=function(l,f){var c=this._map._getUIString("AttributionControl."+f);l.title=c,l.setAttribute("aria-label",c)},fs.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},fs.prototype._updateEditLink=function(){var l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(l){var c=f.reduce(function(d,b,C){return b.value&&(d+=b.key+"="+b.value+(C<f.length-1?"&":"")),d},"?");l.href=v.config.FEEDBACK_URL+"/"+c+(this._map._hash?this._map._hash.getHashString(!0):""),l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}},fs.prototype._updateData=function(l){!l||l.sourceDataType!=="metadata"&&l.sourceDataType!=="visibility"&&l.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},fs.prototype._updateAttributions=function(){if(this._map.style){var l=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=l.concat(this.options.customAttribution.map(function(L){return typeof L!="string"?"":L})):typeof this.options.customAttribution=="string"&&l.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var c=this._map.style.sourceCaches;for(var d in c){var b=c[d];if(b.used){var C=b.getSource();C.attribution&&l.indexOf(C.attribution)<0&&l.push(C.attribution)}}l.sort(function(L,Z){return L.length-Z.length});var A=(l=l.filter(function(L,Z){for(var V=Z+1;V<l.length;V++)if(l[V].indexOf(L)>=0)return!1;return!0})).join(" | ");A!==this._attribHTML&&(this._attribHTML=A,l.length?(this._innerContainer.innerHTML=A,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},fs.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var mu=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};mu.prototype.onAdd=function(l){this._map=l,this._container=F.create("div","mapboxgl-ctrl");var f=F.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},mu.prototype.onRemove=function(){F.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},mu.prototype.getDefaultPosition=function(){return"bottom-left"},mu.prototype._updateLogo=function(l){l&&l.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},mu.prototype._logoRequired=function(){if(this._map.style){var l=this._map.style.sourceCaches;for(var f in l)if(l[f].getSource().mapbox_logo)return!0;return!1}},mu.prototype._updateCompact=function(){var l=this._container.children;if(l.length){var f=l[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var Ko=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ko.prototype.add=function(l){var f=++this._id;return this._queue.push({callback:l,id:f,cancelled:!1}),f},Ko.prototype.remove=function(l){for(var f=this._currentlyRunning,c=0,d=f?this._queue.concat(f):this._queue;c<d.length;c+=1){var b=d[c];if(b.id===l)return void(b.cancelled=!0)}},Ko.prototype.run=function(l){l===void 0&&(l=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var c=0,d=f;c<d.length;c+=1){var b=d[c];if(!b.cancelled&&(b.callback(l),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ko.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Sa={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Mc=v.window.HTMLImageElement,Pc=v.window.HTMLElement,da=v.window.ImageBitmap,Ta={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Ic=function(l){function f(d){var b=this;if((d=v.extend({},Ta,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var C=new Di(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies);if(l.call(this,C,d),this._interactive=d.interactive,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Ko,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},Sa,d.locale),this._clickTolerance=d.clickTolerance,this._requestManager=new v.RequestManager(d.transformRequest,d.accessToken),typeof d.container=="string"){if(this._container=v.window.document.getElementById(d.container),!this._container)throw new Error("Container '"+d.container+"' not found.")}else{if(!(d.container instanceof Pc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return b._update(!1)}),this.on("moveend",function(){return b._update(!1)}),this.on("zoom",function(){return b._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new wn(this,d),this._hash=d.hash&&new Ls(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,v.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new fs({customAttribution:d.customAttribution})),this.addControl(new mu,d.logoPosition),this.on("style.load",function(){b.transform.unmodified&&b.jumpTo(b.style.stylesheet)}),this.on("data",function(A){b._update(A.dataType==="style"),b.fire(new v.Event(A.dataType+"data",A))}),this.on("dataloading",function(A){b.fire(new v.Event(A.dataType+"dataloading",A))})}l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f;var c={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(d,b){if(b===void 0&&(b=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var C=d.onAdd(this);this._controls.push(d);var A=this._controlPositions[b];return b.indexOf("bottom")!==-1?A.insertBefore(C,A.firstChild):A.appendChild(C),this},f.prototype.removeControl=function(d){if(!d||!d.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var b=this._controls.indexOf(d);return b>-1&&this._controls.splice(b,1),d.onRemove(this),this},f.prototype.hasControl=function(d){return this._controls.indexOf(d)>-1},f.prototype.resize=function(d){var b=this._containerDimensions(),C=b[0],A=b[1];if(C===this.transform.width&&A===this.transform.height)return this;this._resizeCanvas(C,A),this.transform.resize(C,A),this.painter.resize(C,A);var L=!this._moving;return L&&this.fire(new v.Event("movestart",d)).fire(new v.Event("move",d)),this.fire(new v.Event("resize",d)),L&&this.fire(new v.Event("moveend",d)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(d){return this.transform.setMaxBounds(v.LngLatBounds.convert(d)),this._update()},f.prototype.setMinZoom=function(d){if((d=d==null?-2:d)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(d){if((d=d==null?22:d)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(d){if((d=d==null?0:d)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(d){if((d=d==null?60:d)>60)throw new Error("maxPitch must be less than or equal to 60");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(d){return this.transform.renderWorldCopies=d,this._update()},f.prototype.project=function(d){return this.transform.locationPoint(v.LngLat.convert(d))},f.prototype.unproject=function(d){return this.transform.pointLocation(v.Point.convert(d))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(d,b,C){var A,L=this;if(d==="mouseenter"||d==="mouseover"){var Z=!1;return{layer:b,listener:C,delegates:{mousemove:function(le){var fe=L.getLayer(b)?L.queryRenderedFeatures(le.point,{layers:[b]}):[];fe.length?Z||(Z=!0,C.call(L,new ko(d,L,le.originalEvent,{features:fe}))):Z=!1},mouseout:function(){Z=!1}}}}if(d==="mouseleave"||d==="mouseout"){var V=!1;return{layer:b,listener:C,delegates:{mousemove:function(le){(L.getLayer(b)?L.queryRenderedFeatures(le.point,{layers:[b]}):[]).length?V=!0:V&&(V=!1,C.call(L,new ko(d,L,le.originalEvent)))},mouseout:function(le){V&&(V=!1,C.call(L,new ko(d,L,le.originalEvent)))}}}}return{layer:b,listener:C,delegates:(A={},A[d]=function(le){var fe=L.getLayer(b)?L.queryRenderedFeatures(le.point,{layers:[b]}):[];fe.length&&(le.features=fe,C.call(L,le),delete le.features)},A)}},f.prototype.on=function(d,b,C){if(C===void 0)return l.prototype.on.call(this,d,b);var A=this._createDelegatedListener(d,b,C);for(var L in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(A),A.delegates)this.on(L,A.delegates[L]);return this},f.prototype.once=function(d,b,C){if(C===void 0)return l.prototype.once.call(this,d,b);var A=this._createDelegatedListener(d,b,C);for(var L in A.delegates)this.once(L,A.delegates[L]);return this},f.prototype.off=function(d,b,C){var A=this;return C===void 0?l.prototype.off.call(this,d,b):(this._delegatedListeners&&this._delegatedListeners[d]&&function(L){for(var Z=L[d],V=0;V<Z.length;V++){var le=Z[V];if(le.layer===b&&le.listener===C){for(var fe in le.delegates)A.off(fe,le.delegates[fe]);return Z.splice(V,1),A}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(d,b){if(!this.style)return[];var C;if(b!==void 0||d===void 0||d instanceof v.Point||Array.isArray(d)||(b=d,d=void 0),b=b||{},(d=d||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof d[0]=="number")C=[v.Point.convert(d)];else{var A=v.Point.convert(d[0]),L=v.Point.convert(d[1]);C=[A,new v.Point(L.x,A.y),L,new v.Point(A.x,L.y),A]}return this.style.queryRenderedFeatures(C,b,this.transform)},f.prototype.querySourceFeatures=function(d,b){return this.style.querySourceFeatures(d,b)},f.prototype.setStyle=function(d,b){return(b=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},b)).diff!==!1&&b.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,b),this):(this._localIdeographFontFamily=b.localIdeographFontFamily,this._updateStyle(d,b))},f.prototype._getUIString=function(d){var b=this._locale[d];if(b==null)throw new Error("Missing UI string '"+d+"'");return b},f.prototype._updateStyle=function(d,b){return this.style&&(this.style.setEventedParent(null),this.style._remove()),d?(this.style=new ls(this,b||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new ls(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(d,b){var C=this;if(typeof d=="string"){var A=this._requestManager.normalizeStyleURL(d),L=this._requestManager.transformRequest(A,v.ResourceType.Style);v.getJSON(L,function(Z,V){Z?C.fire(new v.ErrorEvent(Z)):V&&C._updateDiff(V,b)})}else typeof d=="object"&&this._updateDiff(d,b)},f.prototype._updateDiff=function(d,b){try{this.style.setState(d)&&this._update(!0)}catch(C){v.warnOnce("Unable to perform style diff: "+(C.message||C.error||C)+".  Rebuilding the style from scratch."),this._updateStyle(d,b)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(d,b){return this._lazyInitEmptyStyle(),this.style.addSource(d,b),this._update(!0)},f.prototype.isSourceLoaded=function(d){var b=this.style&&this.style.sourceCaches[d];if(b!==void 0)return b.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+d+"'")))},f.prototype.areTilesLoaded=function(){var d=this.style&&this.style.sourceCaches;for(var b in d){var C=d[b]._tiles;for(var A in C){var L=C[A];if(L.state!=="loaded"&&L.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(d,b,C){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,b,C)},f.prototype.removeSource=function(d){return this.style.removeSource(d),this._update(!0)},f.prototype.getSource=function(d){return this.style.getSource(d)},f.prototype.addImage=function(d,b,C){C===void 0&&(C={});var A=C.pixelRatio;A===void 0&&(A=1);var L=C.sdf;L===void 0&&(L=!1);var Z=C.stretchX,V=C.stretchY,le=C.content;if(this._lazyInitEmptyStyle(),b instanceof Mc||da&&b instanceof da){var fe=v.browser.getImageData(b);this.style.addImage(d,{data:new v.RGBAImage({width:fe.width,height:fe.height},fe.data),pixelRatio:A,stretchX:Z,stretchY:V,content:le,sdf:L,version:0})}else{if(b.width===void 0||b.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var de=b;this.style.addImage(d,{data:new v.RGBAImage({width:b.width,height:b.height},new Uint8Array(b.data)),pixelRatio:A,stretchX:Z,stretchY:V,content:le,sdf:L,version:0,userImage:de}),de.onAdd&&de.onAdd(this,d)}},f.prototype.updateImage=function(d,b){var C=this.style.getImage(d);if(!C)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var A=b instanceof Mc||da&&b instanceof da?v.browser.getImageData(b):b,L=A.width,Z=A.height,V=A.data;return L===void 0||Z===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):L!==C.data.width||Z!==C.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(C.data.replace(V,!(b instanceof Mc||da&&b instanceof da)),void this.style.updateImage(d,C))},f.prototype.hasImage=function(d){return d?!!this.style.getImage(d):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(d){this.style.removeImage(d)},f.prototype.loadImage=function(d,b){v.getImage(this._requestManager.transformRequest(d,v.ResourceType.Image),b)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(d,b){return this._lazyInitEmptyStyle(),this.style.addLayer(d,b),this._update(!0)},f.prototype.moveLayer=function(d,b){return this.style.moveLayer(d,b),this._update(!0)},f.prototype.removeLayer=function(d){return this.style.removeLayer(d),this._update(!0)},f.prototype.getLayer=function(d){return this.style.getLayer(d)},f.prototype.setLayerZoomRange=function(d,b,C){return this.style.setLayerZoomRange(d,b,C),this._update(!0)},f.prototype.setFilter=function(d,b,C){return C===void 0&&(C={}),this.style.setFilter(d,b,C),this._update(!0)},f.prototype.getFilter=function(d){return this.style.getFilter(d)},f.prototype.setPaintProperty=function(d,b,C,A){return A===void 0&&(A={}),this.style.setPaintProperty(d,b,C,A),this._update(!0)},f.prototype.getPaintProperty=function(d,b){return this.style.getPaintProperty(d,b)},f.prototype.setLayoutProperty=function(d,b,C,A){return A===void 0&&(A={}),this.style.setLayoutProperty(d,b,C,A),this._update(!0)},f.prototype.getLayoutProperty=function(d,b){return this.style.getLayoutProperty(d,b)},f.prototype.setLight=function(d,b){return b===void 0&&(b={}),this._lazyInitEmptyStyle(),this.style.setLight(d,b),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(d,b){return this.style.setFeatureState(d,b),this._update()},f.prototype.removeFeatureState=function(d,b){return this.style.removeFeatureState(d,b),this._update()},f.prototype.getFeatureState=function(d){return this.style.getFeatureState(d)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var d=0,b=0;return this._container&&(d=this._container.clientWidth||400,b=this._container.clientHeight||300),[d,b]},f.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=F.create("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();var b=this._canvasContainer=F.create("div","mapboxgl-canvas-container",d);this._interactive&&b.classList.add("mapboxgl-interactive"),this._canvas=F.create("canvas","mapboxgl-canvas",b),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var C=this._containerDimensions();this._resizeCanvas(C[0],C[1]);var A=this._controlContainer=F.create("div","mapboxgl-control-container",d),L=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(Z){L[Z]=F.create("div","mapboxgl-ctrl-"+Z,A)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(d,b){var C=v.browser.devicePixelRatio||1;this._canvas.width=C*d,this._canvas.height=C*b,this._canvas.style.width=d+"px",this._canvas.style.height=b+"px"},f.prototype._setupPainter=function(){var d=v.extend({},ee.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),b=this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);b?(this.painter=new Xa(b,this.transform),v.webpSupported.testSupport(b)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:d}))},f.prototype._contextRestored=function(d){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:d}))},f.prototype._onMapScroll=function(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(d){return this._update(),this._renderTaskQueue.add(d)},f.prototype._cancelRenderFrame=function(d){this._renderTaskQueue.remove(d)},f.prototype._render=function(d){var b,C=this,A=0,L=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(b=L.createQueryEXT(),L.beginQueryEXT(L.TIME_ELAPSED_EXT,b),A=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),!this._removed){var Z=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var V=this.transform.zoom,le=v.browser.now();this.style.zoomHistory.update(V,le);var fe=new v.EvaluationParameters(V,{now:le,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),de=fe.crossFadingFactor();de===1&&de===this._crossFadingFactor||(Z=!0,this._crossFadingFactor=de),this.style.update(fe)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||Z)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var ke=v.browser.now()-A;L.endQueryEXT(L.TIME_ELAPSED_EXT,b),setTimeout(function(){var Ae=L.getQueryObjectEXT(b,L.QUERY_RESULT_EXT)/1e6;L.deleteQueryEXT(b),C.fire(new v.Event("gpu-timing-frame",{cpuTime:ke,gpuTime:Ae}))},50)}if(this.listens("gpu-timing-layer")){var Re=this.painter.collectGpuTimers();setTimeout(function(){var Ae=C.painter.queryGpuTimers(Re);C.fire(new v.Event("gpu-timing-layer",{layerTimes:Ae}))},50)}var He=this._sourcesDirty||this._styleDirty||this._placementDirty;return He||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||He||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var d=0,b=this._controls;d<b.length;d+=1)b[d].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var C=this.painter.context.gl.getExtension("WEBGL_lose_context");C&&C.loseContext(),Tl(this._canvasContainer),Tl(this._controlContainer),Tl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},f.prototype.triggerRepaint=function(){var d=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(b){d._frame=null,d._render(b)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(d){this._trackResize&&this.resize({originalEvent:d})._update()},c.showTileBoundaries.get=function(){return!!this._showTileBoundaries},c.showTileBoundaries.set=function(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())},c.showPadding.get=function(){return!!this._showPadding},c.showPadding.set=function(d){this._showPadding!==d&&(this._showPadding=d,this._update())},c.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},c.showCollisionBoxes.set=function(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())},c.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},c.showOverdrawInspector.set=function(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())},c.repaint.get=function(){return!!this._repaint},c.repaint.set=function(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())},c.vertices.get=function(){return!!this._vertices},c.vertices.set=function(d){this._vertices=d,this._update()},f.prototype._setCacheLimits=function(d,b){v.setCacheLimits(d,b)},c.version.get=function(){return v.version},Object.defineProperties(f.prototype,c),f}(Ql);function Tl(l){l.parentNode&&l.parentNode.removeChild(l)}var gu={showCompass:!0,showZoom:!0,visualizePitch:!1},Ws=function(l){var f=this;this.options=v.extend({},gu,l),this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(c){return c.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(c){return f._map.zoomIn({},{originalEvent:c})}),F.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(c){return f._map.zoomOut({},{originalEvent:c})}),F.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(c){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:c}):f._map.resetNorth({},{originalEvent:c})}),this._compassIcon=F.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Ws.prototype._updateZoomButtons=function(){var l=this._map.getZoom(),f=l===this._map.getMaxZoom(),c=l===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())},Ws.prototype._rotateCompassArrow=function(){var l=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=l},Ws.prototype.onAdd=function(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Do(this._map,this._compass,this.options.visualizePitch)),this._container},Ws.prototype.onRemove=function(){F.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Ws.prototype._createButton=function(l,f){var c=F.create("button",l,this._container);return c.type="button",c.addEventListener("click",f),c},Ws.prototype._setButtonTitle=function(l,f){var c=this._map._getUIString("NavigationControl."+f);l.title=c,l.setAttribute("aria-label",c)};var Do=function(l,f,c){c===void 0&&(c=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new Pf({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,c&&(this.mousePitch=new wu({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),F.addEventListener(f,"mousedown",this.mousedown),F.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),F.addEventListener(f,"touchmove",this.touchmove),F.addEventListener(f,"touchend",this.touchend),F.addEventListener(f,"touchcancel",this.reset)};function ll(l,f,c){if(l=new v.LngLat(l.lng,l.lat),f){var d=new v.LngLat(l.lng-360,l.lat),b=new v.LngLat(l.lng+360,l.lat),C=c.locationPoint(l).distSqr(f);c.locationPoint(d).distSqr(f)<C?l=d:c.locationPoint(b).distSqr(f)<C&&(l=b)}for(;Math.abs(l.lng-c.center.lng)>180;){var A=c.locationPoint(l);if(A.x>=0&&A.y>=0&&A.x<=c.width&&A.y<=c.height)break;l.lng>c.center.lng?l.lng-=360:l.lng+=360}return l}Do.prototype.down=function(l,f){this.mouseRotate.mousedown(l,f),this.mousePitch&&this.mousePitch.mousedown(l,f),F.disableDrag()},Do.prototype.move=function(l,f){var c=this.map,d=this.mouseRotate.mousemoveWindow(l,f);if(d&&d.bearingDelta&&c.setBearing(c.getBearing()+d.bearingDelta),this.mousePitch){var b=this.mousePitch.mousemoveWindow(l,f);b&&b.pitchDelta&&c.setPitch(c.getPitch()+b.pitchDelta)}},Do.prototype.off=function(){var l=this.element;F.removeEventListener(l,"mousedown",this.mousedown),F.removeEventListener(l,"touchstart",this.touchstart,{passive:!1}),F.removeEventListener(l,"touchmove",this.touchmove),F.removeEventListener(l,"touchend",this.touchend),F.removeEventListener(l,"touchcancel",this.reset),this.offTemp()},Do.prototype.offTemp=function(){F.enableDrag(),F.removeEventListener(v.window,"mousemove",this.mousemove),F.removeEventListener(v.window,"mouseup",this.mouseup)},Do.prototype.mousedown=function(l){this.down(v.extend({},l,{ctrlKey:!0,preventDefault:function(){return l.preventDefault()}}),F.mousePos(this.element,l)),F.addEventListener(v.window,"mousemove",this.mousemove),F.addEventListener(v.window,"mouseup",this.mouseup)},Do.prototype.mousemove=function(l){this.move(l,F.mousePos(this.element,l))},Do.prototype.mouseup=function(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()},Do.prototype.touchstart=function(l){l.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=F.touchPos(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return l.preventDefault()}},this._startPos))},Do.prototype.touchmove=function(l){l.targetTouches.length!==1?this.reset():(this._lastPos=F.touchPos(this.element,l.targetTouches)[0],this.move({preventDefault:function(){return l.preventDefault()}},this._lastPos))},Do.prototype.touchend=function(l){l.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Do.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var yu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function sf(l,f,c){var d=l.classList;for(var b in yu)d.remove("mapboxgl-"+c+"-anchor-"+b);d.add("mapboxgl-"+c+"-anchor-"+f)}var Ml,Pl=function(l){function f(c,d){if(l.call(this),(c instanceof v.window.HTMLElement||d)&&(c=v.extend({element:c},d)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment!=="auto"?c.pitchAlignment:this._rotationAlignment,c&&c.element)this._element=c.element,this._offset=v.Point.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=F.create("div"),this._element.setAttribute("aria-label","Map marker");var b=F.createNS("http://www.w3.org/2000/svg","svg");b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height","41px"),b.setAttributeNS(null,"width","27px"),b.setAttributeNS(null,"viewBox","0 0 27 41");var C=F.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"stroke","none"),C.setAttributeNS(null,"stroke-width","1"),C.setAttributeNS(null,"fill","none"),C.setAttributeNS(null,"fill-rule","evenodd");var A=F.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");var L=F.createNS("http://www.w3.org/2000/svg","g");L.setAttributeNS(null,"transform","translate(3.0, 29.0)"),L.setAttributeNS(null,"fill","#000000");for(var Z=0,V=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];Z<V.length;Z+=1){var le=V[Z],fe=F.createNS("http://www.w3.org/2000/svg","ellipse");fe.setAttributeNS(null,"opacity","0.04"),fe.setAttributeNS(null,"cx","10.5"),fe.setAttributeNS(null,"cy","5.80029008"),fe.setAttributeNS(null,"rx",le.rx),fe.setAttributeNS(null,"ry",le.ry),L.appendChild(fe)}var de=F.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"fill",this._color);var ke=F.createNS("http://www.w3.org/2000/svg","path");ke.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),de.appendChild(ke);var Re=F.createNS("http://www.w3.org/2000/svg","g");Re.setAttributeNS(null,"opacity","0.25"),Re.setAttributeNS(null,"fill","#000000");var He=F.createNS("http://www.w3.org/2000/svg","path");He.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Re.appendChild(He);var Ae=F.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ae.setAttributeNS(null,"fill","#FFFFFF");var We=F.createNS("http://www.w3.org/2000/svg","g");We.setAttributeNS(null,"transform","translate(8.0, 8.0)");var tt=F.createNS("http://www.w3.org/2000/svg","circle");tt.setAttributeNS(null,"fill","#000000"),tt.setAttributeNS(null,"opacity","0.25"),tt.setAttributeNS(null,"cx","5.5"),tt.setAttributeNS(null,"cy","5.5"),tt.setAttributeNS(null,"r","5.4999962");var bt=F.createNS("http://www.w3.org/2000/svg","circle");bt.setAttributeNS(null,"fill","#FFFFFF"),bt.setAttributeNS(null,"cx","5.5"),bt.setAttributeNS(null,"cy","5.5"),bt.setAttributeNS(null,"r","5.4999962"),We.appendChild(tt),We.appendChild(bt),A.appendChild(L),A.appendChild(de),A.appendChild(Re),A.appendChild(Ae),A.appendChild(We),b.appendChild(A),b.setAttributeNS(null,"height",41*this._scale+"px"),b.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(b),this._offset=v.Point.convert(c&&c.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Yt){Yt.preventDefault()}),this._element.addEventListener("mousedown",function(Yt){Yt.preventDefault()}),sf(this._element,this._anchor,"marker"),this._popup=null}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._update),c.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),F.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){var d=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(24.6+d)],"bottom-right":[-d,-1*(24.6+d)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=c,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(c){var d=c.code,b=c.charCode||c.keyCode;d!=="Space"&&d!=="Enter"&&b!==32&&b!==13||this.togglePopup()},f.prototype._onMapClick=function(c){var d=c.originalEvent.target,b=this._element;this._popup&&(d===b||b.contains(d))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var c=this._popup;return c?(c.isOpen()?c.remove():c.addTo(this._map),this):this},f.prototype._update=function(c){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ll(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var d="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?d="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(d="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b="rotateX("+this._map.getPitch()+"deg)"),c&&c.type!=="moveend"||(this._pos=this._pos.round()),F.setTransform(this._element,yu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+b+" "+d)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(c){return this._offset=v.Point.convert(c),this._update(),this},f.prototype._onMove=function(c){if(!this._isDragging){var d=this._clickTolerance||this._map._clickTolerance;this._isDragging=c.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=c.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(c){this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(this._pos).add(this._offset),this._pointerdownPos=c.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(c){return this._draggable=!!c,this._map&&(c?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(c){return this._rotation=c||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(c){return this._rotationAlignment=c||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(c){return this._pitchAlignment=c&&c!=="auto"?c:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(v.Evented),Il={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},ec=0,cl=!1,dh=function(l){function f(c){l.call(this),this.options=v.extend({},Il,c),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.onAdd=function(c){var d;return this._map=c,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),d=this._setupUI,Ml!==void 0?d(Ml):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(b){d(Ml=b.state!=="denied")}):d(Ml=!!v.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),F.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,ec=0,cl=!1},f.prototype._isOutOfMapMaxBounds=function(c){var d=this._map.getMaxBounds(),b=c.coords;return d&&(b.longitude<d.getWest()||b.longitude>d.getEast()||b.latitude<d.getSouth()||b.latitude>d.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(c){if(this._map){if(this._isOutOfMapMaxBounds(c))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",c)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=c,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(c),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(c),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",c)),this._finish()}},f.prototype._updateCamera=function(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude),b=c.coords.accuracy,C=this._map.getBearing(),A=v.extend({bearing:C},this.options.fitBoundsOptions);this._map.fitBounds(d.toBounds(b),A,{geolocateSource:!0})},f.prototype._updateMarker=function(c){if(c){var d=new v.LngLat(c.coords.longitude,c.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=c.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var c=this._map._container.clientHeight/2,d=this._map.unproject([0,c]),b=this._map.unproject([1,c]),C=d.distanceTo(b),A=Math.ceil(2*this._accuracy/C);this._circleElement.style.width=A+"px",this._circleElement.style.height=A+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(c){if(this._map){if(this.options.trackUserLocation)if(c.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(c.code===3&&cl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",c)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(c){var d=this;if(this._container.addEventListener("contextmenu",function(A){return A.preventDefault()}),this._geolocateButton=F.create("button","mapboxgl-ctrl-geolocate",this._container),F.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",c===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var b=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}else{var C=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=C,this._geolocateButton.setAttribute("aria-label",C)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Pl(this._dotElement),this._circleElement=F.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Pl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(A){A.geolocateSource||d._watchState!=="ACTIVE_LOCK"||A.originalEvent&&A.originalEvent.type==="resize"||(d._watchState="BACKGROUND",d._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),d._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),d.fire(new v.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":ec--,cl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var c;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++ec>1?(c={maximumAge:6e5,timeout:0},cl=!0):(c=this.options.positionOptions,cl=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,c)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(v.Evented),qu={maxWidth:100,unit:"metric"},Tu=function(l){this.options=v.extend({},qu,l),v.bindAll(["_onMove","setUnit"],this)};function Of(l,f,c){var d=c&&c.maxWidth||100,b=l._container.clientHeight/2,C=l.unproject([0,b]),A=l.unproject([d,b]),L=C.distanceTo(A);if(c&&c.unit==="imperial"){var Z=3.2808*L;Z>5280?fl(f,d,Z/5280,l._getUIString("ScaleControl.Miles")):fl(f,d,Z,l._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?fl(f,d,L/1852,l._getUIString("ScaleControl.NauticalMiles")):L>=1e3?fl(f,d,L/1e3,l._getUIString("ScaleControl.Kilometers")):fl(f,d,L,l._getUIString("ScaleControl.Meters"))}function fl(l,f,c,d){var b,C,A,L=(b=c,(C=Math.pow(10,(""+Math.floor(b)).length-1))*(A=(A=b/C)>=10?10:A>=5?5:A>=3?3:A>=2?2:A>=1?1:function(Z){var V=Math.pow(10,Math.ceil(-Math.log(Z)/Math.LN10));return Math.round(Z*V)/V}(A)));l.style.width=f*(L/c)+"px",l.innerHTML=L+"&nbsp;"+d}Tu.prototype.getDefaultPosition=function(){return"bottom-left"},Tu.prototype._onMove=function(){Of(this._map,this._container,this.options)},Tu.prototype.onAdd=function(l){return this._map=l,this._container=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Tu.prototype.onRemove=function(){F.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Tu.prototype.setUnit=function(l){this.options.unit=l,Of(this._map,this._container,this.options)};var Xs=function(l){this._fullscreen=!1,l&&l.container&&(l.container instanceof v.window.HTMLElement?this._container=l.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};Xs.prototype.onAdd=function(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=F.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Xs.prototype.onRemove=function(){F.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Xs.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},Xs.prototype._setupUI=function(){var l=this._fullscreenButton=F.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);F.create("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden",!0),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Xs.prototype._updateTitle=function(){var l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.title=l},Xs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Xs.prototype._isFullscreen=function(){return this._fullscreen},Xs.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Xs.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var uf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},_u=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),vh=function(l){function f(c){l.call(this),this.options=v.extend(Object.create(uf),c),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return l&&(f.__proto__=l),(f.prototype=Object.create(l&&l.prototype)).constructor=f,f.prototype.addTo=function(c){return this._map&&this.remove(),this._map=c,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&F.remove(this._content),this._container&&(F.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(c){return this._lngLat=v.LngLat.convert(c),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(c){return this.setDOMContent(v.window.document.createTextNode(c))},f.prototype.setHTML=function(c){var d,b=v.window.document.createDocumentFragment(),C=v.window.document.createElement("body");for(C.innerHTML=c;d=C.firstChild;)b.appendChild(d);return this.setDOMContent(b)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(c){return this.options.maxWidth=c,this._update(),this},f.prototype.setDOMContent=function(c){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=F.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(c),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(c){this._container&&this._container.classList.add(c)},f.prototype.removeClassName=function(c){this._container&&this._container.classList.remove(c)},f.prototype.setOffset=function(c){return this.options.offset=c,this._update(),this},f.prototype.toggleClassName=function(c){if(this._container)return this._container.classList.toggle(c)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=F.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(c){this._update(c.point)},f.prototype._onMouseMove=function(c){this._update(c.point)},f.prototype._onDrag=function(c){this._update(c.point)},f.prototype._update=function(c){var d=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=F.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=F.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(fe){return d._container.classList.add(fe)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ll(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||c)){var b=this._pos=this._trackPointer&&c?c:this._map.project(this._lngLat),C=this.options.anchor,A=function fe(de){if(de){if(typeof de=="number"){var ke=Math.round(Math.sqrt(.5*Math.pow(de,2)));return{center:new v.Point(0,0),top:new v.Point(0,de),"top-left":new v.Point(ke,ke),"top-right":new v.Point(-ke,ke),bottom:new v.Point(0,-de),"bottom-left":new v.Point(ke,-ke),"bottom-right":new v.Point(-ke,-ke),left:new v.Point(de,0),right:new v.Point(-de,0)}}if(de instanceof v.Point||Array.isArray(de)){var Re=v.Point.convert(de);return{center:Re,top:Re,"top-left":Re,"top-right":Re,bottom:Re,"bottom-left":Re,"bottom-right":Re,left:Re,right:Re}}return{center:v.Point.convert(de.center||[0,0]),top:v.Point.convert(de.top||[0,0]),"top-left":v.Point.convert(de["top-left"]||[0,0]),"top-right":v.Point.convert(de["top-right"]||[0,0]),bottom:v.Point.convert(de.bottom||[0,0]),"bottom-left":v.Point.convert(de["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(de["bottom-right"]||[0,0]),left:v.Point.convert(de.left||[0,0]),right:v.Point.convert(de.right||[0,0])}}return fe(new v.Point(0,0))}(this.options.offset);if(!C){var L,Z=this._container.offsetWidth,V=this._container.offsetHeight;L=b.y+A.bottom.y<V?["top"]:b.y>this._map.transform.height-V?["bottom"]:[],b.x<Z/2?L.push("left"):b.x>this._map.transform.width-Z/2&&L.push("right"),C=L.length===0?"bottom":L.join("-")}var le=b.add(A[C]).round();F.setTransform(this._container,yu[C]+" translate("+le.x+"px,"+le.y+"px)"),sf(this._container,C,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var c=this._container.querySelector(_u);c&&c.focus()}},f.prototype._onClose=function(){this.remove()},f}(v.Evented),tc={version:v.version,supported:ee,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:Ic,NavigationControl:Ws,GeolocateControl:dh,AttributionControl:fs,ScaleControl:Tu,FullscreenControl:Xs,Popup:vh,Marker:Pl,Style:ls,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){Tt().acquire(Ft)},clearPrewarmedResources:function(){var l=En;l&&(l.isPreloaded()&&l.numActive()===1?(l.release(Ft),En=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(l){v.config.ACCESS_TOKEN=l},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(l){v.config.API_URL=l},get workerCount(){return _r.workerCount},set workerCount(l){_r.workerCount=l},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){v.config.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage:function(l){v.clearTileCache(l)},workerUrl:""};return tc}),Y})},28660:function(Ue,W,R){var Y=R(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var $;(function(v){(function(ee){var F=typeof R.g=="object"?R.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),Q=re(v);typeof F.Reflect=="undefined"?F.Reflect=v:Q=re(F.Reflect,Q),ee(Q);function re(Ee,ne){return function(je,Ce){typeof Ee[je]!="function"&&Object.defineProperty(Ee,je,{configurable:!0,writable:!0,value:Ce}),ne&&ne(je,Ce)}}})(function(ee){var F=Object.prototype.hasOwnProperty,Q=typeof Symbol=="function",re=Q&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ee=Q&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",ne=typeof Object.create=="function",je={__proto__:[]}instanceof Array,Ce=!ne&&!je,et={create:ne?function(){return os(Object.create(null))}:je?function(){return os({__proto__:null})}:function(){return os({})},has:Ce?function(Ut,ir){return F.call(Ut,ir)}:function(Ut,ir){return ir in Ut},get:Ce?function(Ut,ir){return F.call(Ut,ir)?Ut[ir]:void 0}:function(Ut,ir){return Ut[ir]}},Pt=Object.getPrototypeOf(Function),nr=typeof Y=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",xt=!nr&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:ve(),Wt=!nr&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ln(),wt=!nr&&typeof WeakMap=="function"?WeakMap:Ha(),st=new wt;function ut(Ut,ir,Pr,I){if(hn(Pr)){if(!Ei(Ut))throw new TypeError;if(!ua(ir))throw new TypeError;return Ir(Ut,ir)}else{if(!Ei(Ut))throw new TypeError;if(!Gn(ir))throw new TypeError;if(!Gn(I)&&!hn(I)&&!Yi(I))throw new TypeError;return Yi(I)&&(I=void 0),Pr=Ri(Pr),Wr(Ut,ir,Pr,I)}}ee("decorate",ut);function Jt(Ut,ir){function Pr(I,or){if(!Gn(I))throw new TypeError;if(!hn(or)&&!Si(or))throw new TypeError;Nt(Ut,ir,I,or)}return Pr}ee("metadata",Jt);function X(Ut,ir,Pr,I){if(!Gn(Pr))throw new TypeError;return hn(I)||(I=Ri(I)),Nt(Ut,ir,Pr,I)}ee("defineMetadata",X);function Xt(Ut,ir,Pr){if(!Gn(ir))throw new TypeError;return hn(Pr)||(Pr=Ri(Pr)),Ye(Ut,ir,Pr)}ee("hasMetadata",Xt);function vt(Ut,ir,Pr){if(!Gn(ir))throw new TypeError;return hn(Pr)||(Pr=Ri(Pr)),Fe(Ut,ir,Pr)}ee("hasOwnMetadata",vt);function qe(Ut,ir,Pr){if(!Gn(ir))throw new TypeError;return hn(Pr)||(Pr=Ri(Pr)),At(Ut,ir,Pr)}ee("getMetadata",qe);function pt(Ut,ir,Pr){if(!Gn(ir))throw new TypeError;return hn(Pr)||(Pr=Ri(Pr)),gt(Ut,ir,Pr)}ee("getOwnMetadata",pt);function $e(Ut,ir){if(!Gn(Ut))throw new TypeError;return hn(ir)||(ir=Ri(ir)),qt(Ut,ir)}ee("getMetadataKeys",$e);function kt(Ut,ir){if(!Gn(Ut))throw new TypeError;return hn(ir)||(ir=Ri(ir)),Cr(Ut,ir)}ee("getOwnMetadataKeys",kt);function xr(Ut,ir,Pr){if(!Gn(ir))throw new TypeError;hn(Pr)||(Pr=Ri(Pr));var I=Me(ir,Pr,!1);if(hn(I)||!I.delete(Ut))return!1;if(I.size>0)return!0;var or=st.get(ir);return or.delete(Pr),or.size>0||st.delete(ir),!0}ee("deleteMetadata",xr);function Ir(Ut,ir){for(var Pr=Ut.length-1;Pr>=0;--Pr){var I=Ut[Pr],or=I(ir);if(!hn(or)&&!Yi(or)){if(!ua(or))throw new TypeError;ir=or}}return ir}function Wr(Ut,ir,Pr,I){for(var or=Ut.length-1;or>=0;--or){var Rn=Ut[or],oi=Rn(ir,Pr,I);if(!hn(oi)&&!Yi(oi)){if(!Gn(oi))throw new TypeError;I=oi}}return I}function Me(Ut,ir,Pr){var I=st.get(Ut);if(hn(I)){if(!Pr)return;I=new xt,st.set(Ut,I)}var or=I.get(ir);if(hn(or)){if(!Pr)return;or=new xt,I.set(ir,or)}return or}function Ye(Ut,ir,Pr){var I=Fe(Ut,ir,Pr);if(I)return!0;var or=Ga(ir);return Yi(or)?!1:Ye(Ut,or,Pr)}function Fe(Ut,ir,Pr){var I=Me(ir,Pr,!1);return hn(I)?!1:ai(I.has(Ut))}function At(Ut,ir,Pr){var I=Fe(Ut,ir,Pr);if(I)return gt(Ut,ir,Pr);var or=Ga(ir);if(!Yi(or))return At(Ut,or,Pr)}function gt(Ut,ir,Pr){var I=Me(ir,Pr,!1);if(!hn(I))return I.get(Ut)}function Nt(Ut,ir,Pr,I){var or=Me(Pr,I,!0);or.set(Ut,ir)}function qt(Ut,ir){var Pr=Cr(Ut,ir),I=Ga(Ut);if(I===null)return Pr;var or=qt(I,ir);if(or.length<=0)return Pr;if(Pr.length<=0)return or;for(var Rn=new Wt,oi=[],jn=0,nn=Pr;jn<nn.length;jn++){var Ti=nn[jn],Mi=Rn.has(Ti);Mi||(Rn.add(Ti),oi.push(Ti))}for(var $a=0,ss=or;$a<ss.length;$a++){var Ti=ss[$a],Mi=Rn.has(Ti);Mi||(Rn.add(Ti),oi.push(Ti))}return oi}function Cr(Ut,ir){var Pr=[],I=Me(Ut,ir,!1);if(hn(I))return Pr;for(var or=I.keys(),Rn=Mn(or),oi=0;;){var jn=Ui(Rn);if(!jn)return Pr.length=oi,Pr;var nn=_i(jn);try{Pr[oi]=nn}catch(Ti){try{qi(Rn)}finally{throw Ti}}oi++}}function Wn(Ut){if(Ut===null)return 1;switch(typeof Ut){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ut===null?1:6;default:return 6}}function hn(Ut){return Ut===void 0}function Yi(Ut){return Ut===null}function Un(Ut){return typeof Ut=="symbol"}function Gn(Ut){return typeof Ut=="object"?Ut!==null:typeof Ut=="function"}function di(Ut,ir){switch(Wn(Ut)){case 0:return Ut;case 1:return Ut;case 2:return Ut;case 3:return Ut;case 4:return Ut;case 5:return Ut}var Pr=ir===3?"string":ir===5?"number":"default",I=ba(Ut,re);if(I!==void 0){var or=I.call(Ut,Pr);if(Gn(or))throw new TypeError;return or}return Xn(Ut,Pr==="default"?"number":Pr)}function Xn(Ut,ir){if(ir==="string"){var Pr=Ut.toString;if(ji(Pr)){var I=Pr.call(Ut);if(!Gn(I))return I}var or=Ut.valueOf;if(ji(or)){var I=or.call(Ut);if(!Gn(I))return I}}else{var or=Ut.valueOf;if(ji(or)){var I=or.call(Ut);if(!Gn(I))return I}var Rn=Ut.toString;if(ji(Rn)){var I=Rn.call(Ut);if(!Gn(I))return I}}throw new TypeError}function ai(Ut){return!!Ut}function aa(Ut){return""+Ut}function Ri(Ut){var ir=di(Ut,3);return Un(ir)?ir:aa(ir)}function Ei(Ut){return Array.isArray?Array.isArray(Ut):Ut instanceof Object?Ut instanceof Array:Object.prototype.toString.call(Ut)==="[object Array]"}function ji(Ut){return typeof Ut=="function"}function ua(Ut){return typeof Ut=="function"}function Si(Ut){switch(Wn(Ut)){case 3:return!0;case 4:return!0;default:return!1}}function ba(Ut,ir){var Pr=Ut[ir];if(Pr!=null){if(!ji(Pr))throw new TypeError;return Pr}}function Mn(Ut){var ir=ba(Ut,Ee);if(!ji(ir))throw new TypeError;var Pr=ir.call(Ut);if(!Gn(Pr))throw new TypeError;return Pr}function _i(Ut){return Ut.value}function Ui(Ut){var ir=Ut.next();return ir.done?!1:ir}function qi(Ut){var ir=Ut.return;ir&&ir.call(Ut)}function Ga(Ut){var ir=Object.getPrototypeOf(Ut);if(typeof Ut!="function"||Ut===Pt||ir!==Pt)return ir;var Pr=Ut.prototype,I=Pr&&Object.getPrototypeOf(Pr);if(I==null||I===Object.prototype)return ir;var or=I.constructor;return typeof or!="function"||or===Ut?ir:or}function ve(){var Ut={},ir=[],Pr=function(){function oi(jn,nn,Ti){this._index=0,this._keys=jn,this._values=nn,this._selector=Ti}return oi.prototype["@@iterator"]=function(){return this},oi.prototype[Ee]=function(){return this},oi.prototype.next=function(){var jn=this._index;if(jn>=0&&jn<this._keys.length){var nn=this._selector(this._keys[jn],this._values[jn]);return jn+1>=this._keys.length?(this._index=-1,this._keys=ir,this._values=ir):this._index++,{value:nn,done:!1}}return{value:void 0,done:!0}},oi.prototype.throw=function(jn){throw this._index>=0&&(this._index=-1,this._keys=ir,this._values=ir),jn},oi.prototype.return=function(jn){return this._index>=0&&(this._index=-1,this._keys=ir,this._values=ir),{value:jn,done:!0}},oi}();return function(){function oi(){this._keys=[],this._values=[],this._cacheKey=Ut,this._cacheIndex=-2}return Object.defineProperty(oi.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),oi.prototype.has=function(jn){return this._find(jn,!1)>=0},oi.prototype.get=function(jn){var nn=this._find(jn,!1);return nn>=0?this._values[nn]:void 0},oi.prototype.set=function(jn,nn){var Ti=this._find(jn,!0);return this._values[Ti]=nn,this},oi.prototype.delete=function(jn){var nn=this._find(jn,!1);if(nn>=0){for(var Ti=this._keys.length,Mi=nn+1;Mi<Ti;Mi++)this._keys[Mi-1]=this._keys[Mi],this._values[Mi-1]=this._values[Mi];return this._keys.length--,this._values.length--,jn===this._cacheKey&&(this._cacheKey=Ut,this._cacheIndex=-2),!0}return!1},oi.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ut,this._cacheIndex=-2},oi.prototype.keys=function(){return new Pr(this._keys,this._values,I)},oi.prototype.values=function(){return new Pr(this._keys,this._values,or)},oi.prototype.entries=function(){return new Pr(this._keys,this._values,Rn)},oi.prototype["@@iterator"]=function(){return this.entries()},oi.prototype[Ee]=function(){return this.entries()},oi.prototype._find=function(jn,nn){return this._cacheKey!==jn&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=jn)),this._cacheIndex<0&&nn&&(this._cacheIndex=this._keys.length,this._keys.push(jn),this._values.push(void 0)),this._cacheIndex},oi}();function I(oi,jn){return oi}function or(oi,jn){return jn}function Rn(oi,jn){return[oi,jn]}}function Ln(){return function(){function Ut(){this._map=new xt}return Object.defineProperty(Ut.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ut.prototype.has=function(ir){return this._map.has(ir)},Ut.prototype.add=function(ir){return this._map.set(ir,ir),this},Ut.prototype.delete=function(ir){return this._map.delete(ir)},Ut.prototype.clear=function(){this._map.clear()},Ut.prototype.keys=function(){return this._map.keys()},Ut.prototype.values=function(){return this._map.values()},Ut.prototype.entries=function(){return this._map.entries()},Ut.prototype["@@iterator"]=function(){return this.keys()},Ut.prototype[Ee]=function(){return this.keys()},Ut}()}function Ha(){var Ut=16,ir=et.create(),Pr=I();return function(){function nn(){this._key=I()}return nn.prototype.has=function(Ti){var Mi=or(Ti,!1);return Mi!==void 0?et.has(Mi,this._key):!1},nn.prototype.get=function(Ti){var Mi=or(Ti,!1);return Mi!==void 0?et.get(Mi,this._key):void 0},nn.prototype.set=function(Ti,Mi){var $a=or(Ti,!0);return $a[this._key]=Mi,this},nn.prototype.delete=function(Ti){var Mi=or(Ti,!1);return Mi!==void 0?delete Mi[this._key]:!1},nn.prototype.clear=function(){this._key=I()},nn}();function I(){var nn;do nn="@@WeakMap@@"+jn();while(et.has(ir,nn));return ir[nn]=!0,nn}function or(nn,Ti){if(!F.call(nn,Pr)){if(!Ti)return;Object.defineProperty(nn,Pr,{value:et.create()})}return nn[Pr]}function Rn(nn,Ti){for(var Mi=0;Mi<Ti;++Mi)nn[Mi]=Math.random()*255|0;return nn}function oi(nn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(nn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(nn)):Rn(new Uint8Array(nn),nn):Rn(new Array(nn),nn)}function jn(){var nn=oi(Ut);nn[6]=nn[6]&79|64,nn[8]=nn[8]&191|128;for(var Ti="",Mi=0;Mi<Ut;++Mi){var $a=nn[Mi];(Mi===4||Mi===6||Mi===8)&&(Ti+="-"),$a<16&&(Ti+="0"),Ti+=$a.toString(16).toLowerCase()}return Ti}}function os(Ut){return Ut.__=void 0,delete Ut.__,Ut}})})($||($={}))},69848:function(Ue){(function(W,R){Ue.exports=R()})(this,function(){"use strict";function W(vt,qe,pt,$e,kt,xr){if(!(kt-$e<=pt)){var Ir=$e+kt>>1;R(vt,qe,Ir,$e,kt,xr%2),W(vt,qe,pt,$e,Ir-1,xr+1),W(vt,qe,pt,Ir+1,kt,xr+1)}}function R(vt,qe,pt,$e,kt,xr){for(;kt>$e;){if(kt-$e>600){var Ir=kt-$e+1,Wr=pt-$e+1,Me=Math.log(Ir),Ye=.5*Math.exp(2*Me/3),Fe=.5*Math.sqrt(Me*Ye*(Ir-Ye)/Ir)*(Wr-Ir/2<0?-1:1),At=Math.max($e,Math.floor(pt-Wr*Ye/Ir+Fe)),gt=Math.min(kt,Math.floor(pt+(Ir-Wr)*Ye/Ir+Fe));R(vt,qe,pt,At,gt,xr)}var Nt=qe[2*pt+xr],qt=$e,Cr=kt;for(Y(vt,qe,$e,pt),qe[2*kt+xr]>Nt&&Y(vt,qe,$e,kt);qt<Cr;){for(Y(vt,qe,qt,Cr),qt++,Cr--;qe[2*qt+xr]<Nt;)qt++;for(;qe[2*Cr+xr]>Nt;)Cr--}qe[2*$e+xr]===Nt?Y(vt,qe,$e,Cr):(Cr++,Y(vt,qe,Cr,kt)),Cr<=pt&&($e=Cr+1),pt<=Cr&&(kt=Cr-1)}}function Y(vt,qe,pt,$e){$(vt,pt,$e),$(qe,2*pt,2*$e),$(qe,2*pt+1,2*$e+1)}function $(vt,qe,pt){var $e=vt[qe];vt[qe]=vt[pt],vt[pt]=$e}function v(vt,qe,pt,$e,kt,xr,Ir){for(var Wr=[0,vt.length-1,0],Me=[],Ye,Fe;Wr.length;){var At=Wr.pop(),gt=Wr.pop(),Nt=Wr.pop();if(gt-Nt<=Ir){for(var qt=Nt;qt<=gt;qt++)Ye=qe[2*qt],Fe=qe[2*qt+1],Ye>=pt&&Ye<=kt&&Fe>=$e&&Fe<=xr&&Me.push(vt[qt]);continue}var Cr=Math.floor((Nt+gt)/2);Ye=qe[2*Cr],Fe=qe[2*Cr+1],Ye>=pt&&Ye<=kt&&Fe>=$e&&Fe<=xr&&Me.push(vt[Cr]);var Wn=(At+1)%2;(At===0?pt<=Ye:$e<=Fe)&&(Wr.push(Nt),Wr.push(Cr-1),Wr.push(Wn)),(At===0?kt>=Ye:xr>=Fe)&&(Wr.push(Cr+1),Wr.push(gt),Wr.push(Wn))}return Me}function ee(vt,qe,pt,$e,kt,xr){for(var Ir=[0,vt.length-1,0],Wr=[],Me=kt*kt;Ir.length;){var Ye=Ir.pop(),Fe=Ir.pop(),At=Ir.pop();if(Fe-At<=xr){for(var gt=At;gt<=Fe;gt++)F(qe[2*gt],qe[2*gt+1],pt,$e)<=Me&&Wr.push(vt[gt]);continue}var Nt=Math.floor((At+Fe)/2),qt=qe[2*Nt],Cr=qe[2*Nt+1];F(qt,Cr,pt,$e)<=Me&&Wr.push(vt[Nt]);var Wn=(Ye+1)%2;(Ye===0?pt-kt<=qt:$e-kt<=Cr)&&(Ir.push(At),Ir.push(Nt-1),Ir.push(Wn)),(Ye===0?pt+kt>=qt:$e+kt>=Cr)&&(Ir.push(Nt+1),Ir.push(Fe),Ir.push(Wn))}return Wr}function F(vt,qe,pt,$e){var kt=vt-pt,xr=qe-$e;return kt*kt+xr*xr}var Q=function(vt){return vt[0]},re=function(vt){return vt[1]},Ee=function(qe,pt,$e,kt,xr){pt===void 0&&(pt=Q),$e===void 0&&($e=re),kt===void 0&&(kt=64),xr===void 0&&(xr=Float64Array),this.nodeSize=kt,this.points=qe;for(var Ir=qe.length<65536?Uint16Array:Uint32Array,Wr=this.ids=new Ir(qe.length),Me=this.coords=new xr(qe.length*2),Ye=0;Ye<qe.length;Ye++)Wr[Ye]=Ye,Me[2*Ye]=pt(qe[Ye]),Me[2*Ye+1]=$e(qe[Ye]);W(Wr,Me,kt,0,Wr.length-1,0)};Ee.prototype.range=function(qe,pt,$e,kt){return v(this.ids,this.coords,qe,pt,$e,kt,this.nodeSize)},Ee.prototype.within=function(qe,pt,$e){return ee(this.ids,this.coords,qe,pt,$e,this.nodeSize)};var ne={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(vt){return vt}},je=Math.fround||function(vt){return function(qe){return vt[0]=+qe,vt[0]}}(new Float32Array(1)),Ce=function(qe){this.options=Jt(Object.create(ne),qe),this.trees=new Array(this.options.maxZoom+1)};Ce.prototype.load=function(qe){var pt=this.options,$e=pt.log,kt=pt.minZoom,xr=pt.maxZoom,Ir=pt.nodeSize;$e&&console.time("total time");var Wr="prepare "+qe.length+" points";$e&&console.time(Wr),this.points=qe;for(var Me=[],Ye=0;Ye<qe.length;Ye++)!qe[Ye].geometry||Me.push(Pt(qe[Ye],Ye));this.trees[xr+1]=new Ee(Me,X,Xt,Ir,Float32Array),$e&&console.timeEnd(Wr);for(var Fe=xr;Fe>=kt;Fe--){var At=+Date.now();Me=this._cluster(Me,Fe),this.trees[Fe]=new Ee(Me,X,Xt,Ir,Float32Array),$e&&console.log("z%d: %d clusters in %dms",Fe,Me.length,+Date.now()-At)}return $e&&console.timeEnd("total time"),this},Ce.prototype.getClusters=function(qe,pt){var $e=((qe[0]+180)%360+360)%360-180,kt=Math.max(-90,Math.min(90,qe[1])),xr=qe[2]===180?180:((qe[2]+180)%360+360)%360-180,Ir=Math.max(-90,Math.min(90,qe[3]));if(qe[2]-qe[0]>=360)$e=-180,xr=180;else if($e>xr){var Wr=this.getClusters([$e,kt,180,Ir],pt),Me=this.getClusters([-180,kt,xr,Ir],pt);return Wr.concat(Me)}for(var Ye=this.trees[this._limitZoom(pt)],Fe=Ye.range(Wt($e),wt(Ir),Wt(xr),wt(kt)),At=[],gt=0,Nt=Fe;gt<Nt.length;gt+=1){var qt=Nt[gt],Cr=Ye.points[qt];At.push(Cr.numPoints?nr(Cr):this.points[Cr.index])}return At},Ce.prototype.getChildren=function(qe){var pt=this._getOriginId(qe),$e=this._getOriginZoom(qe),kt="No cluster with the specified id.",xr=this.trees[$e];if(!xr)throw new Error(kt);var Ir=xr.points[pt];if(!Ir)throw new Error(kt);for(var Wr=this.options.radius/(this.options.extent*Math.pow(2,$e-1)),Me=xr.within(Ir.x,Ir.y,Wr),Ye=[],Fe=0,At=Me;Fe<At.length;Fe+=1){var gt=At[Fe],Nt=xr.points[gt];Nt.parentId===qe&&Ye.push(Nt.numPoints?nr(Nt):this.points[Nt.index])}if(Ye.length===0)throw new Error(kt);return Ye},Ce.prototype.getLeaves=function(qe,pt,$e){pt=pt||10,$e=$e||0;var kt=[];return this._appendLeaves(kt,qe,pt,$e,0),kt},Ce.prototype.getTile=function(qe,pt,$e){var kt=this.trees[this._limitZoom(qe)],xr=Math.pow(2,qe),Ir=this.options,Wr=Ir.extent,Me=Ir.radius,Ye=Me/Wr,Fe=($e-Ye)/xr,At=($e+1+Ye)/xr,gt={features:[]};return this._addTileFeatures(kt.range((pt-Ye)/xr,Fe,(pt+1+Ye)/xr,At),kt.points,pt,$e,xr,gt),pt===0&&this._addTileFeatures(kt.range(1-Ye/xr,Fe,1,At),kt.points,xr,$e,xr,gt),pt===xr-1&&this._addTileFeatures(kt.range(0,Fe,Ye/xr,At),kt.points,-1,$e,xr,gt),gt.features.length?gt:null},Ce.prototype.getClusterExpansionZoom=function(qe){for(var pt=this._getOriginZoom(qe)-1;pt<=this.options.maxZoom;){var $e=this.getChildren(qe);if(pt++,$e.length!==1)break;qe=$e[0].properties.cluster_id}return pt},Ce.prototype._appendLeaves=function(qe,pt,$e,kt,xr){for(var Ir=this.getChildren(pt),Wr=0,Me=Ir;Wr<Me.length;Wr+=1){var Ye=Me[Wr],Fe=Ye.properties;if(Fe&&Fe.cluster?xr+Fe.point_count<=kt?xr+=Fe.point_count:xr=this._appendLeaves(qe,Fe.cluster_id,$e,kt,xr):xr<kt?xr++:qe.push(Ye),qe.length===$e)break}return xr},Ce.prototype._addTileFeatures=function(qe,pt,$e,kt,xr,Ir){for(var Wr=0,Me=qe;Wr<Me.length;Wr+=1){var Ye=Me[Wr],Fe=pt[Ye],At=Fe.numPoints,gt=void 0,Nt=void 0,qt=void 0;if(At)gt=xt(Fe),Nt=Fe.x,qt=Fe.y;else{var Cr=this.points[Fe.index];gt=Cr.properties,Nt=Wt(Cr.geometry.coordinates[0]),qt=wt(Cr.geometry.coordinates[1])}var Wn={type:1,geometry:[[Math.round(this.options.extent*(Nt*xr-$e)),Math.round(this.options.extent*(qt*xr-kt))]],tags:gt},hn=void 0;At?hn=Fe.id:this.options.generateId?hn=Fe.index:this.points[Fe.index].id&&(hn=this.points[Fe.index].id),hn!==void 0&&(Wn.id=hn),Ir.features.push(Wn)}},Ce.prototype._limitZoom=function(qe){return Math.max(this.options.minZoom,Math.min(+qe,this.options.maxZoom+1))},Ce.prototype._cluster=function(qe,pt){for(var $e=[],kt=this.options,xr=kt.radius,Ir=kt.extent,Wr=kt.reduce,Me=kt.minPoints,Ye=xr/(Ir*Math.pow(2,pt)),Fe=0;Fe<qe.length;Fe++){var At=qe[Fe];if(!(At.zoom<=pt)){At.zoom=pt;for(var gt=this.trees[pt+1],Nt=gt.within(At.x,At.y,Ye),qt=At.numPoints||1,Cr=qt,Wn=0,hn=Nt;Wn<hn.length;Wn+=1){var Yi=hn[Wn],Un=gt.points[Yi];Un.zoom>pt&&(Cr+=Un.numPoints||1)}if(Cr>qt&&Cr>=Me){for(var Gn=At.x*qt,di=At.y*qt,Xn=Wr&&qt>1?this._map(At,!0):null,ai=(Fe<<5)+(pt+1)+this.points.length,aa=0,Ri=Nt;aa<Ri.length;aa+=1){var Ei=Ri[aa],ji=gt.points[Ei];if(!(ji.zoom<=pt)){ji.zoom=pt;var ua=ji.numPoints||1;Gn+=ji.x*ua,di+=ji.y*ua,ji.parentId=ai,Wr&&(Xn||(Xn=this._map(At,!0)),Wr(Xn,this._map(ji)))}}At.parentId=ai,$e.push(et(Gn/Cr,di/Cr,ai,Cr,Xn))}else if($e.push(At),Cr>1)for(var Si=0,ba=Nt;Si<ba.length;Si+=1){var Mn=ba[Si],_i=gt.points[Mn];_i.zoom<=pt||(_i.zoom=pt,$e.push(_i))}}}return $e},Ce.prototype._getOriginId=function(qe){return qe-this.points.length>>5},Ce.prototype._getOriginZoom=function(qe){return(qe-this.points.length)%32},Ce.prototype._map=function(qe,pt){if(qe.numPoints)return pt?Jt({},qe.properties):qe.properties;var $e=this.points[qe.index].properties,kt=this.options.map($e);return pt&&kt===$e?Jt({},kt):kt};function et(vt,qe,pt,$e,kt){return{x:je(vt),y:je(qe),zoom:Infinity,id:pt,parentId:-1,numPoints:$e,properties:kt}}function Pt(vt,qe){var pt=vt.geometry.coordinates,$e=pt[0],kt=pt[1];return{x:je(Wt($e)),y:je(wt(kt)),zoom:Infinity,index:qe,parentId:-1}}function nr(vt){return{type:"Feature",id:vt.id,properties:xt(vt),geometry:{type:"Point",coordinates:[st(vt.x),ut(vt.y)]}}}function xt(vt){var qe=vt.numPoints,pt=qe>=1e4?Math.round(qe/1e3)+"k":qe>=1e3?Math.round(qe/100)/10+"k":qe;return Jt(Jt({},vt.properties),{cluster:!0,cluster_id:vt.id,point_count:qe,point_count_abbreviated:pt})}function Wt(vt){return vt/360+.5}function wt(vt){var qe=Math.sin(vt*Math.PI/180),pt=.5-.25*Math.log((1+qe)/(1-qe))/Math.PI;return pt<0?0:pt>1?1:pt}function st(vt){return(vt-.5)*360}function ut(vt){var qe=(180-vt*360)*Math.PI/180;return 360*Math.atan(Math.exp(qe))/Math.PI-90}function Jt(vt,qe){for(var pt in qe)vt[pt]=qe[pt];return vt}function X(vt){return vt.x}function Xt(vt){return vt.y}return Ce})},75752:function(Ue){Ue.exports.RADIUS=6378137,Ue.exports.FLATTENING=1/298.257223563,Ue.exports.POLAR_RADIUS=63567523142e-4}}]);
